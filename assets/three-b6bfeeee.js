var Bd=Object.defineProperty;var jd=(e,t,i)=>t in e?Bd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Zt=(e,t,i)=>(jd(e,typeof t!="symbol"?t+"":t,i),i);import{a9 as Oe,aa as ze,ab as Qh,ac as tn,ad as Ua,ae as Ud,h as rt,af as Vn,ag as me,ah as T,a6 as X,a8 as Ti,ai as Di,d as Jh,aj as Hn,ak as Ji,al as ec,am as Rd,k as ve,an as tc,B as er,ao as kd,ap as Fd,M as Ne,aq as Cs,ar as Je,as as hi,at as qt,au as tr,av as Gd,aw as Vd,ax as Hd,ay as Wd,S as qd,F as $d,az as Xd,aA as ic,aB as bo,aC as rc,aD as rn,aE as Yd,f as Kd,aF as Zd,aG as qr,aH as Ut,aI as Qd,aJ as Jd,aK as Ra,aL as ep,aM as tp,aN as Ps,aO as ip,L as rp,a4 as ka,i as sp,aP as op,aQ as np,aR as ap,a5 as bs,aS as Ts,aT as sc,a7 as Wn,aU as Es,aV as lp,aW as hp,aX as cp,aY as up,aZ as dp,a_ as pp,a3 as fp,a$ as mp,b0 as gp,b1 as oc,j as vp,c as nc,b2 as yp,P as bp,b3 as xp,b4 as wp,b5 as xo,b6 as _p,b7 as Sp,b8 as Ap,s as Op,C as Cp}from"./three.module-3e64dab6.js";import{c as Pp,a as Tp,b as Ep,r as Fa}from"./world-8aeda606.js";import{aJ as ac,H as Mp,A as Dp,n as Lp}from"./index-27e8f055.js";import{O as Ip}from"./OrbitControls-dfe0b90a.js";const zp=(e,t,i)=>{const r=new Ip(e,t);return i&&!(i!=null&&i.control)?(r.enabled=!1,r.stopListenToKeyEvents()):(r.enableDamping=(i==null?void 0:i.enableDamping)||!1,r.dampingFactor=(i==null?void 0:i.dampingFactor)||.01,r.listenToKeyEvents(window)),r};function Np(e,t=!1){const i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),o={},n={},h=e[0].morphTargetsRelative,a=new Oe;let c=0;for(let d=0;d<e.length;++d){const l=e[d];let u=0;if(i!==(l.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in l.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;o[p]===void 0&&(o[p]=[]),o[p].push(l.attributes[p]),u++}if(u!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(h!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in l.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;n[p]===void 0&&(n[p]=[]),n[p].push(l.morphAttributes[p])}if(t){let p;if(i)p=l.index.count;else if(l.attributes.position!==void 0)p=l.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;a.addGroup(c,p,d),c+=p}}if(i){let d=0;const l=[];for(let u=0;u<e.length;++u){const p=e[u].index;for(let f=0;f<p.count;++f)l.push(p.getX(f)+d);d+=e[u].attributes.position.count}a.setIndex(l)}for(const d in o){const l=Ga(o[d]);if(!l)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" attribute."),null;a.setAttribute(d,l)}for(const d in n){const l=n[d][0].length;if(l===0)break;a.morphAttributes=a.morphAttributes||{},a.morphAttributes[d]=[];for(let u=0;u<l;++u){const p=[];for(let g=0;g<n[d].length;++g)p.push(n[d][g][u]);const f=Ga(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" morphAttribute."),null;a.morphAttributes[d].push(f)}}return a}function Ga(e){let t,i,r,s=0;for(let h=0;h<e.length;++h){const a=e[h];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=a.array.constructor),t!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=a.normalized),r!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=a.array.length}const o=new t(s);let n=0;for(let h=0;h<e.length;++h)o.set(e[h].array,n),n+=e[h].array.length;return new ze(o,i,r)}function lc(e,t=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),Np(e,t)}const wo=new WeakMap;class Bp extends Qh{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,r,s){const o=new tn(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,n=>{this.parse(n,i,s)},r,s)}parse(t,i,r){this.decodeDracoFile(t,i,null,null,Ua).catch(r)}decodeDracoFile(t,i,r,s,o=Ud){const n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:o};return this.decodeGeometry(t,n).then(i)}decodeGeometry(t,i){const r=JSON.stringify(i);if(wo.has(t)){const a=wo.get(t);if(a.key===r)return a.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,n=t.byteLength,h=this._getWorker(o,n).then(a=>(s=a,new Promise((c,d)=>{s._callbacks[o]={resolve:c,reject:d},s.postMessage({type:"decode",id:o,taskConfig:i,buffer:t},[t])}))).then(a=>this._createGeometry(a.geometry));return h.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),wo.set(t,{key:r,promise:h}),h}_createGeometry(t){const i=new Oe;t.index&&i.setIndex(new ze(t.index.array,1));for(let r=0;r<t.attributes.length;r++){const s=t.attributes[r],o=s.name,n=s.array,h=s.itemSize,a=new ze(n,h);o==="color"&&this._assignVertexColorSpace(a,s.vertexColorSpace),i.setAttribute(o,a)}return i}_assignVertexColorSpace(t,i){if(i!==Ua)return;const r=new rt;for(let s=0,o=t.count;s<o;s++)r.fromBufferAttribute(t,s).convertSRGBToLinear(),t.setXYZ(s,r.r,r.g,r.b)}_loadLibrary(t,i){const r=new tn(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((s,o)=>{r.load(t,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{const s=r[0];t||(this.decoderConfig.wasmBinary=r[1]);const o=jp.toString(),n=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(t,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const n=o.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[t]=i,r._taskLoad+=i,r})}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function jp(){let e,t;onmessage=function(n){const h=n.data;switch(h.type){case"init":e=h.decoderConfig,t=new Promise(function(d){e.onModuleLoaded=function(l){d({draco:l})},DracoDecoderModule(e)});break;case"decode":const a=h.buffer,c=h.taskConfig;t.then(d=>{const l=d.draco,u=new l.Decoder;try{const p=i(l,u,new Int8Array(a),c),f=p.attributes.map(g=>g.array.buffer);p.index&&f.push(p.index.array.buffer),self.postMessage({type:"decode",id:h.id,geometry:p},f)}catch(p){console.error(p),self.postMessage({type:"error",id:h.id,error:p.message})}finally{l.destroy(u)}});break}};function i(n,h,a,c){const d=c.attributeIDs,l=c.attributeTypes;let u,p;const f=h.GetEncodedGeometryType(a);if(f===n.TRIANGULAR_MESH)u=new n.Mesh,p=h.DecodeArrayToMesh(a,a.byteLength,u);else if(f===n.POINT_CLOUD)u=new n.PointCloud,p=h.DecodeArrayToPointCloud(a,a.byteLength,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const g={index:null,attributes:[]};for(const v in d){const m=self[l[v]];let y,_;if(c.useUniqueIDs)_=d[v],y=h.GetAttributeByUniqueId(u,_);else{if(_=h.GetAttributeId(u,n[d[v]]),_===-1)continue;y=h.GetAttribute(u,_)}const x=s(n,h,u,v,m,y);v==="color"&&(x.vertexColorSpace=c.vertexColorSpace),g.attributes.push(x)}return f===n.TRIANGULAR_MESH&&(g.index=r(n,h,u)),n.destroy(u),g}function r(n,h,a){const d=a.num_faces()*3,l=d*4,u=n._malloc(l);h.GetTrianglesUInt32Array(a,l,u);const p=new Uint32Array(n.HEAPF32.buffer,u,d).slice();return n._free(u),{array:p,itemSize:1}}function s(n,h,a,c,d,l){const u=l.num_components(),f=a.num_points()*u,g=f*d.BYTES_PER_ELEMENT,v=o(n,d),m=n._malloc(g);h.GetAttributeDataArrayForAllPoints(a,l,v,g,m);const y=new d(n.HEAPF32.buffer,m,f).slice();return n._free(m),{name:c,array:y,itemSize:u}}function o(n,h){switch(h){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}var Up=Object.create,qn=Object.defineProperty,Rp=Object.getOwnPropertyDescriptor,kp=Object.getOwnPropertyNames,Fp=Object.getPrototypeOf,Gp=Object.prototype.hasOwnProperty,eo=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Vp=(e,t)=>{for(var i in t)qn(e,i,{get:t[i],enumerable:!0})},Hp=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of kp(t))!Gp.call(e,s)&&s!==i&&qn(e,s,{get:()=>t[s],enumerable:!(r=Rp(t,s))||r.enumerable});return e},to=(e,t,i)=>(i=e!=null?Up(Fp(e)):{},Hp(t||!e||!e.__esModule?qn(i,"default",{value:e,enumerable:!0}):i,e)),Wp=eo((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(s){var o=new i;return o.importState(s),o},i;function i(){return function(s){var o=0,n=0,h=0,a=1;s.length==0&&(s=[+new Date]);var c=r();o=c(" "),n=c(" "),h=c(" ");for(var d=0;d<s.length;d++)o-=c(s[d]),o<0&&(o+=1),n-=c(s[d]),n<0&&(n+=1),h-=c(s[d]),h<0&&(h+=1);c=null;var l=function(){var u=2091639*o+a*23283064365386963e-26;return o=n,n=h,h=u-(a=u|0)};return l.next=l,l.uint32=function(){return l()*4294967296},l.fract53=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.version="Alea 0.9",l.args=s,l.exportState=function(){return[o,n,h,a]},l.importState=function(u){o=+u[0]||0,n=+u[1]||0,h=+u[2]||0,a=+u[3]||0},l}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,o=function(n){n=n.toString();for(var h=0;h<n.length;h++){s+=n.charCodeAt(h);var a=.02519603282416938*s;s=a>>>0,a-=s,a*=s,s=a>>>0,a-=s,s+=a*4294967296}return(s>>>0)*23283064365386963e-26};return o.version="Mash 0.9",o}})}),qp=eo((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,s,o,n,h){if(s=s===void 0||s,o=o===void 0||o,h=1e-64/(n=n||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var a,c,d,l,u,p,f,g,v,m,y,_,x=r[0].length,S=r.length;if(S<x)throw new TypeError("Invalid matrix: m < n");for(var b=[],A=[],O=[],P=s==="f"?S:x,w=m=f=0;w<S;w++)A[w]=new Array(P).fill(0);for(w=0;w<x;w++)O[w]=new Array(x).fill(0);var C,M=new Array(x).fill(0);for(w=0;w<S;w++)for(a=0;a<x;a++)A[w][a]=r[w][a];for(w=0;w<x;w++){for(b[w]=f,v=0,d=w+1,a=w;a<S;a++)v+=Math.pow(A[a][w],2);if(v<h)f=0;else for(g=(p=A[w][w])*(f=p<0?Math.sqrt(v):-Math.sqrt(v))-v,A[w][w]=p-f,a=d;a<x;a++){for(v=0,c=w;c<S;c++)v+=A[c][w]*A[c][a];for(p=v/g,c=w;c<S;c++)A[c][a]=A[c][a]+p*A[c][w]}for(M[w]=f,v=0,a=d;a<x;a++)v+=Math.pow(A[w][a],2);if(v<h)f=0;else{for(g=(p=A[w][w+1])*(f=p<0?Math.sqrt(v):-Math.sqrt(v))-v,A[w][w+1]=p-f,a=d;a<x;a++)b[a]=A[w][a]/g;for(a=d;a<S;a++){for(v=0,c=d;c<x;c++)v+=A[a][c]*A[w][c];for(c=d;c<x;c++)A[a][c]=A[a][c]+v*b[c]}}m<(y=Math.abs(M[w])+Math.abs(b[w]))&&(m=y)}if(o)for(w=x-1;0<=w;w--){if(f!==0){for(g=A[w][w+1]*f,a=d;a<x;a++)O[a][w]=A[w][a]/g;for(a=d;a<x;a++){for(v=0,c=d;c<x;c++)v+=A[w][c]*O[c][a];for(c=d;c<x;c++)O[c][a]=O[c][a]+v*O[c][w]}}for(a=d;a<x;a++)O[w][a]=0,O[a][w]=0;O[w][w]=1,f=b[w],d=w}if(s){if(s==="f")for(w=x;w<S;w++){for(a=x;a<S;a++)A[w][a]=0;A[w][w]=1}for(w=x-1;0<=w;w--){for(d=w+1,f=M[w],a=d;a<P;a++)A[w][a]=0;if(f!==0){for(g=A[w][w]*f,a=d;a<P;a++){for(v=0,c=d;c<S;c++)v+=A[c][w]*A[c][a];for(p=v/g,c=w;c<S;c++)A[c][a]=A[c][a]+p*A[c][w]}for(a=w;a<S;a++)A[a][w]=A[a][w]/f}else for(a=w;a<S;a++)A[a][w]=0;A[w][w]=A[w][w]+1}}for(n*=m,c=x-1;0<=c;c--)for(var z=0;z<50;z++){for(C=!1,d=c;0<=d;d--){if(Math.abs(b[d])<=n){C=!0;break}if(Math.abs(M[d-1])<=n)break}if(!C){for(u=0,l=d-(v=1),w=d;w<c+1&&(p=v*b[w],b[w]=u*b[w],!(Math.abs(p)<=n));w++)if(f=M[w],M[w]=Math.sqrt(p*p+f*f),u=f/(g=M[w]),v=-p/g,s)for(a=0;a<S;a++)y=A[a][l],_=A[a][w],A[a][l]=y*u+_*v,A[a][w]=-y*v+_*u}if(_=M[c],d===c){if(_<0&&(M[c]=-_,o))for(a=0;a<x;a++)O[a][c]=-O[a][c];break}for(m=M[d],p=(((y=M[c-1])-_)*(y+_)+((f=b[c-1])-(g=b[c]))*(f+g))/(2*g*y),f=Math.sqrt(p*p+1),p=((m-_)*(m+_)+g*(y/(p<0?p-f:p+f)-g))/m,w=d+(v=u=1);w<c+1;w++){if(f=b[w],y=M[w],g=v*f,f*=u,_=Math.sqrt(p*p+g*g),p=m*(u=p/(b[w-1]=_))+f*(v=g/_),f=-m*v+f*u,g=y*v,y*=u,o)for(a=0;a<x;a++)m=O[a][w-1],_=O[a][w],O[a][w-1]=m*u+_*v,O[a][w]=-m*v+_*u;if(_=Math.sqrt(p*p+g*g),p=(u=p/(M[w-1]=_))*f+(v=g/_)*y,m=-v*f+u*y,s)for(a=0;a<S;a++)y=A[a][w-1],_=A[a][w],A[a][w-1]=y*u+_*v,A[a][w]=-y*v+_*u}b[d]=0,b[c]=p,M[c]=m}for(w=0;w<x;w++)M[w]<n&&(M[w]=0);return{u:A,q:M,v:O}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),$p=eo(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||i;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var u=this||i;if(l=parseFloat(l),u.ctx||d(),typeof l<"u"&&l>=0&&l<=1){if(u._volume=l,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(l,i.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var f=u._howls[p]._getSoundIds(),g=0;g<f.length;g++){var v=u._howls[p]._soundById(f[g]);v&&v._node&&(v._node.volume=v._volume*l)}return u}return u._volume},mute:function(l){var u=this||i;u.ctx||d(),u._muted=l,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(l?0:u._volume,i.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var f=u._howls[p]._getSoundIds(),g=0;g<f.length;g++){var v=u._howls[p]._soundById(f[g]);v&&v._node&&(v._node.muted=l?!0:v._muted)}return u},stop:function(){for(var l=this||i,u=0;u<l._howls.length;u++)l._howls[u].stop();return l},unload:function(){for(var l=this||i,u=l._howls.length-1;u>=0;u--)l._howls[u].unload();return l.usingWebAudio&&l.ctx&&typeof l.ctx.close<"u"&&(l.ctx.close(),l.ctx=null,d()),l},codecs:function(l){return(this||i)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||i;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var u=new Audio;u.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||i,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return l}if(!u||typeof u.canPlayType!="function")return l;var p=u.canPlayType("audio/mpeg;").replace(/^no$/,""),f=l._navigator?l._navigator.userAgent:"",g=f.match(/OPR\/([0-6].)/g),v=g&&parseInt(g[0].split("/")[1],10)<33,m=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),_=m&&y&&parseInt(y[1],10)<15;return l._codecs={mp3:!!(!v&&(p||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!_&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!_&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||i;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,!l._mobileUnloaded&&l.ctx.sampleRate!==44100&&(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var u=function(p){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,l._releaseHtml5Audio(f)}catch{l.noAudio=!0;break}for(var g=0;g<l._howls.length;g++)if(!l._howls[g]._webAudio)for(var v=l._howls[g]._getSoundIds(),m=0;m<v.length;m++){var y=l._howls[g]._soundById(v[m]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}l._autoResume();var _=l.ctx.createBufferSource();_.buffer=l._scratchBuffer,_.connect(l.ctx.destination),typeof _.start>"u"?_.noteOn(0):_.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),_.onended=function(){_.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var x=0;x<l._howls.length;x++)l._howls[x]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),l}},_obtainHtml5Audio:function(){var l=this||i;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var u=this||i;return l._unlocked&&u._html5AudioPool.push(l),u},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend>"u"||!i.usingWebAudio)){for(var u=0;u<l._howls.length;u++)if(l._howls[u]._webAudio){for(var p=0;p<l._howls[u]._sounds.length;p++)if(!l._howls[u]._sounds[p]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var f=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(f,f)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume>"u"||!i.usingWebAudio))return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var u=0;u<l._howls.length;u++)l._howls[u]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var i=new t,r=function(l){var u=this;if(!l.src||l.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(l)};r.prototype={init:function(l){var u=this;return i.ctx||d(),u._autoplay=l.autoplay||!1,u._format=typeof l.format!="string"?l.format:[l.format],u._html5=l.html5||!1,u._muted=l.mute||!1,u._loop=l.loop||!1,u._pool=l.pool||5,u._preload=typeof l.preload=="boolean"||l.preload==="metadata"?l.preload:!0,u._rate=l.rate||1,u._sprite=l.sprite||{},u._src=typeof l.src!="string"?l.src:[l.src],u._volume=l.volume!==void 0?l.volume:1,u._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:l.xhr&&l.xhr.withCredentials?l.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=l.onend?[{fn:l.onend}]:[],u._onfade=l.onfade?[{fn:l.onfade}]:[],u._onload=l.onload?[{fn:l.onload}]:[],u._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],u._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],u._onpause=l.onpause?[{fn:l.onpause}]:[],u._onplay=l.onplay?[{fn:l.onplay}]:[],u._onstop=l.onstop?[{fn:l.onstop}]:[],u._onmute=l.onmute?[{fn:l.onmute}]:[],u._onvolume=l.onvolume?[{fn:l.onvolume}]:[],u._onrate=l.onrate?[{fn:l.onrate}]:[],u._onseek=l.onseek?[{fn:l.onseek}]:[],u._onunlock=l.onunlock?[{fn:l.onunlock}]:[],u._onresume=[],u._webAudio=i.usingWebAudio&&!u._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var l=this,u=null;if(i.noAudio){l._emit("loaderror",null,"No audio support.");return}typeof l._src=="string"&&(l._src=[l._src]);for(var p=0;p<l._src.length;p++){var f,g;if(l._format&&l._format[p])f=l._format[p];else{if(g=l._src[p],typeof g!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(g),f||(f=/\.([^.]+)$/.exec(g.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){u=l._src[p];break}}if(!u){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=u,l._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new s(l),l._webAudio&&n(l),l},play:function(l,u){var p=this,f=null;if(typeof l=="number")f=l,l=null;else{if(typeof l=="string"&&p._state==="loaded"&&!p._sprite[l])return null;if(typeof l>"u"&&(l="__default",!p._playLock)){for(var g=0,v=0;v<p._sounds.length;v++)p._sounds[v]._paused&&!p._sounds[v]._ended&&(g++,f=p._sounds[v]._id);g===1?l=null:f=null}}var m=f?p._soundById(f):p._inactiveSound();if(!m)return null;if(f&&!l&&(l=m._sprite||"__default"),p._state!=="loaded"){m._sprite=l,m._ended=!1;var y=m._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!m._paused)return u||p._loadQueue("play"),m._id;p._webAudio&&i._autoResume();var _=Math.max(0,m._seek>0?m._seek:p._sprite[l][0]/1e3),x=Math.max(0,(p._sprite[l][0]+p._sprite[l][1])/1e3-_),S=x*1e3/Math.abs(m._rate),b=p._sprite[l][0]/1e3,A=(p._sprite[l][0]+p._sprite[l][1])/1e3;m._sprite=l,m._ended=!1;var O=function(){m._paused=!1,m._seek=_,m._start=b,m._stop=A,m._loop=!!(m._loop||p._sprite[l][2])};if(_>=A){p._ended(m);return}var P=m._node;if(p._webAudio){var w=function(){p._playLock=!1,O(),p._refreshBuffer(m);var W=m._muted||p._muted?0:m._volume;P.gain.setValueAtTime(W,i.ctx.currentTime),m._playStart=i.ctx.currentTime,typeof P.bufferSource.start>"u"?m._loop?P.bufferSource.noteGrainOn(0,_,86400):P.bufferSource.noteGrainOn(0,_,x):m._loop?P.bufferSource.start(0,_,86400):P.bufferSource.start(0,_,x),S!==1/0&&(p._endTimers[m._id]=setTimeout(p._ended.bind(p,m),S)),u||setTimeout(function(){p._emit("play",m._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?w():(p._playLock=!0,p.once("resume",w),p._clearTimer(m._id))}else{var C=function(){P.currentTime=_,P.muted=m._muted||p._muted||i._muted||P.muted,P.volume=m._volume*i.volume(),P.playbackRate=m._rate;try{var W=P.play();if(W&&typeof Promise<"u"&&(W instanceof Promise||typeof W.then=="function")?(p._playLock=!0,O(),W.then(function(){p._playLock=!1,P._unlocked=!0,u?p._loadQueue():p._emit("play",m._id)}).catch(function(){p._playLock=!1,p._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):u||(p._playLock=!1,O(),p._emit("play",m._id)),P.playbackRate=m._rate,P.paused){p._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}l!=="__default"||m._loop?p._endTimers[m._id]=setTimeout(p._ended.bind(p,m),S):(p._endTimers[m._id]=function(){p._ended(m),P.removeEventListener("ended",p._endTimers[m._id],!1)},P.addEventListener("ended",p._endTimers[m._id],!1))}catch(Q){p._emit("playerror",m._id,Q)}};P.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(P.src=p._src,P.load());var M=window&&window.ejecta||!P.readyState&&i._navigator.isCocoonJS;if(P.readyState>=3||M)C();else{p._playLock=!0,p._state="loading";var z=function(){p._state="loaded",C(),P.removeEventListener(i._canPlayEvent,z,!1)};P.addEventListener(i._canPlayEvent,z,!1),p._clearTimer(m._id)}}return m._id},pause:function(l){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(l)}}),u;for(var p=u._getSoundIds(l),f=0;f<p.length;f++){u._clearTimer(p[f]);var g=u._soundById(p[f]);if(g&&!g._paused&&(g._seek=u.seek(p[f]),g._rateSeek=0,g._paused=!0,u._stopFade(p[f]),g._node))if(u._webAudio){if(!g._node.bufferSource)continue;typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),u._cleanBuffer(g._node)}else(!isNaN(g._node.duration)||g._node.duration===1/0)&&g._node.pause();arguments[1]||u._emit("pause",g?g._id:null)}return u},stop:function(l,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(l)}}),p;for(var f=p._getSoundIds(l),g=0;g<f.length;g++){p._clearTimer(f[g]);var v=p._soundById(f[g]);v&&(v._seek=v._start||0,v._rateSeek=0,v._paused=!0,v._ended=!0,p._stopFade(f[g]),v._node&&(p._webAudio?v._node.bufferSource&&(typeof v._node.bufferSource.stop>"u"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),p._cleanBuffer(v._node)):(!isNaN(v._node.duration)||v._node.duration===1/0)&&(v._node.currentTime=v._start||0,v._node.pause(),v._node.duration===1/0&&p._clearSound(v._node))),u||p._emit("stop",v._id))}return p},mute:function(l,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(l,u)}}),p;if(typeof u>"u")if(typeof l=="boolean")p._muted=l;else return p._muted;for(var f=p._getSoundIds(u),g=0;g<f.length;g++){var v=p._soundById(f[g]);v&&(v._muted=l,v._interval&&p._stopFade(v._id),p._webAudio&&v._node?v._node.gain.setValueAtTime(l?0:v._volume,i.ctx.currentTime):v._node&&(v._node.muted=i._muted?!0:l),p._emit("mute",v._id))}return p},volume:function(){var l=this,u=arguments,p,f;if(u.length===0)return l._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var g=l._getSoundIds(),v=g.indexOf(u[0]);v>=0?f=parseInt(u[0],10):p=parseFloat(u[0])}else u.length>=2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));var m;if(typeof p<"u"&&p>=0&&p<=1){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,u)}}),l;typeof f>"u"&&(l._volume=p),f=l._getSoundIds(f);for(var y=0;y<f.length;y++)m=l._soundById(f[y]),m&&(m._volume=p,u[2]||l._stopFade(f[y]),l._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(p,i.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=p*i.volume()),l._emit("volume",m._id))}else return m=f?l._soundById(f):l._sounds[0],m?m._volume:0;return l},fade:function(l,u,p,f){var g=this;if(g._state!=="loaded"||g._playLock)return g._queue.push({event:"fade",action:function(){g.fade(l,u,p,f)}}),g;l=Math.min(Math.max(0,parseFloat(l)),1),u=Math.min(Math.max(0,parseFloat(u)),1),p=parseFloat(p),g.volume(l,f);for(var v=g._getSoundIds(f),m=0;m<v.length;m++){var y=g._soundById(v[m]);if(y){if(f||g._stopFade(v[m]),g._webAudio&&!y._muted){var _=i.ctx.currentTime,x=_+p/1e3;y._volume=l,y._node.gain.setValueAtTime(l,_),y._node.gain.linearRampToValueAtTime(u,x)}g._startFadeInterval(y,l,u,p,v[m],typeof f>"u")}}return g},_startFadeInterval:function(l,u,p,f,g,v){var m=this,y=u,_=p-u,x=Math.abs(_/.01),S=Math.max(4,x>0?f/x:f),b=Date.now();l._fadeTo=p,l._interval=setInterval(function(){var A=(Date.now()-b)/f;b=Date.now(),y+=_*A,y=Math.round(y*100)/100,_<0?y=Math.max(p,y):y=Math.min(p,y),m._webAudio?l._volume=y:m.volume(y,l._id,!0),v&&(m._volume=y),(p<u&&y<=p||p>u&&y>=p)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,m.volume(p,l._id),m._emit("fade",l._id))},S)},_stopFade:function(l){var u=this,p=u._soundById(l);return p&&p._interval&&(u._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,u.volume(p._fadeTo,l),p._fadeTo=null,u._emit("fade",l)),u},loop:function(){var l=this,u=arguments,p,f,g;if(u.length===0)return l._loop;if(u.length===1)if(typeof u[0]=="boolean")p=u[0],l._loop=p;else return g=l._soundById(parseInt(u[0],10)),g?g._loop:!1;else u.length===2&&(p=u[0],f=parseInt(u[1],10));for(var v=l._getSoundIds(f),m=0;m<v.length;m++)g=l._soundById(v[m]),g&&(g._loop=p,l._webAudio&&g._node&&g._node.bufferSource&&(g._node.bufferSource.loop=p,p&&(g._node.bufferSource.loopStart=g._start||0,g._node.bufferSource.loopEnd=g._stop,l.playing(v[m])&&(l.pause(v[m],!0),l.play(v[m],!0)))));return l},rate:function(){var l=this,u=arguments,p,f;if(u.length===0)f=l._sounds[0]._id;else if(u.length===1){var g=l._getSoundIds(),v=g.indexOf(u[0]);v>=0?f=parseInt(u[0],10):p=parseFloat(u[0])}else u.length===2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));var m;if(typeof p=="number"){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,u)}}),l;typeof f>"u"&&(l._rate=p),f=l._getSoundIds(f);for(var y=0;y<f.length;y++)if(m=l._soundById(f[y]),m){l.playing(f[y])&&(m._rateSeek=l.seek(f[y]),m._playStart=l._webAudio?i.ctx.currentTime:m._playStart),m._rate=p,l._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):m._node&&(m._node.playbackRate=p);var _=l.seek(f[y]),x=(l._sprite[m._sprite][0]+l._sprite[m._sprite][1])/1e3-_,S=x*1e3/Math.abs(m._rate);(l._endTimers[f[y]]||!m._paused)&&(l._clearTimer(f[y]),l._endTimers[f[y]]=setTimeout(l._ended.bind(l,m),S)),l._emit("rate",m._id)}}else return m=l._soundById(f),m?m._rate:l._rate;return l},seek:function(){var l=this,u=arguments,p,f;if(u.length===0)l._sounds.length&&(f=l._sounds[0]._id);else if(u.length===1){var g=l._getSoundIds(),v=g.indexOf(u[0]);v>=0?f=parseInt(u[0],10):l._sounds.length&&(f=l._sounds[0]._id,p=parseFloat(u[0]))}else u.length===2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));if(typeof f>"u")return 0;if(typeof p=="number"&&(l._state!=="loaded"||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,u)}}),l;var m=l._soundById(f);if(m)if(typeof p=="number"&&p>=0){var y=l.playing(f);y&&l.pause(f,!0),m._seek=p,m._ended=!1,l._clearTimer(f),!l._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=p);var _=function(){y&&l.play(f,!0),l._emit("seek",f)};if(y&&!l._webAudio){var x=function(){l._playLock?setTimeout(x,0):_()};setTimeout(x,0)}else _()}else if(l._webAudio){var S=l.playing(f)?i.ctx.currentTime-m._playStart:0,b=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(b+S*Math.abs(m._rate))}else return m._node.currentTime;return l},playing:function(l){var u=this;if(typeof l=="number"){var p=u._soundById(l);return p?!p._paused:!1}for(var f=0;f<u._sounds.length;f++)if(!u._sounds[f]._paused)return!0;return!1},duration:function(l){var u=this,p=u._duration,f=u._soundById(l);return f&&(p=u._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var l=this,u=l._sounds,p=0;p<u.length;p++)u[p]._paused||l.stop(u[p]._id),l._webAudio||(l._clearSound(u[p]._node),u[p]._node.removeEventListener("error",u[p]._errorFn,!1),u[p]._node.removeEventListener(i._canPlayEvent,u[p]._loadFn,!1),u[p]._node.removeEventListener("ended",u[p]._endFn,!1),i._releaseHtml5Audio(u[p]._node)),delete u[p]._node,l._clearTimer(u[p]._id);var f=i._howls.indexOf(l);f>=0&&i._howls.splice(f,1);var g=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===l._src||l._src.indexOf(i._howls[p]._src)>=0){g=!1;break}return o&&g&&delete o[l._src],i.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,u,p,f){var g=this,v=g["_on"+l];return typeof u=="function"&&v.push(f?{id:p,fn:u,once:f}:{id:p,fn:u}),g},off:function(l,u,p){var f=this,g=f["_on"+l],v=0;if(typeof u=="number"&&(p=u,u=null),u||p)for(v=0;v<g.length;v++){var m=p===g[v].id;if(u===g[v].fn&&m||!u&&m){g.splice(v,1);break}}else if(l)f["_on"+l]=[];else{var y=Object.keys(f);for(v=0;v<y.length;v++)y[v].indexOf("_on")===0&&Array.isArray(f[y[v]])&&(f[y[v]]=[])}return f},once:function(l,u,p){var f=this;return f.on(l,u,p,1),f},_emit:function(l,u,p){for(var f=this,g=f["_on"+l],v=g.length-1;v>=0;v--)(!g[v].id||g[v].id===u||l==="load")&&(setTimeout(function(m){m.call(this,u,p)}.bind(f,g[v].fn),0),g[v].once&&f.off(l,g[v].fn,g[v].id));return f._loadQueue(l),f},_loadQueue:function(l){var u=this;if(u._queue.length>0){var p=u._queue[0];p.event===l&&(u._queue.shift(),u._loadQueue()),l||p.action()}return u},_ended:function(l){var u=this,p=l._sprite;if(!u._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(u._ended.bind(u,l),100),u;var f=!!(l._loop||u._sprite[p][2]);if(u._emit("end",l._id),!u._webAudio&&f&&u.stop(l._id,!0).play(l._id),u._webAudio&&f){u._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=i.ctx.currentTime;var g=(l._stop-l._start)*1e3/Math.abs(l._rate);u._endTimers[l._id]=setTimeout(u._ended.bind(u,l),g)}return u._webAudio&&!f&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,u._clearTimer(l._id),u._cleanBuffer(l._node),i._autoSuspend()),!u._webAudio&&!f&&u.stop(l._id,!0),u},_clearTimer:function(l){var u=this;if(u._endTimers[l]){if(typeof u._endTimers[l]!="function")clearTimeout(u._endTimers[l]);else{var p=u._soundById(l);p&&p._node&&p._node.removeEventListener("ended",u._endTimers[l],!1)}delete u._endTimers[l]}return u},_soundById:function(l){for(var u=this,p=0;p<u._sounds.length;p++)if(l===u._sounds[p]._id)return u._sounds[p];return null},_inactiveSound:function(){var l=this;l._drain();for(var u=0;u<l._sounds.length;u++)if(l._sounds[u]._ended)return l._sounds[u].reset();return new s(l)},_drain:function(){var l=this,u=l._pool,p=0,f=0;if(!(l._sounds.length<u)){for(f=0;f<l._sounds.length;f++)l._sounds[f]._ended&&p++;for(f=l._sounds.length-1;f>=0;f--){if(p<=u)return;l._sounds[f]._ended&&(l._webAudio&&l._sounds[f]._node&&l._sounds[f]._node.disconnect(0),l._sounds.splice(f,1),p--)}}},_getSoundIds:function(l){var u=this;if(typeof l>"u"){for(var p=[],f=0;f<u._sounds.length;f++)p.push(u._sounds[f]._id);return p}else return[l]},_refreshBuffer:function(l){var u=this;return l._node.bufferSource=i.ctx.createBufferSource(),l._node.bufferSource.buffer=o[u._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,i.ctx.currentTime),u},_cleanBuffer:function(l){var u=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),p))try{l.bufferSource.buffer=i._scratchBuffer}catch{}return l.bufferSource=null,u},_clearSound:function(l){var u=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);u||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(l){this._parent=l,this.init()};s.prototype={init:function(){var l=this,u=l._parent;return l._muted=u._muted,l._loop=u._loop,l._volume=u._volume,l._rate=u._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++i._counter,u._sounds.push(l),l.create(),l},create:function(){var l=this,u=l._parent,p=i._muted||l._muted||l._parent._muted?0:l._volume;return u._webAudio?(l._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),l._node.gain.setValueAtTime(p,i.ctx.currentTime),l._node.paused=!0,l._node.connect(i.masterGain)):i.noAudio||(l._node=i._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(i._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=u._src,l._node.preload=u._preload===!0?"auto":u._preload,l._node.volume=p*i.volume(),l._node.load()),l},reset:function(){var l=this,u=l._parent;return l._muted=u._muted,l._loop=u._loop,l._volume=u._volume,l._rate=u._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++i._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,u=l._parent;u._duration=Math.ceil(l._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),l._node.removeEventListener(i._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,u=l._parent;u._duration===1/0&&(u._duration=Math.ceil(l._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var o={},n=function(l){var u=l._src;if(o[u]){l._duration=o[u].duration,c(l);return}if(/^data:[^;]+;base64,/.test(u)){for(var p=atob(u.split(",")[1]),f=new Uint8Array(p.length),g=0;g<p.length;++g)f[g]=p.charCodeAt(g);a(f.buffer,l)}else{var v=new XMLHttpRequest;v.open(l._xhr.method,u,!0),v.withCredentials=l._xhr.withCredentials,v.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(m){v.setRequestHeader(m,l._xhr.headers[m])}),v.onload=function(){var m=(v.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){l._emit("loaderror",null,"Failed loading audio file with status: "+v.status+".");return}a(v.response,l)},v.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete o[u],l.load())},h(v)}},h=function(l){try{l.send()}catch{l.onerror()}},a=function(l,u){var p=function(){u._emit("loaderror",null,"Decoding audio data failed.")},f=function(g){g&&u._sounds.length>0?(o[u._src]=g,c(u,g)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(l).then(f).catch(p):i.ctx.decodeAudioData(l,f,p)},c=function(l,u){u&&!l._duration&&(l._duration=u.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},d=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),u=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=u?parseInt(u[1],10):null;if(l&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof e<"u"&&(e.Howler=i,e.Howl=r),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=i,global.Howl=r,global.Sound=s):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=r,window.Sound=s)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,s){var o=this;if(!o.ctx||!o.ctx.listener)return o;if(r=typeof r!="number"?o._pos[1]:r,s=typeof s!="number"?o._pos[2]:s,typeof i=="number")o._pos=[i,r,s],typeof o.ctx.listener.positionX<"u"?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]);else return o._pos;return o},HowlerGlobal.prototype.orientation=function(i,r,s,o,n,h){var a=this;if(!a.ctx||!a.ctx.listener)return a;var c=a._orientation;if(r=typeof r!="number"?c[1]:r,s=typeof s!="number"?c[2]:s,o=typeof o!="number"?c[3]:o,n=typeof n!="number"?c[4]:n,h=typeof h!="number"?c[5]:h,typeof i=="number")a._orientation=[i,r,s,o,n,h],typeof a.ctx.listener.forwardX<"u"?(a.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(i,r,s,o,n,h);else return c;return a},Howl.prototype.init=function(i){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(i,r)}}),s;var o=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")s._stereo=i,s._pos=[i,0,0];else return s._stereo;for(var n=s._getSoundIds(r),h=0;h<n.length;h++){var a=s._soundById(n[h]);if(a)if(typeof i=="number")a._stereo=i,a._pos=[i,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",(!a._panner||!a._panner.pan)&&t(a,o),o==="spatial"?typeof a._panner.positionX<"u"?(a._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(i,0,0):a._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),s._emit("stereo",a._id);else return a._stereo}return s},Howl.prototype.pos=function(i,r,s,o){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"pos",action:function(){n.pos(i,r,s,o)}}),n;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof o>"u")if(typeof i=="number")n._pos=[i,r,s];else return n._pos;for(var h=n._getSoundIds(o),a=0;a<h.length;a++){var c=n._soundById(h[a]);if(c)if(typeof i=="number")c._pos=[i,r,s],c._node&&((!c._panner||c._panner.pan)&&t(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):c._panner.setPosition(i,r,s)),n._emit("pos",c._id);else return c._pos}return n},Howl.prototype.orientation=function(i,r,s,o){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"orientation",action:function(){n.orientation(i,r,s,o)}}),n;if(r=typeof r!="number"?n._orientation[1]:r,s=typeof s!="number"?n._orientation[2]:s,typeof o>"u")if(typeof i=="number")n._orientation=[i,r,s];else return n._orientation;for(var h=n._getSoundIds(o),a=0;a<h.length;a++){var c=n._soundById(h[a]);if(c)if(typeof i=="number")c._orientation=[i,r,s],c._node&&(c._panner||(c._pos||(c._pos=n._pos||[0,0,-.5]),t(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):c._panner.setOrientation(i,r,s)),n._emit("orientation",c._id);else return c._orientation}return n},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,s,o,n;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof o>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),i._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:i._panningModel});else return n=i._soundById(parseInt(r[0],10)),n?n._pannerAttr:i._pannerAttr;else r.length===2&&(s=r[0],o=parseInt(r[1],10));for(var h=i._getSoundIds(o),a=0;a<h.length;a++)if(n=i._soundById(h[a]),n){var c=n._pannerAttr;c={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:c.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:c.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:c.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:c.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:c.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:c.panningModel};var d=n._panner;d?(d.coneInnerAngle=c.coneInnerAngle,d.coneOuterAngle=c.coneOuterAngle,d.coneOuterGain=c.coneOuterGain,d.distanceModel=c.distanceModel,d.maxDistance=c.maxDistance,d.refDistance=c.refDistance,d.rolloffFactor=c.rolloffFactor,d.panningModel=c.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,i.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var t=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),Xp=eo((e,t)=>{t.exports=function(i,r){for(var s=i.split("."),o=r.split("."),n=0;n<3;n++){var h=Number(s[n]),a=Number(o[n]);if(h>a)return 1;if(a>h)return-1;if(!isNaN(h)&&isNaN(a))return 1;if(isNaN(h)&&!isNaN(a))return-1}return 0}}),ke=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,ke.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:s,data:o}=e,n={...t,[s]:o};return Object.setPrototypeOf(n,ke.prototype),{data:n,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let s={...t};return Object.setPrototypeOf(s,ke.prototype),delete s[i],{data:s,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function $n(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&$n(r)}return Object.freeze(e)}function Yp(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var hc=class extends Error{};function _o(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function ii(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let o=e;e=t,t=o}let r=[],s=1/(i+1);for(let o=0;o<i;o++){let n=e+(t-e)*(o+.75+Math.random()*.5)*s;r.push(n)}return r}function Xn(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function Kp(){return typeof process<"u"}function cc(e,t){for(let i of e)t(i.id,i.data)!==!0&&cc(i.children,t)}function uc(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)uc(i,t)}var At=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,At.prototype)}deepFreeze(){let e=0;for(;e<this.length;)$n(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&uc(i,t)}}traverse(e){cc(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),s=r.findIndex(n=>n.id===e);if(s<0)throw new Error("not expected");let o=r[s];return r=[...r],r[s]={...o,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let o=r,n=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let h=r.findIndex(a=>a.id===n);if(h<0)throw new Error;r=[...r],r[h]={...r[h],children:o}}Object.setPrototypeOf(r,At.prototype);let s=r;return s.fillCaches(),s}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:s,children:o}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let n=t,h=this.childrenArray(n),a={fi:i,id:r,data:s,children:o};return h=[...h,a],h.sort((c,d)=>c.fi-d.fi),e.localIndex=h.indexOf(a),{data:this.modifyArrayBy(n,h),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),s=r.findIndex(n=>n.id===t);e.localIndex=s,r=[...r];let o=r.splice(s,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...o,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let l=t;for(;l!==null;){if(l===void 0)throw new Error;if(l===r)throw new hc("cyclic tree");l=this.parent(l)}}let s=this.parent(r);if(s===void 0)return null;let o=s,n=this.childrenArray(s),h=n.findIndex(l=>l.id===r);n=[...n];let a=n.splice(h,1)[0],c=this.modifyArrayBy(s,n);s=t,n=c.childrenArray(s);let d=a.fi;return a={...a,fi:i},n=[...n,a],n.sort((l,u)=>l.fi-u.fi),e.localIndex=n.indexOf(a),c=c.modifyArrayBy(s,n),{data:c,actual:e,reverse:{type:9,parent:o,fi:d,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(s=>s.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(s=>s.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>Yp(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),s=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...s,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return ii(0,i,i);{let s=r[0].fi;return ii(s-i,s,i)}}else{let s=this.get(t);if(s===void 0||this.parent(t)!==e)throw new Error("illegal args");let o=r.find(n=>n.fi>s.fi);if(o===void 0){let n=r[r.length-1].fi;return ii(n,n+i,i)}else return ii(s.fi,o.fi,i)}}},Ms;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let s=r.props,o={},n=[...i],h=!1;if(s)for(let a of Object.keys(s)){let c=parseInt(a);if(isNaN(c))throw new Error("wrong index");o[a]=n[c],n[c]=s[a],h=!0}return h?{data:n,actual:r,reverse:{type:0,props:o}}:null}else{let s=r.props,o={},n={...i},h=!1;if(s)for(let a of Object.keys(s)){o[a]=n[a];let c=s[a];c===void 0?delete n[a]:n[a]=c,h=!0}return h?{data:n,actual:r,reverse:{type:0,props:o}}:null}}e.runOp=t})(Ms||(Ms={}));var Pe=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Pe.prototype)}deepFreeze(){let e=0;for(;e<this.length;)$n(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(o=>o.id===e);if(r<0)throw new Error("not expected");let s=i[r];return i=[...i],i[r]={...s,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,Pe.prototype);let t=e;return Kp()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,s=this,o={fi:t,id:i,data:r};return s=[...s,o],s.sort((n,h)=>n.fi-h.fi),e.localIndex=s.indexOf(o),{data:this.modifyArrayBy(s),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(o=>o.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let s=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...s}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let s=r.findIndex(h=>h.id===i);if(s===-1)return null;let o=r[s].fi,n={...r[s],fi:t};return r[s]=n,r.sort((h,a)=>h.fi-a.fi),e.localIndex=r.indexOf(n),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:o,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return ii(0,t,t);{let r=i[0].fi;return ii(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let s=i.find(o=>o.fi>r.fi);if(s===void 0){let o=i[i.length-1].fi;return ii(o,o+t,t)}else return ii(r.fi,s.fi,t)}}};function ir(e){return e&&typeof e=="object"&&e instanceof qe}var qe=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,s={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!ir(i))return null;r+=1}i=i?_o(i):new qe;for(let[h,a]of Object.entries(e.props)){let c=i[h];s[h]=c,a===void 0?delete i[h]:i[h]=a}for(;r>0;){if(Object.keys(i).length===0){let h=t[r-1];h&&(i=_o(h),delete i[e.path[r-1]])}else{let h=t[r-1];if(h){let a=_o(h);a[e.path[r-1]]=i,i=a}else{let a=new qe;a[e.path[r-1]]=i,i=a}}r-=1}let o=Object.setPrototypeOf(i,qe.prototype),n={...e,props:s};return{data:o,actual:e,reverse:n}}},Oi;(e=>{function t(s,o){return kr(s,o)??s}e.apply=t;function i(s,o){return Kn(s,o)}e.merge=i;function r(s,o){let n=0,h=o.path,a=s;for(;n<h.length&&a!==void 0;){if(a=Rt.zoomOnce(a,h[n]),a===void 0)return o;if(!ir(a))return;n+=1}if(a===void 0)return o;if(ir(a))if(o.type===0){let c={...o.props};for(let d of Object.keys(a))delete c[d];return{...o,props:c}}else if(o.type===1||o.type===4||o.type===7){let c=Yn([o],a);return c?(console.log(c),c):o}else return o}e.filterOp=r})(Oi||(Oi={}));function Yn(e,t){if(t===void 0)return;let i=!1,r=e.map(s=>{let o=s.id,n=kr(s.data,t[o]);if(i=i||n!==void 0,n===void 0&&(n=s.data),s.children){let h=Yn(s.children,t);return h!==void 0?i=!0:h=s.children,{...s,id:o,data:n,children:h}}else return{...s,id:o,data:n}});if(i)return r}function Zp(e,t){if(t===void 0)return;let i=!1,r=e.map(s=>{let o=s.id,n=kr(s.data,t[o]);return i=i||n!==void 0,n===void 0&&(n=s.data),{...s,id:o,data:n}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function kr(e,t){if(!ir(t))return t;if(e instanceof At){let i=Yn(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Pe)return Zp(e,t);if(Array.isArray(e)){let i=!1,r=e.map((s,o)=>{let n=kr(s,t[o]);return i=i||n!==void 0,n===void 0&&(n=s),n});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof qe)return Kn(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[s,o]of Object.entries(e)){let n=kr(o,t[s]);r=r||n!==void 0,n===void 0&&(n=o),i[s]=n}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function Kn(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!ir(t))return t;if(!ir(e))return Oi.apply(e,t);let i=new Set;for(let s of Object.keys(e))i.add(s);for(let s of Object.keys(t))i.add(s);let r=new qe;for(let s of i){let o=Kn(e===void 0?void 0:e[s],t===void 0?void 0:t[s]);r[s]=o}return r}function Qp(e,t){let i={cur:[],result:[],len:0};return e=Fr(e,t,i)??e,[e,i.result]}function Ds(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function Ls(e){e&&(e.len-=1)}function Jp(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function dc(e,t,i){let r=!1,s=e.map(o=>{let n=o.id,h=t[n];if(h!==void 0&&typeof h=="string"&&(r=!0,n=h,i!==null))throw new Error("not supported");let a=Fr(o.data,t,Ds(i,n));Ls(i),r=r||a!==void 0,a===void 0&&(a=o.data);let c=dc(o.children,t,i);return c!==void 0?r=!0:c=o.children,{...o,id:n,data:a,children:c}});if(r)return s}function ef(e,t,i){let r=!1,s=e.map(o=>{let n=o.id,h=t[n];if(h!==void 0&&typeof h=="string"&&(r=!0,n=h,i!==null))throw new Error("not supported");let a=Fr(o.data,t,Ds(i,n));return Ls(i),r=r||a!==void 0,a===void 0&&(a=o.data),{...o,id:n,data:a}});if(r)return Object.setPrototypeOf(s,Object.getPrototypeOf(e)),s}function Fr(e,t,i){if(e instanceof At){let r=dc(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof Pe)return ef(e,t,i);if(Array.isArray(e)){let r=!1,s=e.map((o,n)=>{let h=Fr(o,t,Ds(i,n));return Ls(i),r=r||h!==void 0,h===void 0&&(h=o),h});return r?(Object.setPrototypeOf(s,Object.getPrototypeOf(e)),s):void 0}else if(e&&typeof e=="object"&&!Xn(e)){let r={},s=!1;for(let[o,n]of Object.entries(e))if(o!=="name"&&o!=="text"){let h=t[o];if(typeof h=="string"){if(i!==null)throw new Error("not supported");s=!0,o=h}let a=Fr(n,t,Ds(i,o));Ls(i),s=s||a!==void 0,a===void 0&&(a=n),r[o]=a}else r[o]=n;return s?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];if(r!==void 0){if(e.length!==36)throw new Error("for now you should only call this method when the key is a uuid");Jp(i)}return r}else return}}var sn;(e=>{function t(i,r){let s=Rt.zoom(r,i.path);if(typeof s=="object"){let o={};for(let n of Object.keys(i.props))o[n]=s[n];return{...i,props:o}}else return{...i,props:{}}}e.replaceProps=t})(sn||(sn={}));var nt;(e=>{function t(a,c){return{...a,path:a.path.slice(c)}}e.drop=t;function i(a,c){var d;return((d=r(a,c))==null?void 0:d.data)??a}e.applySimple=i;function r(a,c){var u,p;let d=c.path;for(var l=[];;){let f;if(a instanceof qe&&c.type===0&&(f=a.runOp({...c,path:d.slice(l.length)}),f===null&&(f=void 0)),f===void 0&&l.length===d.length&&(a instanceof At||a instanceof Pe||a instanceof ke?f=a.runOp(c):f=Ms.runOp(a,c)),f!==void 0)if(f!==null){let m=f.data;for(let y=l.length-1;y>=0;y--){let _=d[y],x=l[y];if(x instanceof At){if(typeof _=="number")throw new Error("illegal arg");m=x.modifyById(_,m)}else if(x instanceof Pe){if(typeof _=="number")throw new Error("illegal arg");m=x.modifyById(_,m)}else if(x instanceof ke){if(typeof _=="number")throw new Error("illegal arg");m=x.modifyById(_,m)}else if(x instanceof qe){let S={...x,[_]:m};m=Object.setPrototypeOf(S,qe.prototype)}else if(typeof x=="object")if(Array.isArray(x)){if(typeof _=="string"&&(_=parseInt(_),isNaN(_)))throw new Error("Invalid path");let S=m;m=[...x],m[_]=S}else m={...x,[_]:m};else return null}return{data:m,actual:{...f.actual,path:d},reverse:{...f.reverse,path:d}}}else return null;let g=d[l.length],v;if(a instanceof At){if(typeof g=="number")throw new Error("");v=(u=a.get(g))==null?void 0:u.data}else if(a instanceof Pe){if(typeof g=="number")throw new Error("");v=(p=a.get(g))==null?void 0:p.data}else a!==null&&(v=a[g]);if(v!==void 0)l.push(a),a=v;else return null}}e.apply=r;function s(a,c){for(let d=0;d<a.length&&d<c.length;d++)if(a[d]!==c[d])return!0;return!1}e.pathDisjoint=s;function o(a,c){if(a.length!==c.length)return!1;for(let d=0;d<a.length;d++)if(a[d]!==c[d])return!1;return!0}e.pathEq=o;function n(a,c){return s(a.path,c.path)}e.commutative=n;function h(a,c){return a.type===0&&c.type===0&&o(a.path,c.path)?Object.keys(a.props).every(d=>c.props[d]!==void 0):!1}e.subsumed=h})(nt||(nt={}));var Va;(e=>{function t(){return[]}e.empty=t;function i(c,d){let l=[];for(let u of c){let[p,...f]=u.path;p===d&&l.push({...u,path:f})}return l}e.removePrefix=i;function r(c,d){return c.map(l=>({...l,path:[d,...l.path]}))}e.addPrefix=r;function s(c,d){return[...c,...d]}e.concat=s;function o(c,d){return[...c.filter(l=>!d.some(u=>nt.subsumed(l,u))),...d]}e.compress=o;function n(c,d){return c.every(l=>d.every(u=>nt.commutative(l,u)))}e.commutative=n;function h(c,d){for(let l of d){let u=a(c,l);u!==null&&(c=u.data)}return c}e.applyAll=h;function a(c,d){var l=c;let u=[],p=[];for(let f of d)try{if(f.type===3){let g=Rt.zoom(l,[...f.path,f.id]),v=nt.apply(l,{...f,type:2});if(v!==null){l=v.data;let[m,y]=Qp(l,{[f.id]:g});l=m;for(let _ of y){let x=_[_.length-1];_.splice(_.length-1,1),u.push({type:0,path:_,props:{[x]:g}}),p.push({type:0,path:_,props:{[x]:f.id}})}p.push(v.reverse),u.push(v.actual)}}else{let g=nt.apply(l,f);g!==null&&(u.push(g.actual),l=g.data,p.push(g.reverse))}}catch(g){if(g instanceof hc)return null;throw g}return{data:l,actual:u,reverse:p.reverse()}}e.apply=a})(Va||(Va={}));var pc=Symbol(),tf=Symbol(),io=Symbol(),$r=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let s=i;for(;!(r instanceof mc);){let o=r._path,n=r._current;if(o!==""&&s.splice(0,0,o),r=r._parent,r===null)return;r.update(o,n)}r.push(s,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[io];i&&i(),delete this._children[e]}}}},rf=class extends $r{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,Ms.runOp(this._current,e),e.path)}},sf=class extends $r{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,ke.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},fc={get(e,t){if(t===io)return()=>{e._parent=null};if(t===pc)return e._current;if(t===tf)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let s=r===void 0?void 0:r[t];if(s!==void 0)return s;let o=i[t],n=ro(e,t,o);return n!==o?(r===void 0&&(r={},e._children=r),r[t]=n,n):o},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},of={...fc,set(e,t,i){let r={type:0,props:{[t]:$e(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},nf={...fc,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},Zn=class extends $r{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[io]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var n;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let s=(n=t.get(e))==null?void 0:n.data,o=ro(this,e,s);return o!==s?(i===void 0&&(i={},this._children=i),i[e]=o,o):s}add(e,t,i,r,s){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:s})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.add(e,r[s],o.id,o.data,o.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.add(e,r[s],o.id,o.data,o.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.move(e,r[s],o)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.move(e,r[s],o)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Qn=class extends $r{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[io]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,s=this._current[i].fi;e(this.data(this._current[i].id),r,s)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var n;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let s=(n=t.get(e))==null?void 0:n.data,o=ro(this,e,s);return o!==s?(i===void 0&&(i={},this._children=i),i[e]=o,o):s}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.add(i[r],s.id,s.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.add(i[r],s.id,s.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.move(i[r],s)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.move(i[r],s)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function So(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Rt.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var mc=class extends $r{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){So(this.ts,t,e),So(this.actual,i,e),So(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function ro(e,t,i){return i instanceof At?new Zn(e,t,i):i instanceof Pe?new Qn(e,t,i):i instanceof ke?new Proxy(new sf(e,t,i),nf):i!==null&&typeof i=="object"?Xn(i)?i:new Proxy(new rf(e,t,i),of):i}function gc(e){let t=new mc(e);return[ro(t,"",e),t]}function Is(e,t){let[i,r]=gc(e);return t(i),r.result()}function $e(e){return e instanceof Zn||e instanceof Qn?e._current:e!==null&&typeof e=="object"?e[pc]:e}var Rt;(e=>{function t(o,n){if(n.length===o.length)for(var h=0;h<o.length;){if(o[h]!==n[h])return!1;h+=1}else return!1;return!0}e.equal=t;function i(o,n,h){let a=s(h,o);if(a!==void 0&&typeof a=="object"&&a!==null){let c={...n};return Object.keys(a).forEach(d=>{delete c[d]}),c}else return n}e.removeOverridden=i;function r(o,n){if((o instanceof At||o instanceof Zn)&&typeof n=="string"||(o instanceof Pe||o instanceof Qn)&&typeof n=="string")return o.data(n);if(typeof n=="number"&&Array.isArray(o)||typeof n=="string"&&typeof o=="object"&&o!==null)return o[n]}e.zoomOnce=r;function s(o,n,h=0){for(;h<n.length&&o!==void 0;)o=r(o,n[h]),h+=1;return o}e.zoom=s})(Rt||(Rt={}));function af(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function ti(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var vc=class{},Ha=class extends vc{constructor(e){super(),this.id=e}},Wa=class extends vc{constructor(e){super(),this.data=e}},on;try{on=new TextDecoder}catch{}var ie,ci,E=0,et={},be,ri,ut=0,Nt=0,ot,Xt,Ke=[],xe,qa={useRecords:!1,mapsAsObjects:!0},yc=class{},bc=new yc;bc.name="MessagePack 0xC1";var rr=!1,zs=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(ie)return Oc(()=>(an(),this?this.unpack(e,t):zs.prototype.unpack.call(qa,e,t)));ci=t>-1?t:e.length,E=0,Nt=0,ri=null,ot=null,ie=e;try{xe=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw ie=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof zs){if(et=this,this.structures)return be=this.structures,ts();(!be||be.length>0)&&(be=[])}else et=qa,(!be||be.length>0)&&(be=[]);return ts()}unpackMultiple(e,t){let i,r=0;try{rr=!0;let s=e.length,o=this?this.unpack(e,s):oo.unpack(e,s);if(t){for(t(o);E<s;)if(r=E,t(ts())===!1)return}else{for(i=[o];E<s;)r=E,i.push(ts());return i}}catch(s){throw s.lastPosition=r,s.values=i,s}finally{rr=!1,an()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let s=e[i];s&&(s.isShared=!0,i>=32&&(s.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],s=t[i];s&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function ts(){try{if(!et.trusted&&!rr){let t=be.sharedLength||0;t<be.length&&(be.length=t)}let e=Be();if(E==ci)be.restoreStructures&&$a(),be=null,ie=null,Xt&&(Xt=null);else if(E>ci){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!rr)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw be.restoreStructures&&$a(),an(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function $a(){for(let e in be.restoreStructures)be[e]=be.restoreStructures[e];be.restoreStructures=null}function Be(){let e=ie[E++];if(e<160)if(e<128){if(e<64)return e;{let t=be[e&63]||et.getStructures&&xc()[e&63];return t?(t.read||(t.read=Jn(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,et.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[_c()]=Be();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Be(),Be());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Be();return t}else if(e<192){let t=e-160;if(Nt>=E)return ri.slice(E-ut,(E+=t)-ut);if(Nt==0&&ci<140){let i=t<16?ea(t):wc(t);if(i!=null)return i}return nn(t)}else{let t;switch(e){case 192:return null;case 193:return ot?(t=Be(),t>0?ot[1].slice(ot.position1,ot.position1+=t):ot[0].slice(ot.position0,ot.position0-=t)):bc;case 194:return!1;case 195:return!0;case 196:return Ao(ie[E++]);case 197:return t=xe.getUint16(E),E+=2,Ao(t);case 198:return t=xe.getUint32(E),E+=4,Ao(t);case 199:return mi(ie[E++]);case 200:return t=xe.getUint16(E),E+=2,mi(t);case 201:return t=xe.getUint32(E),E+=4,mi(t);case 202:if(t=xe.getFloat32(E),et.useFloat32>2){let i=ta[(ie[E]&127)<<1|ie[E+1]>>7];return E+=4,(i*t+(t>0?.5:-.5)>>0)/i}return E+=4,t;case 203:return t=xe.getFloat64(E),E+=8,t;case 204:return ie[E++];case 205:return t=xe.getUint16(E),E+=2,t;case 206:return t=xe.getUint32(E),E+=4,t;case 207:return et.int64AsNumber?(t=xe.getUint32(E)*4294967296,t+=xe.getUint32(E+4)):t=xe.getBigUint64(E),E+=8,t;case 208:return xe.getInt8(E++);case 209:return t=xe.getInt16(E),E+=2,t;case 210:return t=xe.getInt32(E),E+=4,t;case 211:return et.int64AsNumber?(t=xe.getInt32(E)*4294967296,t+=xe.getUint32(E+4)):t=xe.getBigInt64(E),E+=8,t;case 212:if(t=ie[E++],t==114)return Qa(ie[E++]&63);{let i=Ke[t];if(i)return i.read?(E++,i.read(Be())):i.noBuffer?(E++,i()):i(ie.subarray(E,++E));throw new Error("Unknown extension "+t)}case 213:return t=ie[E],t==114?(E++,Qa(ie[E++]&63,ie[E++])):mi(2);case 214:return mi(4);case 215:return mi(8);case 216:return mi(16);case 217:return t=ie[E++],Nt>=E?ri.slice(E-ut,(E+=t)-ut):hf(t);case 218:return t=xe.getUint16(E),E+=2,Nt>=E?ri.slice(E-ut,(E+=t)-ut):cf(t);case 219:return t=xe.getUint32(E),E+=4,Nt>=E?ri.slice(E-ut,(E+=t)-ut):uf(t);case 220:return t=xe.getUint16(E),E+=2,Ya(t);case 221:return t=xe.getUint32(E),E+=4,Ya(t);case 222:return t=xe.getUint16(E),E+=2,Ka(t);case 223:return t=xe.getUint32(E),E+=4,Ka(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var lf=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Jn(e,t){function i(){if(i.count++>2){let s=e.read=new Function("r","return function(){return {"+e.map(o=>lf.test(o)?o+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}}")(Be);return e.highByte===0&&(e.read=Xa(t,e.read)),s()}let r={};for(let s=0,o=e.length;s<o;s++){let n=e[s];r[n]=Be()}return r}return i.count=0,e.highByte===0?Xa(t,i):i}var Xa=(e,t)=>function(){let i=ie[E++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),s=be[r]||xc()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=Jn(s,e)),s.read()};function xc(){let e=Oc(()=>(ie=null,et.getStructures()));return be=et._mergeStructures(e,be)}var nn=so,hf=so,cf=so,uf=so;function so(e){let t;if(e<16&&(t=ea(e)))return t;if(e>64&&on)return on.decode(ie.subarray(E,E+=e));let i=E+e,r=[];for(t="";E<i;){let s=ie[E++];if(!(s&128))r.push(s);else if((s&224)===192){let o=ie[E++]&63;r.push((s&31)<<6|o)}else if((s&240)===224){let o=ie[E++]&63,n=ie[E++]&63;r.push((s&31)<<12|o<<6|n)}else if((s&248)===240){let o=ie[E++]&63,n=ie[E++]&63,h=ie[E++]&63,a=(s&7)<<18|o<<12|n<<6|h;a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|a&1023),r.push(a)}else r.push(s);r.length>=4096&&(t+=He.apply(String,r),r.length=0)}return r.length>0&&(t+=He.apply(String,r)),t}function Ya(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Be();return t}function Ka(e){if(et.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[_c()]=Be();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Be(),Be());return t}}var He=String.fromCharCode;function wc(e){let t=E,i=new Array(e);for(let r=0;r<e;r++){let s=ie[E++];if((s&128)>0){E=t;return}i[r]=s}return He.apply(String,i)}function ea(e){if(e<4)if(e<2){if(e===0)return"";{let t=ie[E++];if((t&128)>1){E-=1;return}return He(t)}}else{let t=ie[E++],i=ie[E++];if((t&128)>0||(i&128)>0){E-=2;return}if(e<3)return He(t,i);let r=ie[E++];if((r&128)>0){E-=3;return}return He(t,i,r)}else{let t=ie[E++],i=ie[E++],r=ie[E++],s=ie[E++];if((t&128)>0||(i&128)>0||(r&128)>0||(s&128)>0){E-=4;return}if(e<6){if(e===4)return He(t,i,r,s);{let o=ie[E++];if((o&128)>0){E-=5;return}return He(t,i,r,s,o)}}else if(e<8){let o=ie[E++],n=ie[E++];if((o&128)>0||(n&128)>0){E-=6;return}if(e<7)return He(t,i,r,s,o,n);let h=ie[E++];if((h&128)>0){E-=7;return}return He(t,i,r,s,o,n,h)}else{let o=ie[E++],n=ie[E++],h=ie[E++],a=ie[E++];if((o&128)>0||(n&128)>0||(h&128)>0||(a&128)>0){E-=8;return}if(e<10){if(e===8)return He(t,i,r,s,o,n,h,a);{let c=ie[E++];if((c&128)>0){E-=9;return}return He(t,i,r,s,o,n,h,a,c)}}else if(e<12){let c=ie[E++],d=ie[E++];if((c&128)>0||(d&128)>0){E-=10;return}if(e<11)return He(t,i,r,s,o,n,h,a,c,d);let l=ie[E++];if((l&128)>0){E-=11;return}return He(t,i,r,s,o,n,h,a,c,d,l)}else{let c=ie[E++],d=ie[E++],l=ie[E++],u=ie[E++];if((c&128)>0||(d&128)>0||(l&128)>0||(u&128)>0){E-=12;return}if(e<14){if(e===12)return He(t,i,r,s,o,n,h,a,c,d,l,u);{let p=ie[E++];if((p&128)>0){E-=13;return}return He(t,i,r,s,o,n,h,a,c,d,l,u,p)}}else{let p=ie[E++],f=ie[E++];if((p&128)>0||(f&128)>0){E-=14;return}if(e<15)return He(t,i,r,s,o,n,h,a,c,d,l,u,p,f);let g=ie[E++];if((g&128)>0){E-=15;return}return He(t,i,r,s,o,n,h,a,c,d,l,u,p,f,g)}}}}}function Ao(e){return et.copyBuffers?Uint8Array.prototype.slice.call(ie,E,E+=e):ie.subarray(E,E+=e)}function mi(e){let t=ie[E++];if(Ke[t])return Ke[t](ie.subarray(E,E+=e));throw new Error("Unknown extension type "+t)}var Za=new Array(4096);function _c(){let e=ie[E++];if(e>=160&&e<192){if(e=e-160,Nt>=E)return ri.slice(E-ut,(E+=e)-ut);if(!(Nt==0&&ci<180))return nn(e)}else return E--,Be();let t=(e<<5^(e>1?xe.getUint16(E):e>0?ie[E]:0))&4095,i=Za[t],r=E,s=E+e-3,o,n=0;if(i&&i.bytes==e){for(;r<s;){if(o=xe.getUint32(r),o!=i[n++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(o=ie[r++],o!=i[n++]){r=1879048192;break}if(r===s)return E=r,i.string;s-=3,r=E}for(i=[],Za[t]=i,i.bytes=e;r<s;)o=xe.getUint32(r),i.push(o),r+=4;for(s+=3;r<s;)o=ie[r++],i.push(o);let h=e<16?ea(e):wc(e);return h!=null?i.string=h:i.string=nn(e)}var Qa=(e,t)=>{var i=Be();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let s=be[e];return s&&s.isShared&&((be.restoreStructures||(be.restoreStructures=[]))[e]=s),be[e]=i,i.read=Jn(i,r),i.read()},Sc=typeof self=="object"?self:global;Ke[0]=()=>{};Ke[0].noBuffer=!0;Ke[101]=()=>{let e=Be();return(Sc[e[0]]||Error)(e[1])};Ke[105]=e=>{let t=xe.getUint32(E-4);Xt||(Xt=new Map);let i=ie[E],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let s={target:r};Xt.set(t,s);let o=Be();return s.used?Object.assign(r,o):(s.target=o,o)};Ke[112]=e=>{let t=xe.getUint32(E-4),i=Xt.get(t);return i.used=!0,i.target};Ke[115]=()=>new Set(Be());var Ac=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Ke[116]=e=>{let t=e[0],i=Ac[t];if(!i)throw new Error("Could not find typed array for code "+t);return new Sc[i](Uint8Array.prototype.slice.call(e,1).buffer)};Ke[120]=()=>{let e=Be();return new RegExp(e[0],e[1])};Ke[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=E;E+=t-4,ot=[Be(),Be()],ot.position0=0,ot.position1=0;let r=E;E=i;try{return Be()}finally{E=r}};Ke[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Oc(e){let t=ci,i=E,r=ut,s=Nt,o=ri,n=Xt,h=ot,a=new Uint8Array(ie.slice(0,ci)),c=be,d=be.slice(0,be.length),l=et,u=rr,p=e();return ci=t,E=i,ut=r,Nt=s,ri=o,Xt=n,ot=h,ie=a,rr=u,be=c,be.splice(0,be.length,...d),et=l,xe=new DataView(ie.buffer,ie.byteOffset,ie.byteLength),p}function an(){ie=null,Xt=null,be=null}function df(e){e.unpack?Ke[e.type]=e.unpack:Ke[e.type]=e}var ta=new Array(147);for(let e=0;e<256;e++)ta[e]=+("1e"+Math.floor(45.15-e*.30103));var oo=new zs({useRecords:!1});oo.unpack;oo.unpackMultiple;oo.unpack;var pf=new Float32Array(1);new Uint8Array(pf.buffer,0,4);var xs;try{xs=new TextEncoder}catch{}var Ns,ia,no=typeof Buffer<"u",Oo=no?Buffer.allocUnsafeSlow:Uint8Array,Cc=no?Buffer:Uint8Array,Ja=no?4294967296:2144337920,B,Re,D=0,Tt,Et=null,ff=/[\u0080-\uFFFF]/,yr=Symbol("record-id"),Pc=class extends zs{constructor(e){super(e),this.offset=0;let t,i,r,s,o,n=0,h=Cc.prototype.utf8Write?function(b,A,O){return B.utf8Write(b,A,O)}:xs&&xs.encodeInto?function(b,A){return xs.encodeInto(b,B.subarray(A)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,d=e.structures||e.saveStructures,l=e.maxSharedStructures;if(l==null&&(l=d?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");let u=e.maxOwnStructures;u==null&&(u=d?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=l>32||u+l>64,f=l+64,g=l+u+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],m=0,y=0;this.pack=this.encode=function(b,A){if(B||(B=new Oo(8192),Re=new DataView(B.buffer,0,8192),D=0),Tt=B.length-10,Tt-D<2048?(B=new Oo(B.length),Re=new DataView(B.buffer,0,B.length),Tt=B.length-10,D=0):D=D+7&2147483640,t=D,o=a.structuredClone?new Map:null,a.bundleStrings?(Et=["",""],B[D++]=214,B[D++]=98,Et.position=D-t,D+=4):Et=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let O=i.sharedLength||0;if(O>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let P=0;P<O;P++){let w=i[P];if(!w)continue;let C,M=i.transitions;for(let z=0,W=w.length;z<W;z++){let Q=w[z];C=M[Q],C||(C=M[Q]=Object.create(null)),M=C}M[yr]=P+64}n=O}c||(i.nextId=O+64)}r&&(r=!1),s=i||[];try{if(_(b),Et){Re.setUint32(Et.position+t,D-Et.position-t);let O=Et;Et=null,_(O[0]),_(O[1])}if(a.offset=D,o&&o.idsToInsert){D+=o.idsToInsert.length*6,D>Tt&&S(D),a.offset=D;let O=gf(B.subarray(t,D),o.idsToInsert);return o=null,O}return A&vf?(B.start=t,B.end=D,B):B.subarray(t,D)}finally{if(i){if(y<10&&y++,m>1e4)i.transitions=null,y=0,m=0,v.length>0&&(v=[]);else if(v.length>0&&!c){for(let O=0,P=v.length;O<P;O++)v[O][yr]=0;v=[]}if(r&&a.saveStructures){let O=i.sharedLength||l;i.length>O&&(i=i.slice(0,O));let P=B.subarray(t,D);return a.saveStructures(i,n)===!1?(a._mergeStructures(a.getStructures()),a.pack(b)):(n=O,P)}}A&yf&&(D=t)}};let _=b=>{D>Tt&&(B=S(D));var A=typeof b,O;if(A==="string"){let P=b.length;if(Et&&P>=8&&P<4096){let M=ff.test(b);Et[M?0:1]+=b,B[D++]=193,_(M?-P:P);return}let w;P<32?w=1:P<256?w=2:P<65536?w=3:w=5;let C=P*3;if(D+C>Tt&&(B=S(D+C)),P<64||!h){let M,z,W,Q=D+w;for(M=0;M<P;M++)z=b.charCodeAt(M),z<128?B[Q++]=z:z<2048?(B[Q++]=z>>6|192,B[Q++]=z&63|128):(z&64512)===55296&&((W=b.charCodeAt(M+1))&64512)===56320?(z=65536+((z&1023)<<10)+(W&1023),M++,B[Q++]=z>>18|240,B[Q++]=z>>12&63|128,B[Q++]=z>>6&63|128,B[Q++]=z&63|128):(B[Q++]=z>>12|224,B[Q++]=z>>6&63|128,B[Q++]=z&63|128);O=Q-D-w}else O=h(b,D+w,C);O<32?B[D++]=160|O:O<256?(w<2&&B.copyWithin(D+2,D+1,D+1+O),B[D++]=217,B[D++]=O):O<65536?(w<3&&B.copyWithin(D+3,D+2,D+2+O),B[D++]=218,B[D++]=O>>8,B[D++]=O&255):(w<5&&B.copyWithin(D+5,D+3,D+3+O),B[D++]=219,Re.setUint32(D,O),D+=4),D+=O}else if(A==="number")if(b>>>0===b)b<64?B[D++]=b:b<256?(B[D++]=204,B[D++]=b):b<65536?(B[D++]=205,B[D++]=b>>8,B[D++]=b&255):(B[D++]=206,Re.setUint32(D,b),D+=4);else if(b>>0===b)b>=-32?B[D++]=256+b:b>=-128?(B[D++]=208,B[D++]=b+256):b>=-32768?(B[D++]=209,Re.setInt16(D,b),D+=2):(B[D++]=210,Re.setInt32(D,b),D+=4);else{let P;if((P=this.useFloat32)>0&&b<4294967296&&b>=-2147483648){B[D++]=202,Re.setFloat32(D,b);let w;if(P<4||(w=b*ta[(B[D]&127)<<1|B[D+1]>>7])>>0===w){D+=4;return}else D--}B[D++]=203,Re.setFloat64(D,b),D+=8}else if(A==="object")if(!b)B[D++]=192;else{if(o){let w=o.get(b);if(w){if(!w.id){let C=o.idsToInsert||(o.idsToInsert=[]);w.id=C.push(w)}B[D++]=214,B[D++]=112,Re.setUint32(D,w.id),D+=4;return}else o.set(b,{offset:D-t})}let P=b.constructor;if(P===Object)x(b,!0);else if(P===Array){O=b.length,O<16?B[D++]=144|O:O<65536?(B[D++]=220,B[D++]=O>>8,B[D++]=O&255):(B[D++]=221,Re.setUint32(D,O),D+=4);for(let w=0;w<O;w++)_(b[w])}else if(P===Map){O=b.size,O<16?B[D++]=128|O:O<65536?(B[D++]=222,B[D++]=O>>8,B[D++]=O&255):(B[D++]=223,Re.setUint32(D,O),D+=4);for(let[w,C]of b)_(w),_(C)}else{for(let w=0,C=Ns.length;w<C;w++){let M=ia[w];if(b instanceof M){let z=Ns[w];if(z.write){z.type&&(B[D++]=212,B[D++]=z.type,B[D++]=0),_(z.write.call(this,b));return}let W=B,Q=Re,re=D;B=null;let $;try{$=z.pack.call(this,b,V=>(B=W,W=null,D+=V,D>Tt&&S(D),{target:B,targetView:Re,position:D-V}),_)}finally{W&&(B=W,Re=Q,D=re,Tt=B.length-10)}$&&($.length+D>Tt&&S($.length+D),D=mf($,B,D,z.type));return}}x(b,!b.hasOwnProperty)}}else if(A==="boolean")B[D++]=b?195:194;else if(A==="bigint"){if(b<BigInt(1)<<BigInt(63)&&b>=-(BigInt(1)<<BigInt(63)))B[D++]=211,Re.setBigInt64(D,b);else if(b<BigInt(1)<<BigInt(64)&&b>0)B[D++]=207,Re.setBigUint64(D,b);else if(this.largeBigIntToFloat)B[D++]=203,Re.setFloat64(D,Number(b));else throw new RangeError(b+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");D+=8}else if(A==="undefined")this.encodeUndefinedAsNil?B[D++]=192:(B[D++]=212,B[D++]=0,B[D++]=0);else if(A==="function")_(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},x=this.useRecords===!1?this.variableMapSize?b=>{let A=Object.keys(b),O=A.length;O<16?B[D++]=128|O:O<65536?(B[D++]=222,B[D++]=O>>8,B[D++]=O&255):(B[D++]=223,Re.setUint32(D,O),D+=4);let P;for(let w=0;w<O;w++)_(P=A[w]),_(b[P])}:(b,A)=>{B[D++]=222;let O=D-t;D+=2;let P=0;for(let w in b)(A||b.hasOwnProperty(w))&&(_(w),_(b[w]),P++);B[O+++t]=P>>8,B[O+t]=P&255}:b=>{let A=Object.keys(b),O,P=s.transitions||(s.transitions=Object.create(null)),w=0;for(let M=0,z=A.length;M<z;M++){let W=A[M];O=P[W],O||(O=P[W]=Object.create(null),w++),P=O}let C=P[yr];if(C)C>=96&&p?(B[D++]=((C-=96)&31)+96,B[D++]=C>>5):B[D++]=C;else{C=s.nextId,C||(C=64),C<f&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(C=s.nextOwnId,C<g||(C=f),s.nextOwnId=C+1):(C>=g&&(C=f),s.nextId=C+1);let M=A.highByte=C>=96&&p?C-96>>5:-1;P[yr]=C,s[C-64]=A,C<f?(A.isShared=!0,s.sharedLength=C-63,r=!0,M>=0?(B[D++]=(C&31)+96,B[D++]=M):B[D++]=C):(M>=0?(B[D++]=213,B[D++]=114,B[D++]=(C&31)+96,B[D++]=M):(B[D++]=212,B[D++]=114,B[D++]=C),w&&(m+=y*w),v.length>=u&&(v.shift()[yr]=0),v.push(P),_(A))}for(let M=0,z=A.length;M<z;M++)_(b[A[M]])},S=b=>{let A;if(b>16777216){if(b-t>Ja)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(Ja,Math.round(Math.max((b-t)*(b>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(b-t<<2,B.length-1)>>12)+1<<12;let O=new Oo(A);return Re=new DataView(O.buffer,0,A),B.copy?B.copy(O,0,t,b):O.set(B.slice(t,b)),D-=t,t=0,Tt=O.length-10,B=O}}useBuffer(e){B=e,Re=new DataView(B.buffer,B.byteOffset,B.byteLength),D=0}};ia=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,yc];Ns=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:o,position:n}=t(6);s[n++]=214,s[n++]=255,o.setUint32(n,r)}else if(r>0&&r<17179869184){let{target:s,targetView:o,position:n}=t(10);s[n++]=215,s[n++]=255,o.setUint32(n,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),o.setUint32(n+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:s,targetView:o,position:n}=t(3);s[n++]=212,s[n++]=255,s[n++]=255}else{let{target:s,targetView:o,position:n}=t(15);s[n++]=199,s[n++]=12,s[n++]=255,o.setUint32(n,e.getMilliseconds()*1e6),o.setBigInt64(n+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:s,position:o}=t(this.structuredClone?3:0);this.structuredClone&&(s[o++]=212,s[o++]=115,s[o++]=0),i(r)}},{pack(e,t,i){let{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=101,r[s++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=120,r[s++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?el(e,16,t):tl(no?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==Cc&&this.structuredClone?el(e,Ac.indexOf(i.name),t):tl(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function el(e,t,i,r){let s=e.byteLength;if(s+1<256){var{target:o,position:n}=i(4+s);o[n++]=199,o[n++]=s+1}else if(s+1<65536){var{target:o,position:n}=i(5+s);o[n++]=200,o[n++]=s+1>>8,o[n++]=s+1&255}else{var{target:o,position:n,targetView:h}=i(7+s);o[n++]=201,h.setUint32(n,s+1),n+=4}o[n++]=116,o[n++]=t,o.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n)}function tl(e,t){let i=e.byteLength;var r,s;if(i<256){var{target:r,position:s}=t(i+2);r[s++]=196,r[s++]=i}else if(i<65536){var{target:r,position:s}=t(i+3);r[s++]=197,r[s++]=i>>8,r[s++]=i&255}else{var{target:r,position:s,targetView:o}=t(i+5);r[s++]=198,o.setUint32(s,i),s+=4}r.set(e,s)}function mf(e,t,i,r){let s=e.length;switch(s){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:s<256?(t[i++]=199,t[i++]=s):s<65536?(t[i++]=200,t[i++]=s>>8,t[i++]=s&255):(t[i++]=201,t[i++]=s>>24,t[i++]=s>>16&255,t[i++]=s>>8&255,t[i++]=s&255)}return t[i++]=r,t.set(e,i),i+=s,i}function gf(e,t){let i,r=t.length*6,s=e.length-r;for(t.sort((o,n)=>o.offset>n.offset?1:-1);i=t.pop();){let o=i.offset,n=i.id;e.copyWithin(o+r,o,s),r-=6;let h=o+r;e[h++]=214,e[h++]=105,e[h++]=n>>24,e[h++]=n>>16&255,e[h++]=n>>8&255,e[h++]=n&255,s=o}return e}function cr(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");ia.unshift(e.Class),Ns.unshift(e)}df(e)}var Tc=new Pc({useRecords:!1});Tc.pack;Tc.pack;var vf=512,yf=1024,il=new Pc({structuredClone:!0});cr({Class:ke.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,ke.prototype),e}});cr({Class:Pe.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Pe.prototype),e}});cr({Class:At.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,At.prototype),e}});cr({Class:Ha.prototype.constructor,type:4,write(e){return e.id},read(e){return new Ha(e)}});cr({Class:Wa.prototype.constructor,type:5,write(e){return e.data},read(e){return new Wa(e)}});cr({Class:qe.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,qe.prototype),e}});function bf(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function ln(e){if(Xn(e))return e;if(Array.isArray(e))return e.map(ln);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=ln(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var hn;(e=>{function t(s){return il.pack(s)}e.serialize=t;function i(s){return il.unpack(s)}e.deserialize=i;function r(s){return bf(t(ln(s))).toString()}e.checksum=r})(hn||(hn={}));var rl;(e=>{function t(r,s){return r[0]===s[0]&&r[1]===s[1]}e.isEqual=t;function i(r,s,o){return[r[0]+(s[0]-r[0])*o,r[1]+(s[1]-r[1])*o]}e.lerp=i})(rl||(rl={}));var Hi;(e=>{function t(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}e.isEqual=t;function i(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]}e.add=i;function r(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]}e.sub=r;function s(a,c){return[a[0]/c[0],a[1]/c[1],a[2]/c[2]]}e.div=s;function o(a,c){return[a[0]*c[0],a[1]*c[1],a[2]*c[2]]}e.mul=o;function n(a,c){return Math.hypot(a[0]-c[0],a[1]-c[1],a[2]-c[2])}e.dist=n;function h(a,c,d){return[a[0]+(c[0]-a[0])*d,a[1]+(c[1]-a[1])*d,a[2]+(c[2]-a[2])*d]}e.lerp=h})(Hi||(Hi={}));var sl;(e=>{function t(r,s){return r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]&&r[3]===s[3]}e.isEqual=t;function i(r,s,o){return[r[0]+(s[0]-r[0])*o,r[1]+(s[1]-r[1])*o,r[2]+(s[2]-r[2])*o,r[3]+(s[3]-r[3])*o]}e.lerp=i})(sl||(sl={}));var sr;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(s,o){for(let n=0;n<16;n++)if(s[n]!==o[n])return!1;return!0}e.isEqual=t;function i(s){return s??e.identity}e.simplify=i;function r(s,o){let n=o.slice(0);for(var h=0,a=o.length;h<a;h+=3){let c=s[3]*o[h]+s[7]*o[h+1]+s[11]*o[h+2]+s[15];n[h]=(s[0]*o[h]+s[4]*o[h+1]+s[8]*o[h+2]+s[12])/c,n[h+1]=(s[1]*o[h]+s[5]*o[h+1]+s[9]*o[h+2]+s[13])/c,n[h+2]=(s[2]*o[h]+s[6]*o[h+1]+s[10]*o[h+2]+s[14])/c}return n}e.applyMatrix4=r})(sr||(sr={}));var gt;(e=>{function t(h){return typeof h=="object"&&typeof h.r=="number"&&typeof h.g=="number"&&typeof h.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(h){return{r:Math.round(h.r*255),g:Math.round(h.g*255),b:Math.round(h.b*255),a:1}}e.toRgb255a1=i;function r(h){return{r:h.r,g:h.g,b:h.b}}e.clone=r;function s(h){return h=Math.floor(h),{r:(h>>16&255)/255,g:(h>>8&255)/255,b:(h&255)/255}}e.fromHex=s;function o(h,a){return h.r===a.r&&h.g===a.g&&h.b===a.b}e.equals=o;function n(h,a,c){return{r:h.r+(a.r-h.r)*c,g:h.g+(a.g-h.g)*c,b:h.b+(a.b-h.b)*c}}e.lerp=n})(gt||(gt={}));var $t;(e=>{e.white={...gt.white,a:1},e.transparent={...gt.white,a:0};function t(n){return{r:n[0],g:n[1],b:n[2],a:n[3]}}e.from0to1=t;function i(n,h){return{...gt.fromHex(n),a:h}}e.fromHexAndA=i;function r(n){return{r:Math.round(n.r*255),g:Math.round(n.g*255),b:Math.round(n.b*255),a:n.a}}e.toRgb255a1=r;function s(n,h){return gt.equals(n,h)&&n.a===h.a}e.equals=s;function o(n,h,a){return{r:n.r+(h.r-n.r)*a,g:n.g+(h.g-n.g)*a,b:n.b+(h.b-n.b)*a,a:n.a+(h.a-n.a)*a}}e.lerp=o})($t||($t={}));var cn;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(cn||(cn={}));var ol;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(ol||(ol={}));var nl;(e=>e.defaultData={control1:[.5,.05],control2:[.1,.3]})(nl||(nl={}));var Ei;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Ei||(Ei={}));var Gr;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1,autoZoom:!1,autoZoomFrustumSize:790},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}e.getZoom=t})(Gr||(Gr={}));var si;(e=>{function t(r,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*s,0,0]},grid:{count:[2,2,2],size:r.map(o=>o*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,s){let o={...r};if(xf.forEach(n=>{Object.assign(o,{[n]:s[n]??r[n]})}),o.radial={...r.radial},s.radial){let n=r.radial,h=s.radial;wf.forEach(a=>{Object.assign(o.radial,{[a]:h[a]??n[a]})})}if(o.linear={...r.linear},s.linear){let n=r.linear,h=s.linear;_f.forEach(a=>{Object.assign(o.linear,{[a]:h[a]??n[a]})})}if(o.grid={...r.grid},s.grid){let n=r.grid,h=s.grid;Sf.forEach(a=>{Object.assign(o.grid,{[a]:h[a]??n[a]})})}if(o.toObject={...r.toObject},s.toObject){let n=r.toObject,h=s.toObject;Af.forEach(a=>{Object.assign(o.toObject,{[a]:h[a]??n[a]})})}if(o.randomnessObject={...r.randomnessObject},s.randomnessObject){let n=r.randomnessObject,h=s.randomnessObject;Of.forEach(a=>{Object.assign(o.randomnessObject,{[a]:h[a]??n[a]})})}return o}e.merge=i})(si||(si={}));var un;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,s){let o=[];r.count!==void 0&&o.push({type:0,path:s,props:{count:r.count}});for(let n of t){let h=r[n];h&&Object.keys(h).length>0&&o.push({type:0,path:[...s,n],props:h})}return o}e.toOps=i})(un||(un={}));var xf=["count"],wf=["radius","start","end","position","scale","rotation"],_f=["position","scale","rotation"],Sf=["count","size"],Af=["count","position","scale","rotation"],Of=["strength","scale","rotation","position","movement","seed","freqScale"],dn;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(dn||(dn={}));var pn;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:$t.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if(r==="SpotLight")return{type:r,color:$t.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:$t.white,intensity:1,shadows:!0,size:2e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(pn||(pn={}));var fn;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(fn||(fn={}));var mn;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(mn||(mn={}));var gn;(e=>e.defaultData={...mn.defaultData,...fn.defaultData})(gn||(gn={}));var Bs;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(Bs||(Bs={}));var al;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="transmission"||i==="matcap"||i==="displace"||i==="light"}e.is=t})(al||(al={}));var ll;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(ll||(ll={}));var Cf=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],Pf=["wrapping","image","video"],ft;(e=>{function t(o,n){let{texture:h,...a}=n;if(Object.assign(o,a),h){let c=o.texture;c&&Object.assign(c,h)}}e.patch=t;function i(o,n){return o==="light"&&n?r(n):s(o)}e.defaultData=i;function r(o){switch(o){case"phong":return{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",alpha:.6,visible:!0,mode:0};case"toon":return{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"lambert":return{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0};case"physical":return{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0}}}function s(o){switch(o){case"texture":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"texture",projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"video",projection:0,texture:{video:Bs.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!0};case"color":return{type:"color",alpha:1,visible:!0,mode:0,color:gt.fromHex(5526619)};case"depth":return{type:"depth",alpha:1,visible:!0,mode:0,gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{type:"normal",alpha:1,visible:!0,mode:0,cnormal:[1,1,1]};case"gradient":return{type:"gradient",alpha:1,visible:!0,mode:0,gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{type:"noise",alpha:1,visible:!0,mode:0,size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...gt.fromHex(6710886),a:1},colorB:{...gt.fromHex(6710886),a:1},colorC:{...gt.fromHex(16777215),a:1},colorD:{...gt.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8]};case"fresnel":return{type:"fresnel",alpha:1,visible:!0,mode:0,color:$t.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{type:"rainbow",alpha:1,visible:!0,mode:0,filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{type:"toon",alpha:1,visible:!0,mode:0,positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:$t.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{type:"outline",alpha:1,visible:!0,mode:0,outlineColor:$t.fromHexAndA(0,1),contourColor:$t.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{type:"matcap",alpha:1,visible:!0,mode:0,texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{type:"transmission",alpha:1,visible:!0,mode:0,thickness:10,ior:1.5,roughness:1};case"displace":return{type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,visible:!0}}}})(ft||(ft={}));var kt;(e=>{function t(c){return!c.layers.some(d=>d.data.type==="texture"&&d.data.projection!==0||d.data.type==="depth"&&!d.data.isWorldSpace||d.data.type==="noise"||d.data.type==="displace")}e.isMergable=t;function i(c){let d="";return c.layers.forEach(l=>{Object.entries(l.data).forEach(([u,p])=>{d+=`${u}${p}`,Array.isArray(p)?p.forEach(f=>d+=`${f}`):typeof p=="object"?Object.values(p).forEach(f=>{typeof f=="number"?d+=`${f.toFixed(4)}`:d+=`${f}`}):d+=`${p}`})}),d}e.getHash=i;function r(){return{layers:new Pe}}e.defaultEmptyData=r;function s(c="layer1",d="layer2"){return n("phong",c,d)}e.defaultData=s;function o(c,d){return{...c,name:d}}e.withName=o;function n(c,d="layer1",l="layer2"){let u=new Pe;return u.push({fi:0,data:ft.defaultData("light",c),id:d}),u.push({fi:1,data:ft.defaultData("color"),id:l}),{layers:u}}e.defaultTwoLayerData=n;function h(c,d="phong",l="layer1",u="layer2"){let p=ft.defaultData("texture");Object.assign(p.texture,{image:c});let f=new Pe;return f.push({fi:0,data:p,id:l}),f.push({fi:1,data:ft.defaultData("light",d),id:u}),{layers:f}}e.defaultTwoLayerTextureData=h;function a(c,d="phong",l="layer1",u="layer2"){let p=ft.defaultData("video");Object.assign(p.texture,{video:c});let f=new Pe;return f.push({fi:0,data:p,id:l}),f.push({fi:1,data:ft.defaultData("light",d),id:u}),{layers:f}}e.defaultTwoLayerVideoTextureData=a})(kt||(kt={}));var js;(e=>{function t(){return{points:new Pe,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(js||(js={}));var Us;(e=>{function t(){return{points:new Pe,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(Us||(Us={}));var Ec={type:"Ellipse",width:100,height:100,spikes:64,angle:360,innerRadius:0},vn;(e=>{function t(i,r){let s={...i};return Tf.forEach(o=>{Object.assign(s,{[o]:r[o]??i[o]})}),s}e.merge=t})(vn||(vn={}));var Mc={shape:Ec,depth:1,offset:0,bevel:0,bevelSides:1,angle:0,twist:0,startScale:1,endScale:1},Tf=["depth","offset","angle","twist","startScale","endScale"],Rs;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"}e.isParametricMesh=i})(Rs||(Rs={}));var yn;(e=>{function t(i,r){let s={...i};return Object.assign(s,r),s.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(s.extrusion={...i.extrusion},Object.assign(s.extrusion,vn.merge(s.extrusion,r.extrusion))),s}e.merge=t})(yn||(yn={}));var Wi;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:Us.defaultData(),extrusion:Mc};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:js.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};throw new Error("not implemented")}e.defaultData=t})(Wi||(Wi={}));var hl;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(hl||(hl={}));var or;(e=>{e.identity={...cn.identity,hiddenMatrix:sr.identity};function t(s){return{position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix}}e.fromObject=t;function i(s,o){return{position:(o==null?void 0:o.position)||s.position,rotation:(o==null?void 0:o.rotation)||s.rotation,scale:(o==null?void 0:o.scale)||s.scale,hiddenMatrix:(o==null?void 0:o.hiddenMatrix)||s.hiddenMatrix}}e.merge=i;function r(s,o){return{position:Hi.isEqual(s.position,o.position)?null:o.position,rotation:Hi.isEqual(s.rotation,o.rotation)?null:o.rotation,scale:Hi.isEqual(s.scale,o.scale)?null:o.scale,hiddenMatrix:sr.isEqual(s.hiddenMatrix,o.hiddenMatrix)?null:o.hiddenMatrix}}e.diff=r})(or||(or={}));var cl;(e=>e.defaultData={fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(cl||(cl={}));var yt;(e=>e.defaultData={states:new Pe,events:new Pe,visible:!0,raycastLock:!1,collision:"visibility",physics:null,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...or.identity,cloner:null})(yt||(yt={}));var ul;(e=>e.defaultData={type:"Empty",...yt.defaultData})(ul||(ul={}));var dl;(e=>e.defaultData={type:"Component",...yt.defaultData})(dl||(dl={}));var qi;(e=>e.defaultData={type:"Mesh",...yt.defaultData,...gn.defaultData})(qi||(qi={}));var ks;(e=>e.defaultData={...yt.defaultData,...or.identity,...Gr.defaultData})(ks||(ks={}));var pl;(e=>{function t(i){return{...yt.defaultData,...pn.defaultData(i)}}e.defaultData=t})(pl||(pl={}));var Fs;(e=>{function t(r,s,o=0){for(;o<s.length;){let n=r?r[s[o]]:void 0;if(s.length===o+1)return n;if(n)r=n.descendants,o+=1;else return}}e.resolveWithDes=t;function i(r,s,o=0){let n=t(r,s,o);if(n){let h=Object.keys(n);if(h.length===1&&h[0]==="descendants")return}return n}e.resolve=i})(Fs||(Fs={}));var nr;(e=>{e.rootOverrideProps=["physics"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,s){return{...yt.defaultData,...s,component:r,overrides:new qe,physics:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let s=or.fromObject(r.data);return t(r.id,s)}e.fromComponentData=i})(nr||(nr={}));var fl;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:sr.identity,name:"Play Camera",visible:!0,raycastLock:!1,collision:"visibility",physics:null,states:new Pe,events:new Pe,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...Gr.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...yt.defaultData,...qi.defaultData,geometry:Wi.defaultData("RectangleGeometry"),material:kt.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...yt.defaultData,...qi.defaultData,geometry:Wi.defaultData("BooleanGeometry"),material:kt.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...yt.defaultData,...qi.defaultData,geometry:Wi.defaultData("TextGeometry"),material:kt.defaultTwoLayerData("phong","layer1","layer2")}))(fl||(fl={}));var Gi;(e=>{function t(o,n){let h={name:n};return o.type==="Mesh"?(h.geometry={},"material"in o&&(h.material={layers:new qe}),"materials"in o&&(h.materials=o.materials.map(a=>({layers:new qe})))):Ei.is(o.type)&&(h.perspective={},h.orthographic={}),h}e.newEmpty=t;function i(o,n){if(n===void 0)return o;let h={...o};return"material"in h&&"material"in n&&n.material&&(h.material=Is(h.material,a=>{if(typeof a!="string")for(let[c,d]of Object.entries(n.material.layers)){let l=a.layers.data(c);l&&ft.patch(l,d)}}).data),h.materials&&n.materials&&(h.materials=Is(h.materials,a=>{var c,d;for(let l=0;l<h.materials.length;l++){let u=n.materials[l];if(typeof u!="string")for(let[p,f]of Object.entries(u.layers)){let g=(d=(c=a[l])==null?void 0:c.layers)==null?void 0:d.data(p);g&&ft.patch(g,f)}}}).data),h}function r(o,n){let h,a=[],c={orthographic:0,perspective:0,geometry:0};function d(l,u){for(let[p,f]of Object.entries(u.layers)){let{texture:g,...v}=f;if(g!==void 0&&Object.keys(g).length>0){let m={path:[...l,"layers",p,"texture"],props:g,type:0};a.push(m)}if(Object.keys(v).length>0){let m={path:[...l,"layers",p],props:v,type:0};a.push(m)}}}for(let[l,u]of Object.entries(n))if(l!=="name")if(l==="cloner")a.push(...un.toOps(u,["cloner"]));else if(l==="pathSnapping")a.push({path:[l],props:{slide:u.slide,offset:u.offset},type:0});else if(l==="material")d(["material"],u);else if(l==="materials")for(let[p,f]of Object.entries(u))d(["materials",p],f);else if(c[l]===0){if(l==="geometry"&&u.extrusion!==void 0){let p={path:[l,"extrusion"],props:u.extrusion,type:0};a.push(p),u={...u},delete u.extrusion}if(Object.keys(u).length>0){let p={path:[l],props:u,type:0};a.push(p)}}else h===void 0&&(h={path:[],props:{},type:0},a.push(h)),h.props[l]=u;return a}e.toOps=r;function s(o,n){var a,c,d,l,u,p;if(n===void 0)return o;let h={...o};if(Object.assign(h,or.merge(h,n)),Object.assign(h,{pathSnapping:Object.assign({},h.pathSnapping,{slide:((a=n.pathSnapping)==null?void 0:a.slide)??((c=h.pathSnapping)==null?void 0:c.slide)??0,offset:((d=n.pathSnapping)==null?void 0:d.offset)??((l=h.pathSnapping)==null?void 0:l.offset)??0})}),Ei.is(o.type)){h.orthographic={...h.orthographic},h.perspective={...h.perspective};let f=n;((u=f.orthographic)==null?void 0:u.zoom)!==void 0&&(h.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(h.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(h.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(h.targetOffset=f.targetOffset)}else if(o.type==="Mesh")"geometry"in n&&Object.assign(h,{geometry:yn.merge(h.geometry,n.geometry)}),(n.material||n.materials)&&(h=i(h,n)),h.cloner&&"cloner"in n&&Object.assign(h,{cloner:si.merge(h.cloner,n.cloner)});else if(o.type==="Empty")h.cloner&&"cloner"in n&&Object.assign(h,{cloner:si.merge(h.cloner,n.cloner)});else if(dn.is(o.type)){let f=n;f.intensity!==void 0&&(h.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?h.color=f.color:h.color=gt.clone(f.color))}return h}e.patch=s})(Gi||(Gi={}));var Gs;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0,autoZoom:!1})(Gs||(Gs={}));var bn;(e=>e.defaultData={orbitControls:Gs.defaultData,playCamera:null,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:typeof window<"u"?Math.floor(window.devicePixelRatio):1,stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,s=0;return i<5?s=-30:i<10&&(s=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,s],"show"]}),gameControlObject:null})(bn||(bn={}));function ar(e,t){return Object.setPrototypeOf(e,t),e}function Dc(e){return Array.isArray(e)?e:[e]}function Ef(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var Mf=typeof global=="object"&&global&&global.Object===Object&&global,Lc=Mf,Df=typeof self=="object"&&self&&self.Object===Object&&self,Lf=Lc||Df||Function("return this")(),Ft=Lf,If=Ft.Symbol,bt=If,Ic=Object.prototype,zf=Ic.hasOwnProperty,Nf=Ic.toString,br=bt?bt.toStringTag:void 0;function Bf(e){var t=zf.call(e,br),i=e[br];try{e[br]=void 0;var r=!0}catch{}var s=Nf.call(e);return r&&(t?e[br]=i:delete e[br]),s}var jf=Bf,Uf=Object.prototype,Rf=Uf.toString;function kf(e){return Rf.call(e)}var Ff=kf,Gf="[object Null]",Vf="[object Undefined]",ml=bt?bt.toStringTag:void 0;function Hf(e){return e==null?e===void 0?Vf:Gf:ml&&ml in Object(e)?jf(e):Ff(e)}var Li=Hf;function Wf(e){return e!=null&&typeof e=="object"}var Yt=Wf,qf="[object Symbol]";function $f(e){return typeof e=="symbol"||Yt(e)&&Li(e)==qf}var ra=$f;function Xf(e,t){for(var i=-1,r=e==null?0:e.length,s=Array(r);++i<r;)s[i]=t(e[i],i,e);return s}var zc=Xf,Yf=Array.isArray,Ct=Yf,Kf=1/0,gl=bt?bt.prototype:void 0,vl=gl?gl.toString:void 0;function Nc(e){if(typeof e=="string")return e;if(Ct(e))return zc(e,Nc)+"";if(ra(e))return vl?vl.call(e):"";var t=e+"";return t=="0"&&1/e==-Kf?"-0":t}var Zf=Nc;function Qf(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Mi=Qf;function Jf(e){return e}var em=Jf,tm="[object AsyncFunction]",im="[object Function]",rm="[object GeneratorFunction]",sm="[object Proxy]";function om(e){if(!Mi(e))return!1;var t=Li(e);return t==im||t==rm||t==tm||t==sm}var Bc=om,nm=Ft["__core-js_shared__"],Co=nm,yl=function(){var e=/[^.]+$/.exec(Co&&Co.keys&&Co.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function am(e){return!!yl&&yl in e}var lm=am,hm=Function.prototype,cm=hm.toString;function um(e){if(e!=null){try{return cm.call(e)}catch{}try{return e+""}catch{}}return""}var Ii=um,dm=/[\\^$.*+?()[\]{}|]/g,pm=/^\[object .+?Constructor\]$/,fm=Function.prototype,mm=Object.prototype,gm=fm.toString,vm=mm.hasOwnProperty,ym=RegExp("^"+gm.call(vm).replace(dm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function bm(e){if(!Mi(e)||lm(e))return!1;var t=Bc(e)?ym:pm;return t.test(Ii(e))}var xm=bm;function wm(e,t){return e==null?void 0:e[t]}var _m=wm;function Sm(e,t){var i=_m(e,t);return xm(i)?i:void 0}var zi=Sm,Am=zi(Ft,"WeakMap"),xn=Am,bl=Object.create,Om=function(){function e(){}return function(t){if(!Mi(t))return{};if(bl)return bl(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Cm=Om;function Pm(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var Tm=Pm;function Em(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var Mm=Em,Dm=800,Lm=16,Im=Date.now;function zm(e){var t=0,i=0;return function(){var r=Im(),s=Lm-(r-i);if(i=r,s>0){if(++t>=Dm)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Nm=zm;function Bm(e){return function(){return e}}var jm=Bm,Um=function(){try{var e=zi(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Vs=Um,Rm=Vs?function(e,t){return Vs(e,"toString",{configurable:!0,enumerable:!1,value:jm(t),writable:!0})}:em,km=Rm,Fm=Nm(km),Gm=Fm;function Vm(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var Hm=Vm,Wm=9007199254740991,qm=/^(?:0|[1-9]\d*)$/;function $m(e,t){var i=typeof e;return t=t??Wm,!!t&&(i=="number"||i!="symbol"&&qm.test(e))&&e>-1&&e%1==0&&e<t}var sa=$m;function Xm(e,t,i){t=="__proto__"&&Vs?Vs(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var jc=Xm;function Ym(e,t){return e===t||e!==e&&t!==t}var oa=Ym,Km=Object.prototype,Zm=Km.hasOwnProperty;function Qm(e,t,i){var r=e[t];(!(Zm.call(e,t)&&oa(r,i))||i===void 0&&!(t in e))&&jc(e,t,i)}var na=Qm;function Jm(e,t,i,r){var s=!i;i||(i={});for(var o=-1,n=t.length;++o<n;){var h=t[o],a=r?r(i[h],e[h],h,i,e):void 0;a===void 0&&(a=e[h]),s?jc(i,h,a):na(i,h,a)}return i}var Xr=Jm,xl=Math.max;function eg(e,t,i){return t=xl(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,o=xl(r.length-t,0),n=Array(o);++s<o;)n[s]=r[t+s];s=-1;for(var h=Array(t+1);++s<t;)h[s]=r[s];return h[t]=i(n),Tm(e,this,h)}}var tg=eg,ig=9007199254740991;function rg(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ig}var aa=rg;function sg(e){return e!=null&&aa(e.length)&&!Bc(e)}var Uc=sg,og=Object.prototype;function ng(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||og;return e===i}var la=ng;function ag(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var lg=ag,hg="[object Arguments]";function cg(e){return Yt(e)&&Li(e)==hg}var wl=cg,Rc=Object.prototype,ug=Rc.hasOwnProperty,dg=Rc.propertyIsEnumerable,pg=wl(function(){return arguments}())?wl:function(e){return Yt(e)&&ug.call(e,"callee")&&!dg.call(e,"callee")},ha=pg;function fg(){return!1}var mg=fg,kc=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_l=kc&&typeof module=="object"&&module&&!module.nodeType&&module,gg=_l&&_l.exports===kc,Sl=gg?Ft.Buffer:void 0,vg=Sl?Sl.isBuffer:void 0,yg=vg||mg,Hs=yg,bg="[object Arguments]",xg="[object Array]",wg="[object Boolean]",_g="[object Date]",Sg="[object Error]",Ag="[object Function]",Og="[object Map]",Cg="[object Number]",Pg="[object Object]",Tg="[object RegExp]",Eg="[object Set]",Mg="[object String]",Dg="[object WeakMap]",Lg="[object ArrayBuffer]",Ig="[object DataView]",zg="[object Float32Array]",Ng="[object Float64Array]",Bg="[object Int8Array]",jg="[object Int16Array]",Ug="[object Int32Array]",Rg="[object Uint8Array]",kg="[object Uint8ClampedArray]",Fg="[object Uint16Array]",Gg="[object Uint32Array]",Le={};Le[zg]=Le[Ng]=Le[Bg]=Le[jg]=Le[Ug]=Le[Rg]=Le[kg]=Le[Fg]=Le[Gg]=!0;Le[bg]=Le[xg]=Le[Lg]=Le[wg]=Le[Ig]=Le[_g]=Le[Sg]=Le[Ag]=Le[Og]=Le[Cg]=Le[Pg]=Le[Tg]=Le[Eg]=Le[Mg]=Le[Dg]=!1;function Vg(e){return Yt(e)&&aa(e.length)&&!!Le[Li(e)]}var Hg=Vg;function Wg(e){return function(t){return e(t)}}var ca=Wg,Fc=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Br=Fc&&typeof module=="object"&&module&&!module.nodeType&&module,qg=Br&&Br.exports===Fc,Po=qg&&Lc.process,$g=function(){try{var e=Br&&Br.require&&Br.require("util").types;return e||Po&&Po.binding&&Po.binding("util")}catch{}}(),lr=$g,Al=lr&&lr.isTypedArray,Xg=Al?ca(Al):Hg,Gc=Xg,Yg=Object.prototype,Kg=Yg.hasOwnProperty;function Zg(e,t){var i=Ct(e),r=!i&&ha(e),s=!i&&!r&&Hs(e),o=!i&&!r&&!s&&Gc(e),n=i||r||s||o,h=n?lg(e.length,String):[],a=h.length;for(var c in e)(t||Kg.call(e,c))&&!(n&&(c=="length"||s&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||sa(c,a)))&&h.push(c);return h}var Vc=Zg;function Qg(e,t){return function(i){return e(t(i))}}var Hc=Qg,Jg=Hc(Object.keys,Object),e0=Jg,t0=Object.prototype,i0=t0.hasOwnProperty;function r0(e){if(!la(e))return e0(e);var t=[];for(var i in Object(e))i0.call(e,i)&&i!="constructor"&&t.push(i);return t}var s0=r0;function o0(e){return Uc(e)?Vc(e):s0(e)}var ua=o0;function n0(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var a0=n0,l0=Object.prototype,h0=l0.hasOwnProperty;function c0(e){if(!Mi(e))return a0(e);var t=la(e),i=[];for(var r in e)r=="constructor"&&(t||!h0.call(e,r))||i.push(r);return i}var u0=c0;function d0(e){return Uc(e)?Vc(e,!0):u0(e)}var da=d0,p0=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,f0=/^\w*$/;function m0(e,t){if(Ct(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||ra(e)?!0:f0.test(e)||!p0.test(e)||t!=null&&e in Object(t)}var g0=m0,v0=zi(Object,"create"),Vr=v0;function y0(){this.__data__=Vr?Vr(null):{},this.size=0}var b0=y0;function x0(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var w0=x0,_0="__lodash_hash_undefined__",S0=Object.prototype,A0=S0.hasOwnProperty;function O0(e){var t=this.__data__;if(Vr){var i=t[e];return i===_0?void 0:i}return A0.call(t,e)?t[e]:void 0}var C0=O0,P0=Object.prototype,T0=P0.hasOwnProperty;function E0(e){var t=this.__data__;return Vr?t[e]!==void 0:T0.call(t,e)}var M0=E0,D0="__lodash_hash_undefined__";function L0(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Vr&&t===void 0?D0:t,this}var I0=L0;function ur(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}ur.prototype.clear=b0;ur.prototype.delete=w0;ur.prototype.get=C0;ur.prototype.has=M0;ur.prototype.set=I0;var Ol=ur;function z0(){this.__data__=[],this.size=0}var N0=z0;function B0(e,t){for(var i=e.length;i--;)if(oa(e[i][0],t))return i;return-1}var ao=B0,j0=Array.prototype,U0=j0.splice;function R0(e){var t=this.__data__,i=ao(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():U0.call(t,i,1),--this.size,!0}var k0=R0;function F0(e){var t=this.__data__,i=ao(t,e);return i<0?void 0:t[i][1]}var G0=F0;function V0(e){return ao(this.__data__,e)>-1}var H0=V0;function W0(e,t){var i=this.__data__,r=ao(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var q0=W0;function dr(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}dr.prototype.clear=N0;dr.prototype.delete=k0;dr.prototype.get=G0;dr.prototype.has=H0;dr.prototype.set=q0;var lo=dr,$0=zi(Ft,"Map"),Hr=$0;function X0(){this.size=0,this.__data__={hash:new Ol,map:new(Hr||lo),string:new Ol}}var Y0=X0;function K0(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Z0=K0;function Q0(e,t){var i=e.__data__;return Z0(t)?i[typeof t=="string"?"string":"hash"]:i.map}var ho=Q0;function J0(e){var t=ho(this,e).delete(e);return this.size-=t?1:0,t}var ev=J0;function tv(e){return ho(this,e).get(e)}var iv=tv;function rv(e){return ho(this,e).has(e)}var sv=rv;function ov(e,t){var i=ho(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var nv=ov;function pr(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}pr.prototype.clear=Y0;pr.prototype.delete=ev;pr.prototype.get=iv;pr.prototype.has=sv;pr.prototype.set=nv;var co=pr,av="Expected a function";function pa(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(av);var i=function(){var r=arguments,s=t?t.apply(this,r):r[0],o=i.cache;if(o.has(s))return o.get(s);var n=e.apply(this,r);return i.cache=o.set(s,n)||o,n};return i.cache=new(pa.Cache||co),i}pa.Cache=co;var lv=pa,hv=500;function cv(e){var t=lv(e,function(r){return i.size===hv&&i.clear(),r}),i=t.cache;return t}var uv=cv,dv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pv=/\\(\\)?/g,fv=uv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(dv,function(i,r,s,o){t.push(s?o.replace(pv,"$1"):r||i)}),t}),mv=fv;function gv(e){return e==null?"":Zf(e)}var vv=gv;function yv(e,t){return Ct(e)?e:g0(e,t)?[e]:mv(vv(e))}var fr=yv,bv=1/0;function xv(e){if(typeof e=="string"||ra(e))return e;var t=e+"";return t=="0"&&1/e==-bv?"-0":t}var uo=xv;function wv(e,t){t=fr(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[uo(t[i++])];return i&&i==r?e:void 0}var Wc=wv;function _v(e,t){for(var i=-1,r=t.length,s=e.length;++i<r;)e[s+i]=t[i];return e}var fa=_v,Cl=bt?bt.isConcatSpreadable:void 0;function Sv(e){return Ct(e)||ha(e)||!!(Cl&&e&&e[Cl])}var Av=Sv;function qc(e,t,i,r,s){var o=-1,n=e.length;for(i||(i=Av),s||(s=[]);++o<n;){var h=e[o];t>0&&i(h)?t>1?qc(h,t-1,i,r,s):fa(s,h):r||(s[s.length]=h)}return s}var Ov=qc;function Cv(e){var t=e==null?0:e.length;return t?Ov(e,1):[]}var Pv=Cv;function Tv(e){return Gm(tg(e,void 0,Pv),e+"")}var $c=Tv,Ev=Hc(Object.getPrototypeOf,Object),ma=Ev,Mv="[object Object]",Dv=Function.prototype,Lv=Object.prototype,Xc=Dv.toString,Iv=Lv.hasOwnProperty,zv=Xc.call(Object);function Nv(e){if(!Yt(e)||Li(e)!=Mv)return!1;var t=ma(e);if(t===null)return!0;var i=Iv.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Xc.call(i)==zv}var Bv=Nv;function jv(e,t,i){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),i=i>s?s:i,i<0&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;for(var o=Array(s);++r<s;)o[r]=e[r+t];return o}var Uv=jv;function Rv(){this.__data__=new lo,this.size=0}var kv=Rv;function Fv(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var Gv=Fv;function Vv(e){return this.__data__.get(e)}var Hv=Vv;function Wv(e){return this.__data__.has(e)}var qv=Wv,$v=200;function Xv(e,t){var i=this.__data__;if(i instanceof lo){var r=i.__data__;if(!Hr||r.length<$v-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new co(r)}return i.set(e,t),this.size=i.size,this}var Yv=Xv;function mr(e){var t=this.__data__=new lo(e);this.size=t.size}mr.prototype.clear=kv;mr.prototype.delete=Gv;mr.prototype.get=Hv;mr.prototype.has=qv;mr.prototype.set=Yv;var ws=mr;function Kv(e,t){return e&&Xr(t,ua(t),e)}var Zv=Kv;function Qv(e,t){return e&&Xr(t,da(t),e)}var Jv=Qv,Yc=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Pl=Yc&&typeof module=="object"&&module&&!module.nodeType&&module,ey=Pl&&Pl.exports===Yc,Tl=ey?Ft.Buffer:void 0,El=Tl?Tl.allocUnsafe:void 0;function ty(e,t){if(t)return e.slice();var i=e.length,r=El?El(i):new e.constructor(i);return e.copy(r),r}var iy=ty;function ry(e,t){for(var i=-1,r=e==null?0:e.length,s=0,o=[];++i<r;){var n=e[i];t(n,i,e)&&(o[s++]=n)}return o}var sy=ry;function oy(){return[]}var Kc=oy,ny=Object.prototype,ay=ny.propertyIsEnumerable,Ml=Object.getOwnPropertySymbols,ly=Ml?function(e){return e==null?[]:(e=Object(e),sy(Ml(e),function(t){return ay.call(e,t)}))}:Kc,ga=ly;function hy(e,t){return Xr(e,ga(e),t)}var cy=hy,uy=Object.getOwnPropertySymbols,dy=uy?function(e){for(var t=[];e;)fa(t,ga(e)),e=ma(e);return t}:Kc,Zc=dy;function py(e,t){return Xr(e,Zc(e),t)}var fy=py;function my(e,t,i){var r=t(e);return Ct(e)?r:fa(r,i(e))}var Qc=my;function gy(e){return Qc(e,ua,ga)}var wn=gy;function vy(e){return Qc(e,da,Zc)}var Jc=vy,yy=zi(Ft,"DataView"),_n=yy,by=zi(Ft,"Promise"),Sn=by,xy=zi(Ft,"Set"),An=xy,Dl="[object Map]",wy="[object Object]",Ll="[object Promise]",Il="[object Set]",zl="[object WeakMap]",Nl="[object DataView]",_y=Ii(_n),Sy=Ii(Hr),Ay=Ii(Sn),Oy=Ii(An),Cy=Ii(xn),vi=Li;(_n&&vi(new _n(new ArrayBuffer(1)))!=Nl||Hr&&vi(new Hr)!=Dl||Sn&&vi(Sn.resolve())!=Ll||An&&vi(new An)!=Il||xn&&vi(new xn)!=zl)&&(vi=function(e){var t=Li(e),i=t==wy?e.constructor:void 0,r=i?Ii(i):"";if(r)switch(r){case _y:return Nl;case Sy:return Dl;case Ay:return Ll;case Oy:return Il;case Cy:return zl}return t});var Wr=vi,Py=Object.prototype,Ty=Py.hasOwnProperty;function Ey(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&Ty.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var My=Ey,Dy=Ft.Uint8Array,Ws=Dy;function Ly(e){var t=new e.constructor(e.byteLength);return new Ws(t).set(new Ws(e)),t}var va=Ly;function Iy(e,t){var i=t?va(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var zy=Iy,Ny=/\w*$/;function By(e){var t=new e.constructor(e.source,Ny.exec(e));return t.lastIndex=e.lastIndex,t}var jy=By,Bl=bt?bt.prototype:void 0,jl=Bl?Bl.valueOf:void 0;function Uy(e){return jl?Object(jl.call(e)):{}}var Ry=Uy;function ky(e,t){var i=t?va(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var Fy=ky,Gy="[object Boolean]",Vy="[object Date]",Hy="[object Map]",Wy="[object Number]",qy="[object RegExp]",$y="[object Set]",Xy="[object String]",Yy="[object Symbol]",Ky="[object ArrayBuffer]",Zy="[object DataView]",Qy="[object Float32Array]",Jy="[object Float64Array]",e1="[object Int8Array]",t1="[object Int16Array]",i1="[object Int32Array]",r1="[object Uint8Array]",s1="[object Uint8ClampedArray]",o1="[object Uint16Array]",n1="[object Uint32Array]";function a1(e,t,i){var r=e.constructor;switch(t){case Ky:return va(e);case Gy:case Vy:return new r(+e);case Zy:return zy(e,i);case Qy:case Jy:case e1:case t1:case i1:case r1:case s1:case o1:case n1:return Fy(e,i);case Hy:return new r;case Wy:case Xy:return new r(e);case qy:return jy(e);case $y:return new r;case Yy:return Ry(e)}}var l1=a1;function h1(e){return typeof e.constructor=="function"&&!la(e)?Cm(ma(e)):{}}var c1=h1,u1="[object Map]";function d1(e){return Yt(e)&&Wr(e)==u1}var p1=d1,Ul=lr&&lr.isMap,f1=Ul?ca(Ul):p1,m1=f1,g1="[object Set]";function v1(e){return Yt(e)&&Wr(e)==g1}var y1=v1,Rl=lr&&lr.isSet,b1=Rl?ca(Rl):y1,x1=b1,w1=1,_1=2,S1=4,eu="[object Arguments]",A1="[object Array]",O1="[object Boolean]",C1="[object Date]",P1="[object Error]",tu="[object Function]",T1="[object GeneratorFunction]",E1="[object Map]",M1="[object Number]",iu="[object Object]",D1="[object RegExp]",L1="[object Set]",I1="[object String]",z1="[object Symbol]",N1="[object WeakMap]",B1="[object ArrayBuffer]",j1="[object DataView]",U1="[object Float32Array]",R1="[object Float64Array]",k1="[object Int8Array]",F1="[object Int16Array]",G1="[object Int32Array]",V1="[object Uint8Array]",H1="[object Uint8ClampedArray]",W1="[object Uint16Array]",q1="[object Uint32Array]",Ee={};Ee[eu]=Ee[A1]=Ee[B1]=Ee[j1]=Ee[O1]=Ee[C1]=Ee[U1]=Ee[R1]=Ee[k1]=Ee[F1]=Ee[G1]=Ee[E1]=Ee[M1]=Ee[iu]=Ee[D1]=Ee[L1]=Ee[I1]=Ee[z1]=Ee[V1]=Ee[H1]=Ee[W1]=Ee[q1]=!0;Ee[P1]=Ee[tu]=Ee[N1]=!1;function _s(e,t,i,r,s,o){var n,h=t&w1,a=t&_1,c=t&S1;if(i&&(n=s?i(e,r,s,o):i(e)),n!==void 0)return n;if(!Mi(e))return e;var d=Ct(e);if(d){if(n=My(e),!h)return Mm(e,n)}else{var l=Wr(e),u=l==tu||l==T1;if(Hs(e))return iy(e,h);if(l==iu||l==eu||u&&!s){if(n=a||u?{}:c1(e),!h)return a?fy(e,Jv(n,e)):cy(e,Zv(n,e))}else{if(!Ee[l])return s?e:{};n=l1(e,l,h)}}o||(o=new ws);var p=o.get(e);if(p)return p;o.set(e,n),x1(e)?e.forEach(function(v){n.add(_s(v,t,i,v,e,o))}):m1(e)&&e.forEach(function(v,m){n.set(m,_s(v,t,i,m,e,o))});var f=c?a?Jc:wn:a?da:ua,g=d?void 0:f(e);return Hm(g||e,function(v,m){g&&(m=v,v=e[m]),na(n,m,_s(v,t,i,m,e,o))}),n}var ru=_s,$1=1,X1=4;function Y1(e){return ru(e,$1|X1)}var po=Y1,K1="__lodash_hash_undefined__";function Z1(e){return this.__data__.set(e,K1),this}var Q1=Z1;function J1(e){return this.__data__.has(e)}var eb=J1;function qs(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new co;++t<i;)this.add(e[t])}qs.prototype.add=qs.prototype.push=Q1;qs.prototype.has=eb;var tb=qs;function ib(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var rb=ib;function sb(e,t){return e.has(t)}var ob=sb,nb=1,ab=2;function lb(e,t,i,r,s,o){var n=i&nb,h=e.length,a=t.length;if(h!=a&&!(n&&a>h))return!1;var c=o.get(e),d=o.get(t);if(c&&d)return c==t&&d==e;var l=-1,u=!0,p=i&ab?new tb:void 0;for(o.set(e,t),o.set(t,e);++l<h;){var f=e[l],g=t[l];if(r)var v=n?r(g,f,l,t,e,o):r(f,g,l,e,t,o);if(v!==void 0){if(v)continue;u=!1;break}if(p){if(!rb(t,function(m,y){if(!ob(p,y)&&(f===m||s(f,m,i,r,o)))return p.push(y)})){u=!1;break}}else if(!(f===g||s(f,g,i,r,o))){u=!1;break}}return o.delete(e),o.delete(t),u}var su=lb;function hb(e){var t=-1,i=Array(e.size);return e.forEach(function(r,s){i[++t]=[s,r]}),i}var cb=hb;function ub(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var db=ub,pb=1,fb=2,mb="[object Boolean]",gb="[object Date]",vb="[object Error]",yb="[object Map]",bb="[object Number]",xb="[object RegExp]",wb="[object Set]",_b="[object String]",Sb="[object Symbol]",Ab="[object ArrayBuffer]",Ob="[object DataView]",kl=bt?bt.prototype:void 0,To=kl?kl.valueOf:void 0;function Cb(e,t,i,r,s,o,n){switch(i){case Ob:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ab:return!(e.byteLength!=t.byteLength||!o(new Ws(e),new Ws(t)));case mb:case gb:case bb:return oa(+e,+t);case vb:return e.name==t.name&&e.message==t.message;case xb:case _b:return e==t+"";case yb:var h=cb;case wb:var a=r&pb;if(h||(h=db),e.size!=t.size&&!a)return!1;var c=n.get(e);if(c)return c==t;r|=fb,n.set(e,t);var d=su(h(e),h(t),r,s,o,n);return n.delete(e),d;case Sb:if(To)return To.call(e)==To.call(t)}return!1}var Pb=Cb,Tb=1,Eb=Object.prototype,Mb=Eb.hasOwnProperty;function Db(e,t,i,r,s,o){var n=i&Tb,h=wn(e),a=h.length,c=wn(t),d=c.length;if(a!=d&&!n)return!1;for(var l=a;l--;){var u=h[l];if(!(n?u in t:Mb.call(t,u)))return!1}var p=o.get(e),f=o.get(t);if(p&&f)return p==t&&f==e;var g=!0;o.set(e,t),o.set(t,e);for(var v=n;++l<a;){u=h[l];var m=e[u],y=t[u];if(r)var _=n?r(y,m,u,t,e,o):r(m,y,u,e,t,o);if(!(_===void 0?m===y||s(m,y,i,r,o):_)){g=!1;break}v||(v=u=="constructor")}if(g&&!v){var x=e.constructor,S=t.constructor;x!=S&&"constructor"in e&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof S=="function"&&S instanceof S)&&(g=!1)}return o.delete(e),o.delete(t),g}var Lb=Db,Ib=1,Fl="[object Arguments]",Gl="[object Array]",is="[object Object]",zb=Object.prototype,Vl=zb.hasOwnProperty;function Nb(e,t,i,r,s,o){var n=Ct(e),h=Ct(t),a=n?Gl:Wr(e),c=h?Gl:Wr(t);a=a==Fl?is:a,c=c==Fl?is:c;var d=a==is,l=c==is,u=a==c;if(u&&Hs(e)){if(!Hs(t))return!1;n=!0,d=!1}if(u&&!d)return o||(o=new ws),n||Gc(e)?su(e,t,i,r,s,o):Pb(e,t,a,i,r,s,o);if(!(i&Ib)){var p=d&&Vl.call(e,"__wrapped__"),f=l&&Vl.call(t,"__wrapped__");if(p||f){var g=p?e.value():e,v=f?t.value():t;return o||(o=new ws),s(g,v,i,r,o)}}return u?(o||(o=new ws),Lb(e,t,i,r,s,o)):!1}var Bb=Nb;function ou(e,t,i,r,s){return e===t?!0:e==null||t==null||!Yt(e)&&!Yt(t)?e!==e&&t!==t:Bb(e,t,i,r,ou,s)}var jb=ou;function Ub(e,t){return e!=null&&t in Object(e)}var Rb=Ub;function kb(e,t,i){t=fr(t,e);for(var r=-1,s=t.length,o=!1;++r<s;){var n=uo(t[r]);if(!(o=e!=null&&i(e,n)))break;e=e[n]}return o||++r!=s?o:(s=e==null?0:e.length,!!s&&aa(s)&&sa(n,s)&&(Ct(e)||ha(e)))}var Fb=kb;function Gb(e,t){return e!=null&&Fb(e,t,Rb)}var Vb=Gb;function Hb(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Wb=Hb;function qb(e,t){return t.length<2?e:Wc(e,Uv(t,0,-1))}var $b=qb;function Xb(e,t){return jb(e,t)}var nu=Xb;function Yb(e,t){return t=fr(t,e),e=$b(e,t),e==null||delete e[uo(Wb(t))]}var Kb=Yb;function Zb(e){return Bv(e)?void 0:e}var Qb=Zb,Jb=1,ex=2,tx=4,ix=$c(function(e,t){var i={};if(e==null)return i;var r=!1;t=zc(t,function(o){return o=fr(o,e),r||(r=o.length>1),o}),Xr(e,Jc(e),i),r&&(i=ru(i,Jb|ex|tx,Qb));for(var s=t.length;s--;)Kb(i,t[s]);return i}),On=ix;function rx(e,t,i,r){if(!Mi(e))return e;t=fr(t,e);for(var s=-1,o=t.length,n=o-1,h=e;h!=null&&++s<o;){var a=uo(t[s]),c=i;if(a==="__proto__"||a==="constructor"||a==="prototype")return e;if(s!=n){var d=h[a];c=r?r(d,a,h):void 0,c===void 0&&(c=Mi(d)?d:sa(t[s+1])?[]:{})}na(h,a,c),h=h[a]}return e}var sx=rx;function ox(e,t,i){for(var r=-1,s=t.length,o={};++r<s;){var n=t[r],h=Wc(e,n);i(h,n)&&sx(o,fr(n,e),h)}return o}var nx=ox;function ax(e,t){return nx(e,t,function(i,r){return Vb(e,r)})}var lx=ax,hx=$c(function(e,t){return e==null?{}:lx(e,t)}),$s=hx,Xs;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="})(Xs||(Xs={}));var Cn;(e=>{function t(){let s={};return s["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},ar(s,ke.prototype)}e.defaultColors=t;function i(s){let o={};return s!=null&&s.withAITexture&&(o["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...Xs.emptyImage,name:"AI generated image"}),ar(o,ke.prototype)}e.defaultImages=i;function r(){return{materials:new ke,images:new ke,videos:new ke,colors:new ke,audios:new ke,fonts:new ke,penumbraSize:[2,2,2]}}e.emptyData=r})(Cn||(Cn={}));function Hl(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,s=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],o=[0,1];for(let h=2;h<10;h++)s.push(s[1]),o.push(1);let n={...$s($e(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:s,steps:o,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,n)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...$e(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Ss(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function As(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach(s=>{typeof s!="string"&&t(s)}):"material"in r&&typeof r.material!="string"&&t(r.material)})}function cx(e){Object.assign(e.scene.publish,{orbitControls:{...Gs.defaultData,...$e(e.scene.publish.orbitControls)}})}function ux(e){Object.assign(e.scene.publish.settings,{video:{...bn.defaultData.settings.video,...$e(e.scene.publish.settings.video)}})}function dx(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[s,o]of Object.entries(r))if((Cf.includes(s)||typeof o=="boolean")&&delete r[s],s==="texture")for(let[n,h]of Object.entries(o))(Pf.includes(n)||typeof h=="boolean")&&delete o[n]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(s=>{let o=s;o.material?t(o.material):o.materials&&o.materials.forEach(n=>{t(n)})})})}function px(e){e.scene.publish.withBackground=!0}function fx(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function mx(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(s=>s+1),r.linear.scale=r.linear.scale.map(s=>s+1))})}function gx(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function vx(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let s=$e(e.scene.objects.data(r));s&&s.type==="Mesh"&&s.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=$e(i).booleanExclude!==!0)}})}function yx(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function bx(e){function t(r){Object.setPrototypeOf(r,qe.prototype),r.texture&&Object.setPrototypeOf(r.texture,qe.prototype)}function i(r){Object.setPrototypeOf(r,qe.prototype);for(let s in r)t(r[s])}e.scene.objects.traverse((r,s)=>{s.states.forEach(o=>{let n=o;if(n.material){let h=$e(n.material).layers;i(h),n.material.layers=h}if(n.materials)for(let h=0;h<n.materials.length;h++){let a=n.materials[h],c=$e(a).layers;i(c),a.layers=c}})})}function Wl(e){e.layers===void 0&&Object.assign(e,kt.defaultTwoLayerData("lambert"))}function Eo(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let s={...$e(t),colors:i,steps:r};Object.assign(t,s)}})}function xx(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function ql(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&Eo(r)}):"material"in i&&typeof i.material!="string"&&Eo(i.material)}),Object.values(e.shared.materials).forEach(t=>Eo(t))}function wx(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function _x(e){e.shared.audios=ar({},ke.prototype)}function Sx(e){e.shared.videos=ar({},ke.prototype)}function Ax(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let s={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:s})}})}function Ox(e){Object.entries($e(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries($e(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function Cx(e){e.scene.publish.settings.web.preload=!1}function $l(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function Px(e){e.shared.fonts=ar({},ke.prototype)}function Tx(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function Ex(e){let t=[];e.scene.objects.traverse((i,r)=>{let s=r;if(s.type==="TextFrame"){let o=kt.defaultTwoLayerData("phong"),n=typeof s.color=="string"?e.shared.colors[s.color]:s.color;o.layers[1].data.color={r:n.r,g:n.g,b:n.b},o.layers[1].data.alpha=s.alpha;let h=Tx(s.font);e.shared.fonts[h]===void 0&&(e.shared.fonts[h]={name:h});let a={name:s.name,...yt.defaultData,...qi.defaultData,flatShading:!1,wireframe:!1,geometry:{...Wi.defaultData("TextGeometry"),width:s.width,height:s.height,font:h,depth:0,horizontalAlign:s.horizontalAlign,verticalAlign:s.verticalAlign,fontSize:s.fontSize*1.40625,lineHeight:s.lineHeight/1.40625,letterSpacing:s.letterSpacing-1,text:s.text,textTransform:s.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:o,states:$e(s.states),events:$e(s.events),visible:s.visible,raycastLock:s.raycastLock,position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix},c=$e(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:a,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function Mx(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(s=>{if(t[Number(s.type)])if(Object.assign(s,{type:t[Number(s.type)]}),s.type==="Audio"&&"audioEvent"in s&&(Object.assign(s,{playAudio:s.audioEvent}),delete s.audioEvent),s.type==="GameControl")Object.assign(s,{gameActions:{idle:new Pe,move:new Pe,jump:new Pe}});else{let o=new Pe;Object.assign(s,{actions:o}),(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="KeyDown"||s.type==="KeyUp")&&"url"in s&&o.push({fi:0,id:Ne.generateUUID(),data:{type:"Link",url:s.url,delay:0}}),"targets"in s&&(s.targets.forEach((n,h,a)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},d={easing:n.easing,duration:n.duration};n.easing===6?Object.assign(d,$s(n,"mass","stiffness","damping","velocity")):n.easing===5&&Object.assign(d,{control1:{...n.control1},control2:{...n.control2}});let l={repeat:n.repeat?-1:0,delay:n.delay,delayDirection:n.delayDirection,direction:n.cycle&&n.rewind?"pingpong-rewind":n.cycle?"pingpong":"normal"},u={state:n.state,...l,...d},p={allowSlerp:!0,type:"Transition",object:n.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Pe({fi:0,id:Ne.generateUUID(),data:c},{fi:1,id:Ne.generateUUID(),data:u})};o.push({fi:a,id:h,data:p})}),delete s.targets)}})})}function Dx(e){e.scene.objects.traverse((t,i)=>{function r(s,o){var a;let n=new Pe,h=[];if(i.events.forEach((c,d,l)=>{if(c.type==="Audio"&&c.trigger===o){let u;h.push(d),c.interaction==="play"?u={...$s(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(u={...$s(c,"interaction","delay","object","playAudio"),type:"Audio"}),u&&n.push({fi:l,id:d,data:u})}}),h.forEach(c=>i.events.delete(c)),n.length){let c=(a=i.events.find(d=>d.type===s))==null?void 0:a.data;c?"actions"in c&&c.actions.insertBefore(null,n):i.events.insertBefore(null,[{id:Ne.generateUUID(),data:{type:s,actions:n}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function Xl(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=ft.defaultData("light","phong"),s=t;Object.assign(s,r),s.visible=!1}}function Yl(e){Ss(e,Xl),As(e,Xl)}function Lx(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function Ix(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function zx(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=kt.defaultTwoLayerData("phong"))})}function Nx(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function Bx(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function jx(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function Ux(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function Rx(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function kx(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}var Kl=37;function Fx(e){let t=e.schema??0;t!==Kl&&(console.warn("updating from ",t,"to ",Kl),t<1&&(As(e,Hl),Ss(e,Hl),e.schema=1),t<2&&(cx(e),e.schema=2),t<3&&(dx(e),e.schema=3),t<4&&(px(e),e.schema=4),t<5&&(fx(e),e.schema=5),t<6&&(mx(e),e.schema=6),t<7&&(gx(e),e.schema=7),t<8&&(e.schema=8),t<9&&(ql(e),e.schema=9),t<10&&(xx(e),e.schema=10),t<11&&(wx(e),e.schema=11),t<12&&(ql(e),e.schema=12),t<13&&(_x(e),e.schema=13),t<14&&(Ax(e),e.schema=14),t<15&&(Ox(e),e.schema=15),t<16&&(Cx(e),e.schema=16),t<17&&(As(e,$l),Ss(e,$l),e.schema=17),t<18&&(As(e,Wl),Ss(e,Wl),e.schema=18),t<19&&(ux(e),e.schema=19),t<20&&(Px(e),Ex(e),e.schema=20),t<21&&(Mx(e),Dx(e),e.schema=21),t<22&&(Yl(e),e.schema=22),t<23&&(Lx(e),e.schema=23),t<24&&(Ix(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(Sx(e),t<25&&(e.schema=25)),t<26&&(vx(e),e.schema=26),t<27&&(yx(e),e.schema=27),t<28&&(Yl(e),e.schema=28),t<29&&(bx(e),e.schema=29),t<30&&(zx(e),e.schema=30),t<31&&(Nx(e),e.schema=31),t<33&&(Bx(e),e.schema=33),t<34&&(jx(e),e.schema=34),t<35&&(Ux(e),e.schema=35),t<36&&(Rx(e),e.schema=36),t<37&&(kx(e),e.schema=37))}var xr=to(Wp()),Gx=.5*(Math.sqrt(3)-1),wr=(3-Math.sqrt(3))/6,Vx=1/3,Mt=1/6,jr=e=>Math.floor(e)|0,Zl=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Mo=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Do(e=Math.random){let t=au(e),i=new Float64Array(t).map(s=>Zl[s%12*2]),r=new Float64Array(t).map(s=>Zl[s%12*2+1]);return function(s,o){let n=0,h=0,a=0,c=(s+o)*Gx,d=jr(s+c),l=jr(o+c),u=(d+l)*wr,p=d-u,f=l-u,g=s-p,v=o-f,m,y;g>v?(m=1,y=0):(m=0,y=1);let _=g-m+wr,x=v-y+wr,S=g-1+2*wr,b=v-1+2*wr,A=d&255,O=l&255,P=.5-g*g-v*v;if(P>=0){let M=A+t[O],z=i[M],W=r[M];P*=P,n=P*P*(z*g+W*v)}let w=.5-_*_-x*x;if(w>=0){let M=A+m+t[O+y],z=i[M],W=r[M];w*=w,h=w*w*(z*_+W*x)}let C=.5-S*S-b*b;if(C>=0){let M=A+1+t[O+1],z=i[M],W=r[M];C*=C,a=C*C*(z*S+W*b)}return 70*(n+h+a)}}function Hx(e=Math.random){let t=au(e),i=new Float64Array(t).map(o=>Mo[o%12*3]),r=new Float64Array(t).map(o=>Mo[o%12*3+1]),s=new Float64Array(t).map(o=>Mo[o%12*3+2]);return function(o,n,h){let a,c,d,l,u=(o+n+h)*Vx,p=jr(o+u),f=jr(n+u),g=jr(h+u),v=(p+f+g)*Mt,m=p-v,y=f-v,_=g-v,x=o-m,S=n-y,b=h-_,A,O,P,w,C,M;x>=S?S>=b?(A=1,O=0,P=0,w=1,C=1,M=0):x>=b?(A=1,O=0,P=0,w=1,C=0,M=1):(A=0,O=0,P=1,w=1,C=0,M=1):S<b?(A=0,O=0,P=1,w=0,C=1,M=1):x<b?(A=0,O=1,P=0,w=0,C=1,M=1):(A=0,O=1,P=0,w=1,C=1,M=0);let z=x-A+Mt,W=S-O+Mt,Q=b-P+Mt,re=x-w+2*Mt,$=S-C+2*Mt,V=b-M+2*Mt,H=x-1+3*Mt,I=S-1+3*Mt,j=b-1+3*Mt,L=p&255,N=f&255,R=g&255,G=.6-x*x-S*S-b*b;if(G<0)a=0;else{let F=L+t[N+t[R]];G*=G,a=G*G*(i[F]*x+r[F]*S+s[F]*b)}let U=.6-z*z-W*W-Q*Q;if(U<0)c=0;else{let F=L+A+t[N+O+t[R+P]];U*=U,c=U*U*(i[F]*z+r[F]*W+s[F]*Q)}let k=.6-re*re-$*$-V*V;if(k<0)d=0;else{let F=L+w+t[N+C+t[R+M]];k*=k,d=k*k*(i[F]*re+r[F]*$+s[F]*V)}let q=.6-H*H-I*I-j*j;if(q<0)l=0;else{let F=L+1+t[N+1+t[R+1]];q*=q,l=q*q*(i[F]*H+r[F]*I+s[F]*j)}return 32*(a+c+d+l)}}function au(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),s=t[i];t[i]=t[r],t[r]=s}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var wt=new Vn,Wx=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let s=1;wt.a.fromBufferAttribute(e,r),wt.b.fromBufferAttribute(e,r+1),wt.c.fromBufferAttribute(e,r+2),s*=wt.getArea(),t[r/3]=s}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,s=-1;for(;i<=r;){let o=Math.ceil((i+r)/2);if(o===0||t[o-1]<=e&&t[o]>e){s=o;break}else e<t[o]?r=o-1:i=o+1}return s}sampleFace(e,t,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),wt.a.fromBufferAttribute(this.positionAttribute,e*3),wt.b.fromBufferAttribute(this.positionAttribute,e*3+1),wt.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(wt.a,r).addScaledVector(wt.b,s).addScaledVector(wt.c,1-(r+s)),wt.getNormal(i),this}},qx=to(qp()),$x=new me,Xx=new me,Yx=new me,Ys;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(Ys||(Ys={}));var ya=e=>class extends e{constructor(){super(...arguments),this.hiddenMatrix=new me,this.matrixWorldRigid=new me,this.shearScale=new me,this.shearScaleInv=new me}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof Ti&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let s of this.children)s.updateWorldMatrix(!1,!0)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Ys.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:s,q:o}=(0,qx.SVD)(i),n=$x.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),h=Xx.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),a=Yx.copy(h).transpose();this.shearScale.makeScale(o[0],o[1],o[2]).multiply(a).premultiply(h),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(n,a).copyPosition(this.matrixWorld),o.every(c=>Math.abs(o[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new me().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof me?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}},Kx=class extends ya(Ti){},Zx=e=>e.type==="Mesh",Lr=class extends Kx{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new Lr(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return Zx(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},xi=new T,wi=new T,$i=new me,lu=[new T(-1,1,1),new T(-1,-1,1),new T(1,-1,1),new T(1,1,1),new T(-1,1,-1),new T(-1,-1,-1),new T(1,-1,-1),new T(1,1,-1)],Qx=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],Jx=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Ql=(e,t,i)=>{e.updateEntityBoxSize(xi,wi),$i.copy(t).multiply(e.matrixWorld),wi.x===0&&wi.y===0&&wi.z===0?i.push(new T(xi.x,xi.y,xi.z).applyMatrix4($i)):lu.forEach(r=>{i.push(r.clone().multiply(wi).add(xi).applyMatrix4($i))})},Jl=class extends Di{constructor(){super(...arguments),this.matrix=new me,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new me().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(s=>{(s.visible||s.cloner&&s.data.visible)&&Ql(s,t,r)}):Ql(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4($i.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(wi).multiplyScalar(.5),this.getCenter(xi),$i.copy(this.matrix).setPosition(xi),this.vertices=lu.map(e=>e.clone().multiply(wi).applyMatrix4($i))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=Qx.map(([e,t])=>new wp(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new T))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=Jx.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},oi={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},ew=class extends Sp{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),s=r[r.length-1]/r.length;for(let o=0,n=this.curves;o<n.length;o++){let h=n[o],a=o===0?r[o]:r[o]-r[o-1],c=Math.ceil(e*a/s),d=h.getPoints(c);for(let l=0;l<d.length;l++){let u=d[l];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},Pn=.001;function Tn(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=Pn}function Lo(e,t){let i=new T(...e.position),r=new T(...e.controlNext.position),s=new T(...t.controlPrevious.position),o=new T(...t.position);return Tn(i,r,o)&&Tn(i,s,o)}function hu(e){let t=e.points.map(d=>new T(...d.data.position)),i=[e.points[0]],r=new T(...i[0].data.position);for(let d=0;d<e.points.length-1;d++)Tn(r,t[d],t[d+1])||(i.push(e.points[d]),r=t[d]);i.push(e.points[e.points.length-1]);let s=e.isClosed,o=i.length-(s?0:1),n=i.length,h=[];for(let d=0;d<n;d++){let l=i[d].data,u=new T(...l.position),p=new T(...l.controlPrevious.position),f=new T(...l.controlNext.position),g={position:u,baseRoundness:l.roundness,controlPrevious:p,controlNext:f};if(l.roundness===0||!e.isClosed&&(d===0||d===n-1)){h[d]={...g,removedLength:0};continue}let v=s&&d==0?n-1:d-1,m=s&&d==n-1?0:d+1,y=i[v].data,_=i[m].data,x=new T(...y.position),S=new T(..._.position),b=x.clone().sub(u).normalize(),A=S.clone().sub(u).normalize();Object.assign(g,{prevDir:b,nextDir:A});let O=Lo(y,l),P=Lo(l,_);if(!O||!P)h[d]={...g,removedLength:0};else{let w=b.clone().add(A).normalize(),C=w.clone().cross(b).length()/b.dot(w);h[d]={...g,tan:C,removedLength:l.roundness/C}}}for(let d=0;d<o;d++){let l=d,u=s&&d===n-1?0:d+1,p=h[l],f=h[u];if(p.removedLength!==0||f.removedLength!==0){let g=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,g/2),f.removedLength=Math.min(f.removedLength,g/2)}}let a=[];for(let d=0;d<o;d++){let l=d,u=s&&d===n-1?0:d+1,p=h[l],f=h[u],g=null;if(!Lo(i[l].data,i[u].data))p.position.distanceTo(f.position)>Pn&&(g=new xo(p.position,p.controlNext,f.controlPrevious,f.position));else{let v=p.position.clone(),m=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&v.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&m.add(f.prevDir.clone().setLength(f.removedLength))),v.distanceTo(m)>Pn&&(g=new xo(v,v.clone().lerp(m,.3),m.clone().lerp(v,.3),m))}a[2*d+1]=g}for(let d=0;d<n;d++){let l=h[d];if(l.removedLength===0){a[2*d]=null;continue}let u=l.position,p=l.prevDir.clone().multiplyScalar(l.removedLength).add(u),f=l.nextDir.clone().multiplyScalar(l.removedLength).add(u),g=l.tan*l.removedLength,v=l.prevDir.clone().add(l.nextDir).normalize(),m=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,_=v.clone().multiplyScalar(Math.sqrt(Math.pow(g,2)-Math.pow(y,2))).add(m),x=v.clone().multiplyScalar(-g).add(_),S=u.distanceTo(x)/u.distanceTo(m),b=l.prevDir.clone().multiplyScalar(S*u.distanceTo(p)).add(u),A=b.clone().lerp(x,2),O=p.clone().lerp(b,4/3),P=f.clone().lerp(A,4/3);a[2*d]=new xo(p,O,P,f)}let c=new ew;return a.forEach(d=>{d&&c.add(d)}),c}var Me;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Me||(Me={}));var _r=e=>Me.is(e),tw={type:"completeState",isfromEntity:!0},cu=e=>class extends ya(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new Jl,this._recursiveBBox=new Jl,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Me.is(i))return i}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Me.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let s of this.data.states)Gi.toOps(this.data,s.data).forEach(o=>{let n=sn.replaceProps(o,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,i)});if(t!==null){let s=this.data.states.data(t);s&&(this.dataPatched=Gi.patch(this.data,s),Gi.toOps(this.data,s).forEach(o=>{this.updateByPatchedOp(o,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{_r(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Me.is(i[r]))return i[r];if(Me.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Me.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)_r(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Me.is(i)&&t(i)})}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)_r(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)_r(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>_r(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return On(i,t)}updateTransformState(t){let i=!1;return t.position&&(this.position.fromArray(t.position),i=!0),t.rotation&&(this.rotation.fromArray(t.rotation),i=!0),t.scale&&(i=!0,this.scale.fromArray(t.scale)),t.hiddenMatrix!==void 0&&(i=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??sr.identity)),i&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(r=>{r.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),i}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Me.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Me.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return On(i,t)}updateByOp(t,i,r,s){let o=this.data;this.data=i;let n=t,h=ti(t.path,["states","*"]);if(h!==null){if(t.type===0){let[a]=h;if((this==null?void 0:this.stateSelection)===a){let c={...t.props};if(Object.values(t.props).some(d=>d===void 0)){let d=this.data;if(d!==void 0){let l=Rt.zoom(d,t.path.slice(2));if(l)for(let u in t.props)t.props[u]===void 0&&u in l&&(c[u]=l[u])}}n={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let a=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(a!==void 0){if(t.props.name!==void 0&&a.name){let{name:d,...l}=a;a=l}if(t.props.material!==void 0&&"material"in a){let{material:d,...l}=a;a=l}let c=Rt.removeOverridden(t.path,t.props,a);n={...t,props:c}}}if(this.updateByPatchedOpBase(n,Gi.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),ti(t.path,["overrides"])){let a=[],c=[...t.path];for(a.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)a.push(c[1]),c.splice(0,2);if(a[a.length-1]===void 0){if(t.type===0)for(let d of Object.keys(t.props)){a[a.length-1]=d;let l=r.scene.findInstance([this.uuid,...a]);l&&(l.overrideData=t.props[d],l.updateState(Oi.apply(l.component.data,l.overrideData),r))}}else{let d=r.scene.findInstance([this.uuid,...a]);if(d){let l=Rt.zoom(d.component.data,c);if(t={...t,path:c},t.type===0){let u=t.props;if(l)for(let[p,f]of Object.entries(t.props))f===void 0&&(u===t.props&&(u={...t.props}),u[p]=l[p]);t={...t,props:u}}d.overrideData=Fs.resolve(i.overrides,a),d.updateByOp(t,nt.applySimple(d.data,t),r,!1)}}}else if(this.instances.length>0){let a;if(t.path.length===0&&t.type===0){let c;for(let d of nr.rootOverrideProps)d in t.props&&(c===void 0&&(c={}),c[d]=t.props[d]);c&&(a={...t,props:c})}else for(let c of nr.rootOverrideProps)if(ti(t.path,[c])){a=t;break}a!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let d=Oi.filterOp(c.overrideData,a);d&&c.updateByOp(d,nt.applySimple(c.data,d),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let d=Oi.filterOp(c.overrideData,t);if(d){let l;o===c.data&&t===d?l=i:l=nt.applySimple(c.data,d),c.updateByOp(d,l,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Ei.is(t.props.type)&&oi.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){oi.changeEntityProptotype(this,i,r);for(let s of this.children)Me.is(s)&&s.updateVisible()}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0&&this.updateState(t.props,r),ti(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),ti(t.path,["cloner"])!==null){let s=nt.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible()}}updatePathSnapping(t){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,g,v,m,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((g=this._updatedPathSnapping)==null?void 0:g.slide)??this.dataPatched.pathSnapping.slide??0,s=((v=this._updatedPathSnapping)==null?void 0:v.offset)??this.dataPatched.pathSnapping.offset,o=((m=this._updatedPathSnapping)==null?void 0:m.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let n=t.find(i);if(!n||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let h=n.data,a=hu(h.geometry.path),c=(r+s)%1,d=a.getPointAt(c),l=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new me;n.updateMatrixWorld();let u=new me().multiplyMatrices(l.clone().invert(),n.matrixWorld);d.applyMatrix4(u);let p={position:d.toArray(),rotation:h.rotation};if(o==="tangential"){let _=new me().extractRotation(n.matrixWorld),x=a.getTangentAt(c).applyMatrix4(_).add(d),S=new me().lookAt(d,x,new T(0,1,0)),b=new bs().setFromRotationMatrix(S);p={...p,rotation:[b.x,b.y,b.z]}}this.updateTransformState(p),this.traverseEntity(_=>{_._cameraType&&_.dispatchEvent(tw)})}updateVisible(){var t;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((t=this.dataPatched.cloner)==null?void 0:t.hideBase)!==!0)}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible()),this.updateTransformState(t)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof oi.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new oi.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}},iw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters),r=i.width/2,s=i.radiusTop??r,o=i.radiusBottom??r;return s===o?(s=r,o=r):s>o?(s=r,o=o*r/s):(s=s*r/o,o=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:s,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:s,heightSegments:o,openEnded:n,thetaStart:h,thetaLength:a,radiusTop:c,radiusBottom:d,cornerRadius:l,cornerSegments:u,hollow:p}=e.parameters,f;return l||p?f=new uu(c,d,r,s,o,n,h,a*Math.PI/180,l,l,u,p):f=new lp(c,d,r,s,o,n,h,a*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function Qt(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function eh(e){return new X(e.y,-e.x)}var uu=class extends Oe{constructor(e,t,i,r,s,o,n,h,a,c,d,l,u=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,s=Math.floor(s)||1,o=o!==void 0?o:!1,n=n!==void 0?n:0,h=h!==void 0?h:Math.PI*2,o&&(a=0,c=0);let p=[],f=[],g=[],v=[],m=0,y=i/2,_=new T,x=new T;u&&e==0&&(e=a),u&&t==0&&(t=c);let S=new X(e,y),b=new X(t,-y),A=null,O=null,P=null,w=null,C=S.clone().sub(b),M=0,z=0,W=0;l>0&&(M=Math.min(e,t)*(1-l),z=e-M,W=t-M);let Q=S.clone();Q.x-=M;let re=Math.PI-C.angle(),$=C.angle(),V=Math.tan($/2),H=Math.tan(re/2),I=V+H,j=l?I:H,L=l?I:V;if(a=Math.min(a,(e-z)/j,C.length()/I),c=Math.min(c,(t-W)/L,C.length()/I),a>0){let q=a/V;A=S.clone().sub(new X(q,a)),l&&(P=A.clone(),P.x-=M-I*a),S.sub(C.clone().setLength(q))}if(c>0){let q=c/H;O=b.clone().sub(new X(q,-c)),b.add(C.clone().setLength(q)),l&&(w=O.clone(),w.x-=M-I*c,Q.sub(C.clone().setLength(q)))}C=S.clone().sub(b);let N=C.length()<.5,R=[];for(let q=0;q<=r;q++){let F=[],ee=q/r,K=ee*h+n,Y=new X(Math.sin(K),Math.cos(K));w&&O?(G(F,ee,Y,re,c,w,-1,!0),G(F,ee,Y,$,c,O,-1,!1)):O?(U(F,Y,O.x,0,-1),G(F,ee,Y,$,c,O,-1,!1)):o||U(F,Y,t,W,-1);let te=eh(C).normalize();if(Qt(te,Y,_),!N)for(let J=0;J<=s;J++){let Z=J/s,pe=C.clone().multiplyScalar(Z).add(b);Qt(pe,Y,x),f.push(x.x,x.y,x.z),g.push(_.x,_.y,_.z),v.push(ee,.5+x.y/i),F.push(m++)}if(P&&A?(G(F,ee,Y,re,a,A,1,!1),G(F,ee,Y,$,a,P,1,!0)):A?(G(F,ee,Y,re,a,A,1,!1),U(F,Y,A.x,0,1)):o||U(F,Y,e,z,1),l&&!N){let J=eh(C).multiplyScalar(-1).normalize();Qt(J,Y,_);for(let Z=0;Z<=s;Z++){let pe=Z/s,oe=C.clone().multiplyScalar(-pe).add(Q);Qt(oe,Y,x),f.push(x.x,x.y,x.z),g.push(_.x,_.y,_.z),v.push(ee,.5+x.y/i),F.push(m++)}}l&&!o&&F.push(F[0]),R.push(F)}for(let q=0;q<R.length-1;q++)for(let F=0;F<R[0].length-1;F++){if(o&&l&&F==s)continue;let ee=R[q][F],K=R[q+1][F],Y=R[q+1][F+1],te=R[q][F+1],J=f[Y*3+0],Z=f[Y*3+2];p.push(ee,K,te),(J!=0||Z!=0)&&p.push(K,Y,te)}h<Math.PI*2&&(k(-1,R[0],n),k(1,R[R.length-1],n+h)),this.setIndex(p),this.setAttribute("position",new ve(f,3)),this.setAttribute("normal",new ve(g,3)),this.setAttribute("uv",new ve(v,2));function G(q,F,ee,K,Y,te,J,Z){for(let pe=0;pe<d+1;pe++){let oe=pe/d,he=J<0?oe:1-oe;Z&&(he-=1),he*=K;let ye=new X(Math.sin(he),Math.cos(he)*J),ge=ye.clone().multiplyScalar(Y).add(te);Qt(ge,ee,x),f.push(x.x,x.y,x.z),Qt(ye,ee,_),g.push(_.x,_.y,_.z),v.push(F,.5+x.y/i),q.push(m++)}}function U(q,F,ee,K,Y){let te=new T,J=new X,Z=[ee,K];Y<0&&Z.reverse();for(let pe of Z)J.set(pe,y*Y),Qt(J,F,te),f.push(te.x,te.y,te.z),g.push(0,Y,0),v.push(.5,.5),q.push(m++)}function k(q,F,ee){let K=new X(Math.sin(ee),Math.cos(ee)),Y=new X(-Math.cos(ee),Math.sin(ee)),te=new T,J=q<0?(oe,he,ye)=>p.push(oe,he,ye):(oe,he,ye)=>p.push(oe,ye,he),Z=new X((e+t+z+W)/4,0);Qt(Z,K,te),f.push(te.x,te.y,te.z),g.push(Y.x,0,Y.y),v.push(.5,.5);let pe=m++;for(let oe of F){let he=f.slice(oe*3,oe*3+3);f.push(...he),g.push(Y.x,0,Y.y);let ye=v.slice(oe*2,oe*2+2);v.push(...ye),m++}for(let oe=pe+1;oe<m-1;oe++)J(pe,oe,oe+1);J(pe,m-1,pe+1)}}},rw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:s,heightSegments:o,openEnded:n,thetaStart:h,thetaLength:a,cornerRadiusTop:c,cornerRadiusBottom:d,cornerSegments:l}=e.parameters,u;return c>0||d>0||a<360?u=new uu(0,t/2,r,s,o,n,h,a*Math.PI/180,c,d,l,0,!0):u=new hp(t/2,r,s,o,n),u.scale(1,1,i/t),Object.assign(u,{userData:{...e,type:"ConeGeometry"}})}},sw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:s,heightSegments:o,depthSegments:n,cornerRadius:h,cornerSegments:a}=e.parameters,c;return h==0?c=new er(t,i,r,s,o,n):c=new ow(t,i,r,s,o,n,h,a),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},Io=Math.PI/2,ow=class extends Oe{constructor(e=1,t=1,i=1,r=1,s=1,o=1,n=0,h=4){super(),this.type="BoxGeometry";let a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),h=Math.floor(h),n=Math.min(n,e/2,t/2,i/2);let c=[],d=[],l=[],u=[],p=0,f=0;g("z","y","x",-1,-1,i,t,e,o,s,0),g("z","y","x",1,-1,i,t,-e,o,s,1),g("x","z","y",1,1,e,i,t,r,o,2),g("x","z","y",1,-1,e,i,-t,r,o,3),g("x","y","z",1,-1,e,t,i,r,s,4),g("x","y","z",-1,-1,e,t,-i,r,s,5),n>0&&(v("z","y","x",-1,-1,1,i,t,e,o,0),v("z","y","x",1,-1,-1,i,t,e,o,1),v("z","y","x",-1,1,-1,i,t,e,o,1),v("z","y","x",1,1,1,i,t,e,o,0),v("x","y","z",-1,-1,-1,e,t,i,r,0),v("x","y","z",1,-1,1,e,t,i,r,1),v("x","y","z",-1,1,1,e,t,i,r,0),v("x","y","z",1,1,-1,e,t,i,r,1),v("y","x","z",-1,-1,1,t,e,i,s,0),v("y","x","z",1,-1,-1,t,e,i,s,1),v("y","x","z",1,1,1,t,e,i,s,1),v("y","x","z",-1,1,-1,t,e,i,s,0),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new ve(d,3)),this.setAttribute("normal",new ve(l,3)),this.setAttribute("uv",new ve(u,2));function g(y,_,x,S,b,A,O,P,w,C,M){let z=(A-2*n)/w,W=(O-2*n)/C,Q=A/2-n,re=O/2-n,$=P/2,V=w+1,H=C+1,I=0,j=0,L=new T;for(let N=0;N<H;N++){let R=N*W-re;for(let G=0;G<V;G++){let U=G*z-Q;L[y]=U*S,L[_]=R*b,L[x]=$,d.push(L.x,L.y,L.z),L[y]=0,L[_]=0,L[x]=P>0?1:-1,l.push(L.x,L.y,L.z),u.push(G/w),u.push(1-N/C),I+=1}}for(let N=0;N<C;N++)for(let R=0;R<w;R++){let G=p+R+V*N,U=p+R+V*(N+1),k=p+(R+1)+V*(N+1),q=p+(R+1)+V*N;c.push(G,U,q),c.push(U,k,q),j+=6}a.addGroup(f,j,M),f+=j,p+=I}function v(y,_,x,S,b,A,O,P,w,C,M){let z=(O-2*n)/C,W=O/2-n,Q=P/2-n,re=w/2,$=C+1,V=0,H=0,I=new T,j=new T;for(let L=0;L<h+1;L++){let N=L/h*Io,R=Math.sin(N)*n,G=(1-Math.cos(N))*n,U=Math.sin(N),k=Math.cos(N);I[_]=(Q+R)*b,I[x]=(re-G)*A,j[y]=0,j[_]=U*Math.sign(I[_]),j[x]=k*Math.sign(I[x]);for(let q=0;q<$;q++){let F=q*z-W;I[y]=F*S,d.push(I.x,I.y,I.z),l.push(j.x,j.y,j.z),u.push(q/C),u.push(0),V+=1}}for(let L=0;L<h;L++)for(let N=0;N<C;N++){let R=p+N+$*L,G=p+N+$*(L+1),U=p+(N+1)+$*(L+1),k=p+(N+1)+$*L;c.push(R,G,k),c.push(G,U,k),H+=6}a.addGroup(f,H,M),f+=H,p+=V}function m(y,_,x){let S=new T,b=new T(e/2,t/2,i/2);b.subScalar(n);let A=[],O=y*_*x>0?(w,C,M)=>c.push(w,C,M):(w,C,M)=>c.push(w,M,C);for(let w=0;w<=h;w++){let C=[],M=Io*(1-w/h),z=Math.cos(M),W=Math.sin(M),Q=0;for(let re=0;re<=w;re++){let $=Math.cos(Q),V=Math.sin(Q);S.x=z*$,S.y=W,S.z=z*V;let H=b.clone().addScaledVector(S,n);d.push(y*H.x,_*H.y,x*H.z),l.push(y*S.x,_*S.y,x*S.z),u.push(0,0),C.push(p++),Q+=Io/w}A.push(C)}let P=A.length-1;for(let w=0;w<P;w++){let C=A[w],M=A[w+1],z=C.length-1;O(C[0],M[1],M[0]);for(let W=1;W<=z;W++)O(C[W-1],C[W],M[W]),O(C[W],M[W+1],M[W])}}}},ba=class extends Oe{constructor(e=[],t=[],i="",r=1,s=.2,o=4){super(),this.type="PolyhedronGeometryRound";let n=[],h=[],a=[];c(),d(),this.setAttribute("position",new ve(n,3)),this.setAttribute("normal",new ve(a,3)),this.setAttribute("uv",new ve(h,2));return;function c(){var $;s=Math.min(1-1e-5,s),s==0&&(o=0);let l={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],u=new T,p=u.clone(),f=new Vn,g=s*r,v=r-g,m=o+1,y=new T,_=(V,H)=>y.subVectors(V,H).normalize(),x=(V,H)=>Array(V).fill(void 0).map(H),S=x(e.length/3,(V,H)=>new T().fromArray(e,H*3).setLength(r)),b=[],A=1e6;for(let V=0;V<S.length;V++){let H=S[V],I=[],j,L,N,R=1e10,G=-1;for(;(G=t.indexOf(V,G+1))!=-1;){let F=G-G%3;j=t[F+(G+1)%3],L=t[F+(G+2)%3],N=H.distanceToSquared(S[j]),R=Math.min(R,N),I.push([j,L,N])}R+=1e-6;let U=[],k=0,q=I.length;for(let F=0;F<q;F++){[j,L,N]=I[k];let ee=(($=b[j])==null?void 0:$.includes(V))==!0;N<=R&&U.push(j+ +ee*A),k=I.findIndex(K=>K[0]==L)}b.push(U)}let O=[];{let V=0,H=0,I,j,L=l==3;for(let N=0;N<=o;N++){I=N*(N+1)/2,j=(N+1)*(N+2)/2;for(let R=0;R<o-N;R++)[V,H]=[I+R+N+2,j+R+N+3],O.push(I,j,...L?[H,I]:[V,j],H,V),[I,j]=[V,H];O.push(I,j,I+o+2)}}let P=u.clone(),w=u.clone(),C=u.clone(),M=u.clone(),z=u.clone(),W=[],Q=x(S.length,()=>x(l,()=>u.clone()));for(let V=0;V<S.length;V++){u.copy(S[V]).normalize(),P.copy(u).multiplyScalar(v);let H=b[V];for(let U=0;U<H.length;U++){let k=H[U],q=H[(U+1)%l];f.setFromPointsAndIndices(S,V,k%A,q%A),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(P,Q[V][U])}let I=[],j=[],L=[],N=new T;o==0&&[...Q[V]].reduce((U,k)=>U.add(k),N).multiplyScalar(1/l);for(let U=0;U<l;U++){let k=[],q=(U-1+l)%l,F=Q[V][q],ee=Q[V][U];u.copy(F).sub(P),p.copy(ee).sub(P);let K=P.angleTo(u),Y=u.angleTo(p),te=Math.cos(K)*g;o==0?w.copy(N):w.copy(P).setLength(v+te),j.push(te);let J=[w,F,ee];for(let Z=0;Z<2;Z++){let pe=J[Z],oe=J[Z+1];M.subVectors(pe,P),z.subVectors(oe,P),C.crossVectors(M,z).normalize();for(let he=0;he<m;he++){let ye=[K,Y][Z]*he/m;u.copy(M).applyAxisAngle(C,ye).add(P),I.push(u.clone()),Z&&(_(u,P),k.push([he==0?pe:u.clone(),y.clone()]))}Z&&(_(oe,P),k.push([oe,y.clone()]))}L.push(k)}W.push(L);let R=2*m,G=2;for(let U=0;U<l;U++){let k=R*U,q=R*((U+1)%l),F=[I[k]];for(let K=1;K<m;K++){M=I[k+K],z=I[q+K],F.push(M);for(let Y=1,te=K-G+1;Y<=te;Y++)u.lerpVectors(M,z,Y/(te+1)),u.sub(P).setLength(j[U]).add(P),F.push(u.clone());F.push(z)}for(let K=0;K<m;K++)F.push(I[K+m+k]);F.push(I[q+m]);let ee=O.map(K=>F[K]);n.push(...ee.map(K=>[K.x,K.y,K.z]).flat()),a.push(...ee.map(K=>(_(K,P),[y.x,y.y,y.z])).flat())}}let re=[];for(let V=0;V<b.length;V++)for(let H=0;H<l;H++){let I=b[V][H];if(I<A){let j=b[I].findIndex(R=>R%A==V),L=W[V][H],N=W[I][j];for(let R=0;R<m;R++){let G=L[R],U=N[m-R],k=L[R+1],q=N[m-(R+1)];[G,U,k,k,U,q].forEach(F=>{n.push(F[0].x,F[0].y,F[0].z),a.push(F[1].x,F[1].y,F[1].z)})}re.push(L[0][0],N[m][0],L[m][0],N[0][0])}}for(;re.length;){let V,H,I,j;[V,H]=re.splice(0,2);let L=[V];for(;V!=H;)L.push(H),I=re.indexOf(H),j=I%2,H=re.splice(I-j,2)[1-j];y.subVectors(L[0],L[1]).cross(u.subVectors(L[0],L[2])).normalize();let N=y.dot(L[0])<0;N&&y.negate();for(let R=1;R<=L.length-2;R++)[L[R+ +N],L[R+1-+N],L[0]].forEach(G=>{n.push(G.x,G.y,G.z),a.push(y.x,y.y,y.z)})}}function d(){let l=new T;for(let b=0;b<n.length;b+=3){l.x=n[b+0],l.y=n[b+1],l.z=n[b+2];let A=x(l)/2/Math.PI+.5,O=S(l)/Math.PI+.5;h.push(A,1-O)}let u=new T,p=new T,f=new T,g=new T,v=new X,m=new X,y=new X,_=(b,A,O,P)=>{P<0&&b.x===1&&(h[A]=b.x-1),O.x===0&&O.z===0&&(h[A]=P/2/Math.PI+.5)};for(let b=0,A=0;b<n.length;b+=9,A+=6){u.set(n[b+0],n[b+1],n[b+2]),p.set(n[b+3],n[b+4],n[b+5]),f.set(n[b+6],n[b+7],n[b+8]),v.set(h[A+0],h[A+1]),m.set(h[A+2],h[A+3]),y.set(h[A+4],h[A+5]),g.copy(u).add(p).add(f).divideScalar(3);let O=x(g);_(v,A+0,u,O),_(m,A+2,p,O),_(y,A+4,f,O)}for(let b=0;b<h.length;b+=6){let A=h[b+0],O=h[b+2],P=h[b+4],w=Math.max(A,O,P),C=Math.min(A,O,P);w>.9&&C<.1&&(A<.2&&(h[b+0]+=1),O<.2&&(h[b+2]+=1),P<.2&&(h[b+4]+=1))}function x(b){return Math.atan2(b.z,-b.x)}function S(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}}static fromJSON(e){return new ba(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},nw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:s,corner:o,cornerSides:n}=e.parameters,h=s===0&&o!==0?new du(t*.5,o,n):new cp(t*.5,s);return h.scale(1,i/t,r/t),Object.assign(h,{userData:{...e,type:"DodecahedronGeometry"}})}},du=class extends ba{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,s=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],n=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],h="DodecahedronGeometry";super(o,n,h,e,t,i),this.type=h}static fromJSON(e){return new du(e.radius,e.corner,e.cornerSides)}},Sr=1e-12,xa=class{constructor(e){this.position=new X,this.startPosition=new X,this.uuid=Ne.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new xa(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},En=class extends xa{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new En(this.parent).copy(this)}},Xi=class extends xa{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new En(this),new En(this))}static create(e,t){let i=new Xi(e,new X(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let s=this.controls[i];this.position.distanceTo(s.position)<=t?s.position.copy(this.position):s.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Xi(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new X,t=new X){let[i,r]=this.computeTangents();return i&&r&&(th(i,e),th(r,t)),[e,t]}computeTangent(e=new X){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new X){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function th(e,t=new X){let i=e.length();return t.set(-e.y/i,e.x/i)}var wa=e=>e,gr=new X,fo=new X,aw=new X,lw=new X,hw=new X,cw=new X,pu=new T,fu=new T;function uw(e){let t=new X;t.addVectors(e.v0,gr.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new X;return i.addVectors(e.v2,fo.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new qt(e.v0,t,i,e.v2)}function Ir(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function dw(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function pw(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function mu(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),o=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((s*s+r*r-o*o)/(2*s*r))}function fw(e,t,i){return rh(e,t)&&rh(t,i)&&Mn(e.position,t.position,i.position)}function Mn(e,t,i){return gr.copy(t).sub(e).cross(fo.copy(i).sub(e))===0}function mw(e,t,i,r,s){let o=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=(e.y+t.y)/2,h=(e.x+t.x)/2,a=Math.sqrt(Math.pow(i,2)-Math.pow(o/2,2))*(e.y-t.y)/o,c=Math.sqrt(Math.pow(i,2)-Math.pow(o/2,2))*(t.x-e.x)/o;return r.set(h+a,n+c),s.set(h-a,n-c),[r,s]}function gw(e,t,i){let r=e.distanceTo(i),s=t.distanceTo(i);return r<s?t:e}function vw(e,t,i,r,s,o){let n=t.x-e.x,h=t.y-e.y,a=i.x-e.x,c=i.y-e.y,d=Math.sqrt((n+a)*(n+a)+(h+c)*(h+c)),l;return mu(t,e,i)>Math.PI&&(d*=-1),Ir(c,h)?l=(h+c)*(r/d-.5)*8/3/(n-a):l=(n+a)*(r/d-.5)*8/3/(c-h),s.set(t.x-l*h,t.y+l*n),o.set(i.x+l*c,i.y-l*a),[s,o]}function ih(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function rh(e,t){return Mn(e.position,e.controls[1].position,t.position)&&Mn(e.position,t.controls[0].position,t.position)}function yw(e,t,i,r,s=.5){let o=gr.subVectors(t,e).multiplyScalar(s).add(e),n=fo.subVectors(i,t).multiplyScalar(s).add(t),h=aw.subVectors(r,i).multiplyScalar(s).add(i),a=o,c=lw.subVectors(n,o).multiplyScalar(s).add(o),d=hw.subVectors(h,n).multiplyScalar(s).add(n),l=h,u=cw.subVectors(d,c).multiplyScalar(s).add(c);return[e.x,e.y,a.x,a.y,c.x,c.y,u.x,u.y,d.x,d.y,l.x,l.y,r.x,r.y]}function bw(e,t,i=12,r=!0){let s=fu.set(0,0,0),o,n=0;for(let h=0;h<t.length;h++){let a=wa(t[h]),c=gr,d=Ci(a,i);for(let l=0;l<=d;l++)if(a instanceof qt||a instanceof tr||a instanceof hi){if(a.getPoint(l/d,c),s.set(c.x,c.y,0),o!==void 0&&pw(o,s))continue;o===void 0&&(o=pu),o.copy(s),e.setXYZ(n,s.x,s.y,s.z),n++}}return r&&n>1&&!(e.getX(n-1)===e.getX(0)&&e.getY(n-1)===e.getY(0)&&e.getZ(n-1)===e.getZ(0))&&(e.setXYZ(n,e.getX(0),e.getY(0),e.getZ(0)),n++),e}function xw(e,t,i,r=12,s=!0){let o=fu.set(0,0,0),n=0,h=[];for(let a=0;a<t.length;a++){if(i[a]===!1)continue;let c,d=wa(t[a]),l=gr,u=Ci(d,r);h.push(u);for(let p=0;p<=u;p++)if(d instanceof qt||d instanceof tr||d instanceof hi){if(d.getPoint(p/u,l),o.set(l.x,l.y,0),c==null?void 0:c.equals(o))continue;c===void 0?c=pu:(e.setXYZ(n,c.x,c.y,c.z),n++,e.setXYZ(n,o.x,o.y,o.z),n++),c.copy(o)}}return s&&n>1&&!(e.getX(n-1)===e.getX(0)&&e.getY(n-1)===e.getY(0)&&e.getZ(n-1)===e.getZ(0))&&(e.setXYZ(n,e.getX(0),e.getY(0),e.getZ(0)),n++),h}function sh(e,t=12,i=!1){let r=[];for(let s=0,o=e.length;s<o;s++){let n=e[s],h=0;if(i&&n.roundedCurveCorner!==void 0){let a=Ci(n.roundedCurveCorner,t)*.5;s>0&&(r[s-1]+=a),h+=a}n.curveAfter!==void 0&&(h+=Ci(n.curveAfter,t)),r.push(h)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Ci(e[0].roundedCurveCorner,t)*.5),r}function Ci(e,t=12){return e&&e instanceof up?t*2:e&&(e instanceof hi||e instanceof dp)?1:e&&e instanceof pp?t*e.points.length:t}function ww(e,t,i=12,r=!0){let s,o=0;for(let n=0;n<t.length;n++){let h=wa(t[n]),a=Ci(h,i),c=gr;for(let d=0;d<=a;d++)if(h instanceof qt||h instanceof tr||h instanceof hi){if(h.getPoint(d/a,c),s!==void 0&&dw(s,c,Sr))continue;s===void 0&&(s=fo),s.copy(c),e.push(c.x,c.y),o++}}return Ir(e[0],e[e.length-2],Sr)&&Ir(e[1],e[e.length-1],Sr)&&(e.pop(),e.pop()),r&&o>1&&!(Ir(e[o-1],e[1],Sr)&&Ir(e[o-2],e[0],Sr))&&(e.push(e[0],e[1]),o++),e}var zo=new X,_w=new X,Sw=new X,Aw=new X,Ow=new X,Cw=new X,je=class extends Ps{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new np(new T(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Ne.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new je;return r.isClosed=e.isClosed,r.points=e.points.map(s=>Xi.create(s.id,s.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(s=>je.createFromState(s)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let s=0,o=this.shapeHoles.length;s<o;s++){let n=this.shapeHoles[s],h=n.points.length,a=n.getPointIndexById(e);if(a<0)r+=h;else return a+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],o=e-t;if(o<=s.points.length-1)return s.points[o];t+=s.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],o=s.points.indexOf(e);if(o>=0)return t+o;t+=s.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=zo.set(e,t);for(let r=0,s=this.points.length;r<s;r++){let o=this.points[r];o.position.multiply(i),o.controls[0].position.multiply(i),o.controls[1].position.multiply(i)}for(let r=0,s=this.shapeHoles.length;r<s;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Ne.generateUUID()){let r;e instanceof X?r=e:r=new X(e,t);let s=new Xi(i,r);return s.roundness=this.roundness,s}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return bw(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((s,o)=>s+o,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=sh(this.points,e,!1),this.roundedCurveDivisions=sh(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return xw(e,this.curves,t,i,this.autoClose).reduce((r,s)=>r+s,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),ww(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,s=0;t&&this.points[0].roundedCurveCorner!==void 0&&(s=Ci(this.points[0].roundedCurveCorner,this.subdivision)*.5);let o=e-s;o<0&&(o+=r.reduce((n,h)=>n+h,0));for(let n=0,h=r.length;n<h;n++){let a=r[n];if(o<i+a)return[n,(o-i+1)/a];i+=a}return[0,1]}getCurveT(e,t,i){let r=this.points[e],s=this.points[e>=this.points.length-1?0:e+1],o=this.curveDivisions,n=o[e];if(ih(r,s)){let a=r.position.distanceTo(s.position);return r.position.distanceTo(zo.set(i.x,i.y))/a}let h=0;for(let a=0;a<e;a++)h+=o[a];return(t-h)/n}dispose(){}_applyCurveForPoint(e,t){ih(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let s=this.points[t-1];this._applyCurveForPoint(r,s)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i],o=this.points[i-1]??this.points[this.points.length-1],n=this.points[i+1]??this.points[0],h=s.roundness,a=o&&n&&fw(o,s,n);if(!s.controlsMoved()&&h>0&&!a){let c=s.curveBefore,d=s.curveAfter;if(c===void 0||d===void 0)continue;let l=s.roundedCurveBefore,u=s.roundedCurveAfter,p=c.getLength(),f=d.getLength(),g=Math.min(h,p*.499),v=Math.min(h,f*.499),m=Math.min(g,v),y=1-m/p,_=m/f,x=c.getPointAt(y,zo),S=d.getPointAt(_,_w);this._subSplitCurve(c,l,y,x,void 0),this._subSplitCurve(d,u,_,void 0,S);let b;if(this.useCubicForRoundedCorners){let A=mu(x,s.position,S)/2,O=Math.tan(A)*x.distanceTo(s.position),[P,w]=mw(x,S,O,Sw,Aw),C=gw(P,w,s.position),[M,z]=vw(C,x,S,O,Ow,Cw);b=new qt(x.clone(),M.clone(),z.clone(),S.clone())}else b=new tr(x.clone(),s.position.clone(),S.clone());s.roundedCurveCorner=b,this.roundedCurves.splice(i+t,0,b),t++}}}}_subSplitCurve(e,t,i,r,s){if(e instanceof hi)r!==void 0&&t.v2.copy(r),s!==void 0&&t.v1.copy(s);else{let o=e,n=t,h=o.getUtoTmapping(i,0),a=yw(o.v0,o.v1,o.v2,o.v3,h);return r!==void 0&&(n.v0.set(a[0],a[1]),n.v1.set(a[2],a[3]),n.v2.set(a[4],a[5]),n.v3.set(a[6],a[7])),s!==void 0&&(n.v0.set(a[6],a[7]),n.v1.set(a[8],a[9]),n.v2.set(a[10],a[11]),n.v3.set(a[12],a[13])),n}return t}clone(){let e=new je(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let s=r*7,o=e.points[s+0],n=e.points[s+1],h=e.points[s+2],a=e.points[s+3],c=e.points[s+4],d=e.points[s+5],l=e.points[s+6],u=new Xi(Ne.generateUUID(),new X(o,n));u.controls[0].position.set(h,a),u.controls[1].position.set(c,d),u.roundness=l,this.points.push(u)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let s=new je;return s.fromJSON(r),s}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(r,s)=>{s instanceof qt&&s.v3.equals(r.position)&&r.controls[0].position.copy(s.v2)},i=r=>{let s=[],o,n;for(o=0,n=r.length;o<n;o++)r[o]instanceof tr&&(r[o]=uw(r[o]));for(o=0,n=r.length;o<n;o++){let c=r[o],d=o>0?r[o-1]:null,l;c instanceof qt?(l=this.createPoint(c.v0),l.controls[1].position.copy(c.v1)):c instanceof hi&&(l=this.createPoint(c.v1)),l!==void 0&&(d!==null&&t(l,d),s.push(l))}let h=r[r.length-1],a=!1;return h instanceof qt?h.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(h.v2),a=!0):h instanceof hi&&h.v2.equals(s[0].position)&&(a=!0),this.isClosed=a,s};return this.points=i(e.curves),e instanceof Ps&&(this.shapeHoles=e.holes.map(r=>{let s=new je;return s.fromShape(r),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},Dn=Math.PI*2;function No({x:e,y:t},i,r,s,o){return{x:e*i+s,y:t*r+o}}function Pw(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),s=Math.sin(e),o=Math.cos(e+t),n=Math.sin(e+t);return[{x:r-s*i,y:s+r*i},{x:o+n*i,y:n-o*i},{x:o,y:n}]}function oh(e,t,i,r){let s=e*r-t*i<0?-1:1,o=Math.min(1,Math.max(-1,e*i+t*r));return s*Math.acos(o)}function Tw(e,t,i,r,s,o,n,h,a,c){let d=Math.pow(s,2),l=Math.pow(o,2),u=Math.pow(n,2),p=Math.pow(h,2),f=d*l-d*p-l*u;f<0&&(f=0),f/=d*p+l*u,f=Math.sqrt(f)*(a===c?-1:1);let g=f*s/o*h,v=f*-o/s*n,m=g+(e+i)/2,y=v+(t+r)/2,_=(n-g)/s,x=(h-v)/o,S=(-n-g)/s,b=(-h-v)/o,A=oh(1,0,_,x),O=oh(_,x,S,b);return!c&&O>0&&(O-=Dn),c&&O<0&&(O+=Dn),{centerx:m,centery:y,ang1:A,ang2:O}}function Ew({px:e,py:t,cx:i,cy:r,rx:s,ry:o,largeArcFlag:n,sweepFlag:h}){let a=[];if(s===0||o===0)return[];let c=(e-i)/2,d=(t-r)/2;if(c===0&&d===0)return[];s=Math.abs(s),o=Math.abs(o);let l=Math.pow(c,2)/Math.pow(s,2)+Math.pow(d,2)/Math.pow(o,2);l>1&&(s*=Math.sqrt(l),o*=Math.sqrt(l));let u=Tw(e,t,i,r,s,o,c,d,n,h),{ang1:p,ang2:f}=u,{centerx:g,centery:v}=u,m=Math.abs(f)/(Dn/4);Math.abs(1-m)<1e-7&&(m=1);let y=Math.max(Math.ceil(m),1);f/=y;for(let _=0;_<y;_++)a.push(Pw(p,f)),p+=f;return a.map(_=>{let{x,y:S}=No(_[0],s,o,g,v),{x:b,y:A}=No(_[1],s,o,g,v),{x:O,y:P}=No(_[2],s,o,g,v);return{x1:x,y1:S,x2:b,y2:A,x:O,y:P}})}var Se;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Se||(Se={}));var Fe;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Fe||(Fe={}));function ce(e,t){if(!e)throw t||"Assertion Failed!"}var ae=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){ce(e.vertLeq(t,i)&&e.vertLeq(i,r));var s=i.s-t.s,o=r.s-i.s;return s+o>0?s<o?i.t-t.t+(t.t-r.t)*(s/(s+o)):i.t-r.t+(r.t-t.t)*(o/(s+o)):0},e.edgeSign=function(t,i,r){ce(e.vertLeq(t,i)&&e.vertLeq(i,r));var s=i.s-t.s,o=r.s-i.s;return s+o>0?(i.t-r.t)*s+(i.t-t.t)*o:0},e.transEval=function(t,i,r){ce(e.transLeq(t,i)&&e.transLeq(i,r));var s=i.t-t.t,o=r.t-i.t;return s+o>0?s<o?i.s-t.s+(t.s-r.s)*(s/(s+o)):i.s-r.s+(r.s-t.s)*(o/(s+o)):0},e.transSign=function(t,i,r){ce(e.transLeq(t,i)&&e.transLeq(i,r));var s=i.t-t.t,o=r.t-i.t;return s+o>0?(i.s-r.s)*s+(i.s-t.s)*o:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,s){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+s)/2:i+(s-i)*(t/(t+r)):s+(i-s)*(r/(t+r))},e.intersect=function(t,i,r,s,o){var n,h,a;e.vertLeq(t,i)||(a=t,t=i,i=a),e.vertLeq(r,s)||(a=r,r=s,s=a),e.vertLeq(t,r)||(a=t,t=r,r=a,a=i,i=s,s=a),e.vertLeq(r,i)?e.vertLeq(i,s)?(n=e.edgeEval(t,r,i),h=e.edgeEval(r,i,s),n+h<0&&(n=-n,h=-h),o.s=e.interpolate(n,r.s,h,i.s)):(n=e.edgeSign(t,r,i),h=-e.edgeSign(t,s,i),n+h<0&&(n=-n,h=-h),o.s=e.interpolate(n,r.s,h,s.s)):o.s=(r.s+i.s)/2,e.transLeq(t,i)||(a=t,t=i,i=a),e.transLeq(r,s)||(a=r,r=s,s=a),e.transLeq(t,r)||(a=t,t=r,r=a,a=i,i=s,s=a),e.transLeq(r,i)?e.transLeq(i,s)?(n=e.transEval(t,r,i),h=e.transEval(r,i,s),n+h<0&&(n=-n,h=-h),o.t=e.interpolate(n,r.t,h,i.t)):(n=e.transSign(t,r,i),h=-e.transSign(t,s,i),n+h<0&&(n=-n,h=-h),o.t=e.interpolate(n,r.t,h,s.t)):o.t=(r.t+i.t)/2},e}(),Ar=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),rs=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Ri=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),nh=function(){function e(){var t=new Ri,i=new Ar,r=new rs(0),s=new rs(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=s,s.next=s,s.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=s}return e.prototype.makeEdge_=function(t){var i=new rs(0),r=new rs(1);t.Sym.side<t.side&&(t=t.Sym);var s=t.Sym.next;return r.next=s,s.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,s=i.Onext;r.Sym.Lnext=i,s.Sym.Lnext=t,t.Onext=s,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var s=t;ce(s,"Vertex can't be null!");var o=r.prev;s.prev=o,o.next=s,s.next=r,r.prev=s,s.anEdge=i;var n=i;do n.Org=s,n=n.Onext;while(n!==i)},e.prototype.makeFace_=function(t,i,r){var s=t;ce(s,"Face can't be null");var o=r.prev;s.prev=o,o.next=s,s.next=r,r.prev=s,s.anEdge=i,s.trail=null,s.marked=!1,s.inside=r.inside;var n=i;do n.Lface=s,n=n.Lnext;while(n!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,s=r;do s.Org=i,s=s.Onext;while(s!==r);var o=t.prev,n=t.next;n.prev=o,o.next=n},e.prototype.killFace_=function(t,i){var r=t.anEdge,s=r;do s.Lface=i,s=s.Lnext;while(s!==r);var o=t.prev,n=t.next;n.prev=o,o.next=n},e.prototype.makeEdge=function(){var t=new Ri,i=new Ri,r=new Ar,s=this.makeEdge_(this.eHead);return this.makeVertex_(t,s,this.vHead),this.makeVertex_(i,s.Sym,this.vHead),this.makeFace_(r,s,this.fHead),s},e.prototype.splice=function(t,i){var r=!1,s=!1;if(t!==i){if(i.Org!==t.Org&&(s=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!s){var o=new Ri;this.makeVertex_(o,i,t.Org),t.Org.anEdge=t}if(!r){var n=new Ar;this.makeFace_(n,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var s=new Ar;this.makeFace_(s,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var s=new Ri;return this.makeVertex_(s,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,s=this.makeEdge_(t),o=s.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(s,t.Lnext),this.splice_(o,i),s.Org=t.Dst,o.Org=i.Org,s.Lface=o.Lface=t.Lface,t.Lface.anEdge=o,!r){var n=new Ar;this.makeFace_(n,s,t.Lface)}return s},e.prototype.zapFace=function(t){var i=t.anEdge,r,s,o,n,h;s=i.Lnext;do r=s,s=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),o=r.Sym,o.Onext===o?this.killVertex_(o.Org,null):(o.Org.anEdge=o.Onext,this.splice_(o,o.Oprev)),this.killEdge_(r));while(r!=i);n=t.prev,h=t.next,h.prev=n,n.next=h},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,s,o,n,h,a;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,n=r.Org;s=r.Lnext,o=r.Sym,o&&o.Lface&&o.Lface.inside&&(h=this.countFaceVerts_(i),a=this.countFaceVerts_(o.Lface),h+a-2<=t&&ae.vertCCW(r.Lprev.Org,r.Org,o.Lnext.Lnext.Org)&&ae.vertCCW(o.Lprev.Org,o.Org,r.Lnext.Lnext.Org)&&(s=o.Lnext,this.delete(o),r=null,o=null)),!(r&&r.Lnext.Org===n);)r=s;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,s,o,n,h,a,c;for(o=t,o=t;(s=o.next)!==t;o=s){ce(s.prev===o),a=s.anEdge;do ce(a.Sym!==a),ce(a.Sym.Sym===a),ce(a.Lnext.Onext.Sym===a),ce(a.Onext.Sym.Lnext===a),ce(a.Lface===s),a=a.Lnext;while(a!==s.anEdge)}for(ce(s.prev===o&&s.anEdge===null),h=i,h=i;(n=h.next)!==i;h=n){ce(n.prev===h),a=n.anEdge;do ce(a.Sym!==a),ce(a.Sym.Sym===a),ce(a.Lnext.Onext.Sym===a),ce(a.Onext.Sym.Lnext===a),ce(a.Org===n),a=a.Onext;while(a!==n.anEdge)}for(ce(n.prev===h&&n.anEdge===null),c=r,c=r;(a=c.next)!==r;c=a)ce(a.Sym.next===c.Sym),ce(a.Sym!==a),ce(a.Sym.Sym===a),ce(a.Org!==null),ce(a.Dst!==null),ce(a.Lnext.Onext.Sym===a),ce(a.Onext.Sym.Lnext===a);ce(a.Sym.next===c.Sym&&a.Sym===this.eHeadSym&&a.Sym.Sym===a&&a.Org===null&&a.Dst===null&&a.Lface===null&&a.Rface===null)},e}(),ah=function(){function e(){this.handle=null}return e}(),lh=function(){function e(){this.key=null,this.node=0}return e}(),Mw=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new ah,this.handles[r]=new lh;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,s,o,n;for(s=i[t].handle;;){if(n=t<<1,n<this.size&&this.leq(r[i[n+1].handle].key,r[i[n].handle].key)&&++n,ce(n<=this.max),o=i[n].handle,n>this.size||this.leq(r[s].key,r[o].key)){i[t].handle=s,r[s].node=t;break}i[t].handle=o,r[o].node=t,t=n}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,s,o,n;for(s=i[t].handle;;){if(n=t>>1,o=i[n].handle,n===0||this.leq(r[o].key,r[s].key)){i[t].handle=s,r[s].node=t;break}i[t].handle=o,r[o].node=t,t=n}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var s,o;for(o=this.nodes.length,this.nodes.length=this.max+1,s=o;s<this.nodes.length;s++)this.nodes[s]=new ah;for(o=this.handles.length,this.handles.length=this.max+1,s=o;s<this.handles.length;s++)this.handles[s]=new lh}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,s=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),s},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,s;ce(t>=1&&t<=this.max&&r[t].key!==null),s=r[t].node,i[s].handle=i[this.size].handle,r[i[s].handle].node=s,--this.size,s<=this.size&&(s<=1||this.leq(r[i[s>>1].handle].key,r[i[s].handle].key)?this.floatDown_(s):this.floatUp_(s)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),Bo=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),hh=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),Dw=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new hh,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new hh;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),Lw=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var s=t.event,o=i.eUp,n=r.eUp;if(o.Dst===s)return n.Dst===s?ae.vertLeq(o.Org,n.Org)?ae.edgeSign(n.Dst,o.Org,n.Org)<=0:ae.edgeSign(o.Dst,n.Org,o.Org)>=0:ae.edgeSign(n.Dst,s,n.Org)<=0;if(n.Dst===s)return ae.edgeSign(o.Dst,s,o.Org)>=0;var h=ae.edgeEval(o.Dst,s,o.Org),a=ae.edgeEval(n.Dst,s,n.Org);return h>=a},e.deleteRegion=function(t,i){i.fixUpperEdge&&ce(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){ce(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,s;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(s=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),s===null)return null;e.fixUpperEdge(t,i,s),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var s=new Bo;return s.eUp=r,s.nodeUp=t.dict.insertBefore(i.nodeUp,s),s.fixUpperEdge=!1,s.sentinel=!1,s.dirty=!1,r.activeRegion=s,s},e.isWindingInside=function(t,i){switch(t.windingRule){case Se.ODD:return(i&1)!==0;case Se.NONZERO:return i!==0;case Se.POSITIVE:return i>0;case Se.NEGATIVE:return i<0;case Se.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,s=r.Lface;s.inside=i.inside,s.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var s,o=null,n=i,h=i.eUp;n!==r;){if(n.fixUpperEdge=!1,o=e.regionBelow(n),s=o.eUp,s.Org!=h.Org){if(!o.fixUpperEdge){e.finishRegion(t,n);break}s=t.mesh.connect(h.Lprev,s.Sym),e.fixUpperEdge(t,o,s)}h.Onext!==s&&(t.mesh.splice(s.Oprev,s),t.mesh.splice(h,s)),e.finishRegion(t,n),h=o.eUp,n=o}return h},e.addRightEdges=function(t,i,r,s,o,n){var h,a,c,d,l=!0;c=r;do ce(ae.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==s);for(o===null&&(o=e.regionBelow(i).eUp.Rprev),a=i,d=o;h=e.regionBelow(a),c=h.eUp.Sym,c.Org===d.Org;)c.Onext!==d&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(d.Oprev,c)),h.windingNumber=a.windingNumber-c.winding,h.inside=e.isWindingInside(t,h.windingNumber),a.dirty=!0,!l&&e.checkForRightSplice(t,a)&&(e.addWinding(c,d),e.deleteRegion(t,a),t.mesh.delete(d)),l=!1,a=h,d=c;a.dirty=!0,ce(a.windingNumber-c.winding===h.windingNumber),n&&e.walkDirtyRegions(t,a)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var s=ae.vertL1dist(i,t),o=ae.vertL1dist(r,t),n=.5*o/(s+o),h=.5*s/(s+o);t.coords[0]+=n*i.coords[0]+h*r.coords[0],t.coords[1]+=n*i.coords[1]+h*r.coords[1],t.coords[2]+=n*i.coords[2]+h*r.coords[2]},e.getIntersectData=function(t,i,r,s,o,n){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,s),e.vertexWeights(i,o,n)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),s=i.eUp,o=r.eUp;if(ae.vertLeq(s.Org,o.Org)){if(ae.edgeSign(o.Dst,s.Org,o.Org)>0)return!1;ae.vertEq(s.Org,o.Org)?s.Org!==o.Org&&(t.pq.delete(s.Org.pqHandle),e.spliceMergeVertices(t,o.Oprev,s)):(t.mesh.splitEdge(o.Sym),t.mesh.splice(s,o.Oprev),i.dirty=r.dirty=!0)}else{if(ae.edgeSign(s.Dst,o.Org,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Oprev,s)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),s=i.eUp,o=r.eUp,n;if(ce(!ae.vertEq(s.Dst,o.Dst)),ae.vertLeq(s.Dst,o.Dst)){if(ae.edgeSign(s.Dst,o.Dst,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,n=t.mesh.splitEdge(s),t.mesh.splice(o.Sym,n),n.Lface.inside=i.inside}else{if(ae.edgeSign(o.Dst,s.Dst,o.Org)>0)return!1;i.dirty=r.dirty=!0,n=t.mesh.splitEdge(o),t.mesh.splice(s.Lnext,o.Sym),n.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),s=i.eUp,o=r.eUp,n=s.Org,h=o.Org,a=s.Dst,c=o.Dst,d,l,u=new Ri,p,f;if(ce(!ae.vertEq(c,a)),ce(ae.edgeSign(a,t.event,n)<=0),ce(ae.edgeSign(c,t.event,h)>=0),ce(n!==t.event&&h!==t.event),ce(!i.fixUpperEdge&&!r.fixUpperEdge),n===h||(d=Math.min(n.t,a.t),l=Math.max(h.t,c.t),d>l))return!1;if(ae.vertLeq(n,h)){if(ae.edgeSign(c,n,h)>0)return!1}else if(ae.edgeSign(a,h,n)<0)return!1;return e.debugEvent(t),ae.intersect(a,n,c,h,u),ce(Math.min(n.t,a.t)<=u.t),ce(u.t<=Math.max(h.t,c.t)),ce(Math.min(c.s,a.s)<=u.s),ce(u.s<=Math.max(h.s,n.s)),ae.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t),p=ae.vertLeq(n,h)?n:h,ae.vertLeq(p,u)&&(u.s=p.s,u.t=p.t),ae.vertEq(u,n)||ae.vertEq(u,h)?(e.checkForRightSplice(t,i),!1):!ae.vertEq(a,t.event)&&ae.edgeSign(a,t.event,u)>=0||!ae.vertEq(c,t.event)&&ae.edgeSign(c,t.event,u)<=0?c===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Sym,s),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,s.Oprev,s,s,!0),!0):a===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(s.Lnext,o.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=o.Oprev,o=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,o.Onext,s.Rprev,f,!0),!0):(ae.edgeSign(a,t.event,u)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),ae.edgeSign(c,t.event,u)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),!1):(t.mesh.splitEdge(s.Sym),t.mesh.splitEdge(o.Sym),t.mesh.splice(o.Oprev,s),s.Org.s=u.s,s.Org.t=u.t,s.Org.pqHandle=t.pq.insert(s.Org),e.getIntersectData(t,s.Org,n,a,h,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),s,o;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,s=i.eUp,o=r.eUp,s.Dst!==o.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(o),r=e.regionBelow(i),o=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionAbove(r),s=i.eUp)),s.Org!==o.Org)if(s.Dst!==o.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(s.Dst===t.event||o.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);s.Org===o.Org&&s.Dst===o.Dst&&(e.addWinding(o,s),e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var s,o=r.Onext,n=e.regionBelow(i),h=i.eUp,a=n.eUp,c=!1;if(h.Dst!==a.Dst&&e.checkForIntersect(t,i),ae.vertEq(h.Org,t.event)&&(t.mesh.splice(o.Oprev,h),i=e.topLeftRegion(t,i),o=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),n),c=!0),ae.vertEq(a.Org,t.event)&&(t.mesh.splice(r,a.Oprev),r=e.finishLeftRegions(t,n,null),c=!0),c){e.addRightEdges(t,i,r.Onext,o,o,!0);return}ae.vertLeq(a.Org,h.Org)?s=a.Oprev:s=h,s=t.mesh.connect(r.Lprev,s),e.addRightEdges(t,i,s,s.Onext,s.Onext,!1),s.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var s,o,n,h,a;if(s=i.eUp,ae.vertEq(s.Org,r)){ce(!1),e.spliceMergeVertices(t,s,r.anEdge);return}if(!ae.vertEq(s.Dst,r)){t.mesh.splitEdge(s.Sym),i.fixUpperEdge&&(t.mesh.delete(s.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,s),e.sweepEvent(t,r);return}ce(!1),i=e.topRightRegion(i),a=e.regionBelow(i),n=a.eUp.Sym,o=h=n.Onext,a.fixUpperEdge&&(ce(o!==n),e.deleteRegion(t,a),t.mesh.delete(n),n=o.Oprev),t.mesh.splice(r.anEdge,n),ae.edgeGoesLeft(o)||(o=null),e.addRightEdges(t,i,n.Onext,h,o,!0)},e.connectLeftVertex=function(t,i){var r,s,o,n,h,a,c=new Bo;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,s=e.regionBelow(r),!!s){if(n=r.eUp,h=s.eUp,ae.edgeSign(n.Dst,i,n.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(o=ae.vertLeq(h.Dst,n.Dst)?r:s,r.inside||o.fixUpperEdge){if(o===r)a=t.mesh.connect(i.anEdge.Sym,n.Lnext);else{var d=t.mesh.connect(h.Dnext,i.anEdge);a=d.Sym}o.fixUpperEdge?e.fixUpperEdge(t,o,a):e.computeWinding(t,e.addRegionBelow(t,r,a)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var s=e.topLeftRegion(t,r.activeRegion);ce(s!==null);var o=e.regionBelow(s),n=o.eUp,h=e.finishLeftRegions(t,o,null);h.Onext===n?e.connectRightVertex(t,s,h):e.addRightEdges(t,s,h.Onext,n,n,!0)},e.addSentinel=function(t,i,r,s){var o=new Bo,n=t.mesh.makeEdge();n.Org.s=r,n.Org.t=s,n.Dst.s=i,n.Dst.t=s,t.event=n.Dst,o.eUp=n,o.windingNumber=0,o.inside=!1,o.fixUpperEdge=!1,o.sentinel=!0,o.dirty=!1,o.nodeUp=t.dict.insert(o)},e.initEdgeDict=function(t){t.dict=new Dw(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],s=t.bmin[0]-i,o=t.bmax[0]+i,n=t.bmin[1]-r,h=t.bmax[1]+r;e.addSentinel(t,s,o,n),e.addSentinel(t,s,o,h)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(ce(i.fixUpperEdge),ce(++r===1)),ce(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,s,o=t.mesh.eHead;for(i=o.next;i!==o;i=r)r=i.next,s=i.Lnext,ae.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,s,i),t.mesh.delete(i),i=s,s=i.Lnext),s.Lnext===i&&(s!==i&&((s===r||s===r.Sym)&&(r=r.next),t.mesh.delete(s)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,s,o=0;for(s=t.mesh.vHead,r=s.next;r!==s;r=r.next)o++;for(o+=8,i=t.pq=new Mw(o,ae.vertLeq),s=t.mesh.vHead,r=s.next;r!==s;r=r.next)r.pqHandle=i.insert(r);return r!==s?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,s,o;for(r=i.fHead.next;r!==i.fHead;r=s)s=r.next,o=r.anEdge,ce(o.Lnext!==o),o.Lnext.Lnext===o&&(e.addWinding(o.Onext,o),t.mesh.delete(o));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,s;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;s=t.pq.min(),!(s===null||!ae.vertEq(s,r));)s=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,s.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),Iw=function(){function e(){this.mesh=new nh,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Se.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,s,o,n,h,a=[0,0,0],c=[0,0,0],d=[0,0,0],l=[0,0,0],u=[0,0,0],p=[null,null,null],f=[null,null,null],g=this.mesh.vHead;i=g.next;for(var v=0;v<3;++v)o=i.coords[v],c[v]=o,f[v]=i,a[v]=o,p[v]=i;for(i=g.next;i!==g;i=i.next)for(var m=0;m<3;++m)o=i.coords[m],o<c[m]&&(c[m]=o,f[m]=i),o>a[m]&&(a[m]=o,p[m]=i);var y=0;if(a[1]-c[1]>a[0]-c[0]&&(y=1),a[2]-c[2]>a[y]-c[y]&&(y=2),c[y]>=a[y]){t[0]=0,t[1]=0,t[2]=1;return}for(h=0,r=f[y],s=p[y],d[0]=r.coords[0]-s.coords[0],d[1]=r.coords[1]-s.coords[1],d[2]=r.coords[2]-s.coords[2],i=g.next;i!==g;i=i.next)l[0]=i.coords[0]-s.coords[0],l[1]=i.coords[1]-s.coords[1],l[2]=i.coords[2]-s.coords[2],u[0]=d[1]*l[2]-d[2]*l[1],u[1]=d[2]*l[0]-d[0]*l[2],u[2]=d[0]*l[1]-d[1]*l[0],n=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],n>h&&(h=n,t[0]=u[0],t[1]=u[1],t[2]=u[2]);h<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(d)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,s,o=0,n=t.next;n!==t;n=n.next)if(s=n.anEdge,!(s.winding<=0))do o+=(s.Org.s-s.Dst.s)*(s.Org.t+s.Dst.t),s=s.Lnext;while(s!==n.anEdge);if(o<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,s,o=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),o=!0),r=this.sUnit,s=this.tUnit;var n=this.longAxis_(i);r[n]=0,r[(n+1)%3]=1,r[(n+2)%3]=0,s[n]=0,s[(n+1)%3]=0,s[(n+2)%3]=i[n]>0?1:-1;for(var h=t.next;h!==t;h=h.next)h.s=this.dot_(h.coords,r),h.t=this.dot_(h.coords,s);o&&this.checkOrientation_();for(var a=!0,c=t.next;c!==t;c=c.next)a?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,a=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,s;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;ae.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;ae.vertLeq(r.Org,r.Dst);r=r.Lnext);s=r.Lprev;for(var o=void 0;r.Lnext!==s;)if(ae.vertLeq(r.Dst,s.Org)){for(;s.Lnext!==r&&(ae.edgeGoesLeft(s.Lnext)||ae.edgeSign(s.Org,s.Dst,s.Lnext.Dst)<=0);)o=t.connect(s.Lnext,s),s=o.Sym;s=s.Lprev}else{for(;s.Lnext!==r&&(ae.edgeGoesRight(r.Lprev)||ae.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)o=t.connect(r,r.Lprev),r=o.Sym;r=r.Lnext}if(s.Lnext===r)throw"Mono region invalid";for(;s.Lnext.Lnext!==r;)o=t.connect(s.Lnext,s),s=o.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var s,o=t.eHead.next;o!==t.eHead;o=s)s=o.next,o.Rface.inside!==o.Lface.inside?o.winding=o.Lface.inside?i:-i:r?t.delete(o):o.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,s){var o,n=0,h=0,a;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var d=t.fHead.next;d!==t.fHead;d=d.next)if(d.n=-1,!!d.inside){o=d.anEdge,a=0;do{var c=o.Org;c.n===-1&&(c.n=h,h++),a++,o=o.Lnext}while(o!==d.anEdge);if(a>r)throw"Face vertex greater that support polygon";d.n=n,++n}this.elementCount=n,i===Fe.CONNECTED_POLYGONS&&(n*=2),this.elements=[],this.elements.length=n*r,this.vertexCount=h,this.vertices=[],this.vertices.length=h*s,this.vertexIndices=[],this.vertexIndices.length=h;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var l=c.n*s;this.vertices[l+0]=c.coords[0],this.vertices[l+1]=c.coords[1],s>2&&(this.vertices[l+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var u=0,d=t.fHead.next;d!==t.fHead;d=d.next)if(d.inside){o=d.anEdge,a=0;do{var c=o.Org;this.elements[u++]=c.n,a++,o=o.Lnext}while(o!==d.anEdge);for(var p=a;p<r;++p)this.elements[u++]=-1;if(i===Fe.CONNECTED_POLYGONS){o=d.anEdge;do this.elements[u++]=this.getNeighbourFace_(o),o=o.Lnext;while(o!==d.anEdge);for(var f=a;f<r;++f)this.elements[u++]=-1}}},e.prototype.outputContours_=function(t,i){var r,s,o=0,n=0;this.vertexCount=0,this.elementCount=0;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){s=r=h.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==s);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var a=0,c=0,d=0;o=0;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){n=0,s=r=h.anEdge;do this.vertices[a++]=r.Org.coords[0],this.vertices[a++]=r.Org.coords[1],i>2&&(this.vertices[a++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,n++,r=r.Lnext;while(r!==s);this.elements[d++]=o,this.elements[d++]=n,o+=n}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new nh),t<2&&(t=2),t>3&&(t=3);for(var r=null,s=0;s<i.length;s+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[s+0],r.Org.coords[1]=i[s+1],t>2?r.Org.coords[2]=i[s+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,s,o,n){if(t===void 0&&(t=Se.ODD),i===void 0&&(i=Fe.POLYGONS),n===void 0&&(n=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,o&&(this.normal[0]=o[0],this.normal[1]=o[1],this.normal[2]=o[2]),this.windingRule=t,s<2&&(s=2),s>3&&(s=3),!this.mesh)return!1;this.projectPolygon_(),Lw.computeInterior(this,n);var h=this.mesh;return i===Fe.BOUNDARY_CONTOURS?this.setWindingNumber_(h,1,!0):this.tessellateInterior_(h),n&&h.check(),i===Fe.BOUNDARY_CONTOURS?this.outputContours_(h,s):this.outputPolymesh_(h,i,r,s),!0},e}();function ni(e){var t=e.windingRule,i=t===void 0?Se.ODD:t,r=e.elementType,s=r===void 0?Fe.POLYGONS:r,o=e.polySize,n=o===void 0?3:o,h=e.vertexSize,a=h===void 0?2:h,c=e.normal,d=c===void 0?[0,0,1]:c,l=e.contours,u=l===void 0?[]:l,p=e.strict,f=p===void 0?!0:p,g=e.debug,v=g===void 0?!1:g;if(!u&&f)throw new Error("Contours can't be empty");if(u){var m=new Iw;e.edgeCreateCallback&&(m.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(m.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<u.length;y++)m.addContour(a||2,u[y]);return m.tesselate(i,s,n,a,d,f),{vertices:m.vertices,vertexIndices:m.vertexIndices,vertexCount:m.vertexCount,elements:m.elements,elementCount:m.elementCount,mesh:v?m.mesh:void 0}}}Se.ODD;Se.NONZERO;Se.POSITIVE;Se.NEGATIVE;Se.ABS_GEQ_TWO;Fe.POLYGONS;Fe.CONNECTED_POLYGONS;Fe.BOUNDARY_CONTOURS;var Ln=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*Ln.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,s=0;this.positions=new Float32Array(this.buffer,s*r,3*e),s+=3*e,this.normals=new Float32Array(this.buffer,s*r,3*e),s+=3*e,this.uvs=new Float32Array(this.buffer,s*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} → ${e}`);let i=e*Ln.eSize,r=new ArrayBuffer(i),s=Float32Array.BYTES_PER_ELEMENT,o=0,n=new Float32Array(r,o*s,3*e);o+=3*e;let h=new Float32Array(r,o*s,3*e);o+=3*e;let a=new Float32Array(r,o*s,2*e);n.set(this.positions.slice(0,this.size*3)),h.set(this.normals.slice(0,this.size*3)),a.set(this.uvs.slice(0,this.size*2)),this.buffer=r,this.positions=n,this.normals=h,this.uvs=a,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},gu=Ln;gu.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var _a={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},vu={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},yu={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},jo=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),bu=class extends Oe{constructor(e,t,i=0,r=12,s=3,o=Se.ODD){super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._bevel=i,this._curveSegments=r,this._bevelSegmentsInput=s,i<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(i,t/2-1e-12),this._bevelSegments=Math.floor(s));let n=this._shape.extractShapePointsToFlatArray([],r),h=this._shape.shapeHoles.map(S=>{let b=S.extractShapePointsToFlatArray([],r),A=[];for(let O=b.length-1;O>=1;O-=2){let P=b[O-1],w=b[O-0];A.push(P,w)}return A}),a;try{a=ni({windingRule:o,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n]})}catch{a=_a}let c;try{c=ni({windingRule:Se.ODD,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...h]})}catch{c=vu}if(!a)throw new Error("error generating geometry");let d=a.elementCount;if(c){a.elementCount+=c.elementCount;for(let S=0;S<c.elements.length;S++){let b=c.elements[S],A=S%2===0?a.vertexCount:0;a.elements.push(b+A)}for(let S=0;S<c.vertexIndices.length;S++){let b=c.vertexIndices[S],A=a.vertexCount;a.vertexIndices.push(b+A)}for(let S=0;S<c.vertices.length;S++){let b=c.vertices[S];a.vertices.push(b)}}let l=1/0,u=-1/0,p=1/0,f=-1/0;for(let S=0,b=a.vertexCount;S<b;S++){let A=S*2,O=a.vertices[A+0],P=a.vertices[A+1];O<l&&(l=O),O>u&&(u=O),P<p&&(p=P),P>f&&(f=P)}this._minX=l,this._minY=p,this._width=u-l,this._height=f-p,this._buffer=new gu(this._computeBufferEstimatedSize(a));let g=[],v=[];for(let S=a.elementCount-1;S>=0;S--){let b=S>=d,A=S*2,O=a.elements[A+0],P=a.elements[A+1],w=O+P,C={start:O,count:P,normals:[],continuous:[],concave:[]},M=O,z=w-1,W=O+1,Q=this._shape.roundedCurves.length;do{let H=M-O,I=a.vertices[z*2+0],j=a.vertices[z*2+1],L=a.vertices[M*2+0],N=a.vertices[M*2+1],R=a.vertices[W*2+0],G=a.vertices[W*2+1],U=L-I,k=N-j,q=Math.sqrt(U*U+k*k);U/=q,k/=q;let F=L-R,ee=N-G,K=Math.sqrt(F*F+ee*ee);F/=K,ee/=K,C.normals[H*2+0]=-ee,C.normals[H*2+1]=F,C.concave[H]=U*ee-k*F>0;let Y=a.vertexIndices[M];if(Array.isArray(Y))C.continuous[H]=!1;else{let[te,J]=this._shape.getCurveIndexFromVertexId(Y-1,!0);if(J>0&&J<1)C.continuous[H]=!0;else{let Z=J===1?te+1:te-1;Z=(Z+Q)%Q;let pe=J===1?0:1,oe=this._shape.roundedCurves[te].getTangent(J),he=this._shape.roundedCurves[Z].getTangent(pe);C.continuous[H]=oe.dot(he)>.95}}b&&(C.normals[H*2+0]*=-1,C.normals[H*2+1]*=-1),[z,M,W]=[M,W,W+1],W>=w&&(W-=P)}while(W!==O+1);let re=[];re.push({bevelI:0,angle:0,size:0,boundary:{vertices:a.vertices.slice(O*2,w*2),vertexCount:P,vertexIndices:new Array(P).fill(!0).map((H,I)=>[I,I]),elements:[0,P],elementCount:1,mesh:null},reverseMap:[],insetPoints:a.vertices.slice(O*2,w*2)});for(let H=1;H<=this._bevelSegments;H++){let I=H/this._bevelSegments*Math.PI/2,j=(1-Math.cos(I))*this._bevelSize,L=[],N=[],R=0;for(let U=0;U<P;U++){let k=U*2,q=(U-1+P)%P*2,F=a.vertices[C.start*2+k+0],ee=a.vertices[C.start*2+k+1],K=-C.normals[q+0]*j,Y=-C.normals[q+1]*j,te=-C.normals[k+0]*j,J=-C.normals[k+1]*j;if(C.concave[U]||!C.concave[U]&&b){let Z=Math.atan2(Y,K),pe=Math.atan2(J,te);pe>Z&&(pe-=Math.PI*2);let oe=pe-Z;if(C.continuous[U]||b){let he=Z+oe/2,ye=Math.cos(he)*j,ge=Math.sin(he)*j;L[2*R+0]=F+ye*(b?-1:1),L[2*R+1]=ee+ge*(b?-1:1),N[R]=U,R++}else{let he=Math.max(1,Math.floor(r/4*Math.abs(oe)/Math.PI));for(let ye=0;ye<=he;ye++){let ge=Z+oe*(ye/he),De=Math.cos(ge)*j,Ce=Math.sin(ge)*j;L[2*R+0]=F+De,L[2*R+1]=ee+Ce,N[R]=U,R++}}}else L[2*R+0]=F+K,L[2*R+1]=ee+Y,N[R]=U,R++,L[2*R+0]=F,L[2*R+1]=ee,N[R]=U,R++,L[2*R+0]=F+te,L[2*R+1]=ee+J,N[R]=U,R++}let G=ni({windingRule:Se.POSITIVE,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[L],edgeCreateCallback:U=>{let k=U.Org.idx,q=N[k],F=N[(k+1)%N.length];U.idx=[q,F],U.Sym.idx=[F,q]},vertexIdCallback:U=>{let k=U.Lprev.idx;return[k?k[1]:0,U.idx?U.idx[0]:0]}});if(!G)throw console.log("Error"),new Error(`error generating bevel geometry for ${H}'th loop`);if(!G.vertexCount)break;for(let U=0;U<G.vertexIndices.length;U++){let[k,q]=G.vertexIndices[U];if(k===q)continue;let F=q;q<k&&(F+=P);for(let ee=k;ee<F;ee++){let K=ee%P,Y=(ee+1)%P;if(!C.continuous[K]||!C.continuous[Y]){G.vertexIndices[U]=[k,K],G.vertexIndices.splice(U+1,0,[Y,q]),G.vertices.splice((U+1)*2,0,G.vertices[U*2],G.vertices[U*2+1]);break}}}re.push({bevelI:H,angle:I,size:j,boundary:G,reverseMap:N,insetPoints:L})}let $=(H,I,j)=>{let L=0,N=H.boundary.vertexIndices.length;for(;L<N&&j(H.boundary.vertexIndices[I]);)I=(I+1)%N,L++;return L},V=g.length;for(let H=1;H<re.length;H++){let I=re[H-1],j=re[H],L=I.boundary.vertexIndices.length,N=j.boundary.vertexIndices.length;if(!L||!N)break;let R=C.concave.length,G=0,U=jo(G,P);for(;!I.boundary.vertexIndices.filter(U).length||!j.boundary.vertexIndices.filter(U).length;)G++,U=jo(G,P);let k=I.boundary.vertexIndices.findIndex(U),q=j.boundary.vertexIndices.findIndex(U);do k=(k+1)%L;while(U(I.boundary.vertexIndices[k]));do q=(q+1)%N;while(U(j.boundary.vertexIndices[q]));G=(G+1)%P;let F=G,ee=this._buildBevelVert(C,I,(k-1+L)%L),K=this._buildBevelVert(C,j,(q-1+N)%N),Y=ee,te=K,J,Z,pe=!1;do{U=jo(G,P);let oe=$(I,k,U),he=$(j,q,U),ye=pe;if(pe=!1,oe&&!he){for(let ge=0;ge<oe;ge++)J=this._buildBevelVert(C,I,(k+ge)%L,ge/(oe-1)),g.push(Y.topN,J.topP,te.topN),g.push(J.bottomP,Y.bottomN,te.bottomN),Y=J;pe=!0}else if(!oe&&he)for(let ge=0;ge<he;ge++)Z=this._buildBevelVert(C,j,(q+ge)%N,ge/(he-1)),g.push(te.topN,Y.topP,Z.topP),g.push(Y.bottomP,te.bottomN,Z.bottomP),te=Z;else if(oe&&he)if(J=this._buildBevelVert(C,I,k,0),Z=this._buildBevelVert(C,j,q,0),ye?(g.push(Y.topN,Z.topP,te.topN),g.push(Y.topN,J.topP,Z.topP),g.push(Z.bottomP,Y.bottomN,te.bottomN),g.push(Z.bottomP,J.bottomP,Y.bottomN)):(g.push(te.topN,Y.topN,J.topP),g.push(te.topN,J.topP,Z.topP),g.push(J.bottomP,Y.bottomN,te.bottomN),g.push(J.bottomP,te.bottomN,Z.bottomP)),Y=J,te=Z,oe===he)for(let ge=1;ge<oe;ge++)J=this._buildBevelVert(C,I,(k+ge)%L,ge/(oe-1)),Z=this._buildBevelVert(C,j,(q+ge)%N,ge/(he-1)),g.push(Y.topN,J.topP,te.topN),g.push(te.topN,J.topP,Z.topP),g.push(J.bottomP,Y.bottomN,te.bottomN),g.push(J.bottomP,te.bottomN,Z.bottomP),Y=J,te=Z;else if(oe>he){let ge=oe/he,De=0;for(let Ce=1;Ce<oe;Ce++)J=this._buildBevelVert(C,I,(k+Ce)%L,Ce/(oe-1)),g.push(Y.topN,J.topP,te.topN),g.push(J.bottomP,Y.bottomN,te.bottomN),Y=J,Ce>(De+1)*ge&&(De++,Z=this._buildBevelVert(C,j,(q+De)%N,De/(he-1)),g.push(te.topN,J.topP,Z.topP),g.push(J.bottomP,te.bottomN,Z.bottomP),te=Z)}else{let ge=he/oe,De=0;for(let Ce=1;Ce<he;Ce++)Z=this._buildBevelVert(C,j,(q+Ce)%N,Ce/(he-1)),g.push(te.topN,J.topP,Z.topP),g.push(J.bottomP,te.bottomN,Z.bottomP),te=Z,Ce>(De+1)*ge&&(De++,J=this._buildBevelVert(C,I,(k+De)%L,De/(oe-1)),g.push(Y.topN,J.topP,te.topN),g.push(J.bottomP,Y.bottomN,te.bottomN),Y=J)}k=(k+oe)%L,q=(q+he)%N,G=(G+1)%R}while(G!==F)}if(this._buildWall(re,C,g),b){let H=[];for(let I=g.length-1;I>=V+2;I-=3){let j=g[I-2],L=g[I-1],N=g[I-0];H.push(N,L,j)}g.splice(V,g.length-V,...H)}if(b){let H=[];for(let I=re[re.length-1].boundary.vertices.length-1;I>=1;I-=2){let j=re[re.length-1].boundary.vertices[I-1],L=re[re.length-1].boundary.vertices[I-0];H.push(j,L)}v.push(H)}if(!b){let H=re[re.length-1],I;try{I=ni({windingRule:re.length>1?Se.POSITIVE:Se.ODD,elementType:Fe.POLYGONS,vertexSize:2,strict:!0,contours:[H.insetPoints,...v]})}catch{I=yu}if(!I)throw new Error("Error generating geometry for surface");h.length===0&&Object.assign(this,{capStartIndex:g.length});for(let j=0;j<I.elementCount*3;j+=3){let L=this._buildSurfaceVert(I,I.elements[j+0]),N=this._buildSurfaceVert(I,I.elements[j+1]),R=this._buildSurfaceVert(I,I.elements[j+2]);g.push(L.top,N.top,R.top),g.push(R.bottom,N.bottom,L.bottom)}}this.vertexCache={}}this._buffer.shrink();let m=new ze(Uint32Array.from(g),1),y=new ze(this._buffer.positions,3),_=new ze(this._buffer.normals,3),x=new ze(this._buffer.uvs,2);y.needsUpdate=!0,_.needsUpdate=!0,x.needsUpdate=!0,m.needsUpdate=!0,this.setAttribute("position",y),this.setAttribute("normal",_),this.setAttribute("uv",x),this.setIndex(m)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let s=0,o=r.boundary.vertexCount;s<o;s++){let n=this._buildBevelVert(t,r,s),h=this._buildBevelVert(t,r,(s+1)%o);i.push(h.topP,n.topN,n.bottomN),i.push(h.topP,n.bottomN,h.bottomP)}}_buildSurfaceVert(e,t){let i=t.toString();if(i in this.vertexCache)return this.vertexCache[i];let r=e.vertices[t*2+0],s=e.vertices[t*2+1],o=(r-this._minX)/this._width,n=(s-this._minY)/this._height,h=this._buffer.get(2),a=h*3,c=h*2,d={top:h+0,bottom:h+1};return this._buffer.positions[a+0]=r,this._buffer.positions[a+1]=s,this._buffer.positions[a+2]=this._depth,this._buffer.normals[a+0]=0,this._buffer.normals[a+1]=0,this._buffer.normals[a+2]=1,this._buffer.uvs[c+0]=o,this._buffer.uvs[c+1]=n,this._buffer.positions[a+3]=r,this._buffer.positions[a+4]=s,this._buffer.positions[a+5]=0,this._buffer.normals[a+3]=0,this._buffer.normals[a+4]=0,this._buffer.normals[a+5]=-1,this._buffer.uvs[c+2]=o,this._buffer.uvs[c+3]=n,this.vertexCache[i]=d,d}_buildBevelVert(e,t,i,r=1){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache)return this.vertexCache[s];let[o,n]=t.boundary.vertexIndices[i],h,a,c,d;o!==n?(a=o,h=n,d=!1,c=e.continuous[a]&&e.continuous[h]):(h=o,a=(h-1+e.count)%e.count,d=e.concave[h]&&t.bevelI>0,c=e.continuous[h]||d);let l=Math.cos(t.angle),u=Math.sin(t.angle),p=i*2,f=h*2,g=a*2,v=t.boundary.vertices[p+0],m=t.boundary.vertices[p+1],y=(1-u)*this._bevelSize,_=(v-this._minX)/this._width,x=(m-this._minY)/this._height,S=e.normals[f+0],b=e.normals[f+1],A=e.normals[g+0],O=e.normals[g+1];if(d){let z=A-S,W=O-b;S=S+z*(1-r),b=b+W*(1-r);let Q=Math.sqrt(S*S+b*b);S/=Q,b/=Q}let P=this._buffer.get(c?2:4),w=P*3,C=P*2,M={i,fi:h,topP:P+0,topN:P+0,bottomP:P+1,bottomN:P+1};return this._buffer.positions[w+0]=v,this._buffer.positions[w+1]=m,this._buffer.positions[w+2]=this._depth-y,this._buffer.normals[w+0]=S*l,this._buffer.normals[w+1]=b*l,this._buffer.normals[w+2]=u,this._buffer.uvs[C+0]=_,this._buffer.uvs[C+1]=x,this._buffer.positions[w+3]=v,this._buffer.positions[w+4]=m,this._buffer.positions[w+5]=y,this._buffer.normals[w+3]=S*l,this._buffer.normals[w+4]=b*l,this._buffer.normals[w+5]=-u,this._buffer.uvs[C+2]=x,this._buffer.uvs[C+3]=_,c||(P+=2,w+=6,C+=4,M.topP=P+0,M.bottomP=P+1,this._buffer.positions[w+0]=v,this._buffer.positions[w+1]=m,this._buffer.positions[w+2]=this._depth-y,this._buffer.normals[w+0]=A*l,this._buffer.normals[w+1]=O*l,this._buffer.normals[w+2]=u,this._buffer.uvs[C+0]=_,this._buffer.uvs[C+1]=x,this._buffer.positions[w+3]=v,this._buffer.positions[w+4]=m,this._buffer.positions[w+5]=y,this._buffer.normals[w+3]=A*l,this._buffer.normals[w+4]=O*l,this._buffer.normals[w+5]=-u,this._buffer.uvs[C+2]=x,this._buffer.uvs[C+3]=_),this.vertexCache[s]=M,M}clone(){let e=new bu(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=po(this.userData),e}},xu=class extends Oe{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Se.ODD,this.elementType=Fe.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Se.ODD,elementType:Fe.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),s=this._shape.shapeHoles.map(u=>u.extractShapePointsToFlatArray([],this._curveSegments)),o,n=!0,h=!0,a,c;for(let u=0,p=r.length/2;u<p;u++){let f=u*2,g=r[f+0],v=r[f+1];if(a!==void 0&&g!==a&&(n=!1),c!==void 0&&v!==c&&(h=!1),a=g,c=v,!n&&!h)break}if(!n&&!h)try{o=ni({contours:[r,...s],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{o=_a}let d=(o==null?void 0:o.vertexCount)??1,l=(o==null?void 0:o.elementCount)??1;if(this._positionAttribute=new ze(new Float32Array(d*3),3),this._normalAttribute=new ze(new Float32Array(d*3),3),this._uvAttribute=new ze(new Float32Array(d*2),2),this._indexAttribute=new ze(new Uint32Array(l*3),1),o){let u=1/0,p=-1/0,f=1/0,g=-1/0;for(let y=0,_=d;y<_;y++){let x=y*2,S=o.vertices[x+0],b=o.vertices[x+1];S<u&&(u=S),S>p&&(p=S),b<f&&(f=b),b>g&&(g=b)}let v=p-u,m=g-f;for(let y=0,_=d;y<_;y++){let x=y*2,S=o.vertices[x+0],b=o.vertices[x+1],A=(S-u)/v,O=(b-f)/m;this._positionAttribute.setXYZ(y,S,b,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,A,O)}for(let y=0,_=l;y<_;y++){let x=y*3,S=o.elements[x+0],b=o.elements[x+1],A=o.elements[x+2];this._indexAttribute.setX(x+0,S),this._indexAttribute.setX(x+1,b),this._indexAttribute.setX(x+2,A)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((o==null?void 0:o.elementCount)??1)*3)}clone(){let e=new xu(this._shape,this._curveSegments);return e.userData=po(this.userData),e}},wu=class extends bu{constructor(e,t,i=0,r=12,s=3,o=Se.ODD){super(e,t,i,r,s,o),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let s=0,o=r.boundary.vertexCount;s<o;s++){let n=this._buildBevelVert(t,r,s),h=this._buildBevelVert(t,r,(s+1)%o);i.push(h.topP,n.topN,n.bottomN),i.push(h.topP,n.bottomN,h.bottomP)}}clone(){let e=new wu(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=po(this.userData),e}},Ni=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,d;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Se.ODD},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),o=Math.abs(i.depth??0),n=e.shape??(t==null?void 0:t.shape),h=(n==null?void 0:n.roundness)??i.roundness;n!==void 0&&(n instanceof je?(n.width!==r||n.height!==s)&&n.applySize(r,s):n=new je(r,s).fromJSON(n),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((d=e.parameters)==null?void 0:d.roundness)>0&&n.update());let a=n??new je(r,s);return{parameters:Object.assign(i,{width:r,height:s,depth:o,roundness:h}),shape:a}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:s,roundness:o,windingRule:n}=e.parameters;e.shape.roundness=o;let h;return t<=0?h=new xu(e.shape,s,{windingRule:n}):h=new wu(e.shape,t,i,s,r,n),Object.assign(h,{userData:{...e,type:"VectorGeometry"}})}},_u=Math.PI*2,Sa=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof je?e.shape:new je,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:s,innerRadius:o,depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}=e.parameters,c=e.shape,d=t*.5,l=i*.5,u=zw(c,d,l,s*Math.PI/180,r,o);c.isClosed=!0,c.update();let p=Ni.create({shape:c,parameters:{subdivisions:u,depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}});return Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function zw(e,t,i,r,s,o){if(r>=_u)return s>30||s%4===0?(Bw(e,t,i,o),Math.round(s/4)):ch(e,r,s,t,i,o);r=Math.max(r,.001);let n={x:0,y:i},h=r+Math.PI*.5,a={x:Math.cos(h)*t,y:Math.sin(h)*i},c=Ew({px:n.x,py:n.y,cx:a.x,cy:a.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return s>30||s%c.length===0?Nw(e,n.x,n.y,c,s,t,i,o):ch(e,r,s,t,i,o)}function Nw(e,t,i,r,s,o,n,h){let a=Math.round(s/r.length);e.addPoint(Yi(t,i));for(let c=0,d=r.length;c<d;c++){let l=r[c],u=e.points[c],p=Yi(l.x,l.y);u.controls[1].position.set(l.x1,l.y1),p.controls[0].position.set(l.x2,l.y2),e.addPoint(p)}return h>0?Su(e,o,n,h):e.addPoint(Yi(0,0)),a}function ch(e,t,i,r,s,o){let n=-t/i;for(let h=0;h<=i;h++){let a=n*h,c=Math.sin(a)*r,d=Math.cos(a)*s;e.addPoint(Yi(c,d))}return t<_u?o>0?Su(e,r,s,o):e.addPoint(Yi(0,0)):(e.removePoint(e.points[e.points.length-1]),o>0&&Au(e,r,s,o)),1}function Bw(e,t,i,r=0,s=0,o=0){let n=.5522847498,h=t*n,a=i*n;e.addPoint(ss(s-t,o,s-t,o-a,s-t,o+a)),e.addPoint(ss(s,o+i,s-h,o+i,s+h,o+i)),e.addPoint(ss(s+t,o,s+t,o+a,s+t,o-a)),e.addPoint(ss(s,o-i,s+h,o-i,s-h,o-i)),r>0&&Au(e,t,i,r)}function Yi(e,t){return new Xi(Ne.generateUUID(),new X(e,t))}function ss(e,t,i,r,s,o){let n=Yi(e,t);return n.controls[0].position.set(i,r),n.controls[1].position.set(s,o),n}function Su(e,t,i,r){Ou(e,t,i,r).forEach(s=>e.addPoint(s))}function Au(e,t,i,r){let s=Ou(e,t,i,r),o=new je;s.forEach(n=>o.addPoint(n)),o.isClosed=!0,e.shapeHoles.push(o)}function Ou(e,t,i,r){let s=r*t/100,o=s*(Math.abs(i)/Math.abs(t)),n=new X(s/t,o/i),h=e.points.map(a=>{let c=a.clone();return c.uuid=Ne.generateUUID(),c}).reverse();return h.forEach(a=>{a.position.multiply(n);let c=a.controls[0].position.clone().multiply(n),d=a.controls[1].position.clone().multiply(n);a.controls[0].position.copy(d),a.controls[1].position.copy(c)}),h}var jw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??r),o=Math.abs(i.depth??r),n=Math.abs(Math.min(r,o))/2;return{parameters:Object.assign(i,{width:r,height:s,depth:o,radius:n,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:s,revolutions:o,segments:n,pathRadius:h,pathType:a,pathSegments:c,cornerRadius:d,cornerSegments:l}=e.parameters,u=new Aa(!1,t,i,r,s,o,n,h,a,c,d,l);return Object.assign(u,{userData:{...e,type:"HelixGeometry"}})}},Aa=class extends Oe{constructor(e=!0,t=1,i=1,r=1,s=1,o=1,n=1,h=1,a=1,c=1,d=1,l=1,u=!1){super();let p=e&&o===1;p&&(l=0),d>100&&(d=100);let f=()=>new T,g=new T,v=f(),m=f(),y=f(),_,x,S,b,A,O,P,w,C=f(),M=f(),z=f(),W=f(),Q=f(),re=f(),$=f(),V=f(),H=i-2*h+.001,I=H/o,j=Math.ceil(n*o),L=j+1,N=H/j,R=-H/2,G=c+1,U=2*Math.PI/c,k=Math.PI/2/l,q=.01,F=Math.min((1-d/100)*h,h-q),ee=h-F,K=0,Y=2,te=l*Y+Y,J=G*te/Y,Z=J+G*L,pe=G*(L+te),[oe,he,ye]=[3,3,2].map(Ge=>Array(pe*Ge).fill(0)),ge=[],De=s-h;function Ce(Ge,st){let Pt=Math.PI/2;O=st*N,w=2*Math.PI*(O%I)/I+Pt,O+=R,P=Math.sin(w)*De,A=Math.cos(w)*De,e?Ge.set(A,P,O):Ge.set(A,O,P)}Ce(g,-1e-10),Ce(v,0),C.copy(g),Ce(g,1);let xt=g.distanceTo(v),Kt=p?0:ee+F,Ze=xt*j+2*Kt,vr=F,Qr=Ze-Kt;for(let Ge=0;Ge<=j;Ge++){Ce(m,Ge),V.subVectors(m,C).normalize(),C.copy(m),re.copy(m).setComponent(+e+1,0).normalize(),$.crossVectors(V,re).normalize();let st=Ge===0,Pt=Ge===j,Ed=st?3*Math.PI/2:k,Md=st?vr:Qr,Dd=st?G:Z,Ld=st?0:pe-G,Id=V.clone().multiplyScalar(st?-ee:ee).add(m),zd=V.clone().multiplyScalar(st?-1:1).normalize();for(let Vt=0;Vt<G;Vt++){let ja=Vt*U;if(M.addVectors(g.copy(re).multiplyScalar(h*Math.cos(ja)),v.copy($).multiplyScalar(h*Math.sin(ja))),z.copy(M).normalize(),st||Pt){p||(K=Ld+Vt,[0,1,2].forEach(Qe=>{oe[K*3+Qe]=Id.getComponent(Qe),he[K*3+Qe]=zd.getComponent(Qe)}),ye[K*2]=+Pt,ye[K*2+1]=Vt/c),v.copy(z).multiplyScalar(F),y.addVectors(m,v);for(let Qe=0;Qe<l;Qe++){let yo=Qe*k+Ed;W.addVectors(g.copy(V).multiplyScalar(ee*Math.sin(yo)),v.copy(z).multiplyScalar(ee*Math.cos(yo))),Q.copy(W).normalize(),v.addVectors(y,W),W.normalize(),K=Dd+Qe*G+Vt,[0,1,2].forEach(es=>{oe[K*3+es]=v.getComponent(es),he[K*3+es]=Q.getComponent(es)});let Nd=+st+Math.sin(yo);ye[K*2]=(Md+ee*Nd)/Ze,ye[K*2+1]=Vt/c}}v.addVectors(m,M),K=J+Ge*G+Vt,[0,1,2].forEach(Qe=>{oe[K*3+Qe]=v.getComponent(Qe),he[K*3+Qe]=z.getComponent(Qe)}),ye[K*2]=(Kt+Ge*xt)/Ze,ye[K*2+1]=Vt/c}}let Jr=L+2*l+Y,[go,vo]=[+p,Jr-1];u&&(vo-=1);for(let Ge=go;Ge<=vo-1;Ge++){let st=p&&Ge===vo-1;for(let Pt=0;Pt<G-1;Pt++)_=Ge*G+Pt,x=_+1,S=(st?Pt:_)+G,b=(st?Pt+1:x)+G,Ge===0?ge.push(x,b,S):Ge===Jr-2?ge.push(_,x,S):ge.push(_,x,S,x,b,S)}this.setIndex(ge),this.setAttribute("position",new ve(oe,3)),this.setAttribute("normal",new ve(he,3)),this.setAttribute("uv",new ve(ye,2))}},Uw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:s,corner:o,cornerSides:n}=e.parameters,h=s===0&&o!==0?new Cu(t*.5,o,n):new fp(t*.5,s);return h.scale(1,i/t,r/t),Object.assign(h,{userData:{...e,type:"IcosahedronGeometry"}})}},Cu=class extends ba{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n="IcosahedronGeometry";super(s,o,n,e,t,i),this.type=n}static fromJSON(e){return new Cu(e.radius,e.corner,e.cornerSides)}},Rw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(s=>{Array.isArray(s)&&(s.x=s[0],s.y=s[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,s=new Ps;s.moveTo(t[0].x,t[0].y),s.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let o=new mp(s.extractPoints(r).shape,i);return o.rotateZ(Math.PI),Object.assign(o,{userData:{...e,type:"LatheGeometry"}})}},Dt=new me,Uo=new Ti,os=new T,Ks=class extends Fd{constructor(){super(),this.uuid=Ne.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Cs().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];s.normal.applyMatrix3(t).normalize();for(let o=0,n=s.vertexNormals.length;o<n;o++)s.vertexNormals[o].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Dt.makeRotationX(e),this.applyMatrix4(Dt),this}rotateY(e){return Dt.makeRotationY(e),this.applyMatrix4(Dt),this}rotateZ(e){return Dt.makeRotationZ(e),this.applyMatrix4(Dt),this}translate(e,t,i){return Dt.makeTranslation(e,t,i),this.applyMatrix4(Dt),this}scale(e,t,i){return Dt.makeScale(e,t,i),this.applyMatrix4(Dt),this}lookAt(e){return Uo.lookAt(e),Uo.updateMatrix(),this.applyMatrix4(Uo.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let s=r.position,o=r.normal,n=r.color,h=r.uv,a=r.uv2;a!==void 0&&(this.faceVertexUvs[1]=[]);for(let l=0;l<s.count;l++)t.vertices.push(new T().fromBufferAttribute(s,l)),n!==void 0&&t.colors.push(new rt().fromBufferAttribute(n,l));function c(l,u,p,f){let g=n===void 0?[]:[t.colors[l].clone(),t.colors[u].clone(),t.colors[p].clone()],v=o===void 0?[]:[new T().fromBufferAttribute(o,l),new T().fromBufferAttribute(o,u),new T().fromBufferAttribute(o,p)],m=new In(l,u,p,v,g,f);t.faces.push(m),h!==void 0&&t.faceVertexUvs[0].push([new X().fromBufferAttribute(h,l),new X().fromBufferAttribute(h,u),new X().fromBufferAttribute(h,p)]),a!==void 0&&t.faceVertexUvs[1].push([new X().fromBufferAttribute(a,l),new X().fromBufferAttribute(a,u),new X().fromBufferAttribute(a,p)])}let d=e.groups;if(d.length>0)for(let l=0;l<d.length;l++){let u=d[l],p=u.start,f=u.count;for(let g=p,v=p+f;g<v;g+=3)i!==void 0?c(i.getX(g),i.getX(g+1),i.getX(g+2),u.materialIndex):c(g,g+1,g+2,u.materialIndex)}else if(i!==void 0)for(let l=0;l<i.count;l+=3)c(i.getX(l),i.getX(l+1),i.getX(l+2));else for(let l=0;l<s.count;l+=3)c(l,l+1,l+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(os).negate(),this.translate(os.x,os.y,os.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new me;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new T,t=new T;for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],o=this.vertices[s.a],n=this.vertices[s.b],h=this.vertices[s.c];e.subVectors(h,n),t.subVectors(o,n),e.cross(t),e.normalize(),s.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new T;if(e){let i=new T,r=new T;for(let s=0,o=this.faces.length;s<o;s++){let n=this.faces[s],h=this.vertices[n.a],a=this.vertices[n.b],c=this.vertices[n.c];i.subVectors(c,a),r.subVectors(h,a),i.cross(r),t[n.a].add(i),t[n.b].add(i),t[n.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];t[s.a].add(s.normal),t[s.b].add(s.normal),t[s.c].add(s.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],o=s.vertexNormals;o.length===3?(o[0].copy(t[s.a]),o[1].copy(t[s.b]),o[2].copy(t[s.c])):(o[0]=t[s.a].clone(),o[1]=t[s.b].clone(),o[2]=t[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let s=0,o=r.vertexNormals.length;s<o;s++)r.__originalVertexNormals[s]?r.__originalVertexNormals[s].copy(r.vertexNormals[s]):r.__originalVertexNormals[s]=r.vertexNormals[s].clone()}let e=new Ks;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let s=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(let n=0,h=this.faces.length;n<h;n++){let a=new T,c={a:new T,b:new T,c:new T};s.push(a),o.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let s=0,o=this.faces.length;s<o;s++){let n=this.faces[s],h=r.faceNormals[s],a=r.vertexNormals[s];h.copy(n.normal),a.a.copy(n.vertexNormals[0]),a.b.copy(n.vertexNormals[1]),a.c.copy(n.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Di),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ji),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,s=this.vertices.length,o=this.vertices,n=e.vertices,h=this.faces,a=e.faces,c=this.colors,d=e.colors;t!==void 0&&(r=new Cs().getNormalMatrix(t));for(let l=0,u=n.length;l<u;l++){let p=n[l].clone();t!==void 0&&p.applyMatrix4(t),o.push(p)}for(let l=0,u=d.length;l<u;l++)c.push(d[l].clone());for(let l=0,u=a.length;l<u;l++){let p=a[l],f,g,v=p.vertexNormals,m=p.vertexColors,y=new In(p.a+s,p.b+s,p.c+s);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let _=0,x=v.length;_<x;_++)f=v[_].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let _=0,x=m.length;_<x;_++)g=m[_],y.vertexColors.push(g.clone());y.materialIndex=p.materialIndex+i,h.push(y)}for(let l=0,u=e.faceVertexUvs.length;l<u;l++){let p=e.faceVertexUvs[l];this.faceVertexUvs[l]===void 0&&(this.faceVertexUvs[l]=[]);for(let f=0,g=p.length;f<g;f++){let v=p[f],m=[];for(let y=0,_=v.length;y<_;y++)m.push(v[y].clone());this.faceVertexUvs[l].push(m)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],s=Math.pow(10,e);for(let h=0,a=this.vertices.length;h<a;h++){let c=this.vertices[h],d=Math.round(c.x*s)+"_"+Math.round(c.y*s)+"_"+Math.round(c.z*s);t[d]===void 0?(t[d]=h,i.push(this.vertices[h]),r[h]=i.length-1):r[h]=r[t[d]]}let o=[];for(let h=0,a=this.faces.length;h<a;h++){let c=this.faces[h];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let d=[c.a,c.b,c.c];for(let l=0;l<3;l++)if(d[l]===d[(l+1)%3]){o.push(h);break}}for(let h=o.length-1;h>=0;h--){let a=o[h];this.faces.splice(a,1);for(let c=0,d=this.faceVertexUvs.length;c<d;c++)this.faceVertexUvs[c].splice(a,1)}let n=this.vertices.length-i.length;return this.vertices=i,n}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new T(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let h=0;h<t;h++)e[h]._id=h;function i(h,a){return h.materialIndex-a.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],s=this.faceVertexUvs[1],o,n;r&&r.length===t&&(o=[]),s&&s.length===t&&(n=[]);for(let h=0;h<t;h++){let a=e[h]._id;o&&o.push(r[a]),n&&n.push(s[a])}o&&(this.faceVertexUvs[0]=o),n&&(this.faceVertexUvs[1]=n)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],s={},o=[],n={},h=[],a={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],g=!0,v=!1,m=this.faceVertexUvs[0][p]!==void 0,y=f.normal.length()>0,_=f.vertexNormals.length>0,x=f.color.r!==1||f.color.g!==1||f.color.b!==1,S=f.vertexColors.length>0,b=0;if(b=c(b,0,0),b=c(b,1,g),b=c(b,2,v),b=c(b,3,m),b=c(b,4,y),b=c(b,5,_),b=c(b,6,x),b=c(b,7,S),i.push(b),i.push(f.a,f.b,f.c),i.push(f.materialIndex),m){let A=this.faceVertexUvs[0][p];i.push(u(A[0]),u(A[1]),u(A[2]))}if(y&&i.push(d(f.normal)),_){let A=f.vertexNormals;i.push(d(A[0]),d(A[1]),d(A[2]))}if(x&&i.push(l(f.color)),S){let A=f.vertexColors;i.push(l(A[0]),l(A[1]),l(A[2]))}}function c(p,f,g){return g?p|1<<f:p&~(1<<f)}function d(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return s[f]!==void 0||(s[f]=r.length/3,r.push(p.x,p.y,p.z)),s[f]}function l(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return n[f]!==void 0||(n[f]=o.length,o.push(p.getHex())),n[f]}function u(p){let f=p.x.toString()+p.y.toString();return a[f]!==void 0||(a[f]=h.length/2,h.push(p.x,p.y)),a[f]}return e.data={},e.data.vertices=t,e.data.normals=r,o.length>0&&(e.data.colors=o),h.length>0&&(e.data.uvs=[h]),e.data.faces=i,e}clone(){return new Ks().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let l=0,u=t.length;l<u;l++)this.vertices.push(t[l].clone());let i=e.colors;for(let l=0,u=i.length;l<u;l++)this.colors.push(i[l].clone());let r=e.faces;for(let l=0,u=r.length;l<u;l++)this.faces.push(r[l].clone());for(let l=0,u=e.faceVertexUvs.length;l<u;l++){let p=e.faceVertexUvs[l];this.faceVertexUvs[l]===void 0&&(this.faceVertexUvs[l]=[]);for(let f=0,g=p.length;f<g;f++){let v=p[f],m=[];for(let y=0,_=v.length;y<_;y++){let x=v[y];m.push(x.clone())}this.faceVertexUvs[l].push(m)}}let s=e.morphTargets;for(let l=0,u=s.length;l<u;l++){let p={};if(p.name=s[l].name,s[l].vertices!==void 0){p.vertices=[];for(let f=0,g=s[l].vertices.length;f<g;f++)p.vertices.push(s[l].vertices[f].clone())}if(s[l].normals!==void 0){p.normals=[];for(let f=0,g=s[l].normals.length;f<g;f++)p.normals.push(s[l].normals[f].clone())}this.morphTargets.push(p)}let o=e.morphNormals;for(let l=0,u=o.length;l<u;l++){let p={};if(o[l].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,g=o[l].vertexNormals.length;f<g;f++){let v=o[l].vertexNormals[f],m={};m.a=v.a.clone(),m.b=v.b.clone(),m.c=v.c.clone(),p.vertexNormals.push(m)}}if(o[l].faceNormals!==void 0){p.faceNormals=[];for(let f=0,g=o[l].faceNormals.length;f<g;f++)p.faceNormals.push(o[l].faceNormals[f].clone())}this.morphNormals.push(p)}let n=e.skinWeights;for(let l=0,u=n.length;l<u;l++)this.skinWeights.push(n[l].clone());let h=e.skinIndices;for(let l=0,u=h.length;l<u;l++)this.skinIndices.push(h[l].clone());let a=e.lineDistances;for(let l=0,u=a.length;l<u;l++)this.lineDistances.push(a[l]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new kw().fromGeometry(this),t=new Oe,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",ns.call(new ze(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",ns.call(new ze(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",uh.call(new ze(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",dh.call(new ze(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",dh.call(new ze(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let s=[],o=e.morphTargets[r];for(let n=0,h=o.length;n<h;n++){let a=o[n],c=new ve(a.data.length*3,3);c.name=a.name,s.push(ns.call(c,a.data))}t.morphAttributes[r]=s}if(e.skinIndices.length>0){let r=new ve(e.skinIndices.length*4,4);t.setAttribute("skinIndex",ph.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new ve(e.skinWeights.length*4,4);t.setAttribute("skinWeight",ph.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Oe,i=e.geometry;if(e.isPoints||e.isLine){let r=new ve(i.vertices.length*3,3),s=new ve(i.colors.length*3,3);if(t.setAttribute("position",ns.call(r,i.vertices)),t.setAttribute("color",uh.call(s,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let o=new ve(i.lineDistances.length,1);t.setAttribute("lineDistance",Fw.call(o,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};Ks.prototype.isGeometry=!0;var kw=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,s,o=e.faces;for(r=0;r<o.length;r++){let n=o[r];n.materialIndex!==s&&(s=n.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:s})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,s=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,n=e.morphTargets,h=n.length,a;if(h>0){a=[];for(let v=0;v<h;v++)a[v]={name:n[v].name,data:[]};this.morphTargets.position=a}let c=e.morphNormals,d=c.length,l;if(d>0){l=[];for(let v=0;v<d;v++)l[v]={name:c[v].name,data:[]};this.morphTargets.normal=l}let u=e.skinIndices,p=e.skinWeights,f=u.length===i.length,g=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let v=0;v<t.length;v++){let m=t[v];this.vertices.push(i[m.a],i[m.b],i[m.c]);let y=m.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let x=m.normal;this.normals.push(x,x,x)}let _=m.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let x=m.color;this.colors.push(x,x,x)}if(s===!0){let x=r[0][v];x!==void 0?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new X,new X,new X))}if(o===!0){let x=r[1][v];x!==void 0?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new X,new X,new X))}for(let x=0;x<h;x++){let S=n[x].vertices;a[x].data.push(S[m.a],S[m.b],S[m.c])}for(let x=0;x<d;x++){let S=c[x].vertexNormals[v];l[x].data.push(S.a,S.b,S.c)}f&&this.skinIndices.push(u[m.a],u[m.b],u[m.c]),g&&this.skinWeights.push(p[m.a],p[m.b],p[m.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},In=class{constructor(e,t,i,r,s,o=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new T,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new rt,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=o}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function Fw(e){return this.array.set(e),this}function uh(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new rt),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this}function dh(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new X),t[i++]=o.x,t[i++]=o.y}return this}function ns(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new T),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this}function ph(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Je),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this}var Gw=["a","b","c"];function Vw(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function Ro(e,t,i){let r=Math.min(e,t),s=Math.max(e,t),o=r+"_"+s;return i.get(o)}function ko(e,t,i,r,s,o){let n=Math.min(e,t),h=Math.max(e,t),a=n+"_"+h,c;if(r.has(a))c=r.get(a);else{let d=i[n],l=i[h];c={a:d,b:l,newEdge:null,faces:[]},r.set(a,c)}c.faces.push(s),o[e].edges.push(c),o[t].edges.push(c)}function Hw(e,t,i,r){let s,o,n;for(s=0,o=e.length;s<o;s++)i[s]={edges:[]};for(s=0,o=t.length;s<o;s++)n=t[s],ko(n.a,n.b,e,r,n,i),ko(n.b,n.c,e,r,n,i),ko(n.c,n.a,e,r,n,i)}function as(e,t,i,r,s){e.push(new In(t,i,r,void 0,void 0,s))}function Bi(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function ls(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var Ww=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Oe?e=new Ks().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new T,i,r,s,o,n,h=e.vertices,a=e.faces,c=e.faceVertexUvs[0],d=c!==void 0&&c.length>0,l=[],u=new Map;Hw(h,a,l,u);let p=[],f,g,v,m,y,_,x;for(let k of Array.from(u.keys())){for(g=u.get(k),v=new T,y=3/8,_=1/8,x=g.faces.length,x!=2&&(y=.5,_=0,x!=1),v.addVectors(g.a,g.b).multiplyScalar(y),t.set(0,0,0),o=0;o<x;o++){for(m=g.faces[o],n=0;n<3&&(f=h[Vw(m,Gw[n])],!(f!==g.a&&f!==g.b));n++);f&&t.add(f)}t.multiplyScalar(_),v.add(t),g.newEdge=p.length,p.push(v)}let S,b,A,O,P,w,C,M=[];for(r=0,s=h.length;r<s;r++){for(w=h[r],P=l[r].edges,i=P.length,i==3?S=3/16:i>3&&(S=3/(8*i)),b=1-i*Number(S),A=S,i<=2&&(i==2?(b=3/4,A=1/8):i==1||i==0),C=w.clone().multiplyScalar(b),t.set(0,0,0),o=0;o<i;o++)O=P[o],f=O.a!==w?O.a:O.b,t.add(f);t.multiplyScalar(Number(A)),C.add(t),M.push(C)}let z=M.concat(p),W=M.length,Q,re,$,V=[],H=[],I,j,L,N,R=new X,G=new X,U=new X;for(r=0,s=a.length;r<s;r++)m=a[r],Q=Number(Ro(m.a,m.b,u).newEdge)+W,re=Number(Ro(m.b,m.c,u).newEdge)+W,$=Number(Ro(m.c,m.a,u).newEdge)+W,as(V,Q,re,$,m.materialIndex),as(V,m.a,Q,$,m.materialIndex),as(V,m.b,re,Q,m.materialIndex),as(V,m.c,$,re,m.materialIndex),d&&(I=c[r],j=I[0],L=I[1],N=I[2],R.set(Bi(j.x,L.x),Bi(j.y,L.y)),G.set(Bi(L.x,N.x),Bi(L.y,N.y)),U.set(Bi(j.x,N.x),Bi(j.y,N.y)),ls(H,R,G,U),ls(H,j,R,U),ls(H,L,G,R),ls(H,N,U,G));e.vertices=z,e.faces=V,d&&(e.faceVertexUvs[0]=H)}},Ve=new T,qw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Oe().copy(new er(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Ve),r={width:Ve.x,height:Ve.y,depth:Ve.z,subdivisions:0}):r=t.parameters;let s={...r,...e.parameters};return{parameters:{width:Math.abs(s.width),height:Math.abs(s.height),depth:Math.abs(s.depth),subdivisions:Math.abs(s.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:s}=e.parameters,o=e.geometry??new Oe().copy(new er(100,100,100)),n=o.userData.parameters;n===void 0?(o.computeBoundingBox(),o.boundingBox.getSize(Ve)):Ve.set(n.width,n.height,n.depth),(t!==Ve.x||i!==Ve.y||r!==Ve.z)&&o.scale(Ve.x===0?1:t/Ve.x,Ve.y===0?1:i/Ve.y,Ve.z===0?1:r/Ve.z);let h=o.originalGeometry;return s>0?(h===void 0||(n==null?void 0:n.subdivisions)!==s)&&(h===void 0&&(h=o),o=new Ww(s).modify(h).toBufferGeometry()):(h!==void 0&&(o=h),h=void 0,o.getAttribute("normal")===void 0&&o.computeVertexNormals()),h!==void 0&&Object.assign(o,{originalGeometry:h}),delete e.geometry,Object.assign(o,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new ic(i).load(e,r=>{let s=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Ve);let o=100/Ve.x;Object.assign(s.parameters,{width:100,height:Ve.y*o,depth:Ve.z*o}),t(this.build(s))})}},Pu=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof je?e.shape:new je,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:s,depth:o,extrudeBevelSize:n,extrudeBevelSegments:h}=e.parameters,a=e.shape,c=t*.5,d=i*.5,l=0,u=0,p=2*Math.PI/r;for(let g=0;g<r;g++){let v=p*g,m=l+Math.sin(v)*c,y=u+Math.cos(v)*d;a.addPoint(a.createPoint(m,y))}a.isClosed=!0;for(let g=0,v=a.points.length;g<v;g++)a.points[g].roundness=s;a.roundness=s,a.update();let f=Ni.create({shape:a,parameters:{roundness:s,depth:o,extrudeBevelSize:n,extrudeBevelSegments:h}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},$w=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:s,heightSegments:o,openEnded:n,cornerRadius:h,cornerSegments:a}=e.parameters,c=new Yw(t*.5,i,s,o,n,h,a);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function Or(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function Fo(e,t,i,r,s,o){let n=t.clone().sub(e),h=i.clone().sub(e),a=n.angleTo(h);if(n.normalize(),h.normalize(),r===s){let c=n.add(h).normalize();o.copy(e).addScaledVector(c,r/Math.sin(a/2))}else{let c=n.angleTo(h);o.copy(e),o.addScaledVector(n,s/Math.sin(c)),o.addScaledVector(h,r/Math.sin(c))}}function Xw(e,t,i){let r=e.clone().sub(t),s=i.clone().sub(t);return r.projectOnVector(s),r.add(t)}var Yw=class extends Oe{constructor(e=.5,t=1,i=4,r=1,s=!1,o=0,n=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),n=Math.floor(n);let h=[],a=[],c=[],d=[],l=0,u=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),g=2*Math.PI/i,v=(i-2)*Math.PI/i,m=Math.PI-v,y=new T(0,-u,0),_=new T(0,u,0),x=new X(e,-u),S=new X(f,-u),b=new X(0,_.y).sub(S),A=new X(0,_.y).sub(x),O=new X(b.y,-b.x).normalize(),P=new X(A.y,-A.x).normalize(),w=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-b.angle())/2)-1e-8;o=Math.min(o,w);let C;{let $=new T(O.x,O.y,0),V=new T(Math.cos(g)*$.x,$.y,Math.sin(g)*$.x);C=$.angleTo(V)}let M=o/Math.tan((Math.PI-b.angle())/2),z=o/Math.tan((Math.PI-C)/2),W=new T;if(!s){a.push(y.x,y.y,y.z),c.push(0,-1,0),d.push(0,0);let $=l++,V=[],H=x.clone(),I=M/Math.cos(Math.PI/i);H.x-=I;for(let j=0;j<i;j++){let L=j/i*Math.PI*2+p,N=new X(Math.sin(L),Math.cos(L));Or(H,N,W),a.push(W.x,W.y,W.z),c.push(0,-1,0),d.push(0,0),V.push(l++)}for(let j=0;j<V.length;j++)h.push(V[j],$,V[(j+1)%V.length])}{let $=new T,V=new T,H=new T,I=new T,j=new T,L=new T;for(let N=0;N<i;N++){let R=N/i*Math.PI*2+p,G=(N+.5)/i*Math.PI*2+p,U=(N+1)/i*Math.PI*2+p,k=new X(Math.sin(R),Math.cos(R)),q=new X(Math.sin(G),Math.cos(G)),F=new X(Math.sin(U),Math.cos(U));Or(x,k,V),Or(x,F,H),Or(O,q,$),Fo(_,V,H,z,z,I),a.push(I.x,I.y,I.z),Fo(V,_,H,z,M,j),a.push(j.x,j.y,j.z),Fo(H,V,_,M,z,L),a.push(L.x,L.y,L.z),c.push($.x,$.y,$.z),c.push($.x,$.y,$.z),c.push($.x,$.y,$.z),d.push(0,0),d.push(0,0),d.push(0,0);let ee=l++,K=l++,Y=l++;if(h.push(ee,K,Y),o>0){{let Z=V.clone().add(H).multiplyScalar(.5),pe=_.clone().sub(Z).normalize(),oe=y.clone().sub(Z).normalize().add(pe).normalize().multiplyScalar(-1),he=L.clone().sub(j);Q(Z,he,oe,b.angle())}let te,J;{let Z=new T;Or(P,F,Z);let pe=L.clone().add(I).multiplyScalar(.5);pe=Xw(pe,H,_);let oe=L.clone().sub(I);[te,J]=Q(pe,oe,Z,C,I.y)}{let Z=te,pe=Z.clone().setY(0).normalize(),oe=new T(0,-1,0),he=pe.clone().cross(oe);re(Z,pe,oe,he)}{let Z=b.angle(),pe=Math.PI-Z,oe=_.clone();oe.y-=o/Math.sin(Z-Math.PI/2);let he=new T,ye=[];for(let De=0;De<n;De++){let Ce=[],xt=Math.PI/2-pe*De/n,Kt=Math.cos(xt),Ze=Math.sin(xt),vr=G;for(let Qr=0;Qr<=De;Qr++){let Jr=Math.cos(vr),go=Math.sin(vr);$.x=Kt*go,$.y=Ze,$.z=Kt*Jr,he.copy(oe).addScaledVector($,o),a.push(he.x,he.y,he.z),c.push($.x,$.y,$.z),d.push(0,0),Ce.push(l++),vr+=Math.PI*2/De/i}ye.push(Ce)}J.reverse(),ye.push(J);let ge=ye.length-1;for(let De=0;De<ge;De++){let Ce=ye[De],xt=ye[De+1],Kt=Ce.length-1;h.push(xt[1],Ce[0],xt[0]);for(let Ze=1;Ze<=Kt;Ze++)h.push(Ce[Ze],Ce[Ze-1],xt[Ze]),h.push(xt[Ze+1],Ce[Ze],xt[Ze])}}}}}this.setIndex(h),this.setAttribute("position",new ve(a,3)),this.setAttribute("normal",new ve(c,3)),this.setAttribute("uv",new ve(d,2));function Q($,V,H,I,j){let L=-I/2,N=(Math.PI-I)/2,R=V.clone().normalize().cross(H);$.addScaledVector(H,-o/Math.sin(N));let G=new T,U=new T,k=1,q=l,F=[];for(let ee=0;ee<=n;ee++){let K=L+ee/n*I;U.set(0,0,0),U.addScaledVector(R,Math.sin(K)),U.addScaledVector(H,Math.cos(K));for(let Y=0;Y<=k;Y++){let te=Y/k-.5;if(G.copy($),G.addScaledVector(V,te),G.addScaledVector(U,o),j!=null){let J=Math.max(0,G.y-j);G.addScaledVector(V,-J/V.y)}a.push(G.x,G.y,G.z),c.push(U.x,U.y,U.z),d.push(0,0),Y===0&&F.push(l),l++}}for(let ee=0;ee<n;ee++)for(let K=0;K<k;K++){let Y=q+K+(k+1)*ee,te=Y+(k+1),J=te+1,Z=Y+1;h.push(Y,te,Z),h.push(te,J,Z)}return[$.clone().addScaledVector(V,.5),F]}function re($,V,H,I){let j=Math.PI/2,L=A.angle()-j,N=[],R=new T,G=new T;for(let k=0;k<=n;k++){let q=[],F=k/n;for(let ee=0;ee<=k;ee++){let K=((k?ee/k:0)-.5)*m,Y=Math.cos(K),te=Math.sin(K),J=Math.atan(Math.tan(L)*Y),Z=(j+J)*F,pe=Math.cos(Z),oe=Math.sin(Z);R.set(0,0,0),R.addScaledVector(V,oe*Y),R.addScaledVector(H,pe),R.addScaledVector(I,oe*te),G.copy($).addScaledVector(R,o),a.push(G.x,G.y,G.z),c.push(R.x,R.y,R.z),d.push(0,0),q.push(l++)}N.push(q)}let U=N.length-1;for(let k=0;k<U;k++){let q=N[k],F=N[k+1],ee=q.length-1;h.push(q[0],F[1],F[0]);for(let K=1;K<=ee;K++)h.push(q[K-1],q[K],F[K]),h.push(q[K],F[K+1],F[K])}}}},Tu=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof je?e.shape:new je,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:s,cornerType:o,depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}=e.parameters,c={x:i*.5,y:r*.5},d={x:-c.x,y:-c.y},l={x:c.x,y:c.y};function u(x,S,b){return S>i&&b>r?Math.min(x*i/S,x*r/b):S>i?x*i/S:b>r?x*r/b:x}let p=[];p[0]=s[0]===0?0:u(s[0],s[0]+s[3],s[0]+s[1]),p[1]=s[1]===0?0:u(s[1],s[1]+s[2],s[1]+s[0]),p[2]=s[2]===0?0:u(s[2],s[2]+s[1],s[2]+s[3]),p[3]=s[3]===0?0:u(s[3],s[3]+s[0],s[3]+s[2]);let f=d.x,g=l.x,v=l.y,m=d.y;t.addPoint(t.createPoint(f,v)),t.addPoint(t.createPoint(g,v)),t.addPoint(t.createPoint(g,m)),t.addPoint(t.createPoint(f,m)),t.isClosed=!0;let y=!0;for(let x=0,S=t.points.length;x<S;x++)t.points[x].roundness=p[x],x>0&&p[x]!==p[x-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=o!==1,t.update();let _=Ni.create({shape:t,parameters:{depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}});return Object.assign(_,{userData:{...e,type:"RectangleGeometry"}})}},Kw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:s=64,heightSegments:o=64,phiStart:n,phiLength:h,thetaStart:a,thetaLength:c}=e.parameters,d=new gp(.5*t,s,o,n,h,a,c);return d.scale(1,i/t,r/t),Object.assign(d,{userData:{...e,type:"SphereGeometry"}})}},Zw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:s=8}=e.parameters,o=new oc(t,i,r,s);return o.scale(1,1,1),Object.assign(o,{userData:{...e,type:"PlaneGeometry"}})}},Qw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:s,cornerRadius:o,cornerSegments:n}=e.parameters,h=new Jw(t,i,r,s,o,n);return Object.assign(h,{userData:{...e,type:"BackdropGeometry"}})}},Jw=class extends Oe{constructor(e=1,t=1,i=1,r=90,s=10,o=24){super(),this.type="BackdropGeometry";let n=[],h=[],a=[],c=.001;s==0&&(o=1),o=Math.max(1,Math.floor(o)),s=Math.min(s,100),r=Math.min(180-c,r),r*=Math.PI/180;let d=[],l=Math.PI/2,u=(k=0,q=0,F=0)=>new T(k,q,F),p=u(),f=u(),[g,v,m]=[t/2,e/2,i/2],y=-v,_=+v,[x,S,b]=[u(y,-g,+m),u(y,-g,-m),u(y,+g,-m)],A=(k,q=!1)=>Math.sin(k-Math.PI/(1+ +q)),O=(k,q=!1)=>Math.cos(k-Math.PI/(1+ +q));b.y=Math.sin(r)*t-g;let P=Math.cos(r)*t-m,w=x.z-c;r<=l?(b.z=Math.min(P,w),b.z==w&&(b.y-=(P-w)/Math.tan(l-r))):S.z=Math.min(S.z-P-m,x.z-c),p.subVectors(x,S),f.subVectors(b,S);let C=Math.min(p.length(),f.length())*s/100,M=C*Math.tan(r/2),z=C/Math.cos(r/2),W=p.clone().normalize().add(f.normalize()).setLength(z).add(S);p.set(0,A(r,!0),O(r,!0)),d.push([b,p.clone()]);let Q=(Math.PI-r)/o;for(let k=0;k<=o;k++){let q=l+r+k*Q;p.set(0,Math.sin(q)*M,Math.cos(q)*M),p.add(W),f.set(0,A(q),O(q)),d.push([p.clone(),f.clone()])}d.push([x,u(0,1,0)]);let re=Math.sin(Q/2)*M*2,$=d.length-1,V=d[0][0].distanceTo(d[1][0]),H=d[$-1][0].distanceTo(d[$][0]),I=V+re*o+H;d[0].push(1);for(let k=0;k<=o;k++)d[k+1].push(1-(V+k*re)/I);d[$].push(0);let[j,L,N]=d[0],R,G,U;for(let k=1;k<d.length;k++)[R,G,U]=d[k],n.push(y,j.y,j.z,y,R.y,R.z,_,j.y,j.z,_,j.y,j.z,y,R.y,R.z,_,R.y,R.z),h.push(0,L.y,L.z,0,G.y,G.z,0,L.y,L.z,0,L.y,L.z,0,G.y,G.z,0,G.y,G.z),a.push(0,N,0,U,1,N,1,N,0,U,1,U),[j,L,N]=[R,G,U];this.setAttribute("position",new ve(n,3)),this.setAttribute("normal",new ve(h,3)),this.setAttribute("uv",new ve(a,2))}},Eu=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof je?e.shape:new je,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:s,cornerRadius:o,angle:n,depth:h,extrudeBevelSize:a,extrudeBevelSegments:c}=e.parameters,d=e.shape,l=t*.5,u=i*.5,p=0,f=0,g=n*Math.PI/360/s,v=Math.PI/2*3*-1,m=l*r/100,y=u*r/100;if(s===3&&r===50){g=2*Math.PI/s;for(let x=0;x<s;x++){let S=g*x,b=p+Math.sin(S)*l,A=f+Math.cos(S)*u;d.addPoint(d.createPoint(b,A))}}else for(let x=0;x<s;x++){let S=p+Math.cos(v)*l,b=f+Math.sin(v)*u;d.addPoint(d.createPoint(S,b)),v+=g,S=p+Math.cos(v)*m,b=f+Math.sin(v)*y,d.addPoint(d.createPoint(S,b)),v+=g}d.isClosed=!0;for(let x=0,S=d.points.length;x<S;x++)d.points[x].roundness=o;d.roundness=o,d.update();let _=Ni.create({shape:d,parameters:{roundness:o,depth:h,extrudeBevelSize:a,extrudeBevelSegments:c}});return Object.assign(_,{userData:{...e,type:"StarGeometry"}})}},e_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new oc(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},t_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:Math.PI*2,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),o=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:s,depth:o})}}static build(e){let{width:t,height:i,depth:r,radialSegments:s,tubularSegments:o,arc:n,cornerRadius:h,cornerSegments:a}=e.parameters,c=i_(t,i,r,t*.5,n,o,0,0,s,h,a);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function i_(e,t,i,r,s,o,n,h,a,c,d){return[t,i]=[i,t],n=t/2,s/=2*Math.PI,s==1&&(c=0),new Aa(!0,e,t,i,r,s,o,n,h,a,c,d)}var r_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:s,p:o,q:n}=e.parameters,h=t*.5;h!==i&&(h-=i);let a=new vp(h,i,r,s,o,n);return Object.assign(a,{userData:{...e,type:"TorusKnotGeometry"}})}},s_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof je?e.shape:new je,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:n,isRect:h}=e.parameters,a=e.shape,c=t*.5,d=i*.5;h?(a.addPoint(a.createPoint(-c,d)),a.addPoint(a.createPoint(c,-d)),a.addPoint(a.createPoint(-c,-d))):(a.addPoint(a.createPoint(0,d)),a.addPoint(a.createPoint(c,-d)),a.addPoint(a.createPoint(-c,-d))),a.isClosed=!0;for(let u=0,p=a.points.length;u<p;u++)a.points[u].roundness=r;a.roundness=r,a.update();let l=Ni.create({shape:a,parameters:{roundness:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:n}});return Object.assign(l,{userData:{...e,type:"TriangleGeometry"}})}};function o_(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function n_(e,t,i){let r=[new T,new T,new T],s=[new T,new T,new T];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(s[0],s[1],s[2]),r.forEach((o,n)=>{let h=s[n],a=Ne.lerp(o.length(),h.length(),i);o.lerp(h,i).setLength(a)}),new me().makeBasis(r[0],r[1],r[2])}var a_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),o=Math.abs(i.depth??0),n=(t==null?void 0:t.shapeData)??Sa.create({parameters:Ec}).userData.shape;return{path:e.path??Us.defaultData(),parameters:Object.assign(i,{width:r,height:s,depth:o,extrusion:{...Mc,...i.extrusion}}),shapeData:n}}static build(e){if(e.path.points.length>=2){let t=new l_(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Oe,{userData:{...e,type:"PathGeometry"}})}},l_=class extends Oe{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!o_(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion,s=this.inputs.path.isClosed?e.length:e.length-1,o=Math.floor(r*s),n=this.inputs.path.isClosed?Math.ceil((i+r)*s):Math.ceil(Math.min(1,i+r)*s),h=Math.min(Math.max(2,n-o+1),s+2),a=[],c=[];for(let w=0;w<h;w++){let C=this.inputs.path.isClosed?(w+o)%e.length:Math.min(w+o,e.length-1);a.push(e[C].clone()),c.push(t[C].clone())}let d=(w,C,M)=>{a[w]=a[w].clone().lerp(a[C],M),c[w]=n_(c[w],c[C],M)},l=0,u=r*s%1;(!this.inputs.path.isClosed||i<=1)&&(u||r===0)&&(l=u,d(0,1,l));let p=0,f=(r+i)*s%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,d(a.length-1,a.length-2,1-p)),i===0){let w=a.length-1;a[w].copy(a[0]),c[w].copy(c[0])}this._applyPathModifiers(c,l,p);let{regions:g,infos:v,vertices:m}=this._computeShapePoints(5),y=0,_=0;v.sort((w,C)=>w.start-C.start),v.forEach(w=>{w.verticesStart=y,w.verticesCount=w.continuous.reduce((C,M,z)=>C+(z===0||!M?2:1),0),_+=w.verticesCount,y=_});let x=_*h,S,b=0;if(this._isOpenEnded()){try{S=ni({windingRule:Se.ODD,elementType:Fe.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:g})}catch{S=yu}b=S.vertexCount}let A=x+2*b,O={positions:new Float32Array(A*3),normals:new Float32Array(A*3),uvs:new Float32Array(A*2)},P=[];v.forEach(w=>{this._extrudeRegion(w,m,c,a,O,P,this._isGeometryClosed()&&!this._isOpenEnded())}),S&&(this._closeEnd(S,x,P,O,c[0],a[0],!1),this._closeEnd(S,x+b,P,O,c[c.length-1],a[a.length-1],!0)),this.setAttribute("position",new ze(O.positions,3)),this.setAttribute("normal",new ze(O.normals,3)),this.setAttribute("uv",new ze(O.uvs,2)),this.setIndex(P)}_extractPathPoints(){let e=hu(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,s=new T,o=new T,n=new T,h=new T,a=new T(0,1,0);for(let f=0;f<i;f++){let g=e[f],v;f===0?v=r?e[e.length-2]:g.clone().multiplyScalar(2).sub(e[1]):v=e[f-1];let m;f===i-1?m=r?e[1]:g.clone().multiplyScalar(2).sub(e[f-1]):m=e[f+1];let y=g.clone().sub(v).normalize(),_=m.clone().sub(g).normalize(),x=y.clone().add(_).normalize();n.copy(x),f===0&&(x.equals(a)||x.clone().negate().equals(a))&&a.set(0,0,1);let S=a.clone().cross(x).normalize(),b=x.clone().cross(S).normalize();a.copy(b),h.copy(S),f===0&&(s.copy(b),o.copy(x));let A=new me().makeBasis(S,b,x);t.push(A)}let c=r?o:n,d=r?s:new T(0,1,0),l=c.clone().cross(h).normalize(),u=Math.acos(d.dot(l));if(isNaN(u))return t;let p=d.clone().cross(l);c.dot(p)>0&&(u*=-1);for(let f=1;f<t.length;f++){let g=new me().makeRotationZ(u*f/t.length);t[f].multiply(g)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:s,twist:o,startScale:n,endScale:h}=this.inputs.parameters.extrusion,a=new me,c=new me;return e.forEach((d,l)=>{let u=l===0?0:l===r-1?1:(l-t)/(r-(i===0?0:1)-(t+(1-i)));a.makeRotationZ(Ne.lerp(s,s+o,u));let p=Ne.lerp(n,h,u);c.makeScale(p,p,p),d.multiply(a).multiply(c)}),e}_computeShapePoints(e=12,t=Se.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),s=i.shapeHoles.map(c=>{let d=c.extractShapePointsToFlatArray([],e),l=[];for(let u=d.length-1;u>=1;u-=2){let p=d[u-1],f=d[u-0];l.push(p,f)}return l}),o;try{o=ni({windingRule:t,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{o=_a}let n;try{n=ni({windingRule:Se.ODD,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...s]})}catch{n=vu}if(!o)throw new Error("error generating geometry");let h=o.elementCount;if(n){o.elementCount+=n.elementCount;for(let c=0;c<n.elements.length;c++){let d=n.elements[c],l=c%2===0?o.vertexCount:0;o.elements.push(d+l)}for(let c=0;c<n.vertexIndices.length;c++){let d=n.vertexIndices[c],l=o.vertexCount;o.vertexIndices.push(d+l)}for(let c=0;c<n.vertices.length;c++){let d=n.vertices[c];o.vertices.push(d)}}for(let c=0,d=o.vertexCount;c<d;c++){let l=c*2;o.vertices[l+0],o.vertices[l+1]}let a=[];for(let c=o.elementCount-1;c>=0;c--){let d=c>=h,l=c*2,u=o.elements[l+0],p=o.elements[l+1],f=u+p,g={start:u,count:p,normals:[],isHole:d,continuous:[],verticesStart:0,verticesCount:0};a.push(g);let v=u,m=f-1,y=u+1,_=i.roundedCurves.length;do{let x=v-u;o.vertices[m*2+0],o.vertices[m*2+1];let S=o.vertices[v*2+0],b=o.vertices[v*2+1],A=o.vertices[y*2+0],O=o.vertices[y*2+1],P=S-A,w=b-O,C=Math.sqrt(P*P+w*w);P/=C,w/=C,g.normals[x*2+0]=-w,g.normals[x*2+1]=P;let M=o.vertexIndices[v];if(Array.isArray(M))g.continuous[x]=!1;else{let[z,W]=i.getCurveIndexFromVertexId(M-1,!0);if(W>0&&W<1)g.continuous[x]=!0;else{let Q=W===1?z+1:z-1;Q=(Q+_)%_;let re=W===1?0:1,$=i.roundedCurves[z].getTangent(W),V=i.roundedCurves[Q].getTangent(re);g.continuous[x]=$.dot(V)>.95}}d&&(g.normals[x*2+0]*=-1,g.normals[x*2+1]*=-1),[m,v,y]=[v,y,y+1],y>=f&&(y-=p)}while(y!==u+1)}return{regions:[r,...s],infos:a,vertices:o.vertices}}_insertVertex(e,t,i,r,s){let o=t*2,n=t*3;e.positions[n+0]=i.x,e.positions[n+1]=i.y,e.positions[n+2]=i.z,e.normals[n+0]=r.x,e.normals[n+1]=r.y,e.normals[n+2]=r.z,e.uvs[o+0]=s.x,e.uvs[o+1]=s.y}_extrudeRegion(e,t,i,r,s,o,n){let h=new T,a=new T,c=new T,d=new T,l=new X;i.forEach((p,f)=>{let g=r[f],v=e.verticesStart*i.length+e.verticesCount*f;for(let m=0;m<e.count;m++){let y=(e.start+m)*2;if(h.set(t[y+0],t[y+1],0),c.copy(h).applyMatrix4(p).add(g),e.continuous[m])d.set(e.normals[m*2+0],e.normals[m*2+1],0);else{let _=m==0?(e.start+e.count-1)*2:y-2;a.set(t[_+0],t[_+1],0),d.copy(h).sub(a),d.set(-d.y,d.x,0),e.isHole||d.negate()}if(d.applyMatrix4(p).normalize(),l.set(m===0?1:m/e.count,f/(i.length-1)),this._insertVertex(s,v,c,d,l),v++,!e.continuous[m]||m===0){if(m===0)d.set(e.normals[m*2+0],e.normals[m*2+1],0),l.set(0,f/(i.length-1));else{let _=m===e.count-1?e.start*2:y+2;a.set(t[_+0],t[_+1],0),d.copy(a).sub(h),d.set(-d.y,d.x,0),e.isHole||d.negate()}d.applyMatrix4(p).normalize(),this._insertVertex(s,v,c,d,l),v++}}});let u=i.length-1;for(let p=0;p<u;p++){let f=e.verticesStart*i.length+e.verticesCount*p,g=e.verticesStart*i.length+e.verticesCount*(p+1),v=0;for(let m=0;m<e.count;m++){(!e.continuous[m]||m===0)&&v++;let y=m===e.count-1?0:v+1,_=f+v,x=f+y,S=g+y,b=g+v;e.isHole?o.push(_,S,x,_,b,S):o.push(_,x,S,_,S,b),v++}}}_closeEnd(e,t,i,r,s,o,n){let h=e.vertexCount,a=new T(0,0,n?-1:1).applyMatrix4(s),c=new T,d=new X;for(let u=0;u<h;u++){let p=2*u;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(s).add(o),this._insertVertex(r,t+u,c,a,d)}let l=e.elements;for(let u=0;u<e.elementCount;u++){let p=3*u,f=l[p+0]+t,g=l[p+(n?1:2)]+t,v=l[p+(n?2:1)]+t;i.push(f,g,v)}}};function Mu(){let e=new Oe;return e.setAttribute("position",new ze(new Float32Array([]),3)),e.setIndex(new ze(new Uint16Array([]),1)),e}var h_=Mu().attributes,c_=12,u_=1,Du=class extends Oe{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,h_),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:n,text:h,textTransform:a}=e,c=a===2?h.toUpperCase():a===3?h.toLowerCase():h,d=d_(e,t,c),{shapes:l,charWidths:u,charCoords:p}=t.generateShapes(d,e),f=i*.5,g=r*.5,v=l.map(_=>new je().fromShape(_));this.vectorShapes=v;let m=v.map(_=>Ni.create({shape:_,parameters:{depth:s,extrudeBevelSegments:n,extrudeBevelSize:o,windingRule:s<=0?Se.NONZERO:Se.ODD,subdivisions:this.isLowResolution&&s>0?u_:c_}})),y=m.length?lc(m):Mu();y.translate(-f,g,0),this.dispose(),this.wrappedText=d,this.charCoords=p,this.charWidths=u,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach(([_,x])=>{this.setAttribute(_,x)}),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=ar(new Oe,Du.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};function d_(e,t,i){i=i??e.text;let r=[""],s="";for(let o of i)s+=o,o===" "||o===`
`?(r[r.length-1]+=s,s="",o===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+s,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+s,e)>e.width&&(s.length===1?(r[r.length-1]+=s,s=""):(r[r.length-1]+=s.slice(0,-1),s=s[s.length-1],r.push(""))));return r[r.length-1]+=s,r}var Lu,Oa=new Promise(e=>{Lu=e}),fh=!1;async function p_(){if(fh)return;let e="https://unpkg.com/@splinetool/modelling-wasm@0.9.311/build",[t,i]=await Promise.all([ac(()=>import("./process-10f79362.js"),[]),fetch(`${e}/process.wasm`).then(o=>o.arrayBuffer())]),r=t.default,s=await r({wasmBinary:i});Lu(s),fh=!0}function Zs(e,t,i){let r={parameters:e,type:e.type};if(e.type==="PathGeometry")r.path=e.path;else if(e.type==="VectorGeometry"){let o=je.createFromState(e.shape,e.width,e.height);r.shape=o}else if(e.type==="NonParametricGeometry")e.data.groups&&e.data.groups.forEach(o=>o.materialIndex=Math.max(o.materialIndex??0,0)),r.geometry=new ic().parse(e);else{if(e.type==="SubdivGeometry")return new Ye(e,i);if(e.type==="TextGeometry")return new Du(e,t)}let s;try{s=bh(r)}catch(o){console.error(o)}if(!s){let o=je.createFromState(js.defaultData(),100,100);r.shape=o,s=bh(r)}return s}var f_=new me;function zn(e,t,i,r){let s=e.position.array,o=e.normal.array,n=f_.makeScale(t,i,r).invert().elements,h,a,c;for(var d=0,l=s.length;d<l;d+=3)s[d]*=t,s[d+1]*=i,s[d+2]*=r,h=o[d],a=o[d+1],c=o[d+2],o[d]=n[0]*h+n[4]*a+n[8]*c,o[d+1]=n[1]*h+n[5]*a+n[9]*c,o[d+2]=n[2]*h+n[6]*a+n[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var hs=new Di,ji=new T,le;Oa.then(e=>{le=e});var mh=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),gh=new Uint32Array([0,1,2,3]),vh=new Uint8Array([4]),Ye=class extends Oe{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Hi.div(t,i);this.subdividedGeometry&&zn(this.subdividedGeometry.attributes,...r),this.originalGeometry&&zn(this.originalGeometry.attributes,...r),this.data=e;let s=this.userData.parameters;this.userData.parameters={width:s.width*r[0],height:s.height*r[1],depth:s.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(ji.fromArray(r));let o=ji.set(s.width,s.height,s.depth).length();this.originalGeometry.boundingSphere.radius=o/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=Ye.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new er(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Ye.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Ji,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;hs.setFromBufferAttribute(t),hs.getCenter(i),e.boundingSphere.radius=i.distanceTo(hs.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),hs.getSize(ji);let r={width:ji.x,height:ji.y,depth:ji.z};return this.userData.parameters=r,r}static build(e,t,i,r){let s,o,n,h=(e==null?void 0:e.phongAngle)??35;i===!1&&(h=-1),t&&(le.free_bvh(t),le.free_subdivision_surface(t));try{s=Ye.allocate(e,r)}catch(a){console.error(a,e),s=Ye.allocate({positionWASM:mh,indexWASM:gh,verticesPerFaceWASM:vh},r)}if(le.set_destination_refinement_level(s,0),o=Ye.buildLevel(s,!0,h),e.subdivisions>0)try{le.set_destination_refinement_level(s,e.subdivisions),n=Ye.buildLevel(s,!1,h)}catch{try{le.set_destination_refinement_level(s,e.subdivisions-1),n=Ye.buildLevel(s,!1,h)}catch{n=null}}else n=null;return{subdivPointer:s,originalGeometry:o,subdividedGeometry:n}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r;if(e.type==="TorusGeometry"&&e.arc===Math.PI*2){let{width:c,height:d,depth:l,arc:u,tubularSegments:p,radialSegments:f}=e;r=new Aa(!0,c,l,d,c*.5,u/(2*Math.PI),p,l/2,0,f,0,0,!0)}else r=e.shape!==void 0?t.geometry:Zs(e,i,!1);let s,o,n,h;({positions:s,triIndices:h}=Iu(r.getAttribute("position"),r.getIndex()));let a;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let c=e.radialSegments*e.heightSegments*3*2,d=c+e.radialSegments*3;a=[c,d]}return{indices:o,verticesPerFace:n}=zu(s,h,r,a),{positions:s,indices:o,verticesPerFace:n}}static allocate(e,t){var _;let i,r,s,o=[],n=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,s=e.verticesPerFaceWASM):(i=mh,r=gh,s=vh);let h=i.length,a=r.length,c=s.length,d=i.length+o.length+n.length,l=r.length+s.length,u=d*Float32Array.BYTES_PER_ELEMENT+l*Uint32Array.BYTES_PER_ELEMENT,p=d*Float32Array.BYTES_PER_ELEMENT,f=le._malloc(u),g=new Float32Array(le.HEAPF32.buffer,f,d),v=new Uint32Array(le.HEAPU32.buffer,f+p,l);g.set(i,0),g.set(o,i.length),g.set(n,i.length+o.length),v.set(r,0),v.set(s,r.length);let m;(_=e==null?void 0:e.scaleBaked)!=null&&_.some(x=>x!==1)&&(m=new me().makeScale(...e.scaleBaked)),t&&(m?m.premultiply(t):m=t);let y=m?le.alloc_subdivision_surface2(f,h,f+p,a,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,m.elements):le.alloc_subdivision_surface(f,h,f+p,a,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return le._free(f),y}static buildLevel(e,t,i,r,s){let o=s?le.get_mesh_data2(e,t?le.Level.CONTROL:le.Level.REFINED,i,s.elements):le.get_mesh_data(e,t?le.Level.CONTROL:le.Level.REFINED,i),n=8,h=le.HEAPU32.subarray(o>>2,(o>>2)+n),a=h.subarray(4,4+4),c=0,d=le.HEAPU32[h[c]>>2],l=le.HEAPF32.subarray(d>>2,(d>>2)+a[c]);c++;let u=le.HEAPU32[h[c]>>2],p=le.HEAPF32.subarray(u>>2,(u>>2)+a[c]);c++;let f=le.HEAPU32[h[c]>>2],g=le.HEAPU32.subarray(f>>2,(f>>2)+a[c]);c++;let v=le.HEAPU32[h[c]>>2],m=le.HEAPU32.subarray(v>>2,(v>>2)+a[c]);if(c++,r===void 0){let y=new Oe;if(y.setIndex(new bo(m,1)),y.setAttribute("position",new ve(l,3)),y.setAttribute("normal",new ve(p,3)),t){y.setAttribute("faceMap",new bo(g,1));let _=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new ze(_,4))}return le.free_mesh_data(o),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(l),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,le.free_mesh_data(o)}static freeSubdivPointer(e){le.free_bvh(e),le.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=le.get_wireframe_data_for_base_level(e),s=4,o=le.HEAPU32.subarray(r>>2,(r>>2)+s),n=o.subarray(2,2+2),h=0,a=le.HEAPU32[o[h]>>2],c=le.HEAPF32.subarray(a>>2,(a>>2)+n[h]);h++;let d=le.HEAPU32[o[h]>>2],l=le.HEAPU32.subarray(d>>2,(d>>2)+n[h]);if(t===void 0){let u=new Oe;u.setAttribute("position",new ve(c,3));let p=new Float32Array(c.length);for(let f=0,g=c.length;f<g;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return u.setAttribute("color",new ze(p,3)),u.setIndex(new bo(l,1)),le.free_wireframe_data_for_base_level(r),u}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,le.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||le.set_destination_refinement_level(e,t);let s=i?le.get_topological_data2(e,r?le.Level.CONTROL:le.Level.REFINED,i.elements):le.get_topological_data(e,r?le.Level.CONTROL:le.Level.REFINED),o=6,n=le.HEAPU32.subarray(s>>2,(s>>2)+o),h=n.subarray(3,3+3),a=0,c=le.HEAPU32[n[a]>>2],d=new Float32Array(le.HEAPF32.subarray(c>>2,(c>>2)+h[a]));a++;let l=le.HEAPU32[n[a]>>2],u=new Uint32Array(le.HEAPU32.subarray(l>>2,(l>>2)+h[a]));a++;let p=le.HEAPU32[n[a]>>2],f=new Uint8Array(le.HEAPU32.subarray(p>>2,(p>>2)+h[a]));return le.free_topological_data(s),{positions:d,indices:u,verticesPerFace:f}}},yh=["getX","getY","getZ"];function Iu(e,t){let i={},r=t?t.count:e.count,s=0,o=[],n=[],h=1e4;for(let c=0;c<r;c++){let d=t?t.getX(c):c,l="";for(let u=0;u<3;u++)l+=`${~~(e[yh[u]](d)*h)},`;if(l in i)o.push(i[l]);else{for(let u=0;u<3;u++)n.push(e[yh[u]](d));i[l]=s,o.push(s),s++}}let a=[];for(let c=0;c<o.length;c+=3)o[c]===o[c+1]||o[c]===o[c+2]||o[c+1]===o[c+2]||a.push(o[c],o[c+1],o[c+2]);return{positions:n,triIndices:a}}var cs=new T,Go=new T,Vo=new T,Ho=new T;function zu(e,t,i,r){let s=[],o=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let n=i.userData.shape.extractShapePointsToFlatArray([]),h=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&h<=24&&h%4===0&&i.userData.parameters.angle>=360){let d=n.length/2/h;n=n.filter((l,u)=>Math.floor(u/2)%d===0)}let a=0;for(let d=0;d<n.length;d+=2)a+=(n[d]-n[(d===0?n.length:d)-2])*(n[d+1]+n[(d===0?n.length:d)-1]);e.length=0;let c=0;if(a<0)for(let d=0;d<n.length;d+=2)e.push(n[d],n[d+1],0),s.push(c++);else for(let d=n.length-2;d>=0;d-=2)e.push(n[d],n[d+1],0),s.push(c++);return o.push(c),{indices:s,verticesPerFace:o}}for(let n=0,h=i.capStartIndex??t.length;n<h;)if(t[n+1]===t[n+3]&&t[n+2]===t[n+5]||t[n+0]===t[n+3]&&t[n+2]===t[n+4]){cs.set(e[t[n]*3],e[t[n]*3+1],e[t[n]*3+2]),Go.set(e[t[n+1]*3],e[t[n+1]*3+1],e[t[n+1]*3+2]),Vo.set(e[t[n+4]*3],e[t[n+4]*3+1],e[t[n+4]*3+2]),Ho.set(e[t[n+5]*3],e[t[n+5]*3+1],e[t[n+5]*3+2]),Go.sub(cs).normalize(),Vo.sub(cs).normalize(),Ho.sub(cs).normalize();let a=Go.cross(Vo).dot(Ho);Math.abs(a)>.005||r&&r.some((c,d)=>d%2===1?!1:n>=r[d]&&n<r[d+1])?(s.push(t[n],t[n+1],t[n+2]),o.push(3),n+=3):(s.push(t[n],t[n+1],t[n+4],t[n+5]),o.push(4),n+=6)}else s.push(t[n],t[n+1],t[n+2]),o.push(3),n+=3;if(i.capStartIndex!==void 0){let n=[],h=[],a=0,c=new Float32Array([i.userData.parameters.depth])[0];for(let d=0,l=0;d<e.length;d+=3,l++)e[d+2]===0&&(n.push(l),a++),e[d+2]===c&&h.push(l);if(i.userData.parameters.extrudeBevelSize===0){let d=h[0];h[0]=h[1],h[1]=d}n.reverse(),s.push(...n,...h),o.push(a,a)}return{indices:s,verticesPerFace:o}}var ei={};Vp(ei,{calcBoolean:()=>y_,calcBooleanTopological:()=>v_,freeMeshSet:()=>w_,getMeshSet:()=>b_,transformMeshSet:()=>x_});var m_=new Promise(e=>{}),fe,Ki;m_.then(e=>fe=e);function g_(e,t,i){let r,{positions:s,triIndices:o}=Iu(e.getAttribute("position"),e.getIndex()),n;if(t&&i){let{indices:h,verticesPerFace:a}=zu(s,o,e);n=a.length,r=[];for(let c=0,d=0;c<n;c++){r.push(a[c]);for(let l=0;l<a[c];l++)r.push(h[d++])}}else{let h=o.length;r=Array(h+h/3),n=0;for(let a=0,c=0;c<r.length;)r[c++]=3,n++,r[c++]=o[a++],r[c++]=o[a++],r[c++]=o[a++]}return{positions:s,faceIndices:r,nFaces:n}}function Nu(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,s=Number.isInteger(e[0])?i:r,o=fe._malloc(s);return(Number.isInteger(e[0])?new Uint32Array(fe.HEAPU32.buffer,o,t):new Float32Array(fe.HEAPF32.buffer,o,t)).set(e,0),o}function Bu(e){switch(e){case 0:return fe.OP.UNION;case 1:return fe.OP.INTERSECTION;case 2:return fe.OP.A_MINUS_B;case 3:return fe.OP.B_MINUS_A;case 4:return fe.OP.SYMMETRIC_DIFFERENCE;case 5:return fe.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function v_(e,t){Ki===void 0&&(Ki=fe.init_csg());let i=Nu(e),r=fe.csg_calc_topological(Ki,i,e.length,Bu(t));fe._free(i);let s=6,o=fe.HEAPU32.subarray(r>>2,(r>>2)+s),n=o.subarray(3,3+3),h=0,a=fe.HEAPU32[o[h]>>2],c=new Float32Array(fe.HEAPF32.subarray(a>>2,(a>>2)+n[h]));h++;let d=fe.HEAPU32[o[h]>>2],l=new Uint32Array(fe.HEAPU32.subarray(d>>2,(d>>2)+n[h]));h++;let u=fe.HEAPU32[o[h]>>2],p=new Uint8Array(fe.HEAPU32.subarray(u>>2,(u>>2)+n[h]));return fe.free_mesh_data(r),{positions:c,indices:l,verticesPerFace:p}}function y_(e,t,i,r){Ki===void 0&&(Ki=fe.init_csg());let s=Nu(e),o=fe.csg_calc(Ki,s,e.length,r,Bu(t));fe._free(s);let n=5,h=fe.HEAPU32.subarray(o>>2,(o>>2)+n),a=h.subarray(2,2+3),c=0,d=fe.HEAPU32[h[c]>>2],l=fe.HEAPF32.subarray(d>>2,(d>>2)+a[c]);c++;let u=fe.HEAPU32[h[c]>>2],p=fe.HEAPF32.subarray(u>>2,(u>>2)+a[c]);c++;let f=a[c];i.setAttribute("position",new ve(l,3)),i.setAttribute("normal",new ve(p,3));let g=fe.HEAPF32.subarray((o>>2)+5,(o>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Ji),i.boundingSphere.center.set(g[0],g[1],g[2]),i.boundingSphere.radius=(g[3]**2+g[4]**2+g[5]**2)**.5,i.userData.parameters={width:g[3]*2,height:g[4]*2,depth:g[5]*2},fe.free_mesh_data(o),f}function b_(e,t,i){if(fe===void 0)return-1;let r,s,o;if(t&&e.userData.positions!==void 0){let g=e.userData;o=g.verticesPerFace.length,r=g.positions,s=Array(g.verticesPerFace.reduce((v,m)=>v+m,0)+o);for(let v=0,m=0,y=0;v<g.verticesPerFace.length;v++){s[y++]=g.verticesPerFace[v];for(let _=0;_<g.verticesPerFace[v];_++)s[y++]=g.indices[m++]}}else({positions:r,faceIndices:s,nFaces:o}=g_(e,t,i));let n=r.length,h=s.length,a=r.length,c=s.length,d=a*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,l=a*Float32Array.BYTES_PER_ELEMENT,u=fe._malloc(d),p=new Float32Array(fe.HEAPF32.buffer,u,a),f=new Uint32Array(fe.HEAPU32.buffer,u+l,c);return p.set(r,0),f.set(s,0),fe.get_csg_mesh(u,n,u+l,h,o)}function x_(e,t){fe.transform_csg_mesh(e,t.elements)}function w_(e){fe.free_csg_mesh(e)}var __={ConeGeometry:rw,CubeGeometry:sw,CylinderGeometry:iw,DodecahedronGeometry:nw,EllipseGeometry:Sa,HelixGeometry:jw,IcosahedronGeometry:Uw,LatheGeometry:Rw,NonParametricGeometry:qw,PolygonGeometry:Pu,PyramidGeometry:$w,RectangleGeometry:Tu,SphereGeometry:Kw,PlaneGeometry:Zw,BackdropGeometry:Qw,StarGeometry:Eu,TextFrameGeometry:e_,TorusGeometry:t_,TorusKnotGeometry:r_,TriangleGeometry:s_,PathGeometry:a_,VectorGeometry:Ni},bh=e=>__[e.type].create(e);function Cr(e){return e!==null&&"booleanOp"in e}var ju=class extends cu(nc){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new me}updateVisible(){super.updateVisible(),this.visible=!Cr(this.parent)&&this.visible,Cr(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(ei.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Cr(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof ju&&(e.freeBooleanPointer(),Cr(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e){let t=super.updateTransformState(e);return t&&Cr(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}},us=new Di;function Ca(e,t=0,i=e.count,r,s){let o=1/0,n=1/0,h=1/0,a=-1/0,c=-1/0,d=-1/0;for(let l=t;l<i;l++){let u=e.getX(l),p=e.getY(l),f=e.getZ(l);u<o&&(o=u),p<n&&(n=p),f<h&&(h=f),u>a&&(a=u),p>c&&(c=p),f>d&&(d=f)}us.min.set(o,n,h),us.max.set(a,c,d),us.getCenter(r),us.getSize(s).multiplyScalar(.5)}var S_=new Oe,A_=new Jh,ui=class extends ju{constructor(e,t){super(S_,A_),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?Ca(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},xh=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},fi=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=Ne.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,s,o){return""}generate(e,t,i,r,s){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}getHash(){let e="{",t,i;for(t in this)i=this[t],i instanceof fi&&(e+='"'+t+'":'+i.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)t=this.hashProperties[r],i=this[t],e+='"'+t+'":"'+String(i)+'",';return e+='"id":"'+this.uuid+'"}',e}},O_=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},tt=new O_,Te=class extends fi{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let s=this.getUnique(e,t);s&&this.uuid===void 0&&(this.uuid=Ne.generateUUID()),i=e.getUUID(i??this.getUUID(),!s);let o=e.getNodeData(i),n=o.output||this.getType(e);if(e.analyzing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,i)):super.build(e,t,i);if(s)return o.name=o.name||super.build(e,t,i),o.name;if(!this.getLabel()&&(!this.getShared(e,n)||e.context.ignoreCache||o.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let h=this.getTemp(e,i);if(h)return e.format(h,n,t);{h=super.generate(e,t,i,o.output,r);let a=this.generate(e,n,i);return e.addNodeCode(h+" = "+a+";"),e.format(h,n,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,s){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),s,this.getLabel()).name}},lt=class extends Te{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,s,o){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let n=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,s,o):e.isShader("vertex")?(n.vertex||(n.vertex=e.createVertexUniform(r,this,s,o,this.getLabel())),e.format(n.vertex.name,r,t)):(n.fragment||(n.fragment=e.createFragmentUniform(r,this,s,o,this.getLabel())),e.format(n.fragment.name,r,t))}},dt=class extends lt{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof X?e:new X(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,s,o){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},ct=class extends lt{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof T?e:new T(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,s,o){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},Ot=class extends rt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a=s==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a=s==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},_i=class extends lt{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Ot?e:new Ot(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,s,o){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},C_=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,wh=/[a-z_0-9]+/gi,ne=class extends Te{constructor(e,t,i,r,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=s===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,s){let o,n=0,h=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let a=[];for(;o=wh.exec(this.src);)a.push(o);for(let c=0;c<a.length;c++){let d=a[c],l=d[0],u=this.isMethod?!this.getInputByName(l):!0,p=l;if(this.keywords[l]||this.useKeywords&&u&&tt.containsKeyword(l)){let f=this.keywords[l];if(!f){let g=tt.getKeywordData(l);g.cache&&(f=e.keywords[l]),f=f||tt.getKeyword(l,e),g.cache&&(e.keywords[l]=f)}p=f.build(e)}l!==p&&h[d.index+n-1]!=="."&&(h=h.substring(0,d.index+n)+p+h.substring(d.index+l.length+n),n+=p.length-l.length),this.getIncludeByName(p)===void 0&&tt.contains(p)&&e.include(tt.get(p))}return t==="source"?h:this.isMethod?(this.isInterface||e.include(this,void 0,h),this.name):e.format("( "+h+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let s=C_.exec(this.src);if(this.inputs=[],s&&s.length==4){this.type=s[1],this.name=s[2];let o=s[3].match(wh);if(o){let n=0;for(;n<o.length;){let h=o[n++],a;h==="in"||h==="out"||h==="inout"?a=o[n++]:(a=h,h="");let c=o[n++];this.inputs.push({name:c,type:a,qualifier:h})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},P_=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Uu=class extends Te{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||Uu.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,s){this.src=e||"";let o,n,h="",a=P_.exec(e);this.useDefine=s??this.src.charAt(0)==="#",a&&a.length>1?(n=a[1],o=a[2],h=a[3]):(o=this.src,n="f"),this.name=o,this.type=n,this.value=h}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,s){return e.format(this.name,this.getType(e),t)}},_e=Uu;_e.PI="PI",_e.PI2="PI2",_e.RECIPROCAL_PI="RECIPROCAL_PI",_e.RECIPROCAL_PI2="RECIPROCAL_PI2",_e.LOG2="LOG2",_e.EPSILON="EPSILON";var T_=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),E_=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Ru=class extends Te{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,s){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=T_.exec(e);if(t){let i=t[2],r;for(;r=E_.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},Pa=class extends Te{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};tt.addKeyword("uv",function(){return new Pa});tt.addKeyword("uv2",function(){return new Pa(1)});var ki=class extends Te{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??ki.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case rn:return["Linear"];case rc:return["sRGB"];default:return[]}}generate(e,t){var n;let i=this.input.build(e,"v4"),r=this.getType(e),s=ki.Nodes[this.method],o=e.include(s);if(o===ki.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((n=s.inputs)==null?void 0:n.length)===2){let h=this.factor.build(e,"f");return e.format(o+"( "+i+", "+h+" )",r,t)}else return e.format(o+"( "+i+" )",r,t)}fromEncoding(e){let t=ki.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=ki.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Bt=ki;Bt.Nodes={LinearToLinear:new ne(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new ne(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new ne(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Bt.LINEAR_TO_LINEAR="LinearToLinear",Bt.SRGB_TO_LINEAR="sRGBToLinear",Bt.LINEAR_TO_SRGB="LinearTosRGB";var Ie=class extends ne{constructor(e="",t,i,r,s){super(e,s,r,i,t),this.nodeType="Expression"}},ai=class extends lt{constructor(e=new tc,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new Pa,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"f"):void 0;s===void 0&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f"));let o,n;this.project?o="texture2DProj":o=s?"tex2DBias":"tex2D",s?n=o+"( "+i+", "+r+", "+s+" )":n=o+"( "+i+", "+r+" )";let h={include:e.isShader("vertex"),ignoreCache:!0},a=this.getType(e);return e.addContext(h),this.colorSpace=this.colorSpace??new Bt(new Ie("",a)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,a),e.removeContext(),e.format(n,a,t)}},se=class extends lt{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,s,o){return e.format(this.value+(this.value%1?"":".0"),r,t)}},_h=class extends Te{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,s){r=this.getType(e);let o=this.value,n=o.build(e,t)+"( ",h=[];if(o.inputs){for(let a=0;a<o.inputs.length;a++){let c=o.inputs[a],d=this.inputs[a]||this.inputs[c.name];h.push(d.build(e,e.getTypeByFormat(c.type)))}n+=h.join(", ")+" )"}return e.format(n,r,t)}},ku=class extends Te{constructor(e,t,i=ku.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),s=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+s+" )",i,t)}},jt=ku;jt.ADD="+",jt.SUB="-",jt.MUL="*",jt.DIV="/";var we=class extends Te{constructor(e,t=we.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case we.MIX:case we.CLAMP:case we.REFRACT:case we.SMOOTHSTEP:case we.FACEFORWARD:return 3;case we.MIN:case we.MAX:case we.MOD:case we.STEP:case we.REFLECT:case we.DISTANCE:case we.DOT:case we.CROSS:case we.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case we.LENGTH:case we.DISTANCE:case we.DOT:return"f";case we.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,s,o=this.a?e.getTypeLength(this.a.getType(e)):0,n=this.b?e.getTypeLength(this.b.getType(e)):0,h=this.c?e.getTypeLength(this.c.getType(e)):0,a=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case we.NEGATE:return e.format("( -"+this.a.build(e,a)+" )",a,t);case we.INVERT:return e.format("( 1.0 - "+this.a.build(e,a)+" )",a,t);case we.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case we.STEP:i=this.a.build(e,o===1?"f":a),r=this.b.build(e,a);break;case we.MIN:case we.MAX:case we.MOD:i=this.a.build(e,a),r=this.b.build(e,n===1?"f":a);break;case we.REFRACT:i=this.a.build(e,a),r=this.b.build(e,a),s=this.c.build(e,"f");break;case we.MIX:i=this.a.build(e,a),r=this.b.build(e,a),s=this.c.build(e,h===1?"f":a);break;default:i=this.a.build(e,a),this.b&&(r=this.b.build(e,a)),this.c&&(s=this.c.build(e,a));break}let d=[];d.push(i),r&&d.push(r),s&&d.push(s);let l=this.getNumInputs(e);if(d.length!==l)throw Error(`Arguments not match used in "${this.method}". Require ${l}, currently ${d.length}.`);return e.format(this.method+"( "+d.join(", ")+" )",c,t)}},ue=we;ue.RAD="radians",ue.DEG="degrees",ue.EXP="exp",ue.EXP2="exp2",ue.LOG="log",ue.LOG2="log2",ue.SQRT="sqrt",ue.INV_SQRT="inversesqrt",ue.FLOOR="floor",ue.CEIL="ceil",ue.NORMALIZE="normalize",ue.FRACT="fract",ue.SATURATE="saturate",ue.SIN="sin",ue.COS="cos",ue.TAN="tan",ue.ASIN="asin",ue.ACOS="acos",ue.ARCTAN="atan",ue.ABS="abs",ue.SIGN="sign",ue.LENGTH="length",ue.NEGATE="negate",ue.INVERT="invert",ue.MIN="min",ue.MAX="max",ue.MOD="mod",ue.STEP="step",ue.REFLECT="reflect",ue.DISTANCE="distance",ue.DOT="dot",ue.CROSS="cross",ue.POW="pow",ue.MIX="mix",ue.CLAMP="clamp",ue.REFRACT="refract",ue.SMOOTHSTEP="smoothstep",ue.FACEFORWARD="faceforward";var zr=class extends Te{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let s=new _h(zr.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Bt(new Ie("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(s.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Bt(new Ie("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(s.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Bt(new Ie("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(s.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Bt(new Ie("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(s.build(e)+".br");let o={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(o),this.colorSpaceTLExp=new Ie(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Ie(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Ie(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Ie(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let n=new Ie("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return n.keywords.cubeUV_TL=this.colorSpaceTLExp,n.keywords.cubeUV_TR=this.colorSpaceTRExp,n.keywords.cubeUV_BL=this.colorSpaceBLExp,n.keywords.cubeUV_BR=this.colorSpaceBRExp,n.keywords.cubeUV=s,n}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,s=new _h(zr.Nodes.roughnessToMip,[r]),o=new ue(s,zr.Nodes.m0,zr.Nodes.cubeUV_maxMipLevel,ue.CLAMP),n=new ue(o,ue.FLOOR),h=new ue(o,ue.FRACT),a=this.bilinearCubeUV(e,this.value,i,n),c=this.bilinearCubeUV(e,this.value,i,new jt(n,new se(1).setReadonly(!0),jt.ADD)),d=new ue(a,c,h,ue.MIX);return e.format(d.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},Nn=zr;Nn.Nodes=function(){let e=new Ru(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new _e("float cubeUV_maxMipLevel 8.0",!0),i=new _e("float cubeUV_minMipLevel 4.0",!0),r=new _e("float cubeUV_maxTileSize 256.0",!0),s=new _e("float cubeUV_minTileSize 16.0",!0),o=new ne(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);o.useKeywords=!1;let n=new ne(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);n.useKeywords=!1;let h=new ne(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,o,n,t,i,r,s]);h.useKeywords=!1;let a=new _e("float r0 1.0",!0),c=new _e("float v0 0.339",!0),d=new _e("float m0 -2.0",!0),l=new _e("float r1 0.8",!0),u=new _e("float v1 0.276",!0),p=new _e("float m1 -1.0",!0),f=new _e("float r4 0.4",!0),g=new _e("float v4 0.046",!0),v=new _e("float m4 2.0",!0),m=new _e("float r5 0.305",!0),y=new _e("float v5 0.016",!0),_=new _e("float m5 3.0",!0),x=new _e("float r6 0.21",!0),S=new _e("float v6 0.0038",!0),b=new _e("float m6 4.0",!0),A=[a,c,d,l,u,p,f,g,v,m,y,_,x,S,b],O=new ne(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:h,roughnessToMip:O,m0:d,cubeUV_maxMipLevel:t}}();var Fi=class extends Te{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Fi.VIEW}getShared(){return this.scope===Fi.WORLD}build(e,t,i,r){let s=e.context[this.scope+"Normal"];return s?s.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,s){let o;switch(this.scope){case Fi.VIEW:e.isShader("vertex")?o="transformedNormal":o="geometryNormal";break;case Fi.LOCAL:e.isShader("vertex")?o="objectNormal":(e.requires.normal=!0,o="vObjectNormal");break;case Fi.WORLD:e.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,o="vWNormal");break}return e.format(o,this.getType(e),t)}},it=Fi;it.LOCAL="local",it.WORLD="world",it.VIEW="view",it.NORMAL="normal";tt.addKeyword("viewNormal",function(){return new it(it.VIEW)});tt.addKeyword("localNormal",function(){return new it(it.NORMAL)});tt.addKeyword("worldNormal",function(){return new it(it.WORLD)});var Wt=class extends Te{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Wt.LOCAL}getType(){switch(this.scope){case Wt.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Wt.LOCAL:case Wt.WORLD:return!1}return!0}generate(e,t,i,r,s){let o;switch(this.scope){case Wt.LOCAL:e.isShader("vertex")?o="transformed":(e.requires.position=!0,o="vPosition");break;case Wt.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,o="vWPosition";break;case Wt.VIEW:o=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Wt.PROJECTION:o=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(o,this.getType(),t)}},St=Wt;St.LOCAL="local",St.WORLD="world",St.VIEW="view",St.PROJECTION="projection";tt.addKeyword("position",function(){return new St});tt.addKeyword("worldPosition",function(){return new St(St.WORLD)});tt.addKeyword("viewPosition",function(){return new St(St.VIEW)});var zt=class extends Te{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??zt.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case zt.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case zt.VECTOR:{let s=new it(it.VIEW),o=e.context.roughness,n=s.build(e,"v3"),h=new St(St.VIEW).build(e,"v3"),a=o?o.build(e,"f"):void 0,c=`reflect( -normalize( ${h} ), ${n} )`;a&&(c=`normalize( mix( ${c}, ${n}, ${a} * ${a} ) )`);let d=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${d};`),r="reflectVec"):r=d;break}case zt.CUBE:{let s=new zt(zt.VECTOR).build(e,"v3"),o="vec3( -"+s+".x, "+s+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${o};`),r="reflectCubeVec"):r=o;break}case zt.SPHERE:{let s="normalize( ( viewMatrix * vec4( "+new zt(zt.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${s};`),r="reflectSphereVec"):r=s;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Zi=zt;Zi.CUBE="cube",Zi.SPHERE="sphere",Zi.VECTOR="vector";var M_=class extends Te{constructor(e=new ai,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new Nn(this.value,t??new Zi(Zi.VECTOR),i),this.irradianceNode=new Nn(this.value,new it(it.WORLD),new se(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},D_=class extends lt{constructor(e=new ap,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Zi,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var a;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(a=this.uv)==null?void 0:a.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;s===void 0&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f"));let o;s?o="texCubeBias( "+i+", "+r+", "+s+" )":o="texCube( "+i+", "+r+" )";let n={include:e.isShader("vertex"),ignoreCache:!0},h=this.getType(e);return e.addContext(n),this.colorSpace=this.colorSpace??new Bt(new Ie("",h)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(e,h),e.removeContext(),e.format(o,h,t)}},Sh=["x","y","z","w"],L_=["float","vec2","vec3","vec4"],I_={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},z_={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},N_=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let s="";r=r.sort(e);for(let o=0;o<r.length;o++)r[o].src&&(s+=r[o].src+`
`);return s}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",s="V",o=""){let n=this.getVars(r),h=n[e];if(!h){let a=n.length;h={name:i||"node"+s+a+(o?"_"+o:""),type:t},n.push(h),n[e]=h}return h}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,s=e.length;r<s;++r){let o=e[r],n=o.type,h=o.name,a=o.size,c=this.getFormatByType(n);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+h+`[${a}];
`:i+=t+" "+c+" "+h+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof fi?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,s,o){if(t.includes("[]")){let n=this.inputs.arrayUniforms,h=n.list.length,a=new xh({type:t,size:i.size,name:r||"nodeUA"+h+(o?"_"+o:""),node:i,needsUpdate:s});return n.list.push(a),n[e].push(a),n[e][a.name]=a,this.uniforms[a.name]=a,a}else{let n=this.inputs.uniforms,h=n.list.length,a=new xh({type:t,name:r||"nodeU"+h+(o?"_"+o:""),node:i,needsUpdate:s});return n.list.push(a),n[e].push(a),n[e][a.name]=a,this.uniforms[a.name]=a,a}}createVertexUniform(e,t,i,r,s){return this.createUniform("vertex",e,t,i,r,s)}createFragmentUniform(e,t,i,r,s){return this.createUniform("fragment",e,t,i,r,s)}include(e,t,i){var o;let r;if(e=typeof e=="string"?tt.get(e):e,this.context.include===!1)return e.name;e instanceof ne?r=this.includes.functions:e instanceof _e?r=this.includes.consts:e instanceof Ru&&(r=this.includes.structs);let s=r[this.shader]=r[this.shader]||[];if(e){let n=s[e.name];if(n||(n=s[e.name]={node:e,deps:[]},s.push(n),n.src=e.build(this,"source")),e instanceof ne&&t&&s[t.name]&&s[t.name].deps.indexOf(e)===-1&&(s[t.name].deps.push(e),(o=e.includes)==null?void 0:o.length)){let h=0;do this.include(e.includes[h++],t);while(h<e.includes.length)}return i&&(n.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return L_[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Zd:case Kd:return new D_(i);case Yd:return new M_(new ai(i));default:return new ai(i)}else{if(i.isVector2)return new dt(i);if(i.isVector3)return new ct(i);if(i.isVector4)return new _i(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return I_[e]||e}getFormatByType(e){return z_[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Sh[e]}getIndexByElement(e){return Sh.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=rn,t===rn&&this.context.gamma&&(t=rc),t}},Ue=class extends lt{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Ot?e:new Ot(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,s,o){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let n=e.getNodeData(i),h=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let a=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${a};`)}return h?this.generateReadonly(e,t,i,r,s,o):e.isShader("vertex")?(n.vertex||(n.vertex=e.createVertexUniform(r,this,s,o,this.getLabel())),e.format(n.vertex.name,r,t)):(n.fragment||(n.fragment=e.createFragmentUniform(r,this,s,o,this.getLabel())),e.format(n.fragment.name,r,t))}generateReadonly(e,t,i,r,s,o){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},Ae=class extends lt{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,s,o){return e.format(this.value.toString(),r,t)}},Fu=class extends fi{constructor(){super("basic"),this.nodeType="Basic",this.color=new Ue(5526619),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(qr.merge([Ut.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new Ue(5526619)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let o=["#include <normal_fragment_begin>",i.code];r&&o.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?o.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):o.push(`vec3 finalColor = ${i.result};`),r?o.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} );`):o.push("gl_FragColor = vec4("+i.result+", 1.0 );"),o.push("#include <fog_fragment>","#include <dithering_fragment>"),t=o.join(`
`)}return t}},yi=class extends lt{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},pt={normalRenderTarget:new ai,normalRenderTargetDepth:new ai,transmissionRenderTarget:new ai,transmissionSize:new dt(2048,2048),transmissionRenderTargetDepth:new ai,pixelRatioNode:new se(1),resolution:new dt,penumbraSize:new yi(5,.5)};for(let e of Object.values(pt))e.isRenderGlobal=!0;var B_=class extends fi{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Ue(5526619),this.emissive=new Ue(0),this.emissiveIntensity=new se(1),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(qr.merge([Ut.fog,Ut.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize}),this.color===void 0&&(this.color=new Ue(5526619)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),s=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),o=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,a=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=a!==void 0,e.addParsCode(["uniform float penumbraSize[5];","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];c.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),a&&c.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),c.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&c.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+s.result+";"),c.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;"),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result}, ${n.result} );
				}
				`),h&&c.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),a?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${a.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},j_=class extends fi{constructor(){super("phong"),this.nodeType="Phong",this.color=new Ue(5526619),this.specular=new Ue(1118481),this.shininess=new se(30),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(qr.merge([Ut.fog,Ut.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize}),this.color===void 0&&(this.color=new Ue(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,a=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=a!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),a&&c.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;"),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result}, ${n.result} );
				}
				`),h&&c.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),a?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${a.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},U_=class extends fi{constructor(){super("standard"),this.nodeType="Standard",this.color=new Ue(5526619),this.roughness=new se(.3),this.metalness=new se(0),this.reflectivity=new se(.5),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(qr.merge([Ut.fog,Ut.lights])),Ut.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize});let i={gamma:!0};this.color===void 0&&(this.color=new Ue(5526619)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),o=this.metalness.flow(e,"f"),n=this.shadingAlpha.flow(e,"f"),h=this.shadingBlend.flow(e,"i"),a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let l=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];l.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",s.code,"	float roughnessFactor = "+s.result+";",o.code,"	float metalnessFactor = "+o.result+";"),c&&l.push(c.code,"#ifdef ALPHATEST","	if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),l.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),l.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?l.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):l.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),l.push("#include <lights_fragment_begin>"),l.push("#include <lights_fragment_end>"),l.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),l.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result}, ${h.result} );
				}
				`),a&&l.push(a.code,`outgoingLight = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`),c?l.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):l.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),l.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=l.join(`
`)}return t}},R_=class extends fi{constructor(){super("toon"),this.nodeType="Toon",this.color=new Ue(5526619),this.specular=new Ue(1118481),this.shininess=new se(30),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(qr.merge([Ut.fog,Ut.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize}),this.color===void 0&&(this.color=new Ue(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,a=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=a!==void 0,e.addParsCode(["uniform float penumbraSize[5];","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),a&&c.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result}, ${n.result} );
				}
				`),h&&c.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),a?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${a.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},Pr=class extends lt{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Gu=class extends lt{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Cs}generateReadonly(e,t,i,r,s,o){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},bi=class extends lt{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Je?new Array(e).fill(t):new Array(e).fill(new Je(0))}},Ta=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e))(Ta||{}),vt=function(){let e=new ne(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new ne(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new _e("float F3 0.3333333"),t.keywords.G3=new _e("float G3 0.1666667");let i=new ne(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new ne("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new ne("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),o=new ne(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,s]),n=new ne("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),h=new ne("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[n]),a=new ne(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[h]),c=new ne(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[a]);c.keywords.NUM_OCTAVES=new _e("int NUM_OCTAVES 5");let d=new ne("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),l=new ne(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,s,d]);return{simplex:t,simplexFractal:i,simplexAshima:o,fbm:c,perlin:l}}(),Vu=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c,d,l){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=s,this.distortion=o,this.colorA=n,this.colorB=h,this.colorC=a,this.colorD=c,this.alpha=d,this.noiseType=l,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,s){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let o=Object.values(Ta)[this.noiseType.value],n=new ne(`vec3 ${o}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, float alpha, out float calpha) {
                vec3 st = position / size;
				st /= scale;
				vec3 q = vec3(${o}(st),
							  ${o}(st + vec3(1.0)),
							  ${o}(st + vec3(1.0)));
				vec3 r = vec3(${o}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
							  ${o}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
							  ${o}(st * q));
				float f = ${o}(st + r);
				vec4 color;
				color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
				color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
				color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));

                float lalpha = alpha * color.a;
                calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			    accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return clamp(color, 0.0, 1.0).rgb;
			}`,[vt.simplex,vt.simplexFractal,vt.simplexAshima,vt.fbm,vt.perlin]),h=e.include(n),a=[];return a.push(this.scale.build(e,"f")),a.push(this.size.build(e,"v3")),a.push(this.move.build(e,"f")),a.push(this.fA.build(e,"v2")),a.push(this.fB.build(e,"v2")),a.push(this.distortion.build(e,"v2")),a.push(this.colorA.build(e,"v4")),a.push(this.colorB.build(e,"v4")),a.push(this.colorC.build(e,"v4")),a.push(this.colorD.build(e,"v4")),a.push(this.alpha.build(e,"f")),a.push(this.calpha),e.format(h+"("+a.join(",")+")",this.getType(e),t)}};Vu.numOctaves=5;var Hu=class extends Te{constructor(e,t,i,r,s,o,n){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=s,this.alpha=o,this.mode=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(Hu.Nodes.fresnel),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Wu=Hu;Wu.Nodes=function(){return{fresnel:new ne(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, float alpha, int mode, out float calpha) {
				float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

				float lalpha = clamp( fresnel, 0.0, 1.0 ) * alpha;
				calpha = lalpha / clamp(lalpha + accumAlpha, 0.001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;
				return color;
			}`)}}();var qu=class extends Te{constructor(e,t,i,r,s,o,n){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=s,this.offset=o,this.alpha=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(qu.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},$u=qu;$u.Nodes=function(){let e=new ne(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[vt.simplex]);return{rainbow:new ne(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, float alpha, out float calpha) {
                 vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

                 float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);
                 float lalpha = alpha * rainbowContribution;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

                 return res;
             }`,[e])}}();var Xu=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c,d,l,u,p,f,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=s,this.outlineThreshold=o,this.contourFrequency=n,this.outlineSmoothing=h,this.contourDirection=a,this.positionalLines=c,this.compensation=d,this.resolution=l,this.normalMap=u,this.depthMap=p,this.pixelRatio=f,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.firstTime){let i=this.outlineWidth.build(e,"f"),r=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(i,"uniform float"),e.addVertexParsVariable(r,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float");let n=`g${this.uuid.toString().replace(/-/g,"")}`;e.addVertexFinalCode(`
                vID = randomColor.r;
                if (${s}) {
                    vec4 ${n}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${n}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    vec2 ${n}_offset = normalize(${n}_clipNormal.xy) / ${r} * (${i} / 2.0) * ${n}_clipPosition.w * 2.0 * ${o};
                    ${n}_clipPosition.xy += ${n}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${n}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Xu.Nodes.outline),r=[];return r.push(this.outlineColor.build(e,"c")),r.push(this.contourColor.build(e,"c")),r.push(this.outlineWidth.build(e,"f")),r.push(this.contourWidth.build(e,"f")),r.push(this.contourThreshold.build(e,"f")),r.push(this.outlineThreshold.build(e,"f")),r.push(this.contourFrequency.build(e,"f")),r.push(this.outlineSmoothing.build(e,"f")),r.push(this.contourDirection.build(e,"v3")),r.push(this.positionalLines.build(e,"b")),r.push(this.resolution.build(e,"v2")),r.push(this.normalMap.getTexture(e,"t")),r.push(this.depthMap.getTexture(e,"t")),r.push(this.pixelRatio.build(e,"f")),r.push(this.compensation.build(e,"b")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),this.firstTime=!this.firstTime,e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},Yu=Xu;Yu.Nodes=function(){let e=new ne(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 texelSize = (vec2(1.0) / resolution) * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -texelSize.x, -texelSize.y);
	uvSamples[1] = uv + vec2(0.0, -texelSize.y);
	uvSamples[2] = uv + vec2(  texelSize.x, -texelSize.y);
	uvSamples[3] = uv + vec2( -texelSize.x, 0.0);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  texelSize.x, 0.0);
	uvSamples[6] = uv + vec2( -texelSize.x, texelSize.y);
	uvSamples[7] = uv + vec2(0.0, texelSize.y);
	uvSamples[8] = uv + vec2(  texelSize.x, texelSize.y);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec4 sobel_edge_h = normalSamples[2] + (2.0*normalSamples[5]) + normalSamples[8] - (normalSamples[0] + (2.0*normalSamples[3]) + normalSamples[6]);
  	vec4 sobel_edge_v = normalSamples[0] + (2.0*normalSamples[1]) + normalSamples[2] - (normalSamples[6] + (2.0*normalSamples[7]) + normalSamples[8]);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new ne(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return result;
             }`,[e])}}();var Ku=class extends Te{constructor(e,t,i,r,s,o,n,h){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=s,this.transmissionDepthMap=o,this.aspectRatio=n,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",30),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(Ku.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Zu=Ku;Zu.Nodes=function(){let e=new ne(`
            float gaussian(vec2 i) {
                const float sigma = float(NUM_SAMPLES) * .25;
                return exp( -.5* dot(i/=sigma,i) ) / ( 6.28 * sigma*sigma );
            }`),t=new ne(`
            vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

                const int LOD = 2;
                const int sLOD = 4; // tile size = 2^LOD

                vec3 O = vec3(0);
                float a = 0.0;
                const int s = NUM_SAMPLES/sLOD;
                for ( int i = 0; i < s*s; i++ ) {
                    int modulo = (i)-((i)/(s))*(s);
                    vec2 d = vec2(float(modulo), float(i/s))*float(sLOD) - float(NUM_SAMPLES)/2.;
                    vec2 uv = U + (scale * aspectRatio) * d;
                    // What is the depth of the opaque object we're trying to sample
                    float opaqueDepth = unpackRGBAToDepth(texture2D(dm, uv));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU + ((scale * min(lod / 2., 1.)) * aspectRatio) * d;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    float gaussian = gaussian(d);
		            #ifdef TEXTURE_LOD_EXT
                    O += gaussian * texture2DLodEXT( sp, uv, lod).rgb;
                    #else
                    O += gaussian * textureLod( sp, uv, lod).rgb;
                    #endif
                    a += gaussian;
                }
                return O / a;
            }`,[e]),i=new ne(`
            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        // Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		        // The thickness is specified in local space.
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),r=new ne(`
float applyIorToRoughness( float roughness, float ior ) {
		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	} `),s=new ne(`
vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
        float lod = applyIorToRoughness(roughness, ior);

        return blur(transmissionSamplerMap, fragCoord, vec2(lod / (transmissionSamplerSize.x / 2.)), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
	}`,[r,t]),o=new ne(`
vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
        vec3 refractedRayExit = position + transmissionRay;

        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
        vec2 refractionCoords = ndcPos.xy / ndcPos.w;
        refractionCoords += 1.0;
        refractionCoords /= 2.0;

        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
        unrefractedCoords += 1.0;
        unrefractedCoords /= 2.0;

        // Sample framebuffer to get pixel the refracted ray hits.
        return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    }`,[s,i]);return{transmission:new ne(`
            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                float lalpha = alpha;

                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return transmission;
            }`,[o])}}();var Nr=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c,d){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=s,this.isWorldSpace=o,this.origin=n,this.direction=h,this.colors=a,this.steps=c,this.alpha=d,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new ne(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a;
               calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			   accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
               return color.rgb;
			}`,[Nr.Nodes.vectorLinearWorldSpaceDepth,Nr.Nodes.vectorLinearObjectSpaceDepth,Nr.Nodes.vectorSphericalObjectSpaceDepth,Nr.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let s=e.include(r),o=[];return o.push(this.near.build(e,"f")),o.push(this.far.build(e,"f")),o.push(this.origin.build(e,"v3")),o.push(this.direction.build(e,"v3")),o.push(this.colors.build(e,"v4[]")),o.push(this.steps.build(e,"f[]")),o.push(this.alpha.build(e,"f")),o.push(this.calpha),e.format(s+"("+o.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Qu=Nr;Qu.Nodes=function(){let e=new ne(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new ne(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new ne(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new ne(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var Ah=class extends Te{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Bn=(e=>(e.NOISE="noise",e.MAP="map",e))(Bn||{}),Ju=class extends Te{constructor(e,t,i,r,s){super("v3"),this.displacementTypeIndex=new Ae(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(Bn)[this.displacementTypeIndex.value]==="map"&&(this.mat=new Gu(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=r,this.noiseFunctionIndex=s}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(Bn)[this.displacementTypeIndex.value]){case"map":{i=e.include(Ju.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let s=Object.values(Ta)[this.noiseFunctionIndex.value],o=new ne(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),n=new ne(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement) {
							return p + n * ${s}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
						}`,[vt.simplex,vt.simplexFractal,vt.simplexAshima,vt.fbm,vt.perlin]),h=new ne(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[n,o]);i=e.include(h),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ed=Ju;ed.Nodes=function(){let e=new ne(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new ne(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new ne(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var td=class extends Te{constructor(e,t,i,r,s,o,n,h){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=s,this.morph=o,this.angle=n,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(td.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},id=td;id.Nodes=function(){return{gradient:new ne(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return color.xyz;
			}`)}}();var Os=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c){super("v3"),this.nodeType="CustomTexture",this.firstTime=!0,this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=s,this.side=o,this.size=n,this.mat=h,this.alpha=a,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(Os.Nodes.cylindrical);break;case 2:r=e.include(Os.Nodes.spherical);break;case 1:let o=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],n=new ne(`
		vec3 ${i}_planarTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( (${i}_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${o}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);r=e.include(n);break;default:r=e.include(Os.Nodes.uv);break}if(this.projection.value===1&&this.firstTime){e.addVertexParsCode(`varying vec2 ${i}_vCustomUv;`),e.addFragmentParsCode(`varying vec2 ${i}_vCustomUv;`);let o=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode(`${i}_vCustomUv = (1. + (transformed.${o})) / 2.;`)}e.addFragmentVariable(this.calpha,"float");let s=[];return s.push(this.texture.generate(e,"t")),s.push(this.textureSize.build(e,"v2")),s.push(this.crop.build(e,"f")),s.push(this.mat.build(e,"mat3")),s.push(this.size.build(e,"v2")),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+s.join(",")+")",this.getType(e),t)}},rd=Os;rd.Nodes=function(){let e=new ne(`
vec3 cylindricalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),t=new ne(`
vec3 sphericalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),i=new ne(`vec3 uvTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);return{cylindrical:e,spherical:t,uv:i}}();var sd=class extends Te{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t}generate(e,t){if(e.isShader("fragment")){let i=e.include(sd.Nodes.customNormal),r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.alpha.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},od=sd;od.Nodes=function(){return{customNormal:new ne(`vec3 customNormal(vec3 cnormal, vec3 norm, float alpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return normal;
			}`)}}();function at(e,t){return t.color(e)}function k_(e,t){switch(e.type){case"fresnel":return V_(e,t);case"gradient":return H_(e);case"depth":return W_(e);case"normal":return q_(e);case"noise":return $_(e,t);case"rainbow":return X_(e);case"toon":return Y_(e,t);case"outline":return K_(e,t);case"transmission":return Z_(e);case"color":return G_(e,t)}}function F_(e){return{type:e.type}}function Gt(e){let{alpha:t,mode:i}=e;return{...F_(e),alpha:t,mode:i}}function G_(e,t){return{...Gt(e),color:at(e.color,t)}}function V_(e,t){let{bias:i,scale:r,intensity:s,factor:o,color:n}=e;return{...Gt(e),color:at(n,t),bias:i,scale:r,intensity:s,factor:o}}function H_(e){let{gradientType:t,smooth:i,colors:r,steps:s,angle:o,offset:n,morph:h}=e;return{...Gt(e),gradientType:t,smooth:i,colors:r.map(a=>new Je(a[0],a[1],a[2],a[3])),num:r.length,steps:s,offset:new X(...n),morph:new X(...h),angle:o}}function W_(e){let{gradientType:t,near:i,far:r,isVector:s,isWorldSpace:o,origin:n,direction:h,colors:a,steps:c,smooth:d}=e;return{...Gt(e),gradientType:t,near:i,far:r,isVector:s,isWorldSpace:o,origin:new T(...n),direction:h?new T(...h):new T(1,0,0),colors:a.map(l=>l!==void 0?new Je(l[0],l[1],l[2],l[3]):new Je(0,0,0,0)),steps:c.slice(0,a.length),smooth:d}}function q_(e){let{cnormal:t}=e;return{...Gt(e),cnormal:new T(t[0],t[1],t[2])}}function $_(e,t){return{...Gt(e),scale:e.scale,move:e.move,fA:new X(...e.fA),fB:new X(...e.fB),size:new T(...e.size),distortion:new X(...e.distortion),colorA:at(e.colorA,t),colorB:at(e.colorB,t),colorC:at(e.colorC,t),colorD:at(e.colorD,t),noiseType:e.noiseType}}function X_(e){return{...Gt(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new T(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new T(...e.offset)}}function Y_(e,t){return{...Gt(e),positioning:e.positioning,colors:e.colors.map(i=>new Je(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new T(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:at(e.shadowColor,t),offset:new T(...e.offset)}}function K_(e,t){return{...Gt(e),outlineColor:at(e.outlineColor,t),contourColor:at(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new T(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function Z_(e,t){return{...Gt(e),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}var Qs=class extends Ot{},Q_=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},J_=class extends Q_{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},Wo;function eS(e){return typeof e=="string"?e:(Wo||(Wo=new J_),Wo.load(e))}var tS=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},iS=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},nd=class extends tS{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo=e.type=="video",this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;let r=[1e3,1001,1002];for(let s of r){let o=this[s];o&&(o.image=this.img,o.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(s=>{i.onloadend=o=>{var n;r=(n=o.target)==null?void 0:n.result,s(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=eS(e),this.img.onload=t}getTexture(e){let t=this[e];if(t)return t;{let i;return this.isVideo?i=new Qd(this.img,void 0,e,e):i=new tc(this.img,void 0,e,e),this.loaded&&(i.needsUpdate=!0),this[e]=i,i}}disposeTextures(){var e,t,i;(e=this[1e3])==null||e.dispose(),this[1e3]=void 0,(t=this[1001])==null||t.dispose(),this[1001]=void 0,(i=this[1002])==null||i.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Ai=class extends nd{},Ea=class extends lt{},ad={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"]},ld={depth:["colors"]};function rS(e,t,i){var o,n;let r=ad[e.type],s=ld[e.type];if(s!==void 0){let h=e.color;if(s.includes(t)){let a=(n=(o=h[t])==null?void 0:o.value)==null?void 0:n.length;if(a!==void 0&&a!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function hd(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let s=!1,o=e;if("image"in o){let n=o.image,h=t.image(n),a=r;a.image instanceof Ai||a.image.deref(),a.image=h}if("video"in o){let n=o.video,h=t.video(n),a=r;a.image instanceof Ai||a.image.deref(),a.image=h}if("wrapping"in o){let n=r;n.wrap=o.wrapping}if("repeat"in o||"offset"in o){let n="mat",h=i.uniforms[`f${i.id}_${n}`];"repeat"in o&&(h.repeat=o.repeat),"offset"in o&&(h.offset=o.offset),h.updateMatrix()}return s}function sS(e,t,i,r){let s=!1;for(let[o,n]of Object.entries(e)){if(!o||n===void 0)continue;if(md(o,i,r)){o==="visible"&&i.type==="light"&&(s=!0);continue}i.visible=r.visible;let h=i.uniforms[`f${i.id}_${o}`];if(h&&!(h instanceof Ea))switch(s=s||rS(i,o,n),h.constructor){case Ue:if(typeof n=="string"){let a=t.getColor(n);a&&(h.value=a);break}else{let a=n;h.value instanceof Qs?h.value=new Ot(a.r,a.g,a.b,a.a):h.setRGBA(a);break}case _i:if(typeof n=="string"){let a=t.getColor(n);a&&(h.value=a);break}else{let a=n;h.value instanceof Qs?h.value=new Ot(a.r,a.g,a.b,a.a):h.value.setRGBA(a.r,a.g,a.b,a.a);break}case dt:{let a=n;h.value.setX(a[0]),h.value.setY(a[1]);break}case ct:{let a=n;h.value.setX(a[0]),h.value.setY(a[1]),h.value.setZ(a[2]);break}case ai:{hd(n,t,i);break}case bi:{h.value=n.map(a=>new Je(...a));break}default:{h.value=n;break}}}return s}var cd=class extends Te{constructor(e,t,i){super("v3"),this.nodeType="Matcap",this.texture=e,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(cd.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ud=cd;ud.Nodes=function(){return{matcap:new ne(`vec3 matcap(sampler2D matcapTex, vec3 normal, float alpha, int mode, out float calpha) {
                vec3 viewDir = normalize( vViewPosition );
                vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
                vec3 y = cross( viewDir, x );
                vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
                vec4 matcapColor = texture2D( matcapTex, uv );

                calpha =  alpha / clamp( alpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;
                
                return matcapColor.rgb;
            }
            `)}}();var jn=class extends Ea{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},oS=class extends Ea{constructor(e){super("v3"),this.image=e,this._value=new T}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},dd=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=s,this.noiseStrength=o,this.noiseScale=n,this.shadowColor=h,this.offset=a,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(dd.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pd=dd;pd.Nodes=function(){let e=new ne(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new ne(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new ne(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new ne(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),s=new ne(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new ne(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[vt.simplex,e,i,s])}}();function Oh(e,t,i){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0)}var nS=class extends Gu{constructor(e,t){super(new Cs),this.repeat=e,this.offset=t,Oh(this.value,e,t)}updateMatrix(){Oh(this.value,this.repeat,this.offset)}},Pi=class{constructor(e,t,i,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)md(s,this,i)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Vi.createLigherLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let s=i.type==="texture"?r.image(i.texture.image):r.video(i.texture.video),o=new jn(s,i.texture.wrapping),n=new oS(s),h=new nS(i.texture.repeat,i.texture.offset),a=new se(i.crop?1:0),c=new Ae(i.projection??0),d=new Ae(["x","y","z"].indexOf(i.axis)??0),l=new Ae(i.side??0),u=new dt(i.size?new X(i.size[0],i.size[1]):new X(100,100)),p=new se(i.alpha??1),f=new Ae(i.mode??0),g=new rd(o,n,a,c,d,l,u,h,p,f),v=new Ie(g.calpha,"f");return new We(e,t,i,{texture:o,textureSize:n,crop:a,projection:c,axis:d,side:l,size:u,mat:h,alpha:p,mode:f},g,f,v)}else if(i.type==="matcap"){let s=r.image(i.texture.image),o=new jn(s,i.texture.wrapping),n=new se(i.alpha??1),h=new Ae(i.mode??0),a=new ud(o,n,h),c=new Ie(a.calpha,"f");return new We(e,t,i,{texture:o,alpha:n,mode:h},a,h,c)}else if(i.type==="displace")if(i.displacementType==="noise"){let s=new ct(new T(...i.offset)),o=new se(i.scale??10),n=new se(i.intensity??8),h=new se(i.movement??1),a=new Ae(i.noiseType??0),c=new ed(n,h,s,o,a);return new fd(e,t,i,{offset:s,scale:o,intensity:n,movement:h,noiseType:a},c)}else throw new Error;else return hS(e,t,i,r)}updateByOp(e,t,i){var s;let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?((s=i.scene)==null||s.markNeedsUpdateRendererDirty(),!0):sS(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?hd(r.props,i.shared,this):!0;return!1}dispose(){if(aS(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Ai||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},We=class extends Pi{constructor(e,t,i,r,s,o,n){super(e,t,i,r),this.params=r,this.color=s,this.mode=o,this.alpha=n}},fd=class extends Pi{constructor(e,t,i,r,s){super(e,t,i,r),this.position=s}},Vi=class extends Pi{constructor(e,t,i,r,s){super(e,t,i,s),this.node=r}static createLigherLayer(e,t,i,r){let s,o=new se(i.alpha),n=new Ae(i.mode),h;if(!i.visible)s=new Fu,h={};else if(i.category==="lambert"){s=new B_;let a=new Ue(r.color(i.emissive)??0);h={emissive:a},s.emissive=a}else if(i.category==="toon"){s=new R_;let a=new se(i.shininess??30),c=new Ue(r.color(i.specular)??1118481);h={shininess:a,specular:c},s.shininess=a,s.specular=c}else if(i.category==="physical"){s=new U_;let a=new se(i.roughness??.3),c=new se(i.metalness??0),d=new se(i.reflectivity??.5);h={roughness:a,metalness:c,reflectivity:d},s.roughness=a,s.metalness=c,s.reflectivity=d}else{s=new j_;let a=new se(i.shininess??30),c=new Ue(i.specular!==void 0?r.color(i.specular)??1118481:1118481);h={shininess:a,specular:c},s.shininess=a,s.specular=c}return s.alpha=new se(1),s.shadingAlpha=o,s.shadingBlend=n,h.alpha=s.shadingAlpha,h.mode=s.shadingBlend,new Vi(e,t,i,s,h)}get category(){return this.node.category}};function aS(e){let t=e instanceof Pi?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function lS(e,t,i,r){switch(e.type){case"color":{let s=new Ue(r.color??5526619),o=new se(r.alpha??1),n=new Ie("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");n.keywords.alpha=o;let h=new Ae(r.mode??0);return s.alpha=o,new We(t,i,e,{color:s,alpha:o,mode:h},s,h,n)}case"fresnel":{let s=new Ue(r.color??16777215),o=new se(r.bias??.1),n=new se(r.scale??1),h=new se(r.intensity??2),a=new se(r.factor??1),c=new se(r.alpha??1),d=new Ae(r.mode??0),l=new Wu(s,o,n,h,a,c,d),u=new Ie(l.calpha,"f");return new We(t,i,e,{color:s,bias:o,scale:n,intensity:h,factor:a,alpha:c,mode:d},l,d,u)}case"rainbow":{let s=new se(r.filmThickness??30),o=new se(r.movement??0),n=new ct(r.wavelengths??new T(0,0,0)),h=new se(r.noiseStrength??0),a=new se(r.noiseScale??1),c=new ct(r.offset??new T(0,0,0)),d=new se(r.alpha??1),l=new $u(s,o,n,h,a,c,d),u=new Ie(l.calpha,"f"),p=new Ae(r.mode??0);return new We(t,i,e,{filmThickness:s,movement:o,wavelengths:n,noiseStrength:h,noiseScale:a,offset:c,alpha:d,mode:p},l,p,u)}case"transmission":{let s=new se(r.thickness??10),o=new se(r.ior??1.5),n=new se(r.roughness??.5),h=pt.transmissionSize,a=pt.transmissionRenderTarget,c=pt.transmissionRenderTargetDepth,d=window.innerWidth,l=window.innerHeight,u=d>=l?new dt(l/d,1):new dt(1,d/l),p=new se(r.alpha??1),f=new Zu(s,o,n,h,a,c,u,p),g=new Ie(f.calpha,"f"),v=new Ae(r.mode??0);return new We(t,i,e,{thickness:s,ior:o,roughness:n,aspectRatio:u,alpha:p,mode:v},f,v,g)}case"toon":{let s=new Ae(r.positioning??0),o;r.colors?o=new bi(r.colors.length,r.colors):(o=new bi(10,new Je(0,0,0,1)),o.value[1]=new Je(1,1,1,1));let n;r.steps?n=new yi(r.steps.length,r.steps):(n=new yi(10,1),n.value[0]=0);let h=new ct(r.source??new T(0,0,0)),a=new Pr(r.isWorldSpace??!0),c=new se(r.noiseStrength??0),d=new se(r.noiseScale??1),l=new _i(r.shadowColor),u=new ct(r.offset??new T(0,0,0)),p=new se(r.alpha??1),f=new pd(s,o,n,h,a,c,d,l,u,p),g=new Ie(f.calpha,"f"),v=new Ae(r.mode??0);return new We(t,i,e,{positioning:s,colors:o,steps:n,source:h,isWorldSpace:a,noiseStrength:c,noiseScale:d,shadowColor:l,offset:u,alpha:p,mode:v},f,v,g)}case"outline":{let s=new Ue(r.outlineColor??16777215),o=new Ue(r.contourColor??16777215),n=new se(r.outlineWidth??.1),h=new se(r.contourWidth??.1),a=new se(r.outlineThreshold??.1),c=new se(r.contourThreshold??.1),d=new se(r.outlineSmoothing??.1),l=new se(r.contourFrequency??.1),u=new ct(r.contourDirection??new T(0,1,0)),p=new Pr(r.positionalLines??!1),f=new Pr(r.compensation??!0),g=pt.normalRenderTarget,v=pt.normalRenderTargetDepth,m=pt.pixelRatioNode,y=pt.resolution,_=new se(r.alpha??1),x=new Yu(s,o,n,h,a,c,d,l,u,p,f,y,g,v,m,_),S=new Ie(x.calpha,"f"),b=new Ae(r.mode??0);return new We(t,i,e,{outlineColor:s,contourColor:o,outlineWidth:n,contourWidth:h,outlineThreshold:a,contourThreshold:c,outlineSmoothing:d,contourFrequency:l,contourDirection:u,positionalLines:p,compensation:f,alpha:_,mode:b},x,b,S)}case"depth":{let s=new Ae(r.gradientType??0),o=new Pr(r.smooth??!1),n=new se(r.near??50),h=new se(r.far??200),a=new se(r.isVector??1),c=new se(r.isWorldSpace??0),d=new ct(r.origin??new T),l=new ct(r.direction??new T),u;r.colors?u=new bi(r.colors.length,r.colors):(u=new bi(2,new Je(0,0,0,1)),u.value[1]=new Je(1,1,1,1));let p;r.steps?p=new yi(r.steps.length,r.steps):(p=new yi(2,1),p.value[0]=0);let f=new se(r.alpha??1),g=new Ae(r.mode??0),v=new Qu(s,o,n,h,a,c,d,l,u,p,f),m=new Ie(v.calpha,"f");return new We(t,i,e,{gradientType:s,smooth:o,near:n,far:h,isVector:a,isWorldSpace:c,origin:d,direction:l,colors:u,steps:p,alpha:f,mode:g},v,g,m)}case"noise":{let s=new se(r.scale??1),o=new ct(r.size??new T(100,100,100)),n=new se(r.move??1),h=new dt(r.fA??new X(1.7,9.2)),a=new dt(r.fB??new X(8.3,2.8)),c=new dt(r.distortion??new X(1,1)),d=new _i(r.colorA),l=new _i(r.colorB),u=new _i(r.colorC),p=new _i(r.colorD),f=new se(r.alpha??1),g=new Ae(r.mode??0),v=new Ae(r.noiseType??0),m=new Vu(s,o,n,h,a,c,d,l,u,p,f,v),y=new Ie(m.calpha,"f");return new We(t,i,e,{scale:s,size:o,move:n,fA:h,fB:a,distortion:c,colorA:d,colorB:l,colorC:u,colorD:p,alpha:f,mode:g,noiseType:v},m,g,y)}case"normal":{let s=new ct(r.cnormal??new T(1,1,1)),o=new se(r.alpha??1),n=new Ae(r.mode??0),h=new od(s,o),a=new Ie("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");return a.keywords.alpha=o,new We(t,i,e,{cnormal:s,alpha:o,mode:n},h,n,a)}case"gradient":{let s=new Ae(r.gradientType??0),o=new Pr(r.smooth??!1),n;r.colors?n=new bi(r.colors.length,r.colors):(n=new bi(10,new Je(0,0,0,1)),n.value[1]=new Je(1,1,1,1));let h;r.steps?h=new yi(r.steps.length,r.steps):(h=new yi(10,1),h.value[0]=0);let a=new dt(r.offset??new X(0,0)),c=new dt(r.morph??new X(0,0)),d=new se(r.angle??0),l=new se(r.alpha??1),u=new Ae(r.mode??0),p=new id(s,o,n,h,a,c,d,l),f=new Ie(p.calpha,"f");return new We(t,i,e,{gradientType:s,smooth:o,colors:n,steps:h,offset:a,morph:c,angle:d,alpha:l,mode:u},p,u,f)}default:{let s=new Ue(1,0,0,1),o=new se(1),n=new Ie("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");n.keywords.alpha=o;let h=new Ae(0);return s.alpha=o,new We(t,i,e,{color:s,alpha:o,mode:h},s,h,n)}}}function hS(e,t,i,r){let s=k_(i,r);return lS(i,e,t,s)}function md(e,t,i){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=i.alpha*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return r}}function Ch(e,t){let i=0;for(let r of e.layers)if(r.data.type!=="displace"&&"alpha"in r.data&&r.data.type!=="light"&&r.data.type!=="fresnel"&&r.data.type!=="texture"&&r.data.type!=="matcap"&&r.data.type!=="rainbow"&&r.data.type!=="outline"){let s=r.data.visible?r.data.alpha:0;if(s===1&&r.data.type==="depth"||r.data.type==="gradient"){for(let o of r.data.colors)if(o[3]<1){s=o[3];break}}else if(s===1&&r.data.type==="noise"){let o=t.color(r.data.colorA).a,n=t.color(r.data.colorB).a,h=t.color(r.data.colorC).a,a=t.color(r.data.colorD).a,c=Math.min(o,Math.min(n,Math.min(h,a)));c<1&&(s=c)}i+=(1-i)*s}return i<1}var di=class extends Jd{constructor(){super(void 0),this.flatShading=!1,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},cS=class extends di{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},gd=class extends di{constructor(e,t){super(),this.data=e,this.layerIdGen=0,this.flavors=[],this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,i){let r=i?6:(e?3:0)+t;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let s=this.flavors[r];return s===void 0&&(s=new cS(e,t,i,this),this.flavors[r]=s,s.flatShading=e,s.side=t,s.updateAfterBuild()),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let i=e.layers??kt.defaultTwoLayerData("phong").layers;this.layers=i.map(r=>Pi.create(this.layerIdGen++,r.id,r.data,t.shared)),this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(),this.transparent=Ch(e,t.shared)}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(e=>e instanceof Vi),this.lightLayer===void 0&&(this.lightLayer=new Vi(0,"",{...ft.defaultData("light","phong"),visible:!1},new Fu,{})),this.dispose();for(let e of this.flavors)e&&e.dispose();this.blendColors(),this.blendAfterColors(),this.blendPositions()}updateByOp(e,t,i){var r,s,o;if(t!==void 0?this.data=t:t=this.data,this.transparent=Ch(t,i.shared),e.path[0]==="layers"){this.data=t;let n=i.shared,h=e.path[1];if(h===void 0){if(this.layers.reverse(),e.type===4){let a=Pi.create(this.layerIdGen++,e.id,e.data,i.shared);this.layers.splice(e.localIndex,0,a),(r=i.scene)==null||r.markNeedsUpdateRendererDirty()}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose(),(s=i.scene)==null||s.markNeedsUpdateRendererDirty();else if(e.type===6){let a=this.layers.findIndex(d=>d.uuid===e.id),c=this.layers[a];this.layers.splice(a,1),this.layers.splice(e.localIndex,0,c),(o=i.scene)==null||o.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{let a=this.layers.find(c=>c.uuid===h);if(a){let c=t.layers.data(h);if(a.updateByOp({...e,path:e.path.slice(2)},c,i)){let d=Pi.create(this.layerIdGen++,h,c,n);this.layers.splice(this.layers.findIndex(l=>l.uuid===h),1,d),this.onUpdate()}}}}else this.reset(t,i)}blendColors(){let e=this.layers.findIndex(i=>i instanceof We),t=this.layers.findIndex(i=>i instanceof Vi);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let s=this.layers[r];s instanceof We&&(i=new Ah(i,s.color,s.alpha,s.mode))}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Ie("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Vi);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];r instanceof We&&(e=new Ah(e,r.color,r.alpha,r.mode))}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof fd);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new jt(t,e[i].position,jt.ADD),t=new jt(t,new se(.5).setReadonly(!0),jt.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,s,o)=>Math.min(Math.max(r,s),o);for(let r of this.layers)if(r.type==="displace"){let s=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=s}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if(t.type==="light")e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let i=(ad[t.type]??[]).map(o=>t[o]),r=(ld[t.type]??[]).map(o=>{var n;return((n=t[o])==null?void 0:n.length)??0}),s=[...i,...r];s.length?e+=`["${t.type}", "${s.join('","')}"],`:e+=`"${t.type}",`}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new N_;this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof We){let t=e.params.texture;if(t instanceof jn&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(di.prototype,{properties:{get:function(){return this.fragment.properties}}});var Un=class extends gd{},uS=to($p()),Ph=new Map;function dS(e){if(typeof e=="string")return e;let t=Ph.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},Ph.set(e,t)),t.url}var ds=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let s;typeof e=="string"?s={src:e}:s={src:dS(e),format:"wav"},this.sound=new uS.Howl(s),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},pS=class{constructor(){this.type="ShapePath",this.color=new rt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ra,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var s;return(s=this.currentPath)==null||s.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,o){var n;return(n=this.currentPath)==null||n.bezierCurveTo(e,t,i,r,s,o),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,g,v){let m=p.x,y=f.x,_=g.x,x=v.x,S=p.y,b=f.y,A=g.y,O=v.y,P=(x-_)*(S-A)-(O-A)*(m-_),w=(y-m)*(S-A)-(b-S)*(m-_),C=(O-A)*(y-m)-(x-_)*(b-S),M=P/C,z=w/C;if(C===0&&P!==0||M<=0||M>=1||z<0||z>1)return null;if(P===0&&C===0){for(let W=0;W<2;W++)if(r(W===0?g:v,p,f),t.loc===e.ORIGIN){let Q=W===0?g:v;return{x:Q.x,y:Q.y,t:t.t}}else if(t.loc===e.BETWEEN){let Q=+(m+t.t*(y-m)).toPrecision(10),re=+(S+t.t*(b-S)).toPrecision(10);return{x:Q,y:re,t:t.t}}return null}else{for(let re=0;re<2;re++)if(r(re===0?g:v,p,f),t.loc===e.ORIGIN){let $=re===0?g:v;return{x:$.x,y:$.y,t:t.t}}let W=+(m+M*(y-m)).toPrecision(10),Q=+(S+M*(b-S)).toPrecision(10);return{x:W,y:Q,t:M}}}function r(p,f,g){let v=g.x-f.x,m=g.y-f.y,y=p.x-f.x,_=p.y-f.y,x=v*_-y*m;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===g.x&&p.y===g.y){t.loc=e.DESTINATION,t.t=1;return}if(x<-Number.EPSILON){t.loc=e.LEFT;return}if(x>Number.EPSILON){t.loc=e.RIGHT;return}if(v*y<0||m*_<0){t.loc=e.BEHIND;return}if(Math.sqrt(v*v+m*m)<Math.sqrt(y*y+_*_)){t.loc=e.BEYOND;return}let S;v!==0?S=y/v:S=_/m,t.loc=e.BETWEEN,t.t=S}function s(p,f){let g=[],v=[];for(let m=1;m<p.length;m++){let y=p[m-1],_=p[m];for(let x=1;x<f.length;x++){let S=f[x-1],b=f[x],A=i(y,_,S,b);A!==null&&g.find(O=>O.t<=A.t+Number.EPSILON&&O.t>=A.t-Number.EPSILON)===void 0&&(g.push(A),v.push(new X(A.x,A.y)))}}return v}function o(p,f,g){let v=new X;f.getCenter(v);let m=[];return g.forEach(y=>{y.boundingBox.containsPoint(v)&&s(p,y.points).forEach(_=>{m.push({identifier:y.identifier,isCW:y.isCW,point:_})})}),m.sort((y,_)=>y.point.x-_.point.x),m}function n(p,f,g,v,m){(m==null||m==="")&&(m="nonzero");let y=new X;p.boundingBox.getCenter(y);let _=[new X(g,y.y),new X(v,y.y)],x=o(_,p.boundingBox,f);x.sort((w,C)=>w.point.x-C.point.x);let S=[],b=[];x.forEach(w=>{w.identifier===p.identifier?S.push(w):b.push(w)});let A=S[0].point.x,O=[],P=0;for(;P<b.length&&b[P].point.x<A;)O.length>0&&O[O.length-1]===b[P].identifier?O.pop():O.push(b[P].identifier),P++;if(O.push(p.identifier),m==="evenodd"){let w=O.length%2===0,C=O[O.length-2];return{identifier:p.identifier,isHole:w,for:C}}else if(m==="nonzero"){let w=!0,C=null,M=null;for(let z=0;z<O.length;z++){let W=O[z];f[W]&&(w?(M=f[W].isCW,w=!1,C=W):M!==f[W].isCW&&(M=f[W].isCW,w=!0))}return{identifier:p.identifier,isHole:w,for:C}}else console.warn('fill-rule: "'+m+'" is currently not implemented.')}let h=0,a=999999999,c=-999999999,d=[];this.subPaths.forEach(p=>{let f=p.getPoints(),g=-999999999,v=999999999,m=-999999999,y=999999999;for(let _=0;_<f.length;_++){let x=f[_];x.y>g&&(g=x.y),x.y<v&&(v=x.y),x.x>m&&(m=x.x),x.x<y&&(y=x.x)}c<=m&&(c=m+1),a>=y&&(a=y-1),f.length&&d.push({curves:p.curves,points:f,isCW:ep.isClockWise(f),identifier:h++,boundingBox:new tp(new X(y,v),new X(m,g))})});let l=d.map(p=>{var f;return n(p,d,a,c,(f=this.userData)==null?void 0:f.style.fillRule)}),u=[];return d.forEach(p=>{let f=l[p.identifier];if(f&&!f.isHole){let g=new Ps;g.curves=p.curves,l.filter(v=>(v==null?void 0:v.isHole)&&v.for===p.identifier).forEach(v=>{if(v){let m=d[v.identifier],y=new Ra;y.curves=m.curves,g.holes.push(y)}}),u.push(g)}}),u}},vd,Th=new Promise(e=>{vd=e}),Eh=!1;async function fS(){if(Eh)return;let e=await ac(()=>import("./opentype-fc28cde9.js"),[]);vd(e),Eh=!0}var mS=class{async load(e,t,i=()=>{}){let{load:r}=await Th;r(e,(s,o)=>{s||!o?i(s??"Something went wrong"):t(o)})}async parse(e){let{parse:t,Bidi:i}=await Th;try{let r=t(e),s=new i,o=n=>r.charToGlyphIndex(n.char);return s.registerModifier("glyphIndex",null,o),s.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:s}}catch(r){console.error(r)}}};async function gS(e){return await(await fetch(e)).arrayBuffer()}var vS=new mS;async function Mh(e){let t,i,r=!1;if(e.url?(t=await gS(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer),t){let s=await vS.parse(t);if(s)return{font:s.font,url:i,intercepted:r,arr:t,bidi:s.bidi}}}function yS(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var bS=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Mh(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Mh(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let s=r.tokenizer.tokens,o=[],n=0,h=i.length===s.length;for(let a=0;a<i.length;a++){let c=i[a].index,d=String.fromCharCode(i[a].unicode),l=s[n];if(yS(c,l)||h)o.push({char:d,index:c,replacements:[l.state.glyphIndex],replacementChars:[l.char]}),n++;else{let u=l.char,p="",f=[l.state.glyphIndex],g=[],v=!1;for(;!v;)n++,p=t.charAt(n),u+=p,f.push(e.charToGlyphIndex(p)),g=e.stringToGlyphs(u),g.length===1&&g[0].index===c&&(v=!0),n>t.length&&(v=!0);o.push({char:d,index:c,replacements:f,replacementChars:Array.from(u)}),n++}}return o}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,s=t.fontSize*t.lineHeight,o=e.map(m=>this.getTextWidth(m,t)),n=t.width,h=this.getCharWidth(`
`,t),a=t.horizontalAlign===1?h:0,c=this.computeSpaceWidthForLine(e,0,t),d=this.getLineInitialOffsetX(o[0],n,t.horizontalAlign,e[0],h),l=this.getLineInitialOffsetY(s,e.length,t.height,r,t.verticalAlign),u=[],p=e.map(m=>[]),f=e.map(m=>[]),g;for(let m=0;m<e.length;m++){let y=e[m],_={features:{liga:!0}},x=[];try{x=i.stringToGlyphs(y,_)}catch(b){console.warn(b)}d=this.getLineInitialOffsetX(o[m],n,t.horizontalAlign,y,h);let S=[];try{S=this.reverseLigaturesTable(i,y,x)}catch(b){console.warn(b)}c=this.computeSpaceWidthForLine(e,m,t);for(let b=0;b<x.length;b++){let A=x[b],O=A.index===0?`
`:A.unicode?String.fromCharCode(A.unicode):void 0,P=S[b],w=0,C=0;b===0&&t.horizontalAlign===2&&A.leftSideBearing!==void 0&&(C=-A.leftSideBearing*r),g&&(w=i.getKerningValue(A,g)*r),d+=C+w;let M=0;if(O===`
`)M=a;else if(O===" ")M=c;else{let z=this.createPath(A,r,d,l,t);z&&(M=z.offsetX-(w+C),u.push(z.path))}if(P.replacements.length===1)f[m].push([d,l]),p[m].push(M);else{let z=P.replacements.map($=>(i.glyphs.get($).advanceWidth??0)*r),W=z.reduce(($,V)=>$+=V,0),Q=z.map($=>$/W),re=d;for(let $=0;$<Q.length;$++){let V=M*Q[$];f[m].push([re,l]),p[m].push(V),re+=V}}d+=M,g=A}l-=s}let v=[];for(let m=0,y=u.length;m<y;m++)v.push(...u[m].toShapes());return{shapes:v,charWidths:p,lineWidths:o,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,s){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=s),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,s){let o=t*e,n=Math.abs(this.ascender-this.descender)*r,h=e-n,a=-this.ascender*r-h/2;return s===3?-(i-o-a):s===2?-(i*.5-o*.5-a):a}createPath(e,t,i,r,s){var a;let o=e.getPath(i,-r,s.fontSize,{kerning:!1,letterSpacing:s.letterSpacing});if(!o){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let n=new pS,h=(e.advanceWidth??1)*t;if(e)for(let c of o.commands){let d=(a=n.currentPath)==null?void 0:a.currentPoint;if(!(d&&c.type!=="Z"&&d.x===c.x&&-d.y===c.y))switch(c.type){case"M":n.moveTo(c.x,-c.y);break;case"L":n.lineTo(c.x,-c.y);break;case"Q":n.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":n.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return n.subPaths.forEach(c=>{let d=xS(c.curves);d!==void 0&&c.currentPoint.distanceTo(d)>0&&c.lineTo(d.x,d.y)}),{offsetX:h+s.fontSize*s.letterSpacing,path:n}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),s=e[t];if(s){let o=this.countSpaces(s.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&o){let n=i.width,h=this.getTextWidth(s,i);return(n-(h-o*r))/o}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function xS(e){if(e.length){let t=e[0];if(t instanceof hi)return t.v1;if(t instanceof qt||t instanceof tr)return t.v0}}var wS=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t){let i=this.objects.get(e);return i===void 0?(i=this.createObject(e,t),this.objects.set(e,i)):i.isShared=!0,i}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},Dh=class extends wS{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t){let i=Zs(e,t,this.flatShading);return i.computeBoundingSphere(),i}},_S={find(e){},markNeedsUpdateRendererDirty:function(){},markGeometryCacheDirty:function(){},addPendingExpandCloner:function(e){},addPendingUpdateCloner(e){},addPendingCommand(e){}},SS=class extends iS{constructor(e){super(),this.shared=e}create(e){return new nd(e,this.shared)}},Ma=class{constructor(e,t={}){if(this.geometryCache=new Dh(!0),this.geometryCache2=new Dh(!1),this.imageHolderCache=new SS(this),this.thisContext={scene:_S,shared:this},this.deletedMaterial=new Un(kt.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new Ai(Xs.emptyImage,this),this.deletedVideo=new Ai(Bs.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.penumbraSize=[],this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,r]of Object.entries(t.images))this.addImage(i,r);if(t.videos)for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);if(t.audios)for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r.data);this.reset(e)}setRequestRender(e){this._requestRender=e}reset(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,new Un(i,this.thisContext));for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.data);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i);this.penumbraSize=e.penumbraSize}addMaterial(e,t){t.uuid=e,this.materials[e]=t}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):new gd(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Ai(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Ai(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new Qs(t.r,t.g,t.b,t.a):this.colors[e]=new Qs(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Ot(0,0,0,0))}else return"a"in e?new Ot(e.r,e.g,e.b,e.a):new Ot(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof ds)return t;{let i=new ds({src:t});return this.audios[e]=i,i}}deleteAudio(e){let t=this.audios[e];t&&(t instanceof ds&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new bS(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof ds&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}},AS=new Ma(Cn.emptyData()),Yr=class extends ui{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),af(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,s]of Object.entries(e.props)){let o=i.shared.material(s);this.material[Number(r)]=o}else if(ti(e.path,["material"])&&this.material instanceof di)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(nt.drop(e,1),t.material,i);else if(ti(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let s=t.materials[r];typeof s!="string"&&this.material[r].updateByOp(nt.drop(e,2),s,i)}}}updateState(e,t){var r,s,o,n,h;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if(((r=e.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),(s=t.scene)==null||s.markNeedsUpdateRendererDirty()),((o=e.geometry)==null?void 0:o.type)==="NonParametricGeometry"&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),(n=t.scene)==null||n.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],(h=t.scene)==null||h.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&Dc(this.material).forEach(e=>{e instanceof di&&(e instanceof Un||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},pi=class extends Yr{constructor(e,t,i){super(e,t),this.data=t,this.localGeometry=void 0}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Oe&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof Ma){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return Rs.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return Rs.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),ti(e.path,["geometry"])&&this.updateByPatchedOpGeometry(nt.drop(e,1),t.geometry,i)}removeInteractionGeometry(){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let s=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...s};this.localGeometry=Zs(c,t,this.data.flatShading)}let o,n,h;s.scaleBaked?[o,n,h]=s.scaleBaked:{width:o,height:n,depth:h}=s;let a=this.localGeometry.userData;a.sxPrev!==void 0&&zn(this.localGeometry.attributes,o/a.sxPrev,n/a.syPrev,h/a.szPrev),a.sxPrev=o,a.syPrev=n,a.szPrev=h}else{let s={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=Zs(s,t,this.data.flatShading)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var s;let r=!1;e.type===0&&e.path.length===0&&nu(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof Ye&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((s=i.scene)==null||s.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}};function OS(e){var n,h;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,s=i.normal.array,o=new Float32Array(r.length);for(let a=0;a<r.length;a+=3){let c=`${r[a]}_${r[a+1]}_${r[a+2]}`,d=new T(s[a],s[a+1],s[a+2]);t.has(c)?(n=t.get(c))==null||n.normals.push(d):t.set(c,{normals:[d],result:new T})}t.forEach((a,c)=>{for(let d of a.normals)a.result.add(d);a.result.divideScalar(a.normals.length)});for(let a=0;a<r.length;a+=3){let c=`${r[a]}_${r[a+1]}_${r[a+2]}`,d=(h=t.get(c))==null?void 0:h.result;d&&(o[a]=d.x,o[a+1]=d.y,o[a+2]=d.z)}e.geometry.setAttribute("extrudeNormal",new ve(o,3))}function CS(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new T;for(let s=0;s<t.length;s+=3)r.set(t[s],t[s+1],t[s+2]).normalize(),i[s]=r.x,i[s+1]=r.y,i[s+2]=r.z;e.geometry.setAttribute("extrudeNormal",new ve(i,3))}function Da(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof di)||e.material.getLayersOfType("outline").length===0)return;e instanceof pi&&e.is2DAndNoDepth?CS(e):OS(e)}function La(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),s=[Ne.seededRandom(r),Ne.seededRandom(r+1e4),Ne.seededRandom(r+2e4)];for(let o=0;o<t.length;o++)i[o]=s[o%3];e.geometry.setAttribute("randomColor",new ze(i,3))}Oa.then(e=>{});var Lt=new Di,Tr=new T;function PS(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Rn=class extends pi{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new me,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var o,n,h;if(this.skipReactionUpdate===!0)return;let t=(o=this.localGeometry)==null?void 0:o.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:s}=Ye.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,i!==void 0&&((n=this.originalGeometry)==null||n.dispose(),this.originalGeometry=i),r!==void 0&&((h=this.subdividedGeometry)==null||h.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,Da(this),La(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){Ye.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Ye.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Ye.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Ye.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,ui.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Ji,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;Lt.setFromBufferAttribute(t),Lt.getCenter(i),e.boundingSphere.radius=i.distanceTo(Lt.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Lt.getSize(Tr),this.hasNonUniformScale&&Tr.divide(this.scale);let r={width:Tr.x,height:Tr.y,depth:Tr.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;Lt.min.set(e[0],e[2],e[4]),Lt.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(Lt.min.applyMatrix4(this.shearScaleInv),Lt.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Ji);let i=t.boundingSphere.center;Lt.getCenter(i),t.boundingSphere.radius=i.distanceTo(Lt.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(Ye.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},Lh=-1,TS=1,ES={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},MS={polygon_center:0,edge:1,vertex:2},ps=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,de=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-Lh)*(i-r)/(TS-Lh)+r};function DS(e){let t=[],i={};for(var r=0,s=e.length;r<s;r++){var o=JSON.stringify(e[r].pos.map(n=>Math.round(n*1e4)/1e4));i[o]||(t.push(e[r]),i[o]=!0)}return t}var LS=new T,fs=new T,IS=new T,zS=new T;function Qi(e,t){let i=IS.fromArray(e),r=zS.fromArray(t);fs.copy(r).sub(i);let s=fs.length();return fs.normalize().multiplyScalar(s*.5),LS.copy(i).add(fs).toArray()}var mt=new Vn,ms=new T,Js=new T,Si=new T;function NS(e){let t=[];for(let i=0;i<=e.index.count;i++)if(ms.fromArray(e.index.array,i*3),mt.setFromAttributeAndIndices(e.attributes.position,ms.x,ms.y,ms.z),mt.getNormal(Js),mt.getMidpoint(Si),!(isNaN(Si.x)||isNaN(Si.y)||isNaN(Si.z))){let{a:r,b:s,c:o}=mt,n=r.toArray(),h=s.toArray(),a=o.toArray(),c=r.distanceTo(s),d=s.distanceTo(o),l=o.distanceTo(r),u=Qi(n,h),p=Qi(h,a),f=Qi(a,n),g=[c,d,l],v=Math.max(...g),m=g.filter(x=>Math.round(x)===Math.round(v)).length>1,y=[],_=mt.getMidpoint(Si).toArray();v===c&&!m&&(y=[p,f,f],_=u),v===d&&!m&&(y=[u,f,f],_=p),v===l&&!m&&(y=[u,p,p],_=f),m&&(y=[u,p,f]),t.push({vertices:[n,h,a],faceCenters:y,midpoint:_,norm:mt.getNormal(Js).toArray()})}return t}function BS(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){mt.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),mt.getNormal(Js),mt.getMidpoint(Si);let s=mt.a.toArray(),o=mt.b.toArray(),n=mt.c.toArray();t.push({vertices:[s,o,n],faceCenters:[Qi(s,o),Qi(o,n),Qi(n,s)],midpoint:Si.toArray(),norm:Js.toArray()})}return t}var jS=4,US=.5,qo=e=>.5*(1-Math.cos(e*Math.PI)),RS=class{constructor(){this.perlin=new Array(4095+1)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let v=0;v<4095+1;v++)this.perlin[v]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),s=Math.floor(t),o=Math.floor(i),n=e-r,h=t-s,a=i-o,c,d,l=0,u=.5,p,f,g;for(let v=0;v<jS;v++){let m=r+(s<<4)+(o<<8);c=qo(n),d=qo(h),p=this.perlin[m&4095],p+=c*(this.perlin[m+1&4095]-p),f=this.perlin[m+16&4095],f+=c*(this.perlin[m+16+1&4095]-f),p+=d*(f-p),m+=256,f=this.perlin[m&4095],f+=c*(this.perlin[m+1&4095]-f),g=this.perlin[m+16&4095],g+=c*(this.perlin[m+16+1&4095]-g),f+=d*(g-f),p+=qo(a)*(f-p),l+=p*u,u*=US,r<<=1,n*=2,s<<=1,h*=2,o<<=1,a*=2,n>=1&&(r++,n--),h>=1&&(s++,h--),a>=1&&(o++,a--)}return l}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(s){r=i=(s??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4095+1);for(let i=0;i<4095+1;i++)this.perlin[i]=t.rand()}},kS=RS,Ih=new T,zh=new me,Nh=new Hn;function FS(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(t=!0)}),t}var yd=class extends pi{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(zh.copy(i).invert(),Nh.copy(e.ray).applyMatrix4(zh),Nh.intersectBox(this.singleBBox,Ih))){let r=Ih.applyMatrix4(i),s=e.ray.origin.distanceTo(r);t.push({distance:s,point:r.clone(),object:this})}}},Xe=1e-4,It,bd,xd,wd,Bh=new T,jh=new T;Oa.then(e=>{It=e,bd=[It.get_face_center,It.get_edge_midpoint,It.get_vertex_position],xd=[It.get_face_normal,It.get_edge_normal,It.get_vertex_normal],wd=[It.face_count,It.edge_count,It.vertex_count]});var GS=new me,VS=new me,Jt=new T,gi=new T,Er=new T,$o=new T,HS=new T,WS=new T,Ht=new kS,_d=class extends ya(Ti){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof Lr&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof Lr&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(t=0),this.parameters.type==="toObject"&&this.objectForSample){for(let r=0,s=this.children.length;r<s;++r)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,s=t-i.length;r<s;++r){let o=new Lr(this.object);o.expand(),this.add(o)}else for(let r=0,s=i.length-t;r<s;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let s=new Lr(this.object);s.expand(),this.add(s)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,i=t.start*Ne.DEG2RAD,r=t.end*Ne.DEG2RAD,s=i-r,o=new bs(t.rotation[0],t.rotation[1],t.rotation[2]),n;switch(t.axis){case"z":n=new T(0,0,1);break;case"y":n=new T(0,1,0);break;default:case"x":n=new T(1,0,0);break}let h=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,a=h.noiseType==="perlin";Ht.noiseSeed(h.seed);let c=Do((0,xr.default)(h.seed)),d=ps(h.strength,this.parameters.randomness);for(let[l,u]of this.children.entries()){let p=l*(h.freqScale/10)+h.movement,f=a?Ht.noise(p):c(p,p);u.scale.x=t.scale[0]+d(l,de(f,h.scale[0]))||Xe,u.scale.y=t.scale[1]+d(l,de(f,h.scale[1]))||Xe,u.scale.z=t.scale[2]+d(l,de(f,h.scale[2]))||Xe,u.position.setScalar(0);let g=s/e.count*l-i;switch(t.axis){case"x":u.rotation.set(0,g,0);break;case"y":u.rotation.set(0,0,g);break;case"z":u.rotation.set(g,0,0);break}u.translateOnAxis(n,t.radius),u.position.x+=t.position[0]+d(l,de(f,h.position[0])),u.position.y+=t.position[1]+d(l,de(f,h.position[1])),u.position.z+=t.position[2]+d(l,de(f,h.position[2]));let v=d(l,de(f,h.rotation[0])),m=d(l,de(f,h.rotation[1])),y=d(l,de(f,h.rotation[2]));t.alignment===!0?(u.rotation.x+=o.x+v,u.rotation.y+=o.y+m,u.rotation.z+=o.z+y):u.rotation.set(o.x+v,o.y+m,o.z+y)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new bs(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";Ht.noiseSeed(r.seed);let o=Do((0,xr.default)(r.seed)),n=ps(r.strength,this.parameters.randomness);for(let[h,a]of this.children.entries()){let c=h*(r.freqScale/10)+r.movement,d=s?Ht.noise(c):o(c,c),l=n(h,de(d,r.rotation[0])),u=n(h,de(d,r.rotation[1])),p=n(h,de(d,r.rotation[2]));a.scale.x=1+(t.scale[0]-1)*h+n(h,de(d,r.scale[0]))||Xe,a.scale.y=1+(t.scale[1]-1)*h+n(h,de(d,r.scale[1]))||Xe,a.scale.z=1+(t.scale[2]-1)*h+n(h,de(d,r.scale[2]))||Xe,a.rotation.x=i.x*h+l,a.rotation.y=i.y*h+u,a.rotation.z=i.z*h+p,a.position.x=t.position[0]*h+n(h,de(d,r.position[0])),a.position.y=t.position[1]*h+n(h,de(d,r.position[1])),a.position.z=t.position[2]*h+n(h,de(d,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,s=ps(r.strength,this.parameters.randomness),o=r.noiseType==="perlin";Ht.noiseSeed(r.seed);let n=Hx((0,xr.default)(r.seed));if(i.useCenter===!0){let h={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},a=new T(i.size[0]*(i.count[0]-h.x)*.5,i.size[1]*(i.count[1]-h.y)*.5,i.size[2]*(i.count[2]-h.z)*.5);for(let c=0;c<i.count[0];c++)for(let d=0;d<i.count[1];d++)for(let l=0;l<i.count[2];l++){let u=[(c+1)*(r.freqScale/10)+r.movement,(d+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement],p=o?Ht.noise(...u):n(...u),f=this.children[t++];f.scale.x=1+s(t,de(p,r.scale[0]))||Xe,f.scale.y=1+s(t,de(p,r.scale[1]))||Xe,f.scale.z=1+s(t,de(p,r.scale[2]))||Xe;let g=s(t,de(p,r.rotation[0])),v=s(t,de(p,r.rotation[1])),m=s(t,de(p,r.rotation[2]));f.rotation.set(g,v,m),f.position.x=i.size[0]*c-a.x+s(t,de(p,r.position[0])),f.position.y=i.size[1]*d-a.y+s(t,de(p,r.position[1])),f.position.z=i.size[2]*l-a.z+s(t,de(p,r.position[2]))}}else for(let h=0;h<i.count[0];h++)for(let a=0;a<i.count[1];a++)for(let c=0;c<i.count[2];c++){let d=[(h+1)*(r.freqScale/10)+r.movement,(a+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement],l=o?Ht.noise(...d):n(...d),u=this.children[t++];u.scale.x=1+s(t,de(l,r.scale[0]))||Xe,u.scale.y=1+s(t,de(l,r.scale[1]))||Xe,u.scale.z=1+s(t,de(l,r.scale[2]))||Xe;let p=s(t,de(l,r.rotation[0])),f=s(t,de(l,r.rotation[1])),g=s(t,de(l,r.rotation[2]));u.rotation.set(p,f,g),u.position.x=i.size[0]*h+s(t,de(l,r.position[0])),u.position.y=-i.size[1]*a+s(t,de(l,r.position[1])),u.position.z=-i.size[2]*c+s(t,de(l,r.position[2]))}}_updateToObject(e){var g;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new bs(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";Ht.noiseSeed(r.seed);let o=Do((0,xr.default)(r.seed)),n=ps(r.strength,this.parameters.randomness);if(!t.object){for(let[,v]of this.children.entries())v.position.set(0,0,0),v.scale.setScalar(1),v.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof yd)if(!((g=this.objectForSample.font)!=null&&g.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let h=this.getSubdivData(),a=[],c=v=>{let m=v.length,y=v.map(S=>S[0]).reduce((S,b)=>S+b,0),_=v.map(S=>S[1]).reduce((S,b)=>S+b,0),x=v.map(S=>S[2]).reduce((S,b)=>S+b,0);return[y/m,_/m,x/m]},d=v=>Math.round(v*1e6)/1e6;h.forEach(v=>{let m=h.filter(y=>d(v.pos[0])===d(y.pos[0])&&d(v.pos[1])===d(y.pos[1])&&d(v.pos[2])===d(y.pos[2]));m.length>1?a.push({pos:v.pos,norm:c(m.map(y=>y.norm))}):a.push(v)});let l=DS(a);if(h.length>0){let v=Math.round(l.length*t.count/100);this._updateCount(v)}this.objectForSample.updateMatrixWorld();let u=new Wx(this.objectForSample).build(),p=ES[t.axis],f=this.children;u.setRandomGenerator((0,xr.default)(this.object.uuid+t.seed));for(let[v,m]of f.entries()){let y=v*(r.freqScale/10)+r.movement,_=s?Ht.noise(y):o(y,y),x=n(v,de(_,r.rotation[0])),S=n(v,de(_,r.rotation[1])),b=n(v,de(_,r.rotation[2]));t.spreadType==="random"?u.sample(Er,$o):(l.length&&(Er.fromArray(l[v].pos),$o.fromArray(l[v].norm)),this.objectForSample instanceof Rn&&Er.applyMatrix4(GS.copy(this.objectForSample.matrixWorld).invert())),Er.applyMatrix4(this.object.hiddenMatrix.clone().invert()),m.position.copy(Er),Jt.fromArray(p);let A=t.align==="normal"?$o:this.object.getWorldDirection(WS),O=gi.fromArray(t.position);gi.x+=gi.x+n(v,de(_,r.position[0])),gi.y+=gi.y+n(v,de(_,r.position[1])),gi.z+=gi.z+n(v,de(_,r.position[2]));let P=Math.acos(A.dot(Jt)),w=HS.crossVectors(Jt,A).normalize(),C=VS.makeRotationAxis(w,P),M=A.clone().cross(this.object.up).normalize(),z=M.clone().cross(A).normalize(),W=new me().makeBasis(M,A,z),Q=new T(Jt.y,Jt.z,Jt.x).normalize(),re=Q.clone().cross(Jt).normalize(),$=new me().makeBasis(Q,Jt,re).invert(),V=new me().multiplyMatrices(W,$);m.rotation.setFromRotationMatrix(V),O.applyMatrix4(C),m.position.add(O),m.rotation.x=m.rotation.x+i.x+x,m.rotation.y=m.rotation.y+i.y+S,m.rotation.z=m.rotation.z+i.z+b,m.scale.setScalar(1),m.scale.x=m.scale.x+t.scale[0]+n(v,de(_,r.scale[0]))||Xe,m.scale.y=m.scale.y+t.scale[1]+n(v,de(_,r.scale[1]))||Xe,m.scale.z=m.scale.z+t.scale[2]+n(v,de(_,r.scale[2]))||Xe,m.scale.multiply(this.object.scale),m.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof Rn){let t=this.objectForSample,i=MS[e],r=wd[i],s=bd[i],o=xd[i],n=[],h=r(t.subdivPointerNew);for(let a=0;a<=h-1;a++){let c=s(t.subdivPointerNew,a),d=o(t.subdivPointerNew,a);Bh.fromArray(c).applyMatrix4(t.matrixWorld),jh.fromArray(d),n.push({pos:Bh.toArray(),norm:jh.toArray()})}return n}else return(this.objectForSample.geometry.index?NS(this.objectForSample.geometry):BS(this.objectForSample.geometry)).map((t,i)=>e==="polygon_center"?{pos:t.midpoint,norm:t.norm}:e==="vertex"?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:e==="edge"?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){var i;if(this.parameters=po(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof ui?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new me,this.hiddenMatrix=new me,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Kr=e=>{var t;return t=class extends e{},t.geometryHelper=new er(30,30,30),t},gs=new Hn,Xo=new Ji,Uh=new me,Zr=(e,t,i,r,s=!1)=>{let o=t,n=e.matrixWorld;if(o.boundingSphere===null&&o.computeBoundingSphere(),Xo.copy(o.boundingSphere),Xo.applyMatrix4(n),i.ray.intersectsSphere(Xo)===!1||(Uh.copy(n).invert(),gs.copy(i.ray).applyMatrix4(Uh),o.boundingBox!==null&&gs.intersectsBox(o.boundingBox)===!1))return;let h,a,c,d,l=o.index,u=o.attributes.position,p=o.drawRange,f,g;if(s===!1){let m=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(f=m,g=y;f<g;f+=3)if(a=l.getX(f),c=l.getX(f+1),d=l.getX(f+2),h=v(e,i,gs,u,a,c,d),h){h.faceIndex=Math.floor(f/3),r.push(h);return}}else{let m=o.attributes.position,y=new T,_=new T,x=new T,S=new T,b=2,A=1/((e.scale.x+e.scale.y+e.scale.z)/3),O=A*A,P=Math.max(0,p.start),w=Math.min(m.count,p.start+p.count);for(let C=P,M=w-1;C<M;C+=b){if(y.fromBufferAttribute(m,C),_.fromBufferAttribute(m,C+1),gs.distanceSqToSegment(y,_,S,x)>O)continue;S.applyMatrix4(e.matrixWorld);let z=i.ray.origin.distanceTo(S);z<i.near||z>i.far||r.push({distance:z,point:x.clone().applyMatrix4(e.matrixWorld),object:e})}}function v(m,y,_,x,S,b,A){let O=new T,P=new T,w=new T,C=new T,M=new T;if(O.fromBufferAttribute(x,S),P.fromBufferAttribute(x,b),w.fromBufferAttribute(x,A),_.intersectTriangle(O,P,w,!1,C)===null)return null;M.copy(C),M.applyMatrix4(m.matrixWorld);let z=y.ray.origin.distanceTo(M);return z<y.near||z>y.far?null:{faceIndex:1,distance:z,point:M.clone(),object:m}}},vs=new T,ht=new ec,qS=class extends ip{constructor(e){let t=new Oe,i=new rp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={},n=new rt(15711266),h=new rt(15711266),a=new rt(2857471);c("n1","n2",n),c("n2","n4",n),c("n4","n3",n),c("n3","n1",n),c("f1","f2",n),c("f2","f4",n),c("f4","f3",n),c("f3","f1",n),c("n1","f1",n),c("n2","f2",n),c("n3","f3",n),c("n4","f4",n),c("p","n1",h),c("p","n2",h),c("p","n3",h),c("p","n4",h),c("u1","u2",a),c("u2","u3",a),c("u3","u1",a);function c(l,u,p){d(l,p),d(u,p)}function d(l,u){r.push(0,0,0),s.push(u.r,u.g,u.b),o[l]===void 0&&(o[l]=[]),o[l].push(r.length/3-1)}t.setAttribute("position",new ve(r,3)),t.setAttribute("color",new ve(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){let e=this.geometry,t=this.pointMap;ht.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,s=.8;_t("n1",t,e,ht,-i,-r,s),_t("n2",t,e,ht,i,-r,s),_t("n3",t,e,ht,-i,r,s),_t("n4",t,e,ht,i,r,s);let o=s;_t("f1",t,e,ht,-i,-r,o),_t("f2",t,e,ht,i,-r,o),_t("f3",t,e,ht,-i,r,o),_t("f4",t,e,ht,i,r,o);let n=o,h=.5;_t("u1",t,e,ht,i*.7*h,r*1.1,n),_t("u2",t,e,ht,-i*.7*h,r*1.1,n),_t("u3",t,e,ht,0,r*(1.1+.9*h),n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function _t(e,t,i,r,s,o,n){vs.set(s,o,n).unproject(r);let h=t[e];if(h!==void 0){let a=i.getAttribute("position");for(let c=0,d=h.length;c<d;c++)a.setXYZ(h[c],vs.x,vs.y,vs.z)}}var $S=class extends Kr(qS){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Zr(this.object,this.geometry,e,t,!0)}},kn;(e=>e.is=t=>"objectHelper"in t)(kn||(kn={}));var mo=(e,t)=>class extends cu(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Ts&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof er?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Ts&&(r.visible=!1)}}},Yo=790,Ui=new T,Ko=new T,Zo=new sc,Qo=new T,Mr=new T,Jo=new T,Ur=class extends mo(ec,$S){constructor(e="",t={...ks.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=Gr.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;if(t.orthographic.autoZoom){let s=t.orthographic.autoZoomFrustumSize??Yo,o=i/r,n=i>r?o:1,h=i>r?1:o;this.orthoCamera=new ka(-s*.5*n,s*.5*n,s*.5*(1/h),-s*.5*(1/h),-5e4,1e4)}else this.orthoCamera=new ka(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4);this.perspCamera=new sp(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new T(e,t,i)),super.lookAt(e),this.getWorldPosition(Ui),this.targetOffset=Ui.distanceTo(e)}getTarget(e=new T){return this.getWorldDirection(Ko),this.getWorldPosition(Ui),Ko.multiplyScalar(this.targetOffset),e.copy(Ui).add(Ko),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Ui),Ui.distanceTo(e)}updateUp(){this.getWorldQuaternion(Zo),Qo.set(0,0,1).applyQuaternion(Zo),Mr.copy(Ti.DEFAULT_UP),this.isUpVectorFlipped&&Mr.negate(),Mr.applyQuaternion(Zo),Jo.copy(Ti.DEFAULT_UP).projectOnPlane(Qo),this.angleOffsetFromUp=Jo.angleTo(Mr),this.angleOffsetFromUp*=Jo.cross(Mr).dot(Qo)>=0?1:-1}updateTransformState(e){let t=super.updateTransformState(e);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}getViewFrontToObject(e){let t=e.getWorldPosition(new T),i=e.getWorldDirection(new T).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToObject(e){let t=e.getWorldPosition(new T),i=this.getWorldDirection(new T).multiplyScalar(this.targetOffset);return{position:t.clone().sub(i),target:t}}setViewplaneSize(e,t){if(this.aspect=e/t,this.data.type==="OrthographicCamera"&&this.data.orthographic.autoZoom){let i=this.data.orthographic.autoZoomFrustumSize??Yo,r=e>t?this.aspect:1,s=e>t?1:this.aspect;this.left=-i*.5*r,this.right=i*.5*r,this.top=i*.5*(1/s),this.bottom=-i*.5*(1/s)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,s,o){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,s,o):this.orthoCamera.setViewOffset(e,t,i,r,s,o)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom,autoZoom:!0,autoZoomFrustumSize:Yo},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return On(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Rh=new me,hr=class extends Yr{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Oe,this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let s=0;s<this.children.length;s++){let o=this.children[s];o instanceof hr&&o.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let s=0;s<this.children.length;s++){let o=this.children[s];if(o instanceof ui&&o.dataPatched.visible===!0&&((r=o.geometry.attributes.position)==null?void 0:r.count)>0&&o.geometry.drawRange.count>0){if(o.booleanMeshSetAddress===-1){if((o.geometry.index??o.geometry.getAttribute("position")).count/3<15e5&&(o.booleanMeshSetAddress=ei.getMeshSet(o.geometry,e===!0,t)),o.booleanMeshSetAddress===-1)return;ei.transformMeshSet(o.booleanMeshSetAddress,o.matrix),o.booleanMatrixInvOld.copy(o.matrix).invert(),o.booleanWasTransformed=!1}else o instanceof hr&&o.needsTransformForDownstream===!0?(ei.transformMeshSet(o.booleanMeshSetAddress,o.matrix),o.needsTransformForDownstream=!1):o.booleanWasTransformed===!0&&(Rh.multiplyMatrices(o.matrix,o.booleanMatrixInvOld),ei.transformMeshSet(o.booleanMeshSetAddress,Rh),o.booleanMatrixInvOld.copy(o.matrix).invert(),o.booleanWasTransformed=!1);this.meshSetAddresses.push(o.booleanMeshSetAddress)}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new op([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return ei.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Oe,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=ei.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(s){this.booleanMeshSetAddress=0,console.error(s)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,Da(this),La(this)}dispose(){super.dispose(),this.geometry.dispose()}},kh;(e=>{function t(i){return Me.is(i)&&i instanceof kd}e.is=t})(kh||(kh={}));var Ia=(e,t)=>class extends mo(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Dr=e=>e instanceof ui,ys=e=>e!==null&&e instanceof hr,XS=e=>e instanceof Ur,Fh=e=>kn.is(e),za=class extends Kr(Gd){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}raycast(e,t){Zr(this.object,za.geometryHelper,e,t)}update(){}},Gh=class extends mo(Wn,za){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},Sd=class extends Kr(Vd){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Zr(this.object,Sd.geometryHelper,e,t)}},Ad=class extends Kr(Hd){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Zr(this.object,Ad.geometryHelper,e,t)}},Fn=class extends Kr(Wd){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Zr(this.object,Fn.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=Fn._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let s=0,o=this.cone.material.length;s<o;s++)this.cone.material[s].color.set(r);else this.cone.material.color.set(r)}}},Od=Fn;Od._vector=new T;function YS(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var KS=class extends Ia(yp,Sd){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let s=new Es(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Es&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&YS(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),i&&this.update()}},ZS=class extends Ia(bp,Ad){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let s=new T(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),o=new T(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),n=new Di(s,o),h=new Ts(n,new rt(16755200));h.visible=!1,this.gizmos.shadowmap=h,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Ts){let i=this.shadow.camera,r=new T(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new T(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,s),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Vh=new T,Hh=new T,Wh=new sc,QS=class extends Ia(xp,Od){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Ne.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let s=new Es(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Es&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),Hh.setFromMatrixPosition(this.matrixWorld),Wh.setFromRotationMatrix(this.matrixWorld),Vh.copy(this.up).applyQuaternion(Wh).negate().multiplyScalar(this.distance),this.target.position.copy(Hh).add(Vh),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},JS=class extends pi{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?Ca(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Cd=class extends pi{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var r;let e=this.data.geometry.extrusion.shape,t;if(e.type==="Custom"){let s=e.shapeId;if(s!==this._shapeId&&this.detachShape(),s){this._shapeId=s;let o=this._context.scene.find(s);o!=null&&o.data&&(o.attachedPaths.add(this),t=(r=o.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let s;switch(e.type){case"Rectangle":s=Tu;break;case"Ellipse":s=Sa;break;case"Polygon":s=Pu;break;case"Star":s=Eu;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=s.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(s=>s.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e){return super.updateTransformState(e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?Ca(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Rr=class extends mo(Wn,za){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=t.scene.data.objects.get(e.component);if(i){let r,s;for(let o of nr.rootOverrideProps)e[o]===void 0?(r===void 0&&(r={...e}),r[o]=i.data[o]):(s===void 0&&(s={}),s[o]=e[o]);return this.overrideData=s,r??e}return e}updateByOp(e,t,i,r){let s;if(this.isInstanceRoot&&!r&&(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component))for(let o of nr.rootOverrideProps)o in e.props&&e.props[o]===void 0&&(s===void 0&&(s={...e,props:{...e.props}}),s.props[o]=this.component.data[o]);super.updateByOp(s??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){this.component=e.scene.find(t.component)??null;let i=!1;if(this.component!==this.oldComponent){if(this.oldComponent){let r=0;for(let s of this.children)if(Me.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),Na(s),r+=1;else break;this.children.splice(0,r)}i=!0}this.component&&Pd(e,[this.uuid],t.overrides,this,this.component,this.component,0,i),this.oldComponent=this.component}}};function Na(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Me.is(i)&&Na(i)}}function qh(e,t,i,r){return e.component===t&&nu(e.identity,r)?e.overrideData===i?2:1:0}function Pd(e,t,i,r,s,o,n,h){if(n>50)return!1;if(r.component!==s){if(r.component){let c=r.component.instances.indexOf(r);c>=0&&r.component.instances.splice(c,1)}s.instances.push(r),r.component=s}s instanceof Rr&&s.isInstanceRoot&&s.expandInstanceChildren(e);let a=0;for(let c of s.children)if(Me.is(c)){let d=[...t,...typeof c.identity=="string"?[c.identity]:c.identity],l=Fs.resolve(i,d,1),u=null,p;if(!h){let f=r.children[a];if(u=Me.is(f)?f:null,u!==null){let g=qh(u,c,l,d);p=g>=1?u.stateSelection:void 0,g!==2&&(u=null)}if(u===null&&(u=e.scene.findInstance(d)??null,u!==null)){let g=qh(u,c,l,d);if(p=g>=1?u.stateSelection:void 0,g!==2)u=null;else{let v=u.parent.children.indexOf(u);u.parent.children.splice(v,1),r.children.splice(a,0,u),u.parent===r?v<=a&&console.error("not possible"):(u.parent=r,u.matrixWorldNeedsUpdate=!0,u.resetBBoxNeedsUpdate(),u.updateVisible(),e.pendingDeletes.delete(u))}}}if(u===null){let f=l?Oi.apply(c.data,l):c.data;Ei.is(f.type)&&(f={...f,type:"Empty"}),u=oi.createEntity(d,f,e),u.overrideData=l,r.add(u),r.children.splice(r.children.length-1,1),r.children.splice(a,0,u),u.updateState(u.data,e),p&&u.changeSelectedState(p,e),e.scene.registerInstanceAndSetUuid(u)}a+=1,Pd(e,t,i,u,c,o,n+1,h)}if(!h){let c=a;for(;;){let d=r.children[a];if(Me.is(d))e.pendingDeletes.add(d);else break;a+=1}r.children.splice(c,a-c)}return!0}function e2(e,t,i){let r;return t.geometry.type==="TextGeometry"?new yd(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Rn(e,t,i):t.geometry.type==="PathGeometry"?r=new Cd(e,t,i):t.geometry.type==="VectorGeometry"?r=new JS(e,t,i):t.geometry.type==="BooleanGeometry"?r=new hr(e,t,i):r=new pi(e,t,i),r)}function Ba(e,t,i){return t.type==="Mesh"?e2(e,t,i):t.type==="Empty"?new Gh(e,t):t.type==="PointLight"?new ZS(e,t,i):t.type==="SpotLight"?new QS(e,t,i):t.type==="DirectionalLight"?new KS(e,t,i):t.type==="Component"||t.type==="Instance"?new Rr(e,t,i):Ei.is(t.type)?new Ur(e,t):(console.error(t),new Gh(e,t))}oi.createEntity=Ba;function t2(e,t,i){let r=Ba(e.identity,t,i),s=e.children,o=e.attachedPaths,n=e.parent,h=e.component,a=e.instances,c=e.overrideData,d=e.uuid,l=e.stateSelection;e.dispose();for(let u of Object.keys(e))delete e[u];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let u of Object.keys(r))e[u]=r[u];e.children=[...e.children,...s],e.attachedPaths=o,e.parent=n,e.component=h,e.instances=a,e.uuid=d,e.overrideData=c,e.updateState(e.data,i),l&&e.changeSelectedState(l,i),e.resetBBoxNeedsUpdate()}oi.changeEntityProptotype=t2;oi.Cloner=_d;function i2(e,t,i,r){e.updateByOp(t,i,r,!1)}function $h(e,t){let i=!1,r=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,La(e),Da(e)),r.length===0&&s.length===0&&e.layers.set(0),i}function Xh(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission").filter(o=>o.data.visible),s=t.getLayersOfType("outline").filter(o=>o.data.visible);return r.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),i=!0),r.length===0&&s.length===0&&e.layers.set(0),i}function r2(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Yr)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)$h(i,i.material[r])&&(t=!0);else $h(i,i.material)&&(t=!0)}),t}function s2(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Yr)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Xh(i,i.material[r])&&(t=!0);else Xh(i,i.material)&&(t=!0)}),t}var o2=new Rd,n2=new me,a2=new Hn;function Yh(e,t,i,r=!1){let s=e.cloner;if(s)for(let o of s.children){let n=n2.copy(o.matrixWorld).invert(),h=a2.copy(t.ray).applyMatrix4(n),a=e.matrixWorld;h.applyMatrix4(a);let c=o2;c.set(h.origin,h.direction),c.near=t.near,c.far=t.far;let d=c.intersectObject(e,!1);d.length>0&&i.push({...d[0],object:r?o:e})}}var l2=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let s=[r,i],o=i;for(;this._constraints.has(o);)o=this._constraints.get(o),t.has(o)||s.push(o);for(let n=s.length-2;n>=0;n--)if(!t.has(s[n])){let h=e.find(s[n]);h?h.applyPathSnapping(e):console.warn(`missing entity ${s[n]}`),t.add(s[n])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},h2=new Jh;h2.wireframe=!0;var Kh=new T,Td=class extends qd{constructor(e,t){super(),this.data=e,this.backupFog=new $d(16777215,.1,2e3),this.fogUseBGColor=!1,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.bgColor=new Ot(1,1,1,1),this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new l2,this.needsRecomputeInstances=!1,this.ambientLight=new Xd(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.personalCamera=this.createPersonalCamera(),this.activeCamera=this.personalCamera,this.postprocessing=e.postprocessing,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=s2(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=r2(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let s=r;r=r.parent;let o=r.children.indexOf(s);i.splice(0,0,o)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>Ef(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let s=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);s.updateVisible(),s.resetBBoxNeedsUpdate(),Dr(s)&&ys(s.parent)&&(s.invalidateUpstreamBooleanData(),s.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(s),this.markToExpandCloner(s)}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let s=r.parent;this.markNeedsRecomputeInstancesForAncessors(s),this.markNeedsRecomputeInstancesForChildren(r),r.parent.remove(r),ys(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Dr(r)&&(r.freeBooleanPointer(),s instanceof hr&&s.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof Cd&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid)}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let s=r.parent;this.markNeedsRecomputeInstancesForAncessors(s),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let o=e.parent===null?this:this.find(e.parent);if(o===void 0)throw new Error("unexpected");o.add(r),this.markNeedsRecomputeInstancesForAncessors(o),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(),r.resetBBoxNeedsUpdate();let n=e.localIndex;o.children.splice(n,0,o.children.pop()),Dr(r)&&(r.invalidateUpstreamBooleanData(),ys(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():s instanceof hr&&s.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),t.path.includes("overrides")&&"states"in t.props){let{states:o,rest:n}=t.props;t={...t,props:n},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let s=this.find(e);if(s)try{i2(s,t,i,{scene:this,shared:r}),s instanceof pi&&s.updateGeometryGroupsIfNeeded()}catch(o){console.error(o)}}get enableFog(){return this.fog!==null}set enableFog(e){this.fog=e===!0?this.backupFog:null}init(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(at(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,e.publish.playCamera!==null){let i=this.find(e.publish.playCamera);i instanceof Ur&&this.switchActiveCamera(i)}this.expandInstances(t,!0),this.traverseEntity(i=>{ys(i)&&i.recomputeBoolean(),i instanceof Ur&&i.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Me.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Me.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,s,o,n){e&&e!==r.uuid&&r.find(e)&&s.forInstancesRec(h=>{h.isInstanceRoot||(h.data=Is(h.data,a=>{let c=a.events.data(n.id),d=h.goUp(o);if(d){let l=[...Dc(d.identity),e].join("-"),u=this.entityIdentityToEntity[l];if(u){let p=u.uuid;Rt.zoom(c,t)[i]=p}else console.warn("cannot find instance")}}).data)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Rr&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{r.data.type==="GameControl"?t.forInstancesRec(s=>{s.isInstanceRoot||(s.data=Is(s.data,o=>{o.events.delete(r.id)}).data)}):r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),r.data.inActions.forEach(s=>{s.data.type==="Transition"&&this.relativeizeInner(s.data.object,["inActions",s.id],"object",e,t,i,r)}),r.data.outActions.forEach(s=>{s.data.type==="Transition"&&this.relativeizeInner(s.data.object,["outActions",s.id],"object",e,t,i,r)})):"actions"in r.data&&r.data.actions.forEach(s=>{s.data.type==="Transition"&&this.relativeizeInner(s.data.object,["actions",s.id],"object",e,t,i,r)})})}),!0})}expandInstances(e,t){let i=new Set;this.traverseEntity(r=>{if(r instanceof Rr&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:i}),t||r.resetBBoxNeedsUpdate(),!0});for(let r of i)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),Na(r)}recomputeInstances(e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(t=>{t instanceof Rr&&t.isInstanceRoot&&(t.component=void 0)}),this.expandInstances(e,!1))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Me.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}createPersonalCamera(){let e=new Ur(Td.PERSONAL_CAMERA_ID,{...ks.defaultData,name:"Personal Camera"});return e.objectHelper.visible=!1,this.registerObjectCreatedInLegacy(e),e}raycast(e){let t=[],i=r=>{for(let s of r.children){let o=s.cloner;Me.is(s)&&!s.raycastLock&&(s.visible||o!=null&&o.object.data.visible)&&((Dr(s)||Fh(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),Yh(s,e,t)),i(s))}};return i(this),t}raycastWithClones(e){let t=[],i=r=>{for(let s of r.children){let o=s.cloner;Me.is(s)&&!s.raycastLock&&(s.visible||o!=null&&o.object.data.visible)&&((Dr(s)||Fh(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),Yh(s,e,t,!0)),i(s))}};return i(this),t}forEachEntity(e){for(let t of this.children)Me.is(t)&&e(t)}traverseEntity(e){for(let t of this.children)Me.is(t)&&t.traverseEntity(e)}traverseObject(e){for(let t of this.children)Ys.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Me.is(t)&&t.visible&&t.traverseVisibleEntity(e)}updateFog(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=at(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}dispose(){this.clearScene()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=at(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.groundColor!==void 0&&(this.ambientLight.groundColor=at(e.groundColor,t)),e.enabled!==void 0&&(this.ambientLight.visible=e.enabled)}switchActiveCamera(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}createChildrenObjects(e,t,i){let r=0;for(let s of e)this.createObject(s.id,s.data,s.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,s,o){var a;let n={scene:this,shared:o},h=Ba(e,t,n);return h&&(this.entityByUuid[e]=h,r.add(h),r.children.splice(s,0,r.children.pop()),i.length>0&&(h.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,h,o)),h.updateState(t,n),h instanceof pi&&h.updateGeometryGroupsIfNeeded(),h.updateVisible(),h.cloner&&this.toExpandCloner.add(h),(a=t.pathSnapping)!=null&&a.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),h}getCenter(e){let t=[];for(let r=0,s=e.length;r<s;++r){let{id:o,recursive:n}=e[r],h=this.find(o),a=n?h.recursiveBBox:h.singleBBox;t.push(...a.vertices)}let i=new Di;return i.setFromPoints(t),i.getCenter(Kh),Kh}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof ui)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof di&&e(t.material[i]);else t.material instanceof di&&e(t.material)})}updateCanvasSize(e,t){this.activeCamera.setViewplaneSize(e,t);let i,r;e>=t?(i=t/e,r=1):(i=1,r=e/t),this.traverseMaterial(s=>{s.getLayersOfType("transmission").forEach(o=>{o.uniforms[`f${o.id}_aspectRatio`].value.x=i,o.uniforms[`f${o.id}_aspectRatio`].value.y=r})})}},Gn=Td;Gn.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera",Gn.PERSONAL_CAMERA_EXPORT_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCameraExport";var li;function c2(){return li||(li=new Bp,li.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),li.decoderPending}async function u2(e){if(li){let t={attributeIDs:li.defaultAttributeIDs,attributeTypes:li.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await li.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,s])=>({name:r,itemSize:s.itemSize,array:s.array}))}}return null}async function d2(e,t){let[i,r]=gc(hn.deserialize(new Uint8Array(e)));Fx(i);let s=[];i.scene.objects.traverse((o,n)=>{n.type==="Mesh"&&n.geometry.type==="NonParametricGeometry"&&n.geometry.data.draco!==void 0&&s.push(n)}),s.length&&await c2();for(let o of s){let n=await u2($e(o.geometry.data.draco));if(n){n.index&&(o.geometry.data.index={array:n.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let h={};n.attributes.forEach(({name:a,array:c,itemSize:d})=>{h[a]={array:c,itemSize:d,type:"Float32Array",normalized:!1}}),o.geometry.data.attributes=h,o.geometry.data.draco=void 0}}return t&&t(i),r.result().data}function p2(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function f2(e){let t=new Set;return e.traverse(i=>{if(i instanceof Yr)if(Ct(i.material))i.material.forEach(r=>{let s=r;t.has(s)||t.add(s)});else{let r=i.material;t.has(r)||t.add(r)}}),t.forEach(i=>{if(i instanceof Array)return;let r=i.onBeforeCompile.bind(i);if(m2(i)){Object.assign(i,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new rt,specularColor:new rt});let s=0;i.onBeforeCompile=(o,n)=>{r&&r(o,n),o.uniforms=Object.assign({},_p.physical.uniforms,o.uniforms),i.getLayersOfType("transmission").forEach(h=>{if(o.uniforms.transmissionSamplerMap.value){let a=h.color;a&&(a.transmissionSamplerMap.value=o.uniforms.transmissionSamplerMap.value,a.transmissionSamplerSize.value=o.uniforms.transmissionSamplerSize.value)}else s++,s<2&&(i.needsUpdate=!0)})}}else g2(i)||(i.onBeforeCompile=(s,o)=>{r&&r(s,o),i.transparent=!1})}),e}function m2(e){return e.getLayersOfType("transmission").length>0}function g2(e){let t=0;return e.layers.forEach(i=>{if(i.type!=="light"&&i.type!=="fresnel"){let r=i.uniforms["f"+i.id+"_alpha"];r&&(t+=(1-t)*r.value)}}),t<1}function v2(e){return e.traverse(t=>{if(t.type==="Camera"){let i=t;i.type=i.cameraType}}),e}function y2(e){let t=[],i=(r,s=0)=>{let o=s>0?r+s:r;return t.includes(o)?i(r,s+1):o};return e.traverse(r=>{if(t.includes(r.name)){let s=r.name,o=i(r.name);if(r.name=o,r.isMesh){let n=r;n.material instanceof Array?n.material.forEach(h=>{h.name=h.name.replace(s,o)}):n.material.isAsset||(n.material.name=n.material.name.replace(s,o))}}t.push(r.name)}),e}function b2(e){let t=[];return e.traverse(i=>{i instanceof _d&&t.push(i)}),t.forEach(i=>{let r=i.object,s=i.children.map(n=>{n.updateMatrix();let h=n.geometry.clone().applyMatrix4(n.matrix);return n.matrix.determinant()<0&&p2(h),h}),o=lc(i.parameters.hideBase?s:[r instanceof ui?r.geometry:[],...s]);r instanceof ui&&(r.geometry=o),i.removeFromParent(),r.setFromClonerState(null,{scene:e,shared:AS})}),e}function x2(e){return e.traverse(t=>{t.matrixAutoUpdate=!0}),e}function w2(e){Object.values(e.shared.materials).forEach(t=>{en(t)}),e.scene.objects.traverse((t,i)=>{"material"in i?en(i.material):"materials"in i&&i.materials.forEach(r=>{en(r)})})}function en(e){if(typeof e=="string")return;let t=[];e.layers.forEach((i,r)=>{i.type==="outline"&&t.push(r)}),t.reverse().forEach(i=>{e.layers.delete(i)}),t.length&&console.warn("The Spline Loader currently does not support the outline layer.")}var _2=to(Xp(),1),Zh="The SplineLoader only accepts .splinecode files that are generated from Spline export panel.",S2=class extends Qh{load(e,t,i,r=console.error){let s=new tn(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),e.endsWith(".spline")?console.warn(Zh+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(Zh),s.load(e,async o=>{try{if(typeof o=="string")throw new Error("The .spline file is not binary!");let n=await this.parse(o);t(n)}catch(n){r(n)}},i,r)}async parse(e){let t=await d2(e,w2);t.version&&(0,_2.default)(t.version,"0.9.311")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/loader to the latest version."),await Promise.all([PS(t)&&p_(),FS(t)&&fS()].filter(Boolean));let i=new Ma(t.shared);Object.values(i.getMaterials()).forEach(o=>Object.assign(o,{isAsset:!0}));let r=new Gn(t.scene,i);r.remove(r.personalCamera),t.scene.environment.ambientLight.enabled||r.remove(r.ambientLight);let s=t.scene.publish.playCamera;if(s){let o=r.find(s);o&&XS(o)&&Object.assign(o,{makeDefault:!0})}return r=b2(r),r=f2(r),r=v2(r),r=y2(r),r=x2(r),r}};const A2=new Cp,O2=Mp();class L2{constructor(t,i){Zt(this,"camera");Zt(this,"scene");Zt(this,"renderer");Zt(this,"cube");Zt(this,"animationFrame");Zt(this,"control");Zt(this,"reactiveData");this.reactiveData=i,this.camera=Pp(t),this.scene=Tp(),this.scene.background=new rt("rgb(255,200,160)"),this.renderer=Ep(t.clientWidth,t.clientHeight),t.append(this.renderer.domElement),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Ap,this.renderer.setClearAlpha(1),this.addControl(),this.loadSpline().then(r=>{r.rotation.z+=50,r.rotation.y+=200,r.scale.set(1.2,1.2,1.2),this.scene.add(r),this.scene.background=new rt("rgb(255,200,160)")}),Dp(()=>O2.menu,()=>{Lp(()=>{Fa(this,t)})})}addControl(){this.control=zp(this.camera,this.renderer.domElement),this.control.enableDamping=!0,this.control.dampingFactor=.125}loadSpline(){return new Promise((t,i)=>{const r=new S2,s=this.reactiveData.splineSceneUrl;r.load(s,o=>{console.log(o),t(o)},o=>{if(o.lengthComputable){const{total:n,loaded:h}=o,a=h/n*100;this.reactiveData.percent=Number(a.toFixed(2)),n>h?console.log("加载中"):console.log("加载完毕")}},o=>{i(new Error("An error happened"))})})}animate(){const t=A2.getDelta(),i=Ne.degToRad(30)*t;this.cube&&(this.cube.rotation.x+=i,this.cube.rotation.y+=i,this.cube.rotation.z+=i)}render(t){var i;if((i=this.control)==null||i.update(),this.animate(),Fa(this,t),t.getBoundingClientRect().width>0)this.animationFrame=requestAnimationFrame(this.render.bind(this,t));else return}stop(){if(this.animationFrame)cancelAnimationFrame(this.animationFrame);else return}beforeDestroy(){this.scene.traverse(t=>{C2(t)}),Op.clear(),this.scene.clear(),this.renderer.dispose(),this.renderer.forceContextLoss()}}const C2=e=>{var t,i,r,s;e instanceof nc&&((t=e.geometry)!=null&&t.dispose&&e.geometry.dispose(),(i=e.material)!=null&&i.dispose&&e.material.dispose(),(s=(r=e.material)==null?void 0:r.texture)!=null&&s.dispose&&e.material.texture.dispose()),e instanceof Wn&&e.clear(),e instanceof Ti&&e.clear()};export{L2 as S,zp as c};
