import{d as C,r as v,b as M,A as O,l as S,e as P,o as $,c as D,a as p,f as k,w as N,s as U,L as V,M as b,N as W}from"./index-27e8f055.js";import{E as j}from"./el-input-number-9b9ae2f6.js";import{m as A}from"./ml5.min-a6c0a32a.js";import"./p5-1003a71f.js";const B={class:"fixed w-1/2 flex right-0 top-10 items-center"},H=p("span",null,"SCORE",-1),I=["src"],L=C({__name:"index",setup(T){const u=v(null),i=v(null),r=v(null),h=v(.1),w=v(0),E=v("/vue3_tauri_fun/"),t=M({leftOn:!1,rightOn:!1,surrender:!1,nosePos:{x:0,y:0}});O(()=>t.leftOn,()=>{x()},{deep:!0});const x=()=>{(t.leftOn||t.rightOn)&&b.success(`你举起了${t.leftOn?"左":"右"}手`),t.leftOn&&t.rightOn&&b.success("投降")};O(()=>t.rightOn,()=>{x()},{deep:!0});const m=()=>{t.surrender=!1,t.leftOn&&t.rightOn&&(t.surrender=!0)};return S(()=>{cancelAnimationFrame(w.value)}),P(()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(d){i.value&&(i.value.srcObject=d,i.value.play())}),u.value&&i.value){let d=function(){i.value&&r.value&&u.value&&(u.value.width=r.value.clientWidth,u.value.height=r.value.clientHeight,i.value.width=r.value.clientWidth,i.value.height=r.value.clientHeight,e=u.value.getContext("2d"),e&&(e.drawImage(i.value,0,0,r.value.clientWidth,r.value.clientHeight),g(),_())),w.value=requestAnimationFrame(d)},g=function(){if(e&&s.length>0)for(let l=0;l<1;l+=1){let n=0;for(let c=0;c<s[l].pose.keypoints.length;c+=1){let a=s[l].pose.keypoints[c];if(a.score>h.value){let{x:f,y:o}=a.position;e.beginPath(),e.arc(f,o,10,0,2*Math.PI),a.part.includes("Eye")?e.fillStyle=`rgba(${f*100%255},${o*100%255},${f*100%255},${f%1})`:a.part.includes("nose")?(e.fillStyle="blue",n=o,t.nosePos={x:f,y:o}):e.fillStyle="white",a.part.includes("leftWrist")&&(o<n+50?(t.leftOn=!0,m()):o>n-50&&(t.leftOn=!1,m())),a.part.includes("rightWrist")&&(o<n+50?(t.rightOn=!0,m()):o>n-50&&(t.rightOn=!1,m())),e.fill(),e.fillText(a.part,f-10,o-10),e.stroke()}}}},_=function(){if(e)for(let l=0;l<s.length;l+=1)for(let n=0;n<s[l].skeleton.length;n+=1){let c=s[l].skeleton[n][0],a=s[l].skeleton[n][1];e.beginPath(),e.moveTo(c.position.x,c.position.y),e.lineTo(a.position.x,a.position.y),e.stroke()}},e=u.value.getContext("2d"),s=[];d();const y=A.poseNet(i.value,()=>{y.multiPose(i.value)});y.on("pose",l=>{s=l})}}),(d,g)=>{const _=j,e=W;return $(),D("div",{class:"view",ref_key:"view",ref:r},[p("canvas",{ref_key:"canvas",ref:u},null,512),p("video",{ref_key:"video",ref:i,class:"hidden"},null,512),p("div",B,[H,k(e,{content:"举起手来(以鼻子为基准,当前镜头最好只有一人)",visible:h.value===.1,effect:"customized"},{default:N(()=>[k(_,{min:.1,max:1,step:.01,modelValue:h.value,"onUpdate:modelValue":g[0]||(g[0]=s=>h.value=s)},null,8,["min","step","modelValue"])]),_:1},8,["visible"])]),U(p("img",{src:`${E.value}imgs/splash/white-flag.jpg`,class:"img w-1/2 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",alt:""},null,8,I),[[V,t.surrender]])],512)}}});export{L as default};
